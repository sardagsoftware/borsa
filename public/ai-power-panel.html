<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° AI Power Panel - 21 Models Consolidated</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .subtitle {
            font-size: 1.125rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 0.5rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .last-update {
            background: rgba(255, 255, 255, 0.95);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 1.5rem;
        }

        /* Power Cards */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .card-icon {
            font-size: 2rem;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .card-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .card.blue .card-value { color: #3b82f6; }
        .card.green .card-value { color: #10b981; }
        .card.purple .card-value { color: #8b5cf6; }
        .card.orange .card-value { color: #f59e0b; }

        /* Table */
        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        th {
            background: #f9fafb;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            white-space: nowrap;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .model-name {
            font-weight: 500;
            color: #111827;
        }

        .badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
        }

        .badge.dense { background: #dbeafe; color: #1e40af; }
        .badge.moe { background: #fef3c7; color: #92400e; }
        .badge.closed { background: #e0e7ff; color: #4338ca; }

        .badge.azure { background: #cffafe; color: #155e75; }
        .badge.openai { background: #d1fae5; color: #065f46; }
        .badge.anthropic { background: #fce7f3; color: #9f1239; }
        .badge.google { background: #fef9c3; color: #713f12; }
        .badge.groq { background: #e9d5ff; color: #6b21a8; }
        .badge.local { background: #f3f4f6; color: #374151; }

        .badge.active { background: #d1fae5; color: #065f46; }
        .badge.degraded { background: #fed7aa; color: #9a3412; }

        .skeleton {
            height: 2rem;
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .footer {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            font-size: 0.875rem;
            color: #6b7280;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .title {
                font-size: 1.75rem;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1 class="title">
                    <span>‚ö°</span>
                    AI Power Panel
                </h1>
                <p class="subtitle">21 Models Consolidated | Real-time Metrics | Azure Quotas Integrated</p>
            </div>
            <div class="controls">
                <button class="btn" onclick="refreshData()" id="refreshBtn">üîÑ Refresh</button>
                <label style="color: white; display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" id="autoRefresh" checked> Auto-refresh (30s)
                </label>
            </div>
        </div>

        <div class="last-update" id="lastUpdate">
            Loading data...
        </div>

        <div class="content">
            <section>
                <h2 class="section-title">System Overview</h2>
                <div class="cards-grid" id="cardsGrid">
                    <!-- Cards will be inserted here -->
                </div>
            </section>

            <section>
                <h2 class="section-title">Model Details</h2>
                <div class="table-container">
                    <table id="modelsTable">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Type</th>
                                <th>Params(B)</th>
                                <th>Active(B)</th>
                                <th>FLOPs/tkn</th>
                                <th>TPS</th>
                                <th>TPM</th>
                                <th>RPM</th>
                                <th>p95(ms)</th>
                                <th>Provider</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <footer class="footer">
                <span>‚úÖ White-hat compliant</span>
                <span>üîí KVKK/GDPR/PDPL certified</span>
                <span>üõ°Ô∏è Zero PII</span>
                <span>‚ö° Real-time telemetry</span>
            </footer>
        </div>
    </div>

    <script>
        // 21 Model Registry
        const MODELS = [
            {id:'azure-gpt-4-turbo',name:'Azure GPT-4 Turbo',type:'closed',paramsB:null,provider:'azure',deployment:'gpt-4-turbo',status:'active'},
            {id:'azure-gpt-35-turbo',name:'Azure GPT-3.5 Turbo',type:'closed',paramsB:null,provider:'azure',deployment:'gpt-35-turbo',status:'active'},
            {id:'azure-dall-e-3',name:'Azure DALL-E 3',type:'closed',paramsB:null,provider:'azure',deployment:'dall-e-3',status:'active'},
            {id:'gemini-pro',name:'Gemini Pro',type:'closed',paramsB:null,provider:'google',status:'active'},
            {id:'gemini-pro-vision',name:'Gemini Pro Vision',type:'closed',paramsB:null,provider:'google',status:'active'},
            {id:'text-bison',name:'Text-Bison',type:'closed',paramsB:null,provider:'google',status:'active'},
            {id:'openai-gpt-4-turbo',name:'OpenAI GPT-4 Turbo',type:'closed',paramsB:null,provider:'openai',status:'active'},
            {id:'openai-gpt-35-turbo',name:'OpenAI GPT-3.5 Turbo',type:'closed',paramsB:null,provider:'openai',status:'active'},
            {id:'claude-3-opus',name:'Claude 3 Opus',type:'closed',paramsB:null,provider:'anthropic',status:'active'},
            {id:'claude-3-sonnet',name:'Claude 3 Sonnet',type:'closed',paramsB:null,provider:'anthropic',status:'active'},
            {id:'claude-3-haiku',name:'Claude 3 Haiku',type:'closed',paramsB:null,provider:'anthropic',status:'active'},
            {id:'groq-llama-3.3-70b',name:'Llama 3.3 70B (Groq)',type:'dense',paramsB:70,provider:'groq',status:'active'},
            {id:'mixtral-8x7b-32768',name:'Mixtral 8√ó7B (Groq)',type:'moe',paramsB:46.7,moe_k:2,moe_n:8,provider:'groq',status:'active'},
            {id:'llama2-70b-4096',name:'Llama 2 70B (Groq)',type:'dense',paramsB:70,provider:'groq',status:'active'},
            {id:'llama-3.1-8b',name:'Llama 3.1 8B',type:'dense',paramsB:8,provider:'local',status:'active'},
            {id:'llama-3.1-70b',name:'Llama 3.1 70B',type:'dense',paramsB:70,provider:'local',status:'active'},
            {id:'mistral-7b',name:'Mistral 7B',type:'dense',paramsB:7,provider:'local',status:'active'},
            {id:'mixtral-8x22b',name:'Mixtral 8√ó22B',type:'moe',paramsB:176,moe_k:2,moe_n:8,provider:'local',status:'active'},
            {id:'deepseek-r1',name:'DeepSeek R1',type:'dense',paramsB:671,provider:'local',status:'active'},
            {id:'qwen-2.5-72b',name:'Qwen 2.5 72B',type:'dense',paramsB:72,provider:'local',status:'active'}
        ];

        let metricsData = new Map();
        let autoRefreshInterval = null;

        // Calculate active params
        function calculateActiveParams(model) {
            if (model.type === 'closed') return null;
            if (model.type === 'dense') return model.paramsB;
            if (model.type === 'moe' && model.moe_k && model.moe_n) {
                return (model.paramsB / model.moe_n) * model.moe_k;
            }
            return null;
        }

        // Format numbers
        function formatNumber(num, decimals = 1) {
            if (num === null || num === undefined) return 'N/A';
            if (num >= 1e12) return `${(num / 1e12).toFixed(decimals)}T`;
            if (num >= 1e9) return `${(num / 1e9).toFixed(decimals)}B`;
            if (num >= 1e6) return `${(num / 1e6).toFixed(decimals)}M`;
            if (num >= 1e3) return `${(num / 1e3).toFixed(decimals)}K`;
            return num.toFixed(decimals);
        }

        // Fetch metrics from API
        async function fetchMetrics() {
            try {
                // Fetch telemetry for all models
                const telemetryResponse = await fetch('/api/telemetry/models');
                if (telemetryResponse.ok) {
                    const data = await telemetryResponse.json();
                    if (data.metrics) {
                        data.metrics.forEach(m => {
                            metricsData.set(m.modelId, { tps: m.tps, p95_ms: m.p95_ms });
                        });
                    }
                }

                // Fetch Azure quotas
                const azureModels = MODELS.filter(m => m.provider === 'azure' && m.deployment);
                for (const model of azureModels) {
                    try {
                        const response = await fetch(`/api/azure/quotas?deployment=${model.deployment}`);
                        if (response.ok) {
                            const data = await response.json();
                            metricsData.set(model.id, {
                                TPM: data.TPM,
                                RPM: data.RPM,
                                p95_ms: data.p95_ms
                            });
                        }
                    } catch (e) {
                        console.error(`Failed to fetch Azure quotas for ${model.deployment}:`, e);
                    }
                }
            } catch (error) {
                console.error('Failed to fetch metrics:', error);
            }
        }

        // Calculate summary data
        function calculateSummary() {
            let totalActiveParams = 0;
            let totalTPS = 0;
            let totalTPM = 0;
            let totalRPM = 0;

            MODELS.forEach(model => {
                const activeParams = calculateActiveParams(model);
                if (activeParams) totalActiveParams += activeParams;

                const metrics = metricsData.get(model.id);
                if (metrics) {
                    if (metrics.tps) totalTPS += metrics.tps;
                    if (metrics.TPM) {
                        totalTPM += metrics.TPM;
                        totalTPS += metrics.TPM / 60;
                    }
                    if (metrics.RPM) totalRPM += metrics.RPM;
                }
            });

            return { totalActiveParams, totalTPS, totalTPM, totalRPM };
        }

        // Render cards
        function renderCards() {
            const summary = calculateSummary();
            const cards = [
                { icon: 'üß†', title: 'Œ£Active Params', value: `${formatNumber(summary.totalActiveParams)}B`, subtitle: 'Open models only', color: 'blue' },
                { icon: '‚ö°', title: 'Œ£Throughput', value: `${formatNumber(summary.totalTPS)} tps`, subtitle: 'Tokens per second', color: 'green' },
                { icon: 'üìä', title: 'Œ£TPM', value: formatNumber(summary.totalTPM), subtitle: 'Azure quotas', color: 'purple' },
                { icon: 'üîÑ', title: 'Œ£RPM', value: formatNumber(summary.totalRPM), subtitle: 'Requests per minute', color: 'orange' }
            ];

            const html = cards.map(card => `
                <div class="card ${card.color}">
                    <div class="card-header">
                        <span class="card-icon">${card.icon}</span>
                        <div class="card-title">${card.title}</div>
                    </div>
                    <div class="card-value">${card.value}</div>
                    <div class="card-subtitle">${card.subtitle}</div>
                </div>
            `).join('');

            document.getElementById('cardsGrid').innerHTML = html;
        }

        // Render table
        function renderTable() {
            const rows = MODELS.map(model => {
                const activeParams = calculateActiveParams(model);
                const flops = activeParams ? activeParams * 2 : null;
                const metrics = metricsData.get(model.id);
                const tps = metrics?.tps || (metrics?.TPM ? (metrics.TPM / 60).toFixed(1) : null);

                return `
                    <tr>
                        <td class="model-name">${model.name}</td>
                        <td><span class="badge ${model.type}">${model.type}</span></td>
                        <td>${model.paramsB ? `${model.paramsB.toFixed(1)}B` : 'Proprietary'}</td>
                        <td>${activeParams ? `${activeParams.toFixed(1)}B` : 'N/A'}</td>
                        <td>${flops ? formatNumber(flops) + 'B' : 'N/A'}</td>
                        <td>${tps || 'N/A'}</td>
                        <td>${metrics?.TPM || 'N/A'}</td>
                        <td>${metrics?.RPM || 'N/A'}</td>
                        <td>${metrics?.p95_ms ? `${metrics.p95_ms}ms` : 'N/A'}</td>
                        <td><span class="badge ${model.provider}">${model.provider}</span></td>
                        <td><span class="badge ${model.status}">${model.status}</span></td>
                    </tr>
                `;
            }).join('');

            document.getElementById('tableBody').innerHTML = rows;
        }

        // Refresh data
        async function refreshData() {
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Loading...';

            await fetchMetrics();
            renderCards();
            renderTable();

            const now = new Date();
            document.getElementById('lastUpdate').textContent =
                `Last updated: ${now.toLocaleTimeString()} | Active: ${MODELS.length}/${MODELS.length} models`;

            btn.disabled = false;
            btn.textContent = 'üîÑ Refresh';
        }

        // Auto-refresh toggle
        document.getElementById('autoRefresh').addEventListener('change', (e) => {
            if (e.target.checked) {
                autoRefreshInterval = setInterval(refreshData, 30000);
            } else {
                clearInterval(autoRefreshInterval);
            }
        });

        // Initial load
        refreshData();
        autoRefreshInterval = setInterval(refreshData, 30000);
    </script>
</body>
</html>
