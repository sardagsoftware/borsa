<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Dashboard - LyDian Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* ============================================================
           MEDICAL EXPERT AI - CSS CUSTOM PROPERTIES
           ============================================================ */
        :root {
            /* Premium Hospital-Grade Color System */
            --bg-0: #F8F9FA;
            --bg-1: #FFFFFF;
            --glass: rgba(11, 83, 148, 0.05);
            --glass-2: rgba(11, 83, 148, 0.03);
            --stroke: #E4E6EB;
            --txt-1: #212529;
            --txt-2: #495057;
            --accent-1: #27AE60;  /* Medical green */
            --accent-2: #0B5394;  /* Clinical blue */
            --accent-3: #8E44AD;  /* Purple */
            --warning: #F39C12;   /* Amber warning */
            --medical-success: #27AE60;
            --medical-error: #E74C3C;

            /* Professional Medical Gradients */
            --gradient-medical: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(11, 83, 148, 0.1));
            --gradient-success: linear-gradient(135deg, #27AE60, #0B5394);
            --gradient-accent: linear-gradient(135deg, var(--accent-1), var(--accent-2));

            /* Background System */
            --bg-primary: var(--bg-1);
            --bg-secondary: var(--bg-0);
            --bg-tertiary: var(--glass);
            --bg-hover: rgba(11, 83, 148, 0.05);

            /* Text Colors */
            --text-primary: var(--txt-1);
            --text-secondary: var(--txt-2);
            --text-tertiary: #6C757D;
            --text-inverse: #FFFFFF;

            /* Professional Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-base: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            --shadow-medical: 0 8px 24px rgba(39, 174, 96, 0.15);
            --shadow-hover: 0 12px 32px rgba(11, 83, 148, 0.15);

            /* Borders */
            --border-light: 1px solid var(--stroke);
            --border-medium: 1px solid #CED4DA;
            --border-medical: 1px solid var(--accent-1);
            --border-dark: 1px solid #ADB5BD;
        }

        /* ============================================================
           MEDICAL EXPERT AI - KEYFRAME ANIMATIONS
           ============================================================ */
        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes typingDot {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-12px);
                opacity: 1;
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            10%, 30% { transform: scale(0.9); }
            20%, 40% { transform: scale(1.1); }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            color: #1a1a1a;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: #ffffff;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: #000000;
            margin-bottom: 0.5rem;
        }

        .sidebar-subtitle {
            font-size: 0.85rem;
            color: #666666;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            padding: 0.5rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #999999;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            color: #4a4a4a;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: #f8f8f8;
            color: #000000;
        }

        .nav-item.active {
            background: #000000;
            color: #ffffff;
            border-left-color: #000000;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Header */
        .dashboard-header {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid #e0e0e0;
        }

        .dashboard-header h1 {
            font-size: 2rem;
            font-weight: 800;
            color: #000000;
            margin-bottom: 0.5rem;
        }

        .dashboard-header p {
            color: #666666;
            font-size: 1rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #000000;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #333333;
        }

        .btn-secondary {
            background: #f8f8f8;
            color: #000000;
            border: 1px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #000000;
            margin-bottom: 0.5rem;
        }

        .stat-change {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .stat-change.positive {
            color: #00aa00;
        }

        .stat-change.negative {
            color: #cc0000;
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Card */
        .card {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #000000;
        }

        .card-action {
            color: #000000;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: #f8f8f8;
        }

        .data-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #4a4a4a;
            border-bottom: 2px solid #e0e0e0;
            font-size: 0.9rem;
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            color: #4a4a4a;
        }

        .data-table tr:hover {
            background: #fafafa;
        }

        /* Status Badge */
        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.operational {
            background: #e6ffe6;
            color: #006600;
        }

        .status-badge.warning {
            background: #fff4e6;
            color: #cc6600;
        }

        .status-badge.error {
            background: #ffe6e6;
            color: #cc0000;
        }

        /* Activity Feed */
        .activity-item {
            padding: 1rem 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            gap: 1rem;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            background: #f8f8f8;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-weight: 700;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: #000000;
            margin-bottom: 0.25rem;
        }

        .activity-meta {
            font-size: 0.85rem;
            color: #999999;
        }

        /* Charts Placeholder */
        .chart-container {
            width: 100%;
            height: 300px;
            background: #f8f8f8;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999999;
            font-weight: 600;
        }

        /* Login Section */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
        }

        .login-card {
            background: #ffffff;
            padding: 3rem;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            width: 100%;
            max-width: 400px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-logo {
            font-size: 2rem;
            font-weight: 800;
            color: #000000;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: #666666;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #4a4a4a;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #000000;
        }

        .btn-login {
            width: 100%;
            padding: 1rem;
            background: #000000;
            color: #ffffff;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-login:hover {
            background: #333333;
        }

        .error-message {
            background: #ffe6e6;
            color: #cc0000;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            display: none;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Hidden by default */
        .hidden {
            display: none;
        }

        /* Section Styles */
        .dashboard-section {
            display: block;
        }

        .dashboard-section.hidden {
            display: none;
        }

        /* Chart Styles */
        .chart-wrapper {
            position: relative;
            height: 350px;
            margin-bottom: 1rem;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Table Actions */
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .table-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .filter-input {
            padding: 0.5rem 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* Loading State */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #000000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: #666666;
            gap: 1rem;
        }

        /* API Endpoint Card */
        .endpoint-card {
            background: #f8f8f8;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #000000;
        }

        .endpoint-method {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-right: 0.5rem;
        }

        .method-get { background: #e6f7ff; color: #0066cc; }
        .method-post { background: #e6ffe6; color: #006600; }
        .method-put { background: #fff4e6; color: #cc6600; }
        .method-delete { background: #ffe6e6; color: #cc0000; }

        /* Settings Form */
        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-section h3 {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #000000;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #000000;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Log Entry */
        .log-entry {
            padding: 0.75rem;
            border-bottom: 1px solid #f0f0f0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .log-entry.error { color: #cc0000; }
        .log-entry.warning { color: #cc6600; }
        .log-entry.info { color: #0066cc; }
        .log-entry.success { color: #006600; }

        /* WebSocket Connection Indicator */
        .ws-status-indicator {
            position: absolute;
            top: 2rem;
            right: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .ws-status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #cccccc;
            animation: pulse 2s infinite;
        }

        .ws-status-dot.connected {
            background: #00aa00;
        }

        .ws-status-dot.connecting {
            background: #ff9900;
        }

        .ws-status-dot.disconnected {
            background: #cc0000;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* AI Insights Panel */
        .ai-insights-panel {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            margin-bottom: 2rem;
        }

        .insight-card {
            background: #f8f8f8;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #000000;
        }

        .insight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .insight-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: #000000;
        }

        .priority-badge {
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-badge.critical {
            background: #ffe6e6;
            color: #cc0000;
        }

        .priority-badge.high {
            background: #fff4e6;
            color: #cc6600;
        }

        .priority-badge.medium {
            background: #fff9e6;
            color: #996600;
        }

        .priority-badge.low {
            background: #f0f0f0;
            color: #666666;
        }

        .insight-description {
            color: #4a4a4a;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .insight-recommendations {
            background: #ffffff;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }

        .insight-recommendations h4 {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #000000;
        }

        .insight-recommendations ul {
            margin: 0;
            padding-left: 1.5rem;
        }

        .insight-recommendations li {
            color: #4a4a4a;
            margin-bottom: 0.25rem;
        }

        .confidence-score {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: #666666;
        }

        .confidence-bar {
            flex: 1;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: #000000;
            transition: width 0.3s ease;
        }

        /* Export PDF Button */
        .export-pdf-btn {
            padding: 0.5rem 1rem;
            background: #000000;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .export-pdf-btn:hover {
            background: #333333;
        }

        .export-pdf-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: #000000;
            color: #ffffff;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        .toast-notification.success {
            background: #006600;
        }

        .toast-notification.error {
            background: #cc0000;
        }

        .toast-notification.warning {
            background: #cc6600;
        }

        .toast-notification.info {
            background: #0066cc;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-close {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            margin-left: auto;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-content {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
        }

        /* Email Settings Section */
        .email-settings {
            background: #f8f8f8;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .email-settings h4 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #000000;
        }

        /* ============================================================
           MEDICAL EXPERT AI - CHAT INTERFACE STYLES
           ============================================================ */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 200px);
            background: var(--bg-primary);
            border-radius: 12px;
            border: var(--border-light);
            overflow: hidden;
        }

        .chat-header {
            padding: 1.5rem;
            background: var(--gradient-medical);
            border-bottom: var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: #fafafa;
        }

        .message {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            animation: messageAppear 0.3s ease;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-success);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #000000;
        }

        .message-content {
            flex: 1;
            max-width: 70%;
        }

        .message-bubble {
            background: var(--bg-primary);
            padding: 1rem 1.25rem;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .message.user .message-bubble {
            background: #000000;
            color: #ffffff;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-top: 0.5rem;
            padding: 0 0.25rem;
        }

        .typing-indicator {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-2);
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        .chat-input-area {
            padding: 1.5rem;
            background: var(--bg-primary);
            border-top: var(--border-light);
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: nowrap;
        }

        @media (max-width: 768px) {
            .chat-input-area {
                padding: 1rem;
                gap: 0.75rem;
            }
        }

        @media (min-width: 1200px) {
            .chat-input-area {
                padding: 1.75rem 2rem;
                gap: 1.25rem;
            }
        }

        .chat-input {
            flex: 1;
            padding: 0.875rem 1.25rem;
            border: var(--border-medium);
            border-radius: 24px;
            font-size: 1rem;
            resize: none;
            max-height: 120px;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-2);
            box-shadow: 0 0 0 3px rgba(11, 83, 148, 0.1);
        }

        .chat-send-btn {
            min-width: 48px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-success);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
            padding: 0;
        }

        .chat-send-btn svg {
            width: 24px;
            height: 24px;
            stroke-width: 2.5;
        }

        .chat-send-btn:hover {
            box-shadow: var(--shadow-medical);
            transform: scale(1.05);
        }

        .chat-send-btn:active {
            transform: scale(0.95);
        }

        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: scale(1);
        }

        /* Responsive chat button */
        @media (max-width: 768px) {
            .chat-send-btn {
                min-width: 44px;
                width: 44px;
                height: 44px;
            }

            .chat-send-btn svg {
                width: 20px;
                height: 20px;
            }
        }

        @media (min-width: 1200px) {
            .chat-send-btn {
                min-width: 52px;
                width: 52px;
                height: 52px;
            }

            .chat-send-btn svg {
                width: 26px;
                height: 26px;
            }
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-tertiary);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        /* ============================================================
           MEDICAL CALCULATORS STYLES
           ============================================================ */
        .calculator-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .calculator-tab {
            padding: 0.75rem 1.5rem;
            background: #f8f8f8;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .calculator-tab.active {
            background: var(--gradient-success);
            color: white;
            border-color: var(--accent-1);
        }

        .calculator-content {
            display: none;
            animation: fadeInScale 0.3s ease;
        }

        .calculator-content.active {
            display: block;
        }

        .calculator-card {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 12px;
            border: var(--border-light);
            margin-bottom: 1.5rem;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .calculator-input-group {
            margin-bottom: 1rem;
        }

        .calculator-input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .calculator-input {
            width: 100%;
            padding: 0.75rem;
            border: var(--border-medium);
            border-radius: 8px;
            font-size: 1rem;
        }

        .calculator-input:focus {
            outline: none;
            border-color: var(--accent-2);
        }

        .calculator-btn {
            width: 100%;
            padding: 1rem;
            background: var(--gradient-success);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calculator-btn:hover {
            box-shadow: var(--shadow-medical);
            transform: translateY(-2px);
        }

        .calculator-result {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 4px solid var(--accent-1);
            display: none;
        }

        .calculator-result.show {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        .calculator-result.error {
            background: #FEF2F2;
            border-left-color: var(--medical-error);
        }

        /* ============================================================
           EMERGENCY TOOLS STYLES
           ============================================================ */
        .emergency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .emergency-card {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 12px;
            border: var(--border-light);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .emergency-card:hover {
            box-shadow: var(--shadow-medical);
            transform: translateY(-4px);
        }

        .emergency-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent-2);
            margin-bottom: 0.5rem;
        }

        .emergency-label {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* ============================================================
           SPECIALTIES SECTION STYLES
           ============================================================ */
        .specialties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .specialty-card {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 12px;
            border: var(--border-light);
            transition: all 0.3s ease;
        }

        .specialty-card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-4px);
        }

        .specialty-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient-medical);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .specialty-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .specialty-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* ============================================================
           MEDICAL IMAGING STYLES
           ============================================================ */
        .upload-zone {
            border: 2px dashed var(--stroke);
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }

        .upload-zone:hover {
            border-color: var(--accent-2);
            background: var(--bg-hover);
        }

        .upload-zone.dragging {
            border-color: var(--accent-1);
            background: var(--gradient-medical);
        }

        /* ============================================================
           VOICE NOTES STYLES
           ============================================================ */
        .voice-recorder {
            background: var(--bg-primary);
            padding: 3rem;
            border-radius: 12px;
            border: var(--border-light);
            text-align: center;
        }

        .record-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--medical-error);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        .record-btn:hover {
            box-shadow: 0 0 30px rgba(231, 76, 60, 0.5);
            transform: scale(1.1);
        }

        .record-btn.recording {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">Medical Dashboard</div>
                <div class="login-subtitle">LyDian Enterprise Platform</div>
            </div>

            <div id="errorMessage" class="error-message"></div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="emailInput" required
                           placeholder="admin@lydian.medical">
                </div>

                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="passwordInput" required
                           placeholder="Enter your password">
                </div>

                <button type="submit" class="btn-login">Login to Dashboard</button>
            </form>

            <p style="margin-top: 1.5rem; text-align: center; color: #999999; font-size: 0.9rem;">
                Default: admin@lydian.medical / Admin@2025!
            </p>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboardScreen" class="hidden">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">Medical LyDian</div>
                <div class="sidebar-subtitle">Enterprise Dashboard</div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"></rect>
                                <rect x="14" y="3" width="7" height="7"></rect>
                                <rect x="14" y="14" width="7" height="7"></rect>
                                <rect x="3" y="14" width="7" height="7"></rect>
                            </svg>
                        </span>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('analytics')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                        </span>
                        <span>Analytics</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Management</div>
                    <a href="#" class="nav-item" onclick="showSection('users')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                        </span>
                        <span>Users</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('consultations')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </span>
                        <span>Consultations</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('records')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10 9 9 9 8 9"></polyline>
                            </svg>
                        </span>
                        <span>Medical Records</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Services</div>
                    <a href="#" class="nav-item" onclick="showSection('api')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                        </span>
                        <span>API Management</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('mayo')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                            </svg>
                        </span>
                        <span>Mayo Clinic CDSS</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Medical Expert AI</div>
                    <a href="#" class="nav-item" onclick="showSection('ai-chat')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                <circle cx="9" cy="9" r="1"></circle>
                                <circle cx="12" cy="9" r="1"></circle>
                                <circle cx="15" cy="9" r="1"></circle>
                            </svg>
                        </span>
                        <span>AI Consultation</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('medical-calculators')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                                <line x1="8" y1="6" x2="16" y2="6"></line>
                                <line x1="8" y1="10" x2="16" y2="10"></line>
                                <line x1="8" y1="14" x2="12" y2="14"></line>
                                <line x1="8" y1="18" x2="12" y2="18"></line>
                                <circle cx="15" cy="16" r="2"></circle>
                            </svg>
                        </span>
                        <span>Medical Calculators</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('specialties')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                            </svg>
                        </span>
                        <span>Specialties</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('medical-imaging')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                        </span>
                        <span>Medical Imaging</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('voice-notes')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </span>
                        <span>Voice Notes</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('emergency-tools')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                        </span>
                        <span>Emergency Tools</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <a href="#" class="nav-item" onclick="showSection('security')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                        </span>
                        <span>Security</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('logs')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <line x1="12" y1="9" x2="8" y2="9"></line>
                            </svg>
                        </span>
                        <span>System Logs</span>
                    </a>
                    <a href="#" class="nav-item" onclick="showSection('settings')">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 6l-4.2 4.2M23 12h-6m-6 0H5m13.2 5.2l-4.2-4.2m0-6l-4.2-4.2"></path>
                            </svg>
                        </span>
                        <span>Settings</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Account</div>
                    <a href="#" class="nav-item" onclick="handleLogout()">
                        <span class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                        </span>
                        <span>Logout</span>
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Header -->
            <div class="dashboard-header" style="position: relative;">
                <div class="ws-status-indicator" id="wsStatusIndicator">
                    <div class="ws-status-dot" id="wsStatusDot"></div>
                    <span id="wsStatusText">Connecting...</span>
                </div>
                <h1 id="pageTitle">Medical Dashboard</h1>
                <p id="pageDescription">Real-time monitoring and management of Medical LyDian platform</p>
                <div class="header-actions">
                    <a href="/api-docs.html" class="btn btn-primary">API Documentation</a>
                    <a href="/medical-expert.html" class="btn btn-secondary">Medical AI Interface</a>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard-section" class="dashboard-section">

            <!-- AI Insights Panel -->
            <div class="ai-insights-panel">
                <div class="card-header">
                    <h2 class="card-title">AI-Powered Insights & Recommendations</h2>
                    <button class="btn btn-secondary btn-small" onclick="refreshAIInsights()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                        Refresh
                    </button>
                </div>
                <div id="aiInsightsContainer">
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <span>Loading AI insights...</span>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Users</div>
                    <div class="stat-value">12,458</div>
                    <div class="stat-change positive">+12.5% from last month</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Active Consultations</div>
                    <div class="stat-value">847</div>
                    <div class="stat-change positive">+8.3% from yesterday</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">API Requests (24h)</div>
                    <div class="stat-value">1.2M</div>
                    <div class="stat-change positive">+23.1% from yesterday</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Mayo Clinic CDSS Queries</div>
                    <div class="stat-value">3,456</div>
                    <div class="stat-change positive">+45.2% from last week</div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="content-grid">
                <!-- System Status -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">System Status</h2>
                        <a href="#" class="card-action">View All</a>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Service</th>
                                <th>Status</th>
                                <th>Uptime</th>
                                <th>Latency</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Medical AI Chat API</td>
                                <td><span class="status-badge operational">Operational</span></td>
                                <td>99.98%</td>
                                <td>145ms</td>
                            </tr>
                            <tr>
                                <td>Mayo Clinic CDSS</td>
                                <td><span class="status-badge operational">Operational</span></td>
                                <td>99.95%</td>
                                <td>289ms</td>
                            </tr>
                            <tr>
                                <td>Cancer Diagnosis API</td>
                                <td><span class="status-badge operational">Operational</span></td>
                                <td>99.92%</td>
                                <td>1.2s</td>
                            </tr>
                            <tr>
                                <td>TCIA Data Integration</td>
                                <td><span class="status-badge warning">Degraded</span></td>
                                <td>98.87%</td>
                                <td>3.4s</td>
                            </tr>
                            <tr>
                                <td>Authentication Service</td>
                                <td><span class="status-badge operational">Operational</span></td>
                                <td>99.99%</td>
                                <td>45ms</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Recent Activity</h2>
                        <a href="#" class="card-action">View All</a>
                    </div>

                    <div class="activity-feed">
                        <div class="activity-item">
                            <div class="activity-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">New user registered</div>
                                <div class="activity-meta">Dr. Sarah Johnson - 5 minutes ago</div>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Consultation completed</div>
                                <div class="activity-meta">Cardiology - 12 minutes ago</div>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">API key generated</div>
                                <div class="activity-meta">Enterprise Client - 1 hour ago</div>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Mayo Clinic CDSS query</div>
                                <div class="activity-meta">Oncology Protocol - 2 hours ago</div>
                            </div>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Security scan completed</div>
                                <div class="activity-meta">No threats detected - 3 hours ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Usage Chart -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">API Usage (Last 7 Days)</h2>
                    <a href="#" class="card-action">Export Data</a>
                </div>
                <div class="chart-container">
                    Chart visualization will be displayed here
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card" style="margin-top: 1.5rem;">
                <div class="card-header">
                    <h2 class="card-title">Quick Actions</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <button class="btn btn-primary">Generate API Key</button>
                    <button class="btn btn-secondary">View Analytics</button>
                    <button class="btn btn-secondary">Export Logs</button>
                    <button class="btn btn-secondary">System Health Check</button>
                </div>
            </div>
            </div>
            <!-- End Dashboard Section -->

            <!-- Analytics Section -->
            <div id="analytics-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Analytics Overview</h2>
                        <div class="header-actions">
                            <button class="export-pdf-btn" onclick="exportAnalyticsToPDF()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                Export PDF
                            </button>
                            <button class="btn btn-secondary btn-small">Export Data</button>
                            <button class="btn btn-secondary btn-small">Refresh</button>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">User Growth Trend</h3>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="userGrowthChart"></canvas>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">API Usage by Endpoint</h3>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="apiUsageChart"></canvas>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Consultations by Specialty</h3>
                            </div>
                            <div class="chart-wrapper">
                                <canvas id="consultationsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="table-header">
                        <h2 class="card-title">User Management</h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="export-pdf-btn" onclick="exportUsersToPDF()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                Export PDF
                            </button>
                            <button class="btn btn-primary" onclick="showAddUserModal()">Add New User</button>
                        </div>
                    </div>

                    <div class="table-filters">
                        <input type="text" class="filter-input" placeholder="Search users..." id="userSearchInput">
                        <select class="filter-input" id="userRoleFilter">
                            <option value="">All Roles</option>
                            <option value="admin">Admin</option>
                            <option value="doctor">Doctor</option>
                            <option value="patient">Patient</option>
                        </select>
                        <button class="btn btn-secondary btn-small" onclick="filterUsers()">Apply Filters</button>
                    </div>

                    <div id="usersTableContainer">
                        <div class="loading-container">
                            <div class="loading-spinner"></div>
                            <span>Loading users...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Consultations Section -->
            <div id="consultations-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="table-header">
                        <h2 class="card-title">Consultations</h2>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="export-pdf-btn" onclick="exportConsultationsToPDF()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                Export PDF
                            </button>
                            <button class="btn btn-primary" onclick="exportConsultations()">Export CSV</button>
                        </div>
                    </div>

                    <div class="table-filters">
                        <input type="text" class="filter-input" placeholder="Search consultations..." id="consultationSearchInput">
                        <select class="filter-input" id="consultationStatusFilter">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                        <select class="filter-input" id="consultationSpecialtyFilter">
                            <option value="">All Specialties</option>
                            <option value="cardiology">Cardiology</option>
                            <option value="oncology">Oncology</option>
                            <option value="neurology">Neurology</option>
                            <option value="pediatrics">Pediatrics</option>
                        </select>
                        <button class="btn btn-secondary btn-small" onclick="filterConsultations()">Apply Filters</button>
                    </div>

                    <div id="consultationsTableContainer">
                        <div class="loading-container">
                            <div class="loading-spinner"></div>
                            <span>Loading consultations...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Records Section -->
            <div id="records-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="table-header">
                        <h2 class="card-title">Medical Records</h2>
                        <button class="btn btn-primary" onclick="uploadRecord()">Upload Record</button>
                    </div>

                    <div class="table-filters">
                        <input type="text" class="filter-input" placeholder="Search records..." id="recordSearchInput">
                        <input type="date" class="filter-input" id="recordDateFrom">
                        <input type="date" class="filter-input" id="recordDateTo">
                        <button class="btn btn-secondary btn-small" onclick="filterRecords()">Apply Filters</button>
                    </div>

                    <div id="recordsTableContainer">
                        <div class="loading-container">
                            <div class="loading-spinner"></div>
                            <span>Loading records...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Management Section -->
            <div id="api-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">API Management</h2>
                        <button class="btn btn-primary" onclick="generateAPIKey()">Generate New Key</button>
                    </div>

                    <div id="apiEndpointsContainer">
                        <div class="loading-container">
                            <div class="loading-spinner"></div>
                            <span>Loading API endpoints...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mayo Clinic CDSS Section -->
            <div id="mayo-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Mayo Clinic CDSS Integration</h2>
                        <span class="status-badge operational">Connected</span>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Queries</div>
                            <div class="stat-value" id="mayoTotalQueries">0</div>
                            <div class="stat-change positive">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Success Rate</div>
                            <div class="stat-value" id="mayoSuccessRate">0%</div>
                            <div class="stat-change positive">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Avg Response Time</div>
                            <div class="stat-value" id="mayoAvgResponse">0ms</div>
                            <div class="stat-change positive">Loading...</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Today's Queries</div>
                            <div class="stat-value" id="mayoTodayQueries">0</div>
                            <div class="stat-change positive">Loading...</div>
                        </div>
                    </div>

                    <div id="mayoDetailsContainer" style="margin-top: 2rem;">
                        <div class="loading-container">
                            <div class="loading-spinner"></div>
                            <span>Loading Mayo Clinic data...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Section -->
            <div id="security-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Security Audit Logs</h2>
                        <button class="btn btn-secondary btn-small" onclick="refreshSecurityLogs()">Refresh</button>
                    </div>

                    <div class="table-filters">
                        <select class="filter-input" id="securitySeverityFilter">
                            <option value="">All Severity</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                        <input type="date" class="filter-input" id="securityDateFilter">
                        <button class="btn btn-secondary btn-small" onclick="filterSecurityLogs()">Apply Filters</button>
                    </div>

                    <div id="securityLogsContainer">
                        <div class="loading-container">
                            <div class="loading-spinner"></div>
                            <span>Loading security logs...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Logs Section -->
            <div id="logs-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">System Logs</h2>
                        <div class="header-actions">
                            <button class="btn btn-secondary btn-small" onclick="clearLogs()">Clear Logs</button>
                            <button class="btn btn-secondary btn-small" onclick="downloadLogs()">Download</button>
                            <button class="btn btn-secondary btn-small" onclick="refreshSystemLogs()">Refresh</button>
                        </div>
                    </div>

                    <div class="table-filters">
                        <select class="filter-input" id="logLevelFilter">
                            <option value="">All Levels</option>
                            <option value="error">Error</option>
                            <option value="warning">Warning</option>
                            <option value="info">Info</option>
                            <option value="success">Success</option>
                        </select>
                        <input type="text" class="filter-input" placeholder="Search logs..." id="logSearchInput">
                        <button class="btn btn-secondary btn-small" onclick="filterSystemLogs()">Apply Filters</button>
                    </div>

                    <div id="systemLogsContainer" style="max-height: 600px; overflow-y: auto; background: #f8f8f8; border-radius: 8px;">
                        <div class="loading-container">
                            <div class="loading-spinner"></div>
                            <span>Loading system logs...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">System Settings</h2>
                        <button class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
                    </div>

                    <div class="settings-section">
                        <h3>General Settings</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Platform Name</label>
                                <input type="text" class="form-input" value="Medical LyDian" id="platformName">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Admin Email</label>
                                <input type="email" class="form-input" value="admin@lydian.medical" id="adminEmail">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Timezone</label>
                                <select class="form-input" id="timezone">
                                    <option>UTC</option>
                                    <option>America/New_York</option>
                                    <option>Europe/London</option>
                                    <option>Asia/Tokyo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Language</label>
                                <select class="form-input" id="language">
                                    <option>English</option>
                                    <option>Turkish</option>
                                    <option>Spanish</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>API Configuration</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Rate Limit (requests/minute)</label>
                                <input type="number" class="form-input" value="1000" id="rateLimit">
                            </div>
                            <div class="form-group">
                                <label class="form-label">API Timeout (seconds)</label>
                                <input type="number" class="form-input" value="30" id="apiTimeout">
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Security Settings</h3>
                        <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableMFA">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Enable Multi-Factor Authentication</span>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableAuditLog">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Enable Audit Logging</span>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableIPWhitelist">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Enable IP Whitelist</span>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Mayo Clinic CDSS Integration</h3>
                        <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableMayoCDSS">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Enable Mayo Clinic CDSS</span>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mayo API Key</label>
                            <input type="password" class="form-input" value="************************" id="mayoApiKey">
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Email Notification Settings</h3>
                        <div class="email-settings">
                            <h4>Notification Recipients</h4>
                            <div class="form-group">
                                <label class="form-label">Primary Email</label>
                                <input type="email" class="form-input" value="admin@lydian.medical" id="notificationEmail">
                            </div>
                            <div class="form-group">
                                <label class="form-label">CC Email (Optional)</label>
                                <input type="email" class="form-input" placeholder="cc@lydian.medical" id="notificationEmailCC">
                            </div>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center; gap: 1rem; margin-top: 1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableSystemAlerts">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Send Email on System Alerts</span>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" checked id="enableFailedConsultations">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Send Email on Failed Consultations</span>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center; gap: 1rem;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="enableDailyReports">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Send Daily Summary Reports</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================================
                 MEDICAL EXPERT AI SECTIONS
                 ============================================================ -->

            <!-- AI Chat Interface Section -->
            <div id="ai-chat-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">AI Medical Consultation</h2>
                        <select id="specialtySelector" class="form-input" style="width: auto;" onchange="changeSpecialty(this.value)">
                            <option value="general-medicine">General Medicine</option>
                            <option value="cardiology">Cardiology</option>
                            <option value="neurology">Neurology</option>
                            <option value="radiology">Radiology</option>
                            <option value="oncology">Oncology</option>
                            <option value="pediatrics">Pediatrics</option>
                            <option value="psychiatry">Psychiatry</option>
                            <option value="orthopedics">Orthopedics</option>
                        </select>
                    </div>

                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="empty-state" id="chatEmptyState">
                                <h3>Welcome to AI Medical Consultation</h3>
                                <p>Select a specialty and start a conversation with our AI medical assistant.</p>
                                <p style="font-size: 0.9rem; color: var(--text-tertiary); margin-top: 1rem;">
                                    This AI assistant is powered by Azure OpenAI and provides informational medical guidance.
                                    Always consult with a licensed healthcare professional for medical decisions.
                                </p>
                            </div>
                        </div>

                        <div class="chat-input-area">
                            <textarea
                                id="chatInput"
                                class="chat-input"
                                placeholder="Describe your symptoms or ask a medical question..."
                                rows="1"
                                onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault(); sendChatMessage();}"
                            ></textarea>
                            <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Calculators Section -->
            <div id="medical-calculators-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Medical Calculators</h2>
                    </div>

                    <div class="calculator-tabs">
                        <div class="calculator-tab active" onclick="switchCalculator('vital-signs')">Vital Signs</div>
                        <div class="calculator-tab" onclick="switchCalculator('bmi')">BMI Calculator</div>
                        <div class="calculator-tab" onclick="switchCalculator('framingham')">Framingham Risk</div>
                        <div class="calculator-tab" onclick="switchCalculator('gcs')">Glasgow Coma Scale</div>
                    </div>

                    <!-- Vital Signs Calculator -->
                    <div id="vital-signs-calc" class="calculator-content active">
                        <div class="calculator-card">
                            <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Vital Signs Assessment</h3>
                            <div class="calculator-grid">
                                <div class="calculator-input-group">
                                    <label>Systolic BP (mmHg)</label>
                                    <input type="number" class="calculator-input" id="vitalSystolic" placeholder="120">
                                </div>
                                <div class="calculator-input-group">
                                    <label>Diastolic BP (mmHg)</label>
                                    <input type="number" class="calculator-input" id="vitalDiastolic" placeholder="80">
                                </div>
                                <div class="calculator-input-group">
                                    <label>Heart Rate (bpm)</label>
                                    <input type="number" class="calculator-input" id="vitalHeartRate" placeholder="70">
                                </div>
                                <div class="calculator-input-group">
                                    <label>Temperature (C)</label>
                                    <input type="number" step="0.1" class="calculator-input" id="vitalTemp" placeholder="36.5">
                                </div>
                                <div class="calculator-input-group">
                                    <label>SpO2 (%)</label>
                                    <input type="number" class="calculator-input" id="vitalSpO2" placeholder="98">
                                </div>
                                <div class="calculator-input-group">
                                    <label>Respiratory Rate (/min)</label>
                                    <input type="number" class="calculator-input" id="vitalRespRate" placeholder="16">
                                </div>
                            </div>
                            <button class="calculator-btn" onclick="assessVitalSigns()">Assess Vital Signs</button>
                            <div id="vitalSignsResult" class="calculator-result"></div>
                        </div>
                    </div>

                    <!-- BMI Calculator -->
                    <div id="bmi-calc" class="calculator-content">
                        <div class="calculator-card">
                            <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">BMI Calculator</h3>
                            <div class="calculator-grid">
                                <div class="calculator-input-group">
                                    <label>Weight</label>
                                    <input type="number" step="0.1" class="calculator-input" id="bmiWeight" placeholder="70">
                                </div>
                                <div class="calculator-input-group">
                                    <label>Height</label>
                                    <input type="number" step="0.1" class="calculator-input" id="bmiHeight" placeholder="170">
                                </div>
                                <div class="calculator-input-group">
                                    <label>Unit System</label>
                                    <select class="calculator-input" id="bmiUnit">
                                        <option value="metric">Metric (kg/cm)</option>
                                        <option value="imperial">Imperial (lbs/in)</option>
                                    </select>
                                </div>
                            </div>
                            <button class="calculator-btn" onclick="calculateBMI()">Calculate BMI</button>
                            <div id="bmiResult" class="calculator-result"></div>
                        </div>
                    </div>

                    <!-- Framingham Risk Calculator -->
                    <div id="framingham-calc" class="calculator-content">
                        <div class="calculator-card">
                            <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Framingham Cardiovascular Risk Score</h3>
                            <div class="calculator-grid">
                                <div class="calculator-input-group">
                                    <label>Age (years)</label>
                                    <input type="number" class="calculator-input" id="framAge" placeholder="50">
                                </div>
                                <div class="calculator-input-group">
                                    <label>Gender</label>
                                    <select class="calculator-input" id="framGender">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                                <div class="calculator-input-group">
                                    <label>Total Cholesterol (mg/dL)</label>
                                    <input type="number" class="calculator-input" id="framTotalChol" placeholder="200">
                                </div>
                                <div class="calculator-input-group">
                                    <label>HDL Cholesterol (mg/dL)</label>
                                    <input type="number" class="calculator-input" id="framHDL" placeholder="50">
                                </div>
                                <div class="calculator-input-group">
                                    <label>Systolic BP (mmHg)</label>
                                    <input type="number" class="calculator-input" id="framSystolic" placeholder="120">
                                </div>
                                <div class="calculator-input-group">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="framSmoker"> Current Smoker
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="framDiabetic"> Diabetic
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="framOnBPMeds"> On BP Medication
                                    </label>
                                </div>
                            </div>
                            <button class="calculator-btn" onclick="calculateFramingham()">Calculate Risk</button>
                            <div id="framinghamResult" class="calculator-result"></div>
                        </div>
                    </div>

                    <!-- Glasgow Coma Scale Calculator -->
                    <div id="gcs-calc" class="calculator-content">
                        <div class="calculator-card">
                            <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Glasgow Coma Scale (GCS)</h3>
                            <div class="calculator-input-group">
                                <label>Eye Opening Response</label>
                                <select class="calculator-input" id="gcsEye">
                                    <option value="4">Spontaneous (4)</option>
                                    <option value="3">To verbal command (3)</option>
                                    <option value="2">To pain (2)</option>
                                    <option value="1">No response (1)</option>
                                </select>
                            </div>
                            <div class="calculator-input-group">
                                <label>Verbal Response</label>
                                <select class="calculator-input" id="gcsVerbal">
                                    <option value="5">Oriented (5)</option>
                                    <option value="4">Confused (4)</option>
                                    <option value="3">Inappropriate words (3)</option>
                                    <option value="2">Incomprehensible sounds (2)</option>
                                    <option value="1">No response (1)</option>
                                </select>
                            </div>
                            <div class="calculator-input-group">
                                <label>Motor Response</label>
                                <select class="calculator-input" id="gcsMotor">
                                    <option value="6">Obeys commands (6)</option>
                                    <option value="5">Localizes pain (5)</option>
                                    <option value="4">Withdraws from pain (4)</option>
                                    <option value="3">Flexion to pain (3)</option>
                                    <option value="2">Extension to pain (2)</option>
                                    <option value="1">No response (1)</option>
                                </select>
                            </div>
                            <button class="calculator-btn" onclick="calculateGCS()">Calculate GCS</button>
                            <div id="gcsResult" class="calculator-result"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Emergency Tools Section -->
            <div id="emergency-tools-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Emergency Contact Numbers</h2>
                        <select id="emergencyLanguage" class="form-input" style="width: auto;" onchange="loadEmergencyNumbers(this.value)">
                            <option value="en">English</option>
                            <option value="tr">Trke</option>
                            <option value="es">Espaol</option>
                            <option value="fr">Franais</option>
                        </select>
                    </div>

                    <div class="emergency-grid" id="emergencyGrid">
                        <!-- Emergency numbers will be loaded here -->
                        <div class="emergency-card" onclick="callEmergency('112')">
                            <div class="emergency-number">112</div>
                            <div class="emergency-label">Emergency Medical Services</div>
                        </div>
                        <div class="emergency-card" onclick="callEmergency('184')">
                            <div class="emergency-number">184</div>
                            <div class="emergency-label">Poison Control</div>
                        </div>
                        <div class="emergency-card" onclick="callEmergency('182')">
                            <div class="emergency-number">182</div>
                            <div class="emergency-label">Psychiatric Hotline</div>
                        </div>
                        <div class="emergency-card" onclick="callEmergency('155')">
                            <div class="emergency-number">155</div>
                            <div class="emergency-label">Police Emergency</div>
                        </div>
                        <div class="emergency-card" onclick="callEmergency('110')">
                            <div class="emergency-number">110</div>
                            <div class="emergency-label">Fire Department</div>
                        </div>
                        <div class="emergency-card" onclick="callEmergency('183')">
                            <div class="emergency-number">183</div>
                            <div class="emergency-label">ALO 183 Healthcare</div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem; padding: 1.5rem; background: #FEF3C7; border-radius: 8px; border-left: 4px solid #F59E0B;">
                        <h4 style="font-weight: 700; margin-bottom: 0.5rem; color: #92400E;"> Emergency Guidance</h4>
                        <p style="color: #92400E; line-height: 1.6;">
                            In case of a medical emergency, call the appropriate emergency number immediately.
                            Do not rely solely on AI consultation for emergency situations.
                            If symptoms are severe or life-threatening, seek immediate medical attention.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Specialties Section (TIER 2) -->
            <div id="specialties-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Medical Specialties</h2>
                        <p style="color: var(--text-secondary);">Access specialized AI consultations for different medical fields</p>
                    </div>

                    <div class="specialties-grid">
                        <div class="specialty-card">
                            <div class="specialty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                                </svg>
                            </div>
                            <div class="specialty-title">General Medicine</div>
                            <div class="specialty-description">Comprehensive primary care and general health consultations</div>
                            <button class="btn btn-primary" onclick="launchSpecialty('general-medicine')">Launch</button>
                        </div>

                        <div class="specialty-card">
                            <div class="specialty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                </svg>
                            </div>
                            <div class="specialty-title">Cardiology</div>
                            <div class="specialty-description">Heart and cardiovascular system expertise</div>
                            <button class="btn btn-primary" onclick="launchSpecialty('cardiology')">Launch</button>
                        </div>

                        <div class="specialty-card">
                            <div class="specialty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2a10 10 0 0 1 10 10c0 6-10 12-10 12s-10-6-10-12a10 10 0 0 1 10-10z"></path>
                                </svg>
                            </div>
                            <div class="specialty-title">Neurology</div>
                            <div class="specialty-description">Brain, spinal cord, and nervous system specialists</div>
                            <button class="btn btn-primary" onclick="launchSpecialty('neurology')">Launch</button>
                        </div>

                        <div class="specialty-card">
                            <div class="specialty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="14.31" y1="8" x2="20.05" y2="17.94"></line>
                                    <line x1="9.69" y1="8" x2="21.17" y2="8"></line>
                                </svg>
                            </div>
                            <div class="specialty-title">Radiology</div>
                            <div class="specialty-description">Medical imaging and diagnostic radiology</div>
                            <button class="btn btn-primary" onclick="launchSpecialty('radiology')">Launch</button>
                        </div>

                        <div class="specialty-card">
                            <div class="specialty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <div class="specialty-title">Oncology</div>
                            <div class="specialty-description">Cancer diagnosis, treatment, and care</div>
                            <button class="btn btn-primary" onclick="launchSpecialty('oncology')">Launch</button>
                        </div>

                        <div class="specialty-card">
                            <div class="specialty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <div class="specialty-title">Pediatrics</div>
                            <div class="specialty-description">Child and adolescent healthcare</div>
                            <button class="btn btn-primary" onclick="launchSpecialty('pediatrics')">Launch</button>
                        </div>

                        <div class="specialty-card">
                            <div class="specialty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                                    <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                    <line x1="15" y1="9" x2="15.01" y2="9"></line>
                                </svg>
                            </div>
                            <div class="specialty-title">Psychiatry</div>
                            <div class="specialty-description">Mental health and behavioral disorders</div>
                            <button class="btn btn-primary" onclick="launchSpecialty('psychiatry')">Launch</button>
                        </div>

                        <div class="specialty-card">
                            <div class="specialty-icon">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path>
                                    <path d="M9 12h6"></path>
                                    <path d="M12 9v6"></path>
                                </svg>
                            </div>
                            <div class="specialty-title">Orthopedics</div>
                            <div class="specialty-description">Musculoskeletal system and bone health</div>
                            <button class="btn btn-primary" onclick="launchSpecialty('orthopedics')">Launch</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Imaging Section (TIER 2) -->
            <div id="medical-imaging-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Medical Imaging Analysis</h2>
                        <p style="color: var(--text-secondary);">Upload DICOM or medical images for AI-powered analysis</p>
                    </div>

                    <div class="upload-zone" id="uploadZone" onclick="document.getElementById('medicalImageInput').click()">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin: 0 auto 1rem; color: var(--accent-2);">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <h3 style="margin-bottom: 0.5rem; color: var(--text-primary);">Upload Medical Images</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Drag and drop files here or click to browse
                        </p>
                        <p style="font-size: 0.875rem; color: var(--text-tertiary);">
                            Supported formats: DICOM (.dcm), JPEG, PNG<br>
                            Maximum file size: 50MB
                        </p>
                        <input type="file" id="medicalImageInput" accept=".dcm,.dicom,.jpg,.jpeg,.png" style="display: none;" onchange="handleImageUpload(event)">
                    </div>

                    <div id="imageAnalysisResult" style="margin-top: 2rem; display: none;">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Analysis Results</h3>
                        <div id="imageAnalysisContent" style="padding: 1.5rem; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid var(--accent-1);"></div>
                    </div>
                </div>
            </div>

            <!-- Voice Notes Section (TIER 2) -->
            <div id="voice-notes-section" class="dashboard-section hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Voice Notes & Transcription</h2>
                        <p style="color: var(--text-secondary);">Record medical notes and get AI-powered transcription</p>
                    </div>

                    <div class="voice-recorder">
                        <button class="record-btn" id="recordBtn" onclick="toggleRecording()">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                        <p id="recordingStatus" style="margin-top: 1.5rem; font-weight: 600; color: var(--text-secondary);">
                            Click the button to start recording
                        </p>
                        <p id="recordingTime" style="margin-top: 0.5rem; font-size: 2rem; font-weight: 800; color: var(--accent-2); display: none;">
                            00:00
                        </p>
                    </div>

                    <div id="transcriptionResult" style="margin-top: 2rem; display: none;">
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Transcription</h3>
                        <div id="transcriptionContent" style="padding: 1.5rem; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid var(--accent-1); line-height: 1.8;"></div>
                        <button class="btn btn-primary" style="margin-top: 1rem;" onclick="copyTranscription()">Copy to Clipboard</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Check if user is already logged in
        const isLoggedIn = sessionStorage.getItem('medicalDashboardAuth') === 'true';

        if (isLoggedIn) {
            showDashboard();
        }

        function handleLogin(event) {
            event.preventDefault();

            const email = document.getElementById('emailInput').value;
            const password = document.getElementById('passwordInput').value;

            // Simple authentication (in production, this should be server-side)
            const validCredentials = [
                { email: 'admin@lydian.medical', password: 'Admin@2025!' },
                { email: 'medical@lydian.ai', password: 'Medical@2025!' }
            ];

            const isValid = validCredentials.some(
                cred => cred.email === email && cred.password === password
            );

            if (isValid) {
                sessionStorage.setItem('medicalDashboardAuth', 'true');
                sessionStorage.setItem('userEmail', email);
                showDashboard();
            } else {
                showError('Invalid email or password. Please try again.');
            }
        }

        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.remove('hidden');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';

            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function handleLogout() {
            sessionStorage.removeItem('medicalDashboardAuth');
            sessionStorage.removeItem('userEmail');
            document.getElementById('dashboardScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('loginForm').reset();
        }

        function showSection(section) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to clicked item
            event.target.closest('.nav-item').classList.add('active');

            // Hide all sections
            document.querySelectorAll('.dashboard-section').forEach(sec => {
                sec.classList.add('hidden');
            });

            // Show selected section
            const sectionId = section + '-section';
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            // Update page title
            updatePageTitle(section);

            // Load section data from API
            loadSectionData(section);
        }

        function updatePageTitle(section) {
            const titles = {
                'dashboard': 'Medical Dashboard',
                'analytics': 'Analytics',
                'users': 'User Management',
                'consultations': 'Consultations',
                'records': 'Medical Records',
                'api': 'API Management',
                'mayo': 'Mayo Clinic CDSS',
                'security': 'Security',
                'logs': 'System Logs',
                'settings': 'Settings',
                // Medical Expert AI Sections
                'ai-chat': 'AI Medical Consultation',
                'medical-calculators': 'Medical Calculators',
                'emergency-tools': 'Emergency Tools',
                'specialties': 'Medical Specialties',
                'medical-imaging': 'Medical Imaging Analysis',
                'voice-notes': 'Voice Notes & Transcription'
            };

            const descriptions = {
                'dashboard': 'Real-time monitoring and management of Medical LyDian platform',
                'analytics': 'Comprehensive analytics and data visualization',
                'users': 'Manage users, roles, and permissions',
                'consultations': 'View and manage medical consultations',
                'records': 'Access and manage medical records',
                'api': 'Manage API keys and monitor endpoint usage',
                'mayo': 'Monitor Mayo Clinic CDSS integration status',
                'security': 'View security audit logs and alerts',
                'logs': 'System logs and application monitoring',
                'settings': 'Configure system settings and preferences',
                // Medical Expert AI Descriptions
                'ai-chat': 'AI-powered medical consultation with specialty-specific assistance',
                'medical-calculators': 'Professional medical calculators for vital signs, BMI, risk scores, and more',
                'emergency-tools': 'Quick access to emergency contact numbers and critical care resources',
                'specialties': 'Access specialized AI consultations across different medical fields',
                'medical-imaging': 'AI-powered analysis of DICOM and medical imaging files',
                'voice-notes': 'Record and transcribe medical notes with AI-powered voice recognition'
            };

            document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';
            document.getElementById('pageDescription').textContent = descriptions[section] || '';
        }

        // API Integration Functions
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/admin/big-data?action=dashboard-stats');
                if (response.ok) {
                    const data = await response.json();
                    updateDashboardStats(data.stats);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        async function loadSectionData(section) {
            console.log('Loading section:', section);

            switch(section) {
                case 'dashboard':
                    await loadDashboardData();
                    break;
                case 'analytics':
                    await loadAnalyticsData();
                    break;
                case 'users':
                    await loadUsersData();
                    break;
                case 'consultations':
                    await loadConsultationsData();
                    break;
                case 'records':
                    await loadRecordsData();
                    break;
                case 'api':
                    await loadAPIManagementData();
                    break;
                case 'mayo':
                    await loadMayoData();
                    break;
                case 'security':
                    await loadSecurityData();
                    break;
                case 'logs':
                    await loadSystemLogsData();
                    break;
                case 'settings':
                    loadSettingsData();
                    break;
                default:
                    console.log('Section:', section);
            }
        }

        // Chart.js instances
        let userGrowthChart = null;
        let apiUsageChart = null;
        let consultationsChart = null;

        async function loadAnalyticsData() {
            try {
                const response = await fetch('/api/admin/big-data?action=analytics');
                if (response.ok) {
                    const data = await response.json();
                    initializeCharts(data);
                } else {
                    // Use mock data if API fails
                    initializeCharts(getMockAnalyticsData());
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
                initializeCharts(getMockAnalyticsData());
            }
        }

        function getMockAnalyticsData() {
            return {
                userGrowth: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    data: [1200, 1900, 3000, 5000, 7500, 10200, 12458]
                },
                apiUsage: {
                    labels: ['Chat API', 'Mayo CDSS', 'Cancer Diagnosis', 'TCIA Data', 'Auth Service'],
                    data: [45000, 32000, 28000, 15000, 12000]
                },
                consultations: {
                    labels: ['Cardiology', 'Oncology', 'Neurology', 'Pediatrics', 'Other'],
                    data: [250, 180, 145, 120, 152]
                }
            };
        }

        function initializeCharts(data) {
            // Destroy existing charts
            if (userGrowthChart) userGrowthChart.destroy();
            if (apiUsageChart) apiUsageChart.destroy();
            if (consultationsChart) consultationsChart.destroy();

            // User Growth Chart (Line)
            const userCtx = document.getElementById('userGrowthChart');
            if (userCtx) {
                userGrowthChart = new Chart(userCtx, {
                    type: 'line',
                    data: {
                        labels: data.userGrowth.labels,
                        datasets: [{
                            label: 'Total Users',
                            data: data.userGrowth.data,
                            borderColor: '#000000',
                            backgroundColor: 'rgba(0, 0, 0, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // API Usage Chart (Bar)
            const apiCtx = document.getElementById('apiUsageChart');
            if (apiCtx) {
                apiUsageChart = new Chart(apiCtx, {
                    type: 'bar',
                    data: {
                        labels: data.apiUsage.labels,
                        datasets: [{
                            label: 'API Calls (24h)',
                            data: data.apiUsage.data,
                            backgroundColor: [
                                'rgba(0, 0, 0, 0.8)',
                                'rgba(51, 51, 51, 0.8)',
                                'rgba(102, 102, 102, 0.8)',
                                'rgba(153, 153, 153, 0.8)',
                                'rgba(204, 204, 204, 0.8)'
                            ],
                            borderColor: '#000000',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Consultations Chart (Pie)
            const consultCtx = document.getElementById('consultationsChart');
            if (consultCtx) {
                consultationsChart = new Chart(consultCtx, {
                    type: 'pie',
                    data: {
                        labels: data.consultations.labels,
                        datasets: [{
                            data: data.consultations.data,
                            backgroundColor: [
                                'rgba(0, 0, 0, 0.9)',
                                'rgba(51, 51, 51, 0.9)',
                                'rgba(102, 102, 102, 0.9)',
                                'rgba(153, 153, 153, 0.9)',
                                'rgba(204, 204, 204, 0.9)'
                            ],
                            borderColor: '#ffffff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                });
            }
        }

        async function loadUsersData() {
            const container = document.getElementById('usersTableContainer');
            try {
                const response = await fetch('/api/admin/big-data?action=users&limit=100');
                if (response.ok) {
                    const data = await response.json();
                    renderUsersTable(data.users || []);
                } else {
                    renderUsersTable(getMockUsers());
                }
            } catch (error) {
                console.error('Error loading users:', error);
                renderUsersTable(getMockUsers());
            }
        }

        function getMockUsers() {
            const users = [];
            const roles = ['admin', 'doctor', 'patient'];
            const names = ['John Smith', 'Sarah Johnson', 'Michael Brown', 'Emily Davis', 'David Wilson'];

            for (let i = 0; i < 50; i++) {
                users.push({
                    id: `user_${i + 1}`,
                    name: names[i % names.length],
                    email: `user${i + 1}@lydian.medical`,
                    role: roles[i % roles.length],
                    status: i % 5 === 0 ? 'inactive' : 'active',
                    lastLogin: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
                });
            }
            return users;
        }

        function renderUsersTable(users) {
            const container = document.getElementById('usersTableContainer');

            const html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Last Login</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>${user.id}</td>
                                <td>${user.name}</td>
                                <td>${user.email}</td>
                                <td><span class="status-badge ${user.role === 'admin' ? 'warning' : 'operational'}">${user.role}</span></td>
                                <td><span class="status-badge ${user.status === 'active' ? 'operational' : 'error'}">${user.status}</span></td>
                                <td>${new Date(user.lastLogin).toLocaleString()}</td>
                                <td>
                                    <button class="btn btn-secondary btn-small" onclick="editUser('${user.id}')">Edit</button>
                                    <button class="btn btn-secondary btn-small" onclick="deleteUser('${user.id}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        async function loadConsultationsData() {
            const container = document.getElementById('consultationsTableContainer');
            try {
                const response = await fetch('/api/admin/big-data?action=consultations&limit=100');
                if (response.ok) {
                    const data = await response.json();
                    renderConsultationsTable(data.consultations || []);
                } else {
                    renderConsultationsTable(getMockConsultations());
                }
            } catch (error) {
                console.error('Error loading consultations:', error);
                renderConsultationsTable(getMockConsultations());
            }
        }

        function getMockConsultations() {
            const consultations = [];
            const specialties = ['Cardiology', 'Oncology', 'Neurology', 'Pediatrics'];
            const statuses = ['active', 'completed', 'cancelled'];

            for (let i = 0; i < 40; i++) {
                consultations.push({
                    id: `consult_${i + 1}`,
                    patientName: `Patient ${i + 1}`,
                    doctorName: `Dr. Smith ${i % 5}`,
                    specialty: specialties[i % specialties.length],
                    status: statuses[i % statuses.length],
                    date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),
                    duration: Math.floor(Math.random() * 60) + 15
                });
            }
            return consultations;
        }

        function renderConsultationsTable(consultations) {
            const container = document.getElementById('consultationsTableContainer');

            const html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Consultation ID</th>
                            <th>Patient</th>
                            <th>Doctor</th>
                            <th>Specialty</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Duration</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${consultations.map(consult => `
                            <tr>
                                <td>${consult.id}</td>
                                <td>${consult.patientName}</td>
                                <td>${consult.doctorName}</td>
                                <td>${consult.specialty}</td>
                                <td><span class="status-badge ${consult.status === 'active' ? 'warning' : consult.status === 'completed' ? 'operational' : 'error'}">${consult.status}</span></td>
                                <td>${new Date(consult.date).toLocaleDateString()}</td>
                                <td>${consult.duration} min</td>
                                <td>
                                    <button class="btn btn-secondary btn-small" onclick="viewConsultation('${consult.id}')">View</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        async function loadRecordsData() {
            const container = document.getElementById('recordsTableContainer');
            try {
                const response = await fetch('/api/admin/big-data?action=records&limit=100');
                if (response.ok) {
                    const data = await response.json();
                    renderRecordsTable(data.records || []);
                } else {
                    renderRecordsTable(getMockRecords());
                }
            } catch (error) {
                console.error('Error loading records:', error);
                renderRecordsTable(getMockRecords());
            }
        }

        function getMockRecords() {
            const records = [];
            const types = ['Lab Report', 'Imaging', 'Prescription', 'Diagnosis'];

            for (let i = 0; i < 30; i++) {
                records.push({
                    id: `record_${i + 1}`,
                    patientName: `Patient ${i + 1}`,
                    type: types[i % types.length],
                    date: new Date(Date.now() - Math.random() * 60 * 24 * 60 * 60 * 1000).toISOString(),
                    doctor: `Dr. Wilson ${i % 5}`,
                    size: `${(Math.random() * 5 + 0.5).toFixed(1)} MB`
                });
            }
            return records;
        }

        function renderRecordsTable(records) {
            const container = document.getElementById('recordsTableContainer');

            const html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Record ID</th>
                            <th>Patient</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Doctor</th>
                            <th>Size</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${records.map(record => `
                            <tr>
                                <td>${record.id}</td>
                                <td>${record.patientName}</td>
                                <td><span class="status-badge operational">${record.type}</span></td>
                                <td>${new Date(record.date).toLocaleDateString()}</td>
                                <td>${record.doctor}</td>
                                <td>${record.size}</td>
                                <td>
                                    <button class="btn btn-secondary btn-small" onclick="viewRecord('${record.id}')">View</button>
                                    <button class="btn btn-secondary btn-small" onclick="downloadRecord('${record.id}')">Download</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        async function loadAPIManagementData() {
            const container = document.getElementById('apiEndpointsContainer');
            try {
                const response = await fetch('/api/admin/big-data?action=api-management');
                if (response.ok) {
                    const data = await response.json();
                    renderAPIEndpoints(data.endpoints || getMockAPIEndpoints());
                } else {
                    renderAPIEndpoints(getMockAPIEndpoints());
                }
            } catch (error) {
                console.error('Error loading API management:', error);
                renderAPIEndpoints(getMockAPIEndpoints());
            }
        }

        function getMockAPIEndpoints() {
            return [
                { method: 'POST', path: '/api/chat', description: 'Medical AI Chat', calls: 45000, avgLatency: '145ms' },
                { method: 'GET', path: '/api/mayo-clinic', description: 'Mayo Clinic CDSS Query', calls: 32000, avgLatency: '289ms' },
                { method: 'POST', path: '/api/cancer-diagnosis', description: 'Cancer Diagnosis Analysis', calls: 28000, avgLatency: '1.2s' },
                { method: 'GET', path: '/api/tcia/data', description: 'TCIA Data Integration', calls: 15000, avgLatency: '3.4s' },
                { method: 'POST', path: '/api/auth/login', description: 'User Authentication', calls: 12000, avgLatency: '45ms' }
            ];
        }

        function renderAPIEndpoints(endpoints) {
            const container = document.getElementById('apiEndpointsContainer');

            const html = endpoints.map(endpoint => `
                <div class="endpoint-card">
                    <div>
                        <span class="endpoint-method method-${endpoint.method.toLowerCase()}">${endpoint.method}</span>
                        <strong style="font-size: 1.1rem;">${endpoint.path}</strong>
                    </div>
                    <p style="color: #666666; margin: 0.5rem 0;">${endpoint.description}</p>
                    <div style="display: flex; gap: 2rem; margin-top: 1rem;">
                        <div>
                            <strong>Calls (24h):</strong> ${endpoint.calls.toLocaleString()}
                        </div>
                        <div>
                            <strong>Avg Latency:</strong> ${endpoint.avgLatency}
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        async function loadMayoData() {
            try {
                const response = await fetch('/api/admin/big-data?action=mayo-clinic');
                if (response.ok) {
                    const data = await response.json();
                    updateMayoStats(data);
                } else {
                    updateMayoStats(getMockMayoData());
                }
            } catch (error) {
                console.error('Error loading Mayo data:', error);
                updateMayoStats(getMockMayoData());
            }
        }

        function getMockMayoData() {
            return {
                totalQueries: 3456,
                successRate: 99.2,
                avgResponseTime: 289,
                todayQueries: 847
            };
        }

        function updateMayoStats(data) {
            document.getElementById('mayoTotalQueries').textContent = data.totalQueries.toLocaleString();
            document.getElementById('mayoSuccessRate').textContent = data.successRate + '%';
            document.getElementById('mayoAvgResponse').textContent = data.avgResponseTime + 'ms';
            document.getElementById('mayoTodayQueries').textContent = data.todayQueries.toLocaleString();

            const container = document.getElementById('mayoDetailsContainer');
            container.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Recent Mayo Clinic Queries</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Query ID</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Response Time</th>
                                <th>Timestamp</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Array.from({length: 10}, (_, i) => `
                                <tr>
                                    <td>mayo_${Math.floor(Math.random() * 10000)}</td>
                                    <td>Protocol Query</td>
                                    <td><span class="status-badge operational">Success</span></td>
                                    <td>${Math.floor(Math.random() * 500 + 100)}ms</td>
                                    <td>${new Date(Date.now() - Math.random() * 24 * 60 * 60 * 1000).toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        async function loadSecurityData() {
            const container = document.getElementById('securityLogsContainer');
            try {
                const response = await fetch('/api/admin/big-data?action=security');
                if (response.ok) {
                    const data = await response.json();
                    renderSecurityLogs(data.logs || []);
                } else {
                    renderSecurityLogs(getMockSecurityLogs());
                }
            } catch (error) {
                console.error('Error loading security data:', error);
                renderSecurityLogs(getMockSecurityLogs());
            }
        }

        function getMockSecurityLogs() {
            const logs = [];
            const severities = ['low', 'medium', 'high', 'critical'];
            const events = ['Failed Login', 'API Key Generated', 'Password Changed', 'Suspicious Activity'];

            for (let i = 0; i < 20; i++) {
                logs.push({
                    id: `sec_${i + 1}`,
                    event: events[i % events.length],
                    severity: severities[i % severities.length],
                    user: `user${i + 1}@lydian.medical`,
                    ip: `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                    timestamp: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
                });
            }
            return logs;
        }

        function renderSecurityLogs(logs) {
            const container = document.getElementById('securityLogsContainer');

            const html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Event ID</th>
                            <th>Event</th>
                            <th>Severity</th>
                            <th>User</th>
                            <th>IP Address</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${logs.map(log => `
                            <tr>
                                <td>${log.id}</td>
                                <td>${log.event}</td>
                                <td><span class="status-badge ${log.severity === 'critical' ? 'error' : log.severity === 'high' ? 'warning' : 'operational'}">${log.severity}</span></td>
                                <td>${log.user}</td>
                                <td>${log.ip}</td>
                                <td>${new Date(log.timestamp).toLocaleString()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        async function loadSystemLogsData() {
            const container = document.getElementById('systemLogsContainer');
            try {
                const response = await fetch('/api/admin/big-data?action=system-logs&limit=100');
                if (response.ok) {
                    const data = await response.json();
                    renderSystemLogs(data.logs || []);
                } else {
                    renderSystemLogs(getMockSystemLogs());
                }
            } catch (error) {
                console.error('Error loading system logs:', error);
                renderSystemLogs(getMockSystemLogs());
            }
        }

        function getMockSystemLogs() {
            const logs = [];
            const levels = ['error', 'warning', 'info', 'success'];
            const messages = [
                'API request completed successfully',
                'Database connection established',
                'User authentication failed',
                'Cache cleared',
                'Backup completed'
            ];

            for (let i = 0; i < 50; i++) {
                const level = levels[i % levels.length];
                logs.push({
                    timestamp: new Date(Date.now() - i * 60000).toISOString(),
                    level: level,
                    message: messages[i % messages.length]
                });
            }
            return logs;
        }

        function renderSystemLogs(logs) {
            const container = document.getElementById('systemLogsContainer');

            const html = logs.map(log => `
                <div class="log-entry ${log.level}">
                    [${new Date(log.timestamp).toLocaleString()}] [${log.level.toUpperCase()}] ${log.message}
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function loadSettingsData() {
            // Settings are loaded from the form inputs
            console.log('Settings section loaded');
        }

        // Utility functions for buttons
        function showAddUserModal() {
            alert('Add User functionality would open a modal here');
        }

        function editUser(id) {
            alert('Edit user: ' + id);
        }

        function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                alert('Delete user: ' + id);
            }
        }

        function filterUsers() {
            alert('Filter users functionality');
        }

        function exportConsultations() {
            alert('Export consultations to CSV');
        }

        function filterConsultations() {
            alert('Filter consultations functionality');
        }

        function viewConsultation(id) {
            alert('View consultation: ' + id);
        }

        function filterRecords() {
            alert('Filter records functionality');
        }

        function uploadRecord() {
            alert('Upload record functionality');
        }

        function viewRecord(id) {
            alert('View record: ' + id);
        }

        function downloadRecord(id) {
            alert('Download record: ' + id);
        }

        function generateAPIKey() {
            alert('Generate new API key');
        }

        function refreshSecurityLogs() {
            loadSecurityData();
        }

        function filterSecurityLogs() {
            alert('Filter security logs functionality');
        }

        function refreshSystemLogs() {
            loadSystemLogsData();
        }

        function clearLogs() {
            if (confirm('Are you sure you want to clear all logs?')) {
                alert('Logs cleared');
            }
        }

        function downloadLogs() {
            alert('Download logs functionality');
        }

        function filterSystemLogs() {
            alert('Filter system logs functionality');
        }

        function saveSettings() {
            alert('Settings saved successfully');
        }

        function updateDashboardStats(stats) {
            if (stats) {
                document.getElementById('totalUsers').textContent = stats.totalUsers || '12,458';
                document.getElementById('activeConsultations').textContent = stats.activeConsultations || '847';
                document.getElementById('apiRequests').textContent = formatNumber(stats.apiRequests24h) || '1.2M';
                document.getElementById('mayoQueries').textContent = stats.mayoClinicQueries || '3,456';
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num;
        }

        // Log user activity to big data system
        async function logActivity(action, details) {
            try {
                await fetch('/api/admin/big-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'log-user-activity',
                        data: {
                            userId: sessionStorage.getItem('userEmail'),
                            action,
                            details,
                            timestamp: new Date().toISOString(),
                            page: window.location.pathname
                        }
                    })
                });
            } catch (error) {
                console.error('Error logging activity:', error);
            }
        }

        // ===================================
        // MEDICAL EXPERT SYNC INTEGRATION
        // ===================================

        // Sync Service for Dashboard <-> Medical Expert communication
        class DashboardSyncService {
            constructor() {
                this.syncInterval = null;
                this.syncEndpoint = '/api/sync/dashboard-expert';
            }

            // Initialize sync on dashboard load
            async init() {
                try {
                    // Update system status
                    await this.updateSystemStatus('dashboard', true);

                    // Start periodic sync
                    this.startPeriodicSync();

                    // Listen for storage changes from Medical Expert
                    window.addEventListener('storage', this.handleStorageChange.bind(this));

                    console.log('Dashboard Sync Service initialized');
                } catch (error) {
                    console.error('Sync service initialization error:', error);
                }
            }

            // Update system online status
            async updateSystemStatus(source, online) {
                try {
                    const response = await fetch(this.syncEndpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'update-status',
                            data: { source, online }
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('System status updated:', result.status);
                    }
                } catch (error) {
                    console.error('Error updating system status:', error);
                }
            }

            // Sync consultation data
            async syncConsultation(consultationData) {
                try {
                    const response = await fetch(this.syncEndpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'sync-consultation',
                            data: consultationData
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('Consultation synced:', result.consultation);

                        // Store in localStorage for cross-page access
                        this.saveToLocalStorage('lastConsultation', result.consultation);
                    }
                } catch (error) {
                    console.error('Error syncing consultation:', error);
                }
            }

            // Add activity to sync
            async addActivity(activity) {
                try {
                    const response = await fetch(this.syncEndpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'add-activity',
                            data: activity
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.saveToLocalStorage('recentActivities', result.activity);
                    }
                } catch (error) {
                    console.error('Error adding activity:', error);
                }
            }

            // Sync user session
            async syncUserSession() {
                try {
                    const sessionData = {
                        userId: sessionStorage.getItem('userEmail'),
                        source: 'dashboard',
                        ipAddress: 'client-side',
                        userAgent: navigator.userAgent,
                        timestamp: new Date().toISOString()
                    };

                    const response = await fetch(this.syncEndpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'sync-session',
                            data: sessionData
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('Session synced:', result.session);
                    }
                } catch (error) {
                    console.error('Error syncing session:', error);
                }
            }

            // Get full sync data
            async getSyncData() {
                try {
                    const response = await fetch(`${this.syncEndpoint}?action=sync`);

                    if (response.ok) {
                        const result = await response.json();
                        return result.data;
                    }
                } catch (error) {
                    console.error('Error getting sync data:', error);
                }
                return null;
            }

            // Get active consultations
            async getActiveConsultations() {
                try {
                    const response = await fetch(`${this.syncEndpoint}?action=consultations`);

                    if (response.ok) {
                        const result = await response.json();
                        return result.consultations;
                    }
                } catch (error) {
                    console.error('Error getting consultations:', error);
                }
                return [];
            }

            // Get sync status
            async getSyncStatus() {
                try {
                    const response = await fetch(`${this.syncEndpoint}?action=status`);

                    if (response.ok) {
                        const result = await response.json();
                        return result.status;
                    }
                } catch (error) {
                    console.error('Error getting sync status:', error);
                }
                return null;
            }

            // Start periodic sync (every 10 seconds)
            startPeriodicSync() {
                this.syncInterval = setInterval(async () => {
                    const syncData = await this.getSyncData();
                    if (syncData) {
                        // Update dashboard with synced data
                        this.updateDashboardFromSync(syncData);
                    }
                }, 10000); // 10 seconds
            }

            // Stop periodic sync
            stopPeriodicSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                }
            }

            // Update dashboard with synced data
            updateDashboardFromSync(syncData) {
                // Update active consultations count
                if (syncData.consultations && syncData.consultations.length > 0) {
                    const consultationsEl = document.getElementById('activeConsultations');
                    if (consultationsEl) {
                        consultationsEl.textContent = syncData.consultations.length;
                    }
                }

                // Update recent activities
                if (syncData.activities && syncData.activities.length > 0) {
                    console.log('Recent activities:', syncData.activities.length);
                }

                // Store sync timestamp
                this.saveToLocalStorage('lastSyncTime', syncData.timestamp);
            }

            // Handle localStorage changes from Medical Expert
            handleStorageChange(event) {
                if (event.key === 'medicalExpertConsultation') {
                    console.log('New consultation from Medical Expert:', event.newValue);

                    try {
                        const consultationData = JSON.parse(event.newValue);
                        this.syncConsultation(consultationData);
                    } catch (error) {
                        console.error('Error parsing consultation data:', error);
                    }
                }

                if (event.key === 'medicalExpertActivity') {
                    console.log('New activity from Medical Expert:', event.newValue);

                    try {
                        const activityData = JSON.parse(event.newValue);
                        this.addActivity(activityData);
                    } catch (error) {
                        console.error('Error parsing activity data:', error);
                    }
                }
            }

            // Save to localStorage
            saveToLocalStorage(key, data) {
                try {
                    localStorage.setItem(`dashboard_${key}`, JSON.stringify(data));
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }
            }

            // Get from localStorage
            getFromLocalStorage(key) {
                try {
                    const data = localStorage.getItem(`dashboard_${key}`);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Error reading from localStorage:', error);
                    return null;
                }
            }

            // Cleanup on page unload
            cleanup() {
                this.stopPeriodicSync();
                this.updateSystemStatus('dashboard', false);
            }
        }

        // Initialize Sync Service
        let dashboardSync = null;

        if (isLoggedIn) {
            dashboardSync = new DashboardSyncService();
            dashboardSync.init();
            dashboardSync.syncUserSession();

            // Cleanup on page unload
            window.addEventListener('beforeunload', () => {
                if (dashboardSync) {
                    dashboardSync.cleanup();
                }
            });
        }

        // ===================================
        // WEBSOCKET REAL-TIME INTEGRATION
        // ===================================

        class WebSocketClient {
            constructor() {
                this.ws = null;
                this.reconnectInterval = 5000;
                this.isConnecting = false;
                this.messageHandlers = new Map();
            }

            connect() {
                if (this.isConnecting || (this.ws && this.ws.readyState === WebSocket.OPEN)) {
                    return;
                }

                this.isConnecting = true;
                this.updateStatus('connecting', 'Connecting...');

                try {
                    // Use wss:// for production, ws:// for local development
                    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                    const wsUrl = `${protocol}//${window.location.host}/api/realtime/websocket`;

                    this.ws = new WebSocket(wsUrl);

                    this.ws.onopen = () => {
                        console.log('WebSocket connected');
                        this.isConnecting = false;
                        this.updateStatus('connected', 'Connected');
                        this.subscribe();
                    };

                    this.ws.onmessage = (event) => {
                        try {
                            const message = JSON.parse(event.data);
                            this.handleMessage(message);
                        } catch (error) {
                            console.error('Error parsing WebSocket message:', error);
                        }
                    };

                    this.ws.onerror = (error) => {
                        console.error('WebSocket error:', error);
                        this.updateStatus('disconnected', 'Connection Error');
                    };

                    this.ws.onclose = () => {
                        console.log('WebSocket disconnected');
                        this.isConnecting = false;
                        this.updateStatus('disconnected', 'Disconnected');

                        // Attempt to reconnect after delay
                        setTimeout(() => this.connect(), this.reconnectInterval);
                    };
                } catch (error) {
                    console.error('Error creating WebSocket:', error);
                    this.isConnecting = false;
                    this.updateStatus('disconnected', 'Failed to Connect');
                    setTimeout(() => this.connect(), this.reconnectInterval);
                }
            }

            subscribe() {
                if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {
                    return;
                }

                // Subscribe to dashboard room
                this.send({
                    type: 'subscribe',
                    room: 'dashboard'
                });

                // Subscribe to consultations room
                this.send({
                    type: 'subscribe',
                    room: 'consultations'
                });

                console.log('Subscribed to WebSocket rooms');
            }

            send(data) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify(data));
                }
            }

            handleMessage(message) {
                console.log('WebSocket message received:', message);

                switch(message.type) {
                    case 'dashboard_update':
                        this.handleDashboardUpdate(message.data);
                        break;
                    case 'consultation_update':
                        this.handleConsultationUpdate(message.data);
                        break;
                    case 'system_alert':
                        this.handleSystemAlert(message.data);
                        break;
                    case 'user_activity':
                        this.handleUserActivity(message.data);
                        break;
                    default:
                        console.log('Unknown message type:', message.type);
                }
            }

            handleDashboardUpdate(data) {
                console.log('Dashboard update:', data);

                // Update dashboard stats in real-time
                if (data.stats) {
                    updateDashboardStats(data.stats);
                }

                // Refresh AI insights if available
                if (data.insights) {
                    renderAIInsights(data.insights);
                }

                showToast('Dashboard updated with real-time data', 'info');
            }

            handleConsultationUpdate(data) {
                console.log('Consultation update:', data);

                // Reload consultations section if visible
                const consultationsSection = document.getElementById('consultations-section');
                if (consultationsSection && !consultationsSection.classList.contains('hidden')) {
                    loadConsultationsData();
                }

                showToast(`Consultation ${data.action}: ${data.id}`, 'info');
            }

            handleSystemAlert(data) {
                console.log('System alert:', data);

                // Show critical alerts as toast notifications
                const severity = data.severity || 'warning';
                showToast(`System Alert: ${data.message}`, severity);

                // Send email notification for critical alerts
                if (severity === 'critical' && document.getElementById('enableSystemAlerts')?.checked) {
                    sendEmailNotification({
                        subject: `CRITICAL ALERT: ${data.message}`,
                        message: data.details || data.message,
                        priority: 'high'
                    });
                }
            }

            handleUserActivity(data) {
                console.log('User activity:', data);
                // Update activity feed if on dashboard
            }

            updateStatus(status, text) {
                const statusDot = document.getElementById('wsStatusDot');
                const statusText = document.getElementById('wsStatusText');

                if (statusDot) {
                    statusDot.className = 'ws-status-dot ' + status;
                }
                if (statusText) {
                    statusText.textContent = text;
                }
            }

            disconnect() {
                if (this.ws) {
                    this.ws.close();
                    this.ws = null;
                }
            }
        }

        // Initialize WebSocket client
        let wsClient = null;

        // ===================================
        // EMAIL NOTIFICATION INTEGRATION
        // ===================================

        async function sendEmailNotification(options) {
            const { subject, message, priority = 'normal', to = null } = options;

            try {
                const notificationEmail = to || document.getElementById('notificationEmail')?.value || 'admin@lydian.medical';
                const notificationEmailCC = document.getElementById('notificationEmailCC')?.value;

                const response = await fetch('/api/notifications/email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        to: notificationEmail,
                        cc: notificationEmailCC || undefined,
                        subject: subject,
                        message: message,
                        priority: priority,
                        timestamp: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Email notification sent:', result);
                    showToast('Email notification sent successfully', 'success');
                    return result;
                } else {
                    throw new Error('Failed to send email notification');
                }
            } catch (error) {
                console.error('Error sending email notification:', error);
                showToast('Failed to send email notification', 'error');
                return null;
            }
        }

        // ===================================
        // PDF EXPORT INTEGRATION
        // ===================================

        async function exportAnalyticsToPDF() {
            const button = event.target.closest('button');
            if (button) button.disabled = true;

            showLoadingOverlay('Generating Analytics PDF...');

            try {
                const response = await fetch('/api/export/pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        type: 'analytics',
                        data: {
                            userGrowth: getMockAnalyticsData().userGrowth,
                            apiUsage: getMockAnalyticsData().apiUsage,
                            consultations: getMockAnalyticsData().consultations
                        },
                        options: {
                            title: 'Analytics Report',
                            includeCharts: true,
                            includeTimestamp: true
                        }
                    })
                });

                hideLoadingOverlay();

                if (response.ok) {
                    const result = await response.json();

                    if (result.downloadUrl) {
                        // Create download link
                        const a = document.createElement('a');
                        a.href = result.downloadUrl;
                        a.download = result.filename || 'analytics-report.pdf';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);

                        showToast('Analytics PDF exported successfully', 'success');
                    }
                } else {
                    throw new Error('PDF export failed');
                }
            } catch (error) {
                console.error('Error exporting analytics PDF:', error);
                showToast('Failed to export PDF', 'error');
                hideLoadingOverlay();
            } finally {
                if (button) button.disabled = false;
            }
        }

        async function exportUsersToPDF() {
            const button = event.target.closest('button');
            if (button) button.disabled = true;

            showLoadingOverlay('Generating Users PDF...');

            try {
                const users = getMockUsers();

                const response = await fetch('/api/export/pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        type: 'users',
                        data: { users: users },
                        options: {
                            title: 'User Management Report',
                            includeTimestamp: true
                        }
                    })
                });

                hideLoadingOverlay();

                if (response.ok) {
                    const result = await response.json();

                    if (result.downloadUrl) {
                        const a = document.createElement('a');
                        a.href = result.downloadUrl;
                        a.download = result.filename || 'users-report.pdf';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);

                        showToast('Users PDF exported successfully', 'success');
                    }
                } else {
                    throw new Error('PDF export failed');
                }
            } catch (error) {
                console.error('Error exporting users PDF:', error);
                showToast('Failed to export PDF', 'error');
                hideLoadingOverlay();
            } finally {
                if (button) button.disabled = false;
            }
        }

        async function exportConsultationsToPDF() {
            const button = event.target.closest('button');
            if (button) button.disabled = true;

            showLoadingOverlay('Generating Consultations PDF...');

            try {
                const consultations = getMockConsultations();

                const response = await fetch('/api/export/pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        type: 'consultations',
                        data: { consultations: consultations },
                        options: {
                            title: 'Consultations Report',
                            includeTimestamp: true
                        }
                    })
                });

                hideLoadingOverlay();

                if (response.ok) {
                    const result = await response.json();

                    if (result.downloadUrl) {
                        const a = document.createElement('a');
                        a.href = result.downloadUrl;
                        a.download = result.filename || 'consultations-report.pdf';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);

                        showToast('Consultations PDF exported successfully', 'success');
                    }
                } else {
                    throw new Error('PDF export failed');
                }
            } catch (error) {
                console.error('Error exporting consultations PDF:', error);
                showToast('Failed to export PDF', 'error');
                hideLoadingOverlay();
            } finally {
                if (button) button.disabled = false;
            }
        }

        // ===================================
        // AI INSIGHTS INTEGRATION
        // ===================================

        async function loadAIInsights() {
            const container = document.getElementById('aiInsightsContainer');

            try {
                const response = await fetch('/api/ai/insights', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    renderAIInsights(result.insights || []);
                } else {
                    // Use mock data if API fails
                    renderAIInsights(getMockAIInsights());
                }
            } catch (error) {
                console.error('Error loading AI insights:', error);
                renderAIInsights(getMockAIInsights());
            }
        }

        function getMockAIInsights() {
            return [
                {
                    id: 'insight_1',
                    title: 'High API Usage Detected',
                    priority: 'high',
                    description: 'API request volume has increased by 45% in the last 24 hours. This trend may require scaling adjustments.',
                    recommendations: [
                        'Consider increasing server capacity',
                        'Review rate limiting policies',
                        'Monitor response times closely'
                    ],
                    confidence: 0.92,
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'insight_2',
                    title: 'User Engagement Optimization',
                    priority: 'medium',
                    description: 'User session duration has decreased by 15%. AI analysis suggests improving onboarding flow.',
                    recommendations: [
                        'Simplify initial consultation steps',
                        'Add interactive tutorials',
                        'Enhance mobile responsiveness'
                    ],
                    confidence: 0.78,
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'insight_3',
                    title: 'System Performance Excellent',
                    priority: 'low',
                    description: 'All services are operating within optimal parameters. No immediate action required.',
                    recommendations: [
                        'Maintain current monitoring practices',
                        'Schedule routine maintenance'
                    ],
                    confidence: 0.95,
                    timestamp: new Date().toISOString()
                }
            ];
        }

        function renderAIInsights(insights) {
            const container = document.getElementById('aiInsightsContainer');

            if (!insights || insights.length === 0) {
                container.innerHTML = '<p style="color: #666666; text-align: center; padding: 2rem;">No AI insights available at this time.</p>';
                return;
            }

            const html = insights.map(insight => `
                <div class="insight-card">
                    <div class="insight-header">
                        <h3 class="insight-title">${insight.title}</h3>
                        <span class="priority-badge ${insight.priority}">${insight.priority}</span>
                    </div>
                    <p class="insight-description">${insight.description}</p>
                    <div class="insight-recommendations">
                        <h4>Recommendations:</h4>
                        <ul>
                            ${insight.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="confidence-score">
                        <span>Confidence:</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${insight.confidence * 100}%"></div>
                        </div>
                        <span>${Math.round(insight.confidence * 100)}%</span>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        async function refreshAIInsights() {
            const container = document.getElementById('aiInsightsContainer');
            container.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <span>Refreshing AI insights...</span>
                </div>
            `;
            await loadAIInsights();
        }

        // ===================================
        // TOAST NOTIFICATION SYSTEM
        // ===================================

        function showToast(message, type = 'info') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast-notification');
            existingToasts.forEach(toast => toast.remove());

            // Create new toast
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()"></button>
            `;

            document.body.appendChild(toast);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        // ===================================
        // LOADING OVERLAY
        // ===================================

        function showLoadingOverlay(message = 'Loading...') {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.id = 'loadingOverlay';
            overlay.innerHTML = `
                <div class="loading-content">
                    <div class="loading-spinner" style="margin: 0 auto 1rem;"></div>
                    <p style="color: #000000; font-weight: 600;">${message}</p>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // ===================================
        // DASHBOARD INITIALIZATION
        // ===================================

        // Initialize dashboard on load
        if (isLoggedIn) {
            loadDashboardData();
            logActivity('dashboard_view', 'User viewed dashboard');

            // Initialize WebSocket connection
            wsClient = new WebSocketClient();
            wsClient.connect();

            // Load AI Insights
            loadAIInsights();

            // Auto-refresh AI insights every 5 minutes
            setInterval(loadAIInsights, 5 * 60 * 1000);

            // Refresh data every 30 seconds
            setInterval(loadDashboardData, 30000);

            // Cleanup on page unload
            window.addEventListener('beforeunload', () => {
                if (wsClient) {
                    wsClient.disconnect();
                }
            });
        }

        // Prevent form resubmission on page refresh
        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }

        // ============================================================
        // MEDICAL EXPERT AI - STATE & HELPER FUNCTIONS
        // ============================================================

        // Medical Expert AI State
        const medicalExpertState = {
            messages: [],
            currentSpecialty: 'general-medicine',
            currentLanguage: 'en',
            isRecording: false,
            mediaRecorder: null,
            audioChunks: [],
            recordingStartTime: null
        };

        // Escape HTML for security
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        // Display calculator result
        function displayResult(elementId, html, isError = false) {
            const resultEl = document.getElementById(elementId);
            if (!resultEl) return;

            resultEl.innerHTML = html;
            resultEl.classList.remove('error');
            if (isError) {
                resultEl.classList.add('error');
            }
            resultEl.classList.add('show');
        }

        // Scroll chat to bottom
        function scrollChatToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // ============================================================
        // AI CHAT INTERFACE FUNCTIONS
        // ============================================================

        function changeSpecialty(specialty) {
            medicalExpertState.currentSpecialty = specialty;
            console.log('Specialty changed to:', specialty);
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('chatSendBtn');
            const text = input.value.trim();

            if (!text) return;

            // Add user message
            addChatMessage(text, true);
            input.value = '';
            sendBtn.disabled = true;

            // Show typing indicator
            showTypingIndicator();

            try {
                const response = await fetch('/api/medical/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        message: text,
                        language: medicalExpertState.currentLanguage,
                        specialization: medicalExpertState.currentSpecialty,
                        user_id: 'user-001',
                        hospital_id: 'hospital-001',
                        patient_id: 'patient-001'
                    })
                });

                const data = await response.json();
                hideTypingIndicator();

                if (data.success && data.response) {
                    addChatMessage(data.response, false);
                } else {
                    throw new Error(data.error || 'Failed to get AI response');
                }
            } catch (error) {
                hideTypingIndicator();
                console.error('Chat error:', error);
                addChatMessage('An error occurred. Please check your connection and try again.', false);
                showToast('Chat error: ' + error.message, 'error');
            } finally {
                sendBtn.disabled = false;
            }
        }

        function addChatMessage(content, isUser = false) {
            const chatMessages = document.getElementById('chatMessages');
            const emptyState = document.getElementById('chatEmptyState');

            if (emptyState) {
                emptyState.style.display = 'none';
            }

            const message = {
                id: Date.now().toString(),
                role: isUser ? 'user' : 'ai',
                content: content,
                timestamp: new Date().toISOString()
            };

            medicalExpertState.messages.push(message);

            const time = new Date(message.timestamp).toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.role}`;
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${isUser ? `
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    ` : `
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"/>
                            <path d="M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4"/>
                            <circle cx="20" cy="10" r="2"/>
                        </svg>
                    `}
                </div>
                <div class="message-content">
                    <div class="message-bubble">${escapeHtml(content)}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;

            chatMessages.appendChild(messageDiv);
            scrollChatToBottom();
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const indicator = document.createElement('div');
            indicator.id = 'typingIndicator';
            indicator.className = 'message ai';
            indicator.innerHTML = `
                <div class="message-avatar">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3"/>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(indicator);
            scrollChatToBottom();
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        // ============================================================
        // MEDICAL CALCULATORS FUNCTIONS
        // ============================================================

        function switchCalculator(calcId) {
            // Update tabs
            document.querySelectorAll('.calculator-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.calculator-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(calcId + '-calc').classList.add('active');
        }

        async function assessVitalSigns() {
            const systolic = parseInt(document.getElementById('vitalSystolic').value);
            const diastolic = parseInt(document.getElementById('vitalDiastolic').value);
            const heartRate = parseInt(document.getElementById('vitalHeartRate').value);
            const temperature = parseFloat(document.getElementById('vitalTemp').value);
            const spO2 = parseInt(document.getElementById('vitalSpO2').value);
            const respiratoryRate = parseInt(document.getElementById('vitalRespRate').value);

            if (!systolic || !diastolic || !heartRate || !temperature || !spO2 || !respiratoryRate) {
                displayResult('vitalSignsResult', 'Please fill in all vital signs', true);
                return;
            }

            try {
                const response = await fetch('/api/medical/general/vital-signs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        systolic, diastolic, heartRate, temperature, spO2, respiratoryRate,
                        hospital_id: 'hospital-001', user_id: 'user-001', patient_id: 'patient-001'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const assessment = data.assessment;
                    let html = `
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--medical-primary);">Vital Signs Assessment</h4>
                        <div style="background: ${assessment.overallStatus === 'critical' ? '#FEF2F2' : assessment.overallStatus === 'abnormal' ? '#FEF3C7' : '#ECFDF5'}; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <strong>Overall Status:</strong> ${assessment.overallStatus.toUpperCase()}
                            ${assessment.alerts && assessment.alerts.length > 0 ? '<br><strong style="color: #DC2626;">' + assessment.alerts.join('<br>') + '</strong>' : ''}
                        </div>
                        <div style="display: grid; gap: 0.75rem;">
                            <div><strong>Blood Pressure:</strong> ${assessment.bloodPressure.systolic}/${assessment.bloodPressure.diastolic} mmHg - ${assessment.bloodPressure.category}<br><small>${assessment.bloodPressure.recommendation}</small></div>
                            <div><strong>Heart Rate:</strong> ${assessment.heartRate.heartRate} bpm - ${assessment.heartRate.category}<br><small>${assessment.heartRate.recommendation}</small></div>
                            <div><strong>Temperature:</strong> ${assessment.temperature.temperature}C - ${assessment.temperature.category}<br><small>${assessment.temperature.recommendation}</small></div>
                            <div><strong>SpO2:</strong> ${assessment.oxygenSaturation.spO2}% - ${assessment.oxygenSaturation.category}<br><small>${assessment.oxygenSaturation.recommendation}</small></div>
                            <div><strong>Respiratory Rate:</strong> ${assessment.respiratoryRate.respiratoryRate}/min - ${assessment.respiratoryRate.category}<br><small>${assessment.respiratoryRate.recommendation}</small></div>
                        </div>
                    `;
                    displayResult('vitalSignsResult', html);
                } else {
                    throw new Error(data.error || 'Failed to assess vital signs');
                }
            } catch (error) {
                displayResult('vitalSignsResult', `Error: ${error.message}`, true);
            }
        }

        async function calculateBMI() {
            const weight = parseFloat(document.getElementById('bmiWeight').value);
            const height = parseFloat(document.getElementById('bmiHeight').value);
            const unit = document.getElementById('bmiUnit').value;

            if (!weight || !height) {
                displayResult('bmiResult', 'Please enter weight and height', true);
                return;
            }

            try {
                const response = await fetch('/api/medical/general/bmi', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        weight, height, unit,
                        hospital_id: 'hospital-001', user_id: 'user-001', patient_id: 'patient-001'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const bmi = data.bmi;
                    const bsa = data.bsa;
                    let html = `
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--medical-primary);">BMI Results</h4>
                        <div style="background: ${bmi.status === 'critical' ? '#FEF2F2' : bmi.status === 'abnormal' ? '#FEF3C7' : '#ECFDF5'}; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <strong style="font-size: 1.5rem;">${bmi.bmi}</strong> - ${bmi.category}
                        </div>
                        <div style="display: grid; gap: 0.5rem; font-size: 0.9375rem;">
                            <div><strong>Status:</strong> ${bmi.status}</div>
                            <div><strong>Recommendation:</strong> ${bmi.recommendation}</div>
                            <div><strong>Ideal Weight:</strong> ${bmi.idealWeight} kg</div>
                            <div><strong>Weight Difference:</strong> ${bmi.weightDifference > 0 ? '+' : ''}${bmi.weightDifference} kg</div>
                            <div><strong>Body Surface Area (BSA):</strong> ${bsa.bsa} ${bsa.unit}</div>
                            <div><small style="color: var(--text-tertiary);">${bsa.use}</small></div>
                        </div>
                    `;
                    displayResult('bmiResult', html);
                } else {
                    throw new Error(data.error || 'Failed to calculate BMI');
                }
            } catch (error) {
                displayResult('bmiResult', `Error: ${error.message}`, true);
            }
        }

        async function calculateFramingham() {
            const age = parseInt(document.getElementById('framAge').value);
            const gender = document.getElementById('framGender').value;
            const totalCholesterol = parseInt(document.getElementById('framTotalChol').value);
            const hdlCholesterol = parseInt(document.getElementById('framHDL').value);
            const systolicBP = parseInt(document.getElementById('framSystolic').value);
            const isSmoker = document.getElementById('framSmoker').checked;
            const isDiabetic = document.getElementById('framDiabetic').checked;
            const onBPMeds = document.getElementById('framOnBPMeds').checked;

            if (!age || !gender || !totalCholesterol || !hdlCholesterol || !systolicBP) {
                displayResult('framinghamResult', 'Please fill in all required fields', true);
                return;
            }

            try {
                const response = await fetch('/api/medical/cardiology/framingham', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        age, gender, totalCholesterol, hdlCholesterol, systolicBP, isSmoker, isDiabetic, onBPMeds,
                        hospital_id: 'hospital-001', user_id: 'user-001', patient_id: 'patient-001'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const result = data.result;
                    let html = `
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--medical-primary);">Framingham Risk Score</h4>
                        <div style="background: ${result.riskCategory === 'high' ? '#FEF2F2' : result.riskCategory === 'intermediate' ? '#FEF3C7' : '#ECFDF5'}; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--medical-primary);">${result.riskScore}%</div>
                            <div style="font-weight: 600; margin-top: 0.5rem;">${result.riskCategory.toUpperCase()} RISK</div>
                            <div style="font-size: 0.875rem; margin-top: 0.25rem; color: var(--text-tertiary);">10-year cardiovascular disease risk</div>
                        </div>
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                            <strong>Interpretation:</strong> ${result.interpretation}<br><br>
                            <strong>Recommendations:</strong>
                            <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                    displayResult('framinghamResult', html);
                } else {
                    throw new Error(data.error || 'Failed to calculate Framingham risk');
                }
            } catch (error) {
                displayResult('framinghamResult', `Error: ${error.message}`, true);
            }
        }

        async function calculateGCS() {
            const eyeOpening = parseInt(document.getElementById('gcsEye').value);
            const verbalResponse = parseInt(document.getElementById('gcsVerbal').value);
            const motorResponse = parseInt(document.getElementById('gcsMotor').value);

            try {
                const response = await fetch('/api/medical/neurology/gcs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: JSON.stringify({
                        eyeOpening, verbalResponse, motorResponse,
                        hospital_id: 'hospital-001', user_id: 'user-001', patient_id: 'patient-001'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const result = data.result;
                    let html = `
                        <h4 style="font-weight: 700; margin-bottom: 1rem; color: var(--medical-primary);">Glasgow Coma Scale</h4>
                        <div style="background: ${result.totalScore <= 8 ? '#FEF2F2' : result.totalScore <= 12 ? '#FEF3C7' : '#ECFDF5'}; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--medical-primary);">${result.totalScore}</div>
                            <div style="font-weight: 600; margin-top: 0.5rem;">${result.severity}</div>
                            <div style="font-size: 0.875rem; margin-top: 0.25rem; color: var(--text-tertiary);">${result.scale}</div>
                        </div>
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 1rem;">
                            <strong>Components:</strong><br>
                             Eye Opening (${result.breakdown.eyeOpening}): ${result.components.eye}<br>
                             Verbal Response (${result.breakdown.verbalResponse}): ${result.components.verbal}<br>
                             Motor Response (${result.breakdown.motorResponse}): ${result.components.motor}
                        </div>
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                            <strong>Interpretation:</strong> ${result.interpretation}<br>
                            <strong>Recommendation:</strong> ${result.recommendation}
                        </div>
                    `;
                    displayResult('gcsResult', html);
                } else {
                    throw new Error(data.error || 'Failed to calculate GCS');
                }
            } catch (error) {
                displayResult('gcsResult', `Error: ${error.message}`, true);
            }
        }

        // ============================================================
        // EMERGENCY TOOLS FUNCTIONS
        // ============================================================

        function callEmergency(number) {
            if (confirm(`Call emergency number ${number}?`)) {
                window.open(`tel:${number}`);
                showToast(`Calling ${number}`, 'info');
            }
        }

        async function loadEmergencyNumbers(language) {
            try {
                const response = await fetch(`/api/medical/emergency-numbers?language=${language}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    }
                });

                const data = await response.json();

                if (data.success && data.numbers) {
                    displayEmergencyNumbers(data.numbers);
                }
            } catch (error) {
                console.error('Emergency numbers error:', error);
            }
        }

        function displayEmergencyNumbers(numbers) {
            const grid = document.getElementById('emergencyGrid');
            if (!grid) return;

            grid.innerHTML = numbers.map(item => `
                <div class="emergency-card" onclick="callEmergency('${item.number}')">
                    <div class="emergency-number">${item.number}</div>
                    <div class="emergency-label">${item.label}</div>
                </div>
            `).join('');
        }

        // ============================================================
        // SPECIALTIES FUNCTIONS
        // ============================================================

        function launchSpecialty(specialty) {
            window.open(`/medical-expert.html?specialty=${specialty}`, '_blank');
        }

        // ============================================================
        // MEDICAL IMAGING FUNCTIONS
        // ============================================================

        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);
            formData.append('hospital_id', 'hospital-001');
            formData.append('user_id', 'user-001');
            formData.append('patient_id', 'patient-001');

            showLoadingOverlay('Analyzing medical image...');

            try {
                const response = await fetch('/api/medical/radiology-analysis', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: formData
                });

                const data = await response.json();
                hideLoadingOverlay();

                if (data.success && data.analysis) {
                    document.getElementById('imageAnalysisResult').style.display = 'block';
                    document.getElementById('imageAnalysisContent').innerHTML = `
                        <h4 style="font-weight: 700; margin-bottom: 1rem;">AI Analysis Results</h4>
                        <p style="line-height: 1.8;">${escapeHtml(data.analysis)}</p>
                    `;
                    showToast('Image analysis completed', 'success');
                } else {
                    throw new Error(data.error || 'Analysis failed');
                }
            } catch (error) {
                hideLoadingOverlay();
                console.error('Image upload error:', error);
                showToast('Image analysis failed: ' + error.message, 'error');
            }
        }

        // ============================================================
        // VOICE NOTES FUNCTIONS
        // ============================================================

        async function toggleRecording() {
            if (medicalExpertState.isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                medicalExpertState.mediaRecorder = new MediaRecorder(stream);
                medicalExpertState.audioChunks = [];
                medicalExpertState.isRecording = true;
                medicalExpertState.recordingStartTime = Date.now();

                medicalExpertState.mediaRecorder.addEventListener('dataavailable', event => {
                    medicalExpertState.audioChunks.push(event.data);
                });

                medicalExpertState.mediaRecorder.addEventListener('stop', async () => {
                    const audioBlob = new Blob(medicalExpertState.audioChunks, { type: 'audio/webm' });
                    await transcribeAudio(audioBlob);
                });

                medicalExpertState.mediaRecorder.start();

                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordingStatus').textContent = 'Recording in progress...';
                document.getElementById('recordingTime').style.display = 'block';

                updateRecordingTime();
            } catch (error) {
                console.error('Recording error:', error);
                showToast('Failed to start recording: ' + error.message, 'error');
            }
        }

        function stopRecording() {
            if (medicalExpertState.mediaRecorder && medicalExpertState.isRecording) {
                medicalExpertState.mediaRecorder.stop();
                medicalExpertState.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                medicalExpertState.isRecording = false;

                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordingStatus').textContent = 'Processing transcription...';
                document.getElementById('recordingTime').style.display = 'none';
            }
        }

        function updateRecordingTime() {
            if (!medicalExpertState.isRecording) return;

            const elapsed = Math.floor((Date.now() - medicalExpertState.recordingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('recordingTime').textContent = `${minutes}:${seconds}`;

            setTimeout(updateRecordingTime, 1000);
        }

        async function transcribeAudio(audioBlob) {
            const formData = new FormData();
            formData.append('audio', audioBlob, 'recording.webm');
            formData.append('hospital_id', 'hospital-001');
            formData.append('user_id', 'user-001');

            try {
                const response = await fetch('/api/medical/transcribe', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${sessionStorage.getItem('authToken') || 'demo-token'}`
                    },
                    body: formData
                });

                const data = await response.json();

                if (data.success && data.transcription) {
                    document.getElementById('transcriptionResult').style.display = 'block';
                    document.getElementById('transcriptionContent').textContent = data.transcription;
                    document.getElementById('recordingStatus').textContent = 'Click the button to start recording';
                    showToast('Transcription completed', 'success');
                } else {
                    throw new Error(data.error || 'Transcription failed');
                }
            } catch (error) {
                console.error('Transcription error:', error);
                document.getElementById('recordingStatus').textContent = 'Transcription failed. Click to try again.';
                showToast('Transcription failed: ' + error.message, 'error');
            }
        }

        function copyTranscription() {
            const text = document.getElementById('transcriptionContent').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showToast('Transcription copied to clipboard', 'success');
            }).catch(err => {
                showToast('Failed to copy transcription', 'error');
            });
        }
    </script>
</body>
</html>
