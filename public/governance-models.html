<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Model Registry - Manage and track AI models lifecycle">
    <title>Model Registry | AI Governance</title>

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- i18n System -->
    <script src="/js/governance-i18n.js"></script>

    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-DRAFT { background-color: #FEF3C7; color: #92400E; }
        .status-TESTING { background-color: #DBEAFE; color: #1E40AF; }
        .status-ACTIVE { background-color: #D1FAE5; color: #065F46; }
        .status-DEPRECATED { background-color: #FEE2E2; color: #991B1B; }
        .status-ARCHIVED { background-color: #E5E7EB; color: #374151; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-4">
                    <a href="/governance-dashboard.html" class="text-gray-600 hover:text-gray-900" data-i18n="nav.back">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </a>
                    <h1 class="text-2xl font-bold text-gray-900" data-i18n="models.title">Model Kayıt</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <button onclick="GovernanceI18n.setLanguage('tr')"
                                class="px-3 py-1 rounded transition text-sm"
                                id="lang-tr">
                            TR
                        </button>
                        <button onclick="GovernanceI18n.setLanguage('en')"
                                class="px-3 py-1 rounded transition text-sm"
                                id="lang-en">
                            EN
                        </button>
                    </div>
                    <button onclick="openRegisterModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition" data-i18n="models.register">
                        + Model Kaydet
                    </button>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition" data-i18n="nav.logout">
                        Çıkış
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Filters and Search -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Search -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="models.search">Ara</label>
                    <input type="text" id="searchInput" data-i18n="models.search_placeholder" placeholder="İsim veya sağlayıcıya göre ara..."
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                           onkeyup="handleSearch()">
                </div>

                <!-- Status Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="models.status">Durum</label>
                    <select id="statusFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                            onchange="handleFilters()">
                        <option value="" data-i18n="models.all_statuses">Tüm Durumlar</option>
                        <option value="DRAFT" data-i18n="status.DRAFT">Taslak</option>
                        <option value="TESTING" data-i18n="status.TESTING">Test</option>
                        <option value="ACTIVE" data-i18n="status.ACTIVE">Aktif</option>
                        <option value="DEPRECATED" data-i18n="status.DEPRECATED">Eski</option>
                        <option value="ARCHIVED" data-i18n="status.ARCHIVED">Arşivlenmiş</option>
                    </select>
                </div>

                <!-- Provider Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="models.provider">Sağlayıcı</label>
                    <select id="providerFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                            onchange="handleFilters()">
                        <option value="" data-i18n="models.all_providers">Tüm Sağlayıcılar</option>
                        <option value="OpenAI">OpenAI</option>
                        <option value="Anthropic">Anthropic</option>
                        <option value="Google">Google</option>
                        <option value="Meta">Meta</option>
                        <option value="Custom">Custom</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Models Table -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="models.table.model">Model</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="models.table.version">Version</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="models.table.provider">Provider</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="models.table.status">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="models.table.created">Created</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="models.table.actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="modelsTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Loading State -->
                        <tr>
                            <td colspan="6" class="px-6 py-12 text-center">
                                <div class="flex justify-center">
                                    <div class="loader"></div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200">
                <!-- Pagination will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Register Model Modal -->
    <div id="registerModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-900" data-i18n="models.modal.register_title">Yeni Model Kaydet</h3>
                <button onclick="closeRegisterModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="registerForm" onsubmit="handleRegister(event)" class="px-6 py-4">
                <div class="space-y-4">
                    <!-- Model Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="models.modal.model_name">Model Adı *</label>
                        <input type="text" name="name" required
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                               placeholder="e.g., GPT-4 Medical Assistant">
                    </div>

                    <!-- Version -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="models.modal.version">Versiyon (Semantik) *</label>
                        <input type="text" name="version" required pattern="^\d+\.\d+\.\d+(-[a-zA-Z0-9]+)?$"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                               placeholder="e.g., 1.0.0 or 2.1.3-beta">
                        <p class="text-xs text-gray-500 mt-1">Format: X.Y.Z (e.g., 1.0.0)</p>
                    </div>

                    <!-- Provider -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Provider *</label>
                        <select name="provider" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent">
                            <option value="">Select Provider</option>
                            <option value="OpenAI">OpenAI</option>
                            <option value="Anthropic">Anthropic</option>
                            <option value="Google">Google</option>
                            <option value="Meta">Meta</option>
                            <option value="Custom">Custom</option>
                        </select>
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="models.modal.description">Açıklama</label>
                        <textarea name="description" rows="3"
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent"
                                  placeholder="Brief description of the AI model..."></textarea>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeRegisterModal()"
                                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition" data-i18n="models.modal.cancel">
                            İptal
                        </button>
                        <button type="submit"
                                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition" data-i18n="models.modal.register_btn">
                            Model Kaydet
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Model Details Modal -->
    <div id="detailsModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-900" data-i18n="models.modal.details_title">Model Detayları</h3>
                <button onclick="closeDetailsModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div id="modelDetailsContent" class="px-6 py-4">
                <!-- Details will be inserted here -->
            </div>
        </div>
    </div>

    <script src="/js/governance-auth.js"></script>
    <script>
        // ============================================================================
        // SECURITY UTILITIES (Shared from dashboard)
        // ============================================================================

        const AuthManager = {
            getToken() {
                try {
                    const token = localStorage.getItem('governance_token');
                    if (!token) return null;
                    const payload = this.decodeToken(token);
                    if (!payload || !payload.exp) return null;
                    const now = Math.floor(Date.now() / 1000);
                    if (payload.exp < now) {
                        this.clearToken();
                        return null;
                    }
                    return token;
                } catch (error) {
                    return null;
                }
            },
            decodeToken(token) {
                try {
                    const parts = token.split('.');
                    if (parts.length !== 3) return null;
                    const payload = parts[1];
                    const decoded = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));
                    return JSON.parse(decoded);
                } catch (error) {
                    return null;
                }
            },
            clearToken() {
                localStorage.removeItem('governance_token');
                localStorage.removeItem('governance_user');
            },
            getUser() {
                try {
                    const userStr = localStorage.getItem('governance_user');
                    return userStr ? JSON.parse(userStr) : null;
                } catch (error) {
                    return null;
                }
            },
            isAuthenticated() {
                return this.getToken() !== null;
            }
        };

        function sanitizeHTML(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        async function secureAPICall(url, options = {}) {
            const token = AuthManager.getToken();
            if (!token) throw new Error('Not authenticated');

            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`,
                ...options.headers
            };

            try {
                const response = await fetch(url, {
                    ...options,
                    headers,
                    credentials: 'same-origin'
                });

                if (response.status === 401 || response.status === 403) {
                    AuthManager.clearToken();
                    window.location.href = '/auth.html';
                    throw new Error('Authentication failed');
                }

                if (!response.ok) {
                    const error = await response.json().catch(() => ({ message: 'Request failed' }));
                    throw new Error(error.message || 'Request failed');
                }

                return await response.json();
            } catch (error) {
                throw error;
            }
        }

        function logout() {
            AuthManager.clearToken();
            window.location.href = '/auth.html';
        }

        // ============================================================================
        // MODEL REGISTRY FUNCTIONS
        // ============================================================================

        let allModels = [];
        let filteredModels = [];
        let currentPage = 1;
        const pageSize = 10;

        /**
         * Load models from API
         */
        async function loadModels() {
            try {
                const response = await secureAPICall('/api/governance/models');
                allModels = response.data || [];
                filteredModels = [...allModels];
                renderModels();
            } catch (error) {
                showError('Failed to load models: ' + error.message);
                document.getElementById('modelsTableBody').innerHTML = `
                    <tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">
                        Failed to load models. Please try again.
                    </td></tr>
                `;
            }
        }

        /**
         * Render models table
         */
        function renderModels() {
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageModels = filteredModels.slice(startIndex, endIndex);

            if (pageModels.length === 0) {
                document.getElementById('modelsTableBody').innerHTML = `
                    <tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">
                        No models found. Register your first model!
                    </td></tr>
                `;
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            const html = pageModels.map(model => `
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="viewModelDetails('${sanitizeHTML(model.id)}')">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${sanitizeHTML(model.name)}</div>
                        <div class="text-xs text-gray-500">${sanitizeHTML(model.id)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${sanitizeHTML(model.version)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${sanitizeHTML(model.provider)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge status-${sanitizeHTML(model.status)}">${sanitizeHTML(model.status)}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${new Date(model.createdAt).toLocaleDateString()}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button onclick="event.stopPropagation(); changeModelStatus('${sanitizeHTML(model.id)}', '${sanitizeHTML(model.status)}')"
                                class="text-purple-600 hover:text-purple-900 mr-3">Manage</button>
                        <button onclick="event.stopPropagation(); viewModelDetails('${sanitizeHTML(model.id)}')"
                                class="text-blue-600 hover:text-blue-900">View</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('modelsTableBody').innerHTML = html;
            renderPagination();
        }

        /**
         * Render pagination
         */
        function renderPagination() {
            const totalPages = Math.ceil(filteredModels.length / pageSize);

            if (totalPages <= 1) {
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            const html = `
                <div class="flex items-center justify-between w-full">
                    <div class="text-sm text-gray-700">
                        Showing ${((currentPage - 1) * pageSize) + 1} to ${Math.min(currentPage * pageSize, filteredModels.length)} of ${filteredModels.length} models
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}
                                class="px-3 py-1 rounded border ${currentPage === 1 ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-50'}">
                            Previous
                        </button>
                        ${Array.from({ length: totalPages }, (_, i) => i + 1).map(page => `
                            <button onclick="changePage(${page})"
                                    class="px-3 py-1 rounded ${page === currentPage ? 'bg-purple-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50 border'}">
                                ${page}
                            </button>
                        `).join('')}
                        <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}
                                class="px-3 py-1 rounded border ${currentPage === totalPages ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-50'}">
                            Next
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('pagination').innerHTML = html;
        }

        /**
         * Change page
         */
        function changePage(page) {
            const totalPages = Math.ceil(filteredModels.length / pageSize);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderModels();
        }

        /**
         * Handle search
         */
        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filteredModels = allModels.filter(model =>
                model.name.toLowerCase().includes(searchTerm) ||
                model.provider.toLowerCase().includes(searchTerm) ||
                model.id.toLowerCase().includes(searchTerm)
            );
            handleFilters();
        }

        /**
         * Handle filters
         */
        function handleFilters() {
            const status = document.getElementById('statusFilter').value;
            const provider = document.getElementById('providerFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredModels = allModels.filter(model => {
                const matchesSearch = !searchTerm ||
                    model.name.toLowerCase().includes(searchTerm) ||
                    model.provider.toLowerCase().includes(searchTerm) ||
                    model.id.toLowerCase().includes(searchTerm);
                const matchesStatus = !status || model.status === status;
                const matchesProvider = !provider || model.provider === provider;
                return matchesSearch && matchesStatus && matchesProvider;
            });

            currentPage = 1;
            renderModels();
        }

        /**
         * Open register modal
         */
        function openRegisterModal() {
            document.getElementById('registerModal').classList.add('active');
        }

        /**
         * Close register modal
         */
        function closeRegisterModal() {
            document.getElementById('registerModal').classList.remove('active');
            document.getElementById('registerForm').reset();
        }

        /**
         * Handle model registration
         */
        async function handleRegister(event) {
            event.preventDefault();
            const formData = new FormData(event.target);

            const data = {
                name: formData.get('name'),
                version: formData.get('version'),
                provider: formData.get('provider'),
                description: formData.get('description') || '',
                metadata: {}
            };

            try {
                await secureAPICall('/api/governance/models/register', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                closeRegisterModal();
                showSuccess('Model registered successfully!');
                await loadModels();
            } catch (error) {
                showError('Registration failed: ' + error.message);
            }
        }

        /**
         * View model details
         */
        async function viewModelDetails(modelId) {
            try {
                const response = await secureAPICall(`/api/governance/models/${modelId}`);
                const model = response.data;

                const html = `
                    <div class="space-y-6">
                        <!-- Basic Info -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Basic Information</h4>
                            <dl class="grid grid-cols-2 gap-4">
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Name</dt>
                                    <dd class="mt-1 text-sm text-gray-900">${sanitizeHTML(model.name)}</dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Version</dt>
                                    <dd class="mt-1 text-sm text-gray-900">${sanitizeHTML(model.version)}</dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Provider</dt>
                                    <dd class="mt-1 text-sm text-gray-900">${sanitizeHTML(model.provider)}</dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Status</dt>
                                    <dd class="mt-1"><span class="status-badge status-${sanitizeHTML(model.status)}">${sanitizeHTML(model.status)}</span></dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Created</dt>
                                    <dd class="mt-1 text-sm text-gray-900">${new Date(model.createdAt).toLocaleString()}</dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-500">Updated</dt>
                                    <dd class="mt-1 text-sm text-gray-900">${new Date(model.updatedAt).toLocaleString()}</dd>
                                </div>
                            </dl>
                        </div>

                        <!-- Description -->
                        ${model.description ? `
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-2">Description</h4>
                            <p class="text-sm text-gray-700">${sanitizeHTML(model.description)}</p>
                        </div>
                        ` : ''}

                        <!-- Owner Info -->
                        ${model.owner ? `
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-2">Owner</h4>
                            <p class="text-sm text-gray-700">${sanitizeHTML(model.owner.name || model.owner.email)}</p>
                        </div>
                        ` : ''}

                        <!-- Actions -->
                        <div class="flex justify-end space-x-3 pt-4 border-t">
                            <button onclick="changeModelStatus('${sanitizeHTML(model.id)}', '${sanitizeHTML(model.status)}')"
                                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                                Change Status
                            </button>
                            <button onclick="closeDetailsModal()"
                                    class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition">
                                Close
                            </button>
                        </div>
                    </div>
                `;

                document.getElementById('modelDetailsContent').innerHTML = html;
                document.getElementById('detailsModal').classList.add('active');
            } catch (error) {
                showError('Failed to load model details: ' + error.message);
            }
        }

        /**
         * Close details modal
         */
        function closeDetailsModal() {
            document.getElementById('detailsModal').classList.remove('active');
        }

        /**
         * Change model status (lifecycle management)
         */
        async function changeModelStatus(modelId, currentStatus) {
            const validTransitions = {
                DRAFT: ['TESTING', 'ARCHIVED'],
                TESTING: ['DRAFT', 'ACTIVE', 'ARCHIVED'],
                ACTIVE: ['DEPRECATED', 'ARCHIVED'],
                DEPRECATED: ['ACTIVE', 'ARCHIVED'],
                ARCHIVED: []
            };

            const allowed = validTransitions[currentStatus] || [];

            if (allowed.length === 0) {
                showError('Model is archived and cannot be changed');
                return;
            }

            const options = allowed.map(status => `<option value="${status}">${status}</option>`).join('');
            const newStatus = prompt(`Change status from ${currentStatus} to:\n\nAllowed: ${allowed.join(', ')}\n\nEnter new status:`);

            if (!newStatus) return;

            if (!allowed.includes(newStatus.toUpperCase())) {
                showError(`Invalid transition from ${currentStatus} to ${newStatus}`);
                return;
            }

            try {
                await secureAPICall(`/api/governance/models/${modelId}/status`, {
                    method: 'POST',
                    body: JSON.stringify({ status: newStatus.toUpperCase() })
                });

                showSuccess('Status updated successfully!');
                await loadModels();
                closeDetailsModal();
            } catch (error) {
                showError('Failed to update status: ' + error.message);
            }
        }

        /**
         * Show success message
         */
        function showSuccess(message) {
            alert('✅ ' + sanitizeHTML(message));
        }

        /**
         * Show error message
         */
        function showError(message) {
            alert('❌ ' + sanitizeHTML(message));
        }

        /**
         * Update language switcher buttons
         */
        function updateLanguageSwitcher() {
            const currentLang = GovernanceI18n.currentLang;
            const trBtn = document.getElementById('lang-tr');
            const enBtn = document.getElementById('lang-en');

            if (currentLang === 'tr') {
                trBtn.className = 'px-3 py-1 rounded bg-purple-600 text-white hover:bg-purple-500 transition text-sm';
                enBtn.className = 'px-3 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition text-sm';
            } else {
                trBtn.className = 'px-3 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 transition text-sm';
                enBtn.className = 'px-3 py-1 rounded bg-purple-600 text-white hover:bg-purple-500 transition text-sm';
            }
        }

        /**
         * Initialize page
         */
        async function initPage() {
            // DEMO MODE: Allow access without authentication
            const DEMO_MODE = true; // Set to false in production

            if (!AuthManager.isAuthenticated() && !DEMO_MODE) {
                window.location.href = '/auth.html';
                return;
            }

            await loadModels();

            // Translate page and update language switcher
            GovernanceI18n.translatePage();
            updateLanguageSwitcher();
        }

        // Handle language change
        window.addEventListener('languageChanged', () => {
            location.reload();
        });

        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
