<!-- Cache-Buster: 1759577324 --><!doctype html>
<html lang="tr">
  <head>
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover, interactive-widget=resizes-content"
    />

    <!-- Favicon - Lydian Grape Logo -->
    <link rel="icon" type="image/svg+xml" href="/icons/grape-icon-simple.svg" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/grape-favicon-16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/grape-favicon-32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="/icons/grape-favicon-48.png" />
    <link rel="icon" type="image/x-icon" href="/icons/grape-favicon.ico" />
    <link rel="shortcut icon" href="/icons/grape-favicon.ico" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-180.png" />

    <!-- Prevent FOUC on desktop: suppress all transitions and set final layout immediately -->
    <script>
      if (window.innerWidth > 768) document.documentElement.classList.add('desktop-early');
    </script>
    <style>
      .desktop-early .sidebar {
        display: none !important;
      }
      .desktop-early .chat-header {
        left: 0 !important;
        width: 100% !important;
      }
      .desktop-early .chat-container {
        margin-left: 0 !important;
        width: 100% !important;
      }
      .desktop-early *,
      .desktop-early *::before,
      .desktop-early *::after {
        transition: none !important;
        animation: none !important;
      }
    </style>

    <!-- GeoIP Auto-Language Detection (MUST BE FIRST) -->
    <script src="/js/geo-language.js"></script>

    <!-- Premium Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="" />
    <!-- Fonts - Inline critical fonts for instant load -->
    <style>
      /* Righteous font for Logo - Inline for instant load */
      @font-face {
        font-family: 'Righteous';
        font-style: normal;
        font-weight: 400;
        font-display: block;
        src: url(https://fonts.gstatic.com/s/righteous/v14/1cXxaUPXBpj2rGoU7C9WhnGFucE.woff2)
          format('woff2');
        unicode-range:
          U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F,
          U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
    </style>
    <link
      rel="preload"
      as="style"
      as="style"
      crossorigin="anonymous"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;family=JetBrains+Mono:wght@400;500;600;700&amp;family=Orbitron:wght@400;500;600;700;800;900&amp;family=Righteous&amp;display=swap"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;family=JetBrains+Mono:wght@400;500;600;700&amp;family=Orbitron:wght@400;500;600;700;800;900&amp;family=Righteous&amp;display=swap"
      rel="stylesheet"
      crossorigin="anonymous"
    />

    <style>
      /* ============================================================
   âœ¨ CLEAN WHITE PREMIUM CHAT INTERFACE 2025
   ============================================================ */

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* Premium White Color System */
        --bg-0: #0a0b0d;
        --bg-1: #111214;
        --glass: rgba(255, 255, 255, 0.05);
        --glass-2: rgba(255, 255, 255, 0.03);
        --stroke: rgba(255, 255, 255, 0.08);
        --txt-1: #ffffff;
        --txt-2: #b0b0b0;
        --accent-1: #ffffff; /* Premium white */
        --accent-2: #6e84ff; /* Electric blue */
        --accent-3: #b86bff; /* Purple */
        --warning: #fdb022; /* Gold warning */

        /* Premium Gradients */
        --gradient-primary: linear-gradient(135deg, var(--accent-1), var(--accent-2));
        --gradient-subtle: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08),
          rgba(110, 132, 255, 0.08)
        );
        --gradient-accent: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.12),
          rgba(110, 132, 255, 0.12)
        );

        /* Background System */
        --bg-primary: var(--bg-0);
        --bg-secondary: var(--bg-1);
        --bg-tertiary: var(--glass);
        --bg-hover: var(--glass);

        /* Text Colors */
        --text-primary: var(--txt-1);
        --text-secondary: var(--txt-2);
        --text-tertiary: #888888;
        --text-muted: #666666;

        /* Border Radius */
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-full: 9999px;

        /* Font Stacks */
        --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        --font-mono: 'JetBrains Mono', 'SF Mono', monospace;

        /* Premium Shadows */
        --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.3);
        --shadow-base: 0 8px 24px rgba(0, 0, 0, 0.4);
        --shadow-md: 0 12px 32px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.6);
        --shadow-xl: 0 24px 64px rgba(0, 0, 0, 0.7);
        --shadow-green: 0 8px 24px rgba(255, 255, 255, 0.1);
        --shadow-orange: 0 8px 24px rgba(110, 132, 255, 0.3);
        --shadow-hover: 0 12px 32px rgba(255, 255, 255, 0.08);
        --shadow-neon: none;

        /* Borders */
        --border-light: 1px solid var(--stroke);
        --border-medium: 1px solid rgba(255, 255, 255, 0.12);
        --border-green: 1px solid rgba(255, 255, 255, 0.3);
        --border-orange: 1px solid var(--accent-2);
      }

      /* ============================================================
         â˜€ï¸ LIGHT THEME - Premium Clean White
         ============================================================ */
      [data-theme='light'] {
        --bg-0: #ffffff;
        --bg-1: #f5f5f7;
        --glass: rgba(0, 0, 0, 0.03);
        --glass-2: rgba(0, 0, 0, 0.02);
        --stroke: rgba(0, 0, 0, 0.08);
        --txt-1: #0a0b0d;
        --txt-2: #4a4a4a;
        --accent-1: #0a0b0d;
        --accent-2: #4f46e5;
        --accent-3: #7c3aed;
        --warning: #d97706;

        --gradient-primary: linear-gradient(135deg, var(--accent-1), var(--accent-2));
        --gradient-subtle: linear-gradient(135deg, rgba(0, 0, 0, 0.03), rgba(79, 70, 229, 0.05));
        --gradient-accent: linear-gradient(135deg, rgba(0, 0, 0, 0.05), rgba(79, 70, 229, 0.08));

        --bg-primary: var(--bg-0);
        --bg-secondary: var(--bg-1);
        --bg-tertiary: var(--glass);
        --bg-hover: var(--glass);

        --text-primary: var(--txt-1);
        --text-secondary: var(--txt-2);
        --text-tertiary: #666666;
        --text-muted: #888888;

        --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-base: 0 8px 24px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 12px 32px rgba(0, 0, 0, 0.12);
        --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.15);
        --shadow-xl: 0 24px 64px rgba(0, 0, 0, 0.18);
        --shadow-green: 0 8px 24px rgba(0, 0, 0, 0.06);
        --shadow-orange: 0 8px 24px rgba(79, 70, 229, 0.15);
        --shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.1);
        --shadow-neon: none;

        --border-light: 1px solid var(--stroke);
        --border-medium: 1px solid rgba(0, 0, 0, 0.1);
        --border-green: 1px solid rgba(0, 0, 0, 0.15);
        --border-orange: 1px solid var(--accent-2);
      }

      /* Light Theme Specific Overrides */
      [data-theme='light'] .sidebar,
      [data-theme='light'] .mobile-sidebar {
        background: linear-gradient(180deg, #f5f5f7 0%, #ffffff 100%);
        border-right-color: rgba(0, 0, 0, 0.08);
      }

      [data-theme='light'] .input-area {
        background: rgba(0, 0, 0, 0.03);
        border-color: rgba(0, 0, 0, 0.1);
      }

      [data-theme='light'] .input-area:focus-within {
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }

      [data-theme='light'] .message-ai {
        background: transparent;
      }

      [data-theme='light'] .message-user {
        background: transparent;
        color: #1f2328;
      }

      [data-theme='light'] .message-user .message-text {
        color: #1f2328;
      }

      [data-theme='light'] .chat-header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: none;
      }

      [data-theme='light'] .modal,
      [data-theme='light'] .settings-panel,
      [data-theme='light'] .chat-auth-panel {
        background: linear-gradient(145deg, #171717, #1f1f1f);
        border-color: rgba(255, 255, 255, 0.1);
        color: #ffffff;
      }

      /* Keep auth panels dark even in light mode for better UX */
      [data-theme='light'] .chat-auth-panel h2,
      [data-theme='light'] .chat-auth-panel h3,
      [data-theme='light'] .chat-auth-panel label,
      [data-theme='light'] .chat-auth-panel .auth-title,
      [data-theme='light'] .chat-auth-panel .auth-subtitle,
      [data-theme='light'] .chat-auth-panel .chat-auth-setting-label,
      [data-theme='light'] .chat-auth-panel .chat-auth-section-title {
        color: #ffffff;
      }

      [data-theme='light'] .chat-auth-panel .chat-auth-setting-desc,
      [data-theme='light'] .chat-auth-panel .chat-auth-privacy-desc {
        color: rgba(255, 255, 255, 0.6);
      }

      [data-theme='light'] .chat-auth-panel input,
      [data-theme='light'] .chat-auth-panel select,
      [data-theme='light'] .chat-auth-panel .auth-input {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.15);
        color: #ffffff;
      }
      [data-theme='light'] .chat-auth-panel .auth-input::placeholder {
        color: rgba(255, 255, 255, 0.3);
      }

      /* ---- Light Theme: Drawer Panels (Settings/Security) ---- */
      [data-theme='light'] .chat-auth-panel.chat-auth-panel--drawer {
        background: #ffffff;
        border-color: rgba(0, 0, 0, 0.1);
        color: #0a0b0d;
        box-shadow: -4px 0 24px rgba(0, 0, 0, 0.08);
      }
      [data-theme='light'] .chat-auth-panel--drawer > .chat-auth-header {
        background: #ffffff;
        border-bottom-color: rgba(0, 0, 0, 0.08);
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-header h2 {
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-close,
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-back {
        color: #4a4a4a;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-close:hover,
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-back:hover {
        background: rgba(0, 0, 0, 0.06);
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-section-title {
        color: #6b7280;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-setting-label {
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-setting-desc,
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-privacy-desc {
        color: #6b7280;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-setting-row {
        border-bottom-color: rgba(0, 0, 0, 0.06);
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-field label {
        color: #4a4a4a;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-field input,
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-select,
      [data-theme='light'] .chat-auth-panel--drawer select {
        background: #f5f5f7;
        border-color: rgba(0, 0, 0, 0.12);
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-field input:focus,
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-select:focus {
        border-color: #6e84ff;
        box-shadow: 0 0 0 3px rgba(110, 132, 255, 0.1);
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-field input::placeholder {
        color: #9ca3af;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-select option {
        background: #ffffff;
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-toggle {
        background: rgba(0, 0, 0, 0.12);
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-toggle.active {
        background: #6e84ff;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-toggle::after {
        background: #ffffff;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-toggle.active::after {
        background: #ffffff;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-btn {
        background: #0a0b0d;
        color: #ffffff;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-btn:hover:not(:disabled) {
        background: #1a1a1a;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-profile-edit {
        background: rgba(0, 0, 0, 0.02);
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-avatar-actions button {
        background: rgba(0, 0, 0, 0.04);
        border-color: rgba(0, 0, 0, 0.1);
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-avatar-actions button:hover {
        background: rgba(0, 0, 0, 0.08);
      }
      /* Security panel light theme */
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-security-title {
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-security-desc {
        color: #6b7280;
      }
      [data-theme='light']
        .chat-auth-panel--drawer
        .chat-auth-security-status.warning
        .chat-auth-security-title {
        color: #ea580c;
      }
      [data-theme='light']
        .chat-auth-panel--drawer
        .chat-auth-security-status.good
        .chat-auth-security-title {
        color: #16a34a;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-2fa-title {
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-2fa-desc {
        color: #6b7280;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-session {
        background: rgba(0, 0, 0, 0.02);
        border-color: rgba(0, 0, 0, 0.06);
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-session-device {
        color: #0a0b0d;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-session-details {
        color: #6b7280;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-session-icon {
        background: rgba(0, 0, 0, 0.05);
        color: #4a4a4a;
      }
      [data-theme='light'] .chat-auth-panel--drawer .chat-auth-danger-zone {
        border-top-color: rgba(0, 0, 0, 0.06);
      }
      /* Drawer scrollbar light */
      [data-theme='light']
        .chat-auth-panel--drawer
        .chat-auth-drawer-body::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.1);
      }
      [data-theme='light']
        .chat-auth-panel--drawer
        .chat-auth-drawer-body::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.2);
      }

      [data-theme='light'] .dropdown-menu {
        background: #171717;
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        color: #ffffff;
      }

      [data-theme='light'] .orbit-container {
        background: radial-gradient(circle at center, rgba(79, 70, 229, 0.05), transparent 70%);
      }

      [data-theme='light'] .mini-spinner-container {
        filter: drop-shadow(0 0 16px rgba(79, 70, 229, 0.08));
        opacity: 0.7;
      }

      /* Toast stays dark in all themes for consistency */
      [data-theme='light'] .toast-notification {
        background: rgba(22, 22, 22, 0.92);
        border-color: rgba(255, 255, 255, 0.06);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      }

      /* Desktop History Toggle Button - Modern Drawer Style */
      .desktop-history-toggle {
        position: fixed;
        top: 1.25rem;
        left: 10rem;
        z-index: 1001;
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        padding: 6px;
        border-radius: 8px;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .desktop-history-toggle:hover {
        color: #ffffff;
        background: rgba(255, 255, 255, 0.08);
      }

      /* Desktop layout light theme adjustments */
      [data-theme='light'] .desktop-history-toggle {
        color: rgba(0, 0, 0, 0.5);
      }

      [data-theme='light'] .desktop-history-toggle:hover {
        color: #0a0b0d;
        background: rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .desktop-logo-container .logo-text {
        color: #0a0b0d;
      }

      [data-theme='light'] .desktop-new-chat-btn {
        background: rgba(0, 0, 0, 0.06);
        border-color: rgba(0, 0, 0, 0.1);
        color: #0a0b0d;
      }

      [data-theme='light'] .desktop-new-chat-btn:hover {
        background: rgba(0, 0, 0, 0.1);
        border-color: rgba(0, 0, 0, 0.15);
      }

      [data-theme='light'] body.desktop-centered.chat-active .input-container {
        background: transparent !important;
      }

      [data-theme='light'] .toast-title {
        color: #ffffff;
      }

      [data-theme='light'] .toast-subtitle {
        color: rgba(255, 255, 255, 0.6);
      }

      /* Light theme - Main content area and chat elements */
      [data-theme='light'] .chat-container {
        background: #ffffff;
      }

      [data-theme='light'] .messages-container {
        background: transparent;
      }

      [data-theme='light'] .empty-state {
        background: transparent;
      }

      [data-theme='light'] .welcome-message,
      [data-theme='light'] .welcome-user-name {
        color: var(--txt-1);
      }

      [data-theme='light'] .user-welcome-text {
        color: var(--txt-1);
      }

      [data-theme='light'] .chat-item {
        background: rgba(0, 0, 0, 0.03);
        border-color: rgba(0, 0, 0, 0.06);
        color: var(--txt-1);
      }

      [data-theme='light'] .chat-item:hover {
        background: rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .chat-item-title {
        color: var(--txt-1);
      }

      [data-theme='light'] .chat-item-preview {
        color: var(--txt-2);
      }

      [data-theme='light'] .new-chat-btn {
        background: linear-gradient(135deg, #0a0b0d, #1a1a1a);
        color: #ffffff;
      }

      [data-theme='light'] .new-chat-btn:hover {
        background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
      }

      [data-theme='light'] .sidebar-search input {
        background: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.1);
        color: var(--txt-1);
      }

      [data-theme='light'] .sidebar-search input::placeholder {
        color: var(--txt-2);
      }

      [data-theme='light'] .user-name {
        color: var(--txt-1);
      }

      [data-theme='light'] .user-email {
        color: var(--txt-2);
      }

      [data-theme='light'] .message-text {
        color: var(--txt-1);
      }

      [data-theme='light'] .message-ai .message-text {
        color: var(--txt-1);
      }

      [data-theme='light'] .logo span {
        color: var(--txt-1);
      }

      [data-theme='light'] .model-badge {
        background: rgba(0, 0, 0, 0.08);
        color: var(--txt-1);
      }

      [data-theme='light'] #messageInput {
        color: var(--txt-1);
      }

      [data-theme='light'] #messageInput::placeholder {
        color: var(--txt-2);
      }

      [data-theme='light'] .typing-indicator {
        background: linear-gradient(145deg, #f5f5f7, #ffffff);
        border-color: rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .typing-indicator span {
        background: var(--txt-2);
      }

      /* Light theme - Body & Layout overrides */
      [data-theme='light'] body,
      body[data-theme='light'] {
        background: var(--bg-0) !important;
      }

      [data-theme='light'] .chat-header {
        background: #ffffff !important;
        backdrop-filter: none;
        border-bottom: none !important;
        box-shadow: none !important;
      }

      [data-theme='light'] .main-chat {
        background: #ffffff !important;
      }

      [data-theme='light'] .input-container {
        background: #ffffff !important;
        border-top: none !important;
        box-shadow: none !important;
      }

      [data-theme='light'] .input-area {
        background: #f5f5f7 !important;
        border-color: rgba(0, 0, 0, 0.12) !important;
        color: #0a0b0d;
      }

      [data-theme='light'] .input-area:focus-within {
        border-color: #4f46e5 !important;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        background: #ffffff !important;
      }

      [data-theme='light'] .ai-disclaimer {
        color: rgba(0, 0, 0, 0.45);
        border-top: none;
      }

      [data-theme='light'] .ai-disclaimer strong {
        color: rgba(0, 0, 0, 0.65);
      }

      [data-theme='light'] .ai-disclaimer a {
        color: rgba(0, 0, 0, 0.55);
      }

      [data-theme='light'] .token-counter {
        background: rgba(0, 0, 0, 0.04);
        border-color: rgba(0, 0, 0, 0.08);
        color: #4a4a4a;
      }

      [data-theme='light'] .send-btn {
        background: linear-gradient(135deg, #0a0b0d, #1a1a1a);
        color: #ffffff;
      }

      [data-theme='light'] .send-btn:hover {
        background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
      }

      /* Light theme - Send button (actual ID selector) */
      [data-theme='light'] #sendBtn {
        background: linear-gradient(135deg, #0a0b0d, #1a1a1a);
        border-color: rgba(0, 0, 0, 0.15);
      }

      [data-theme='light'] #sendBtn svg {
        fill: #ffffff;
      }

      [data-theme='light'] #sendBtn:disabled {
        background: rgba(0, 0, 0, 0.06);
        border-color: rgba(0, 0, 0, 0.08);
      }

      [data-theme='light'] #sendBtn:disabled svg {
        fill: rgba(0, 0, 0, 0.25);
      }

      /* Light theme - Input action buttons */
      [data-theme='light'] .voice-chat-btn {
        color: rgba(0, 0, 0, 0.5);
      }

      [data-theme='light'] .voice-chat-btn:hover {
        background: rgba(0, 0, 0, 0.06);
        color: #0a0b0d;
      }

      [data-theme='light'] .file-upload-btn {
        color: rgba(0, 0, 0, 0.5);
      }

      [data-theme='light'] .file-upload-btn:hover {
        background: rgba(0, 0, 0, 0.06);
        color: #0a0b0d;
      }

      [data-theme='light'] .file-upload-btn svg {
        fill: rgba(0, 0, 0, 0.5);
      }
      [data-theme='light'] .code-write-btn {
        color: rgba(0, 0, 0, 0.5);
      }
      [data-theme='light'] .code-write-btn:hover {
        background: rgba(79, 70, 229, 0.1);
        color: var(--accent-2, #4f46e5);
      }
      [data-theme='light'] .code-write-btn.active {
        background: rgba(79, 70, 229, 0.15);
        color: var(--accent-2, #4f46e5);
      }

      /* Light theme - Header icons & SVGs */
      [data-theme='light'] .chat-header svg {
        stroke: #0a0b0d;
        color: #0a0b0d;
      }

      [data-theme='light'] .chat-header .header-btn,
      [data-theme='light'] .chat-header button {
        color: #0a0b0d;
      }

      [data-theme='light'] .input-area svg {
        stroke: #4a4a4a;
        color: #4a4a4a;
      }

      /* Light theme - Footer */
      [data-theme='light'] .input-footer {
        background: transparent;
        color: #4a4a4a;
      }

      [data-theme='light'] .input-footer svg {
        stroke: #4a4a4a;
        color: #4a4a4a;
      }

      [data-theme='light'] .footer-stats span {
        color: #4a4a4a;
      }

      [data-theme='light'] .mode-selector-container button {
        color: #4a4a4a;
        background: rgba(0, 0, 0, 0.04);
        border-color: rgba(0, 0, 0, 0.08);
      }

      [data-theme='light'] .mode-selector-container button:hover,
      [data-theme='light'] .mode-selector-container button.active {
        background: rgba(0, 0, 0, 0.08);
        color: #0a0b0d;
      }

      /* Light theme - Scrollbar */
      [data-theme='light'] ::-webkit-scrollbar-track {
        background: #f5f5f7;
      }

      [data-theme='light'] ::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.15);
      }

      [data-theme='light'] ::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.25);
      }

      /* Light theme - Code blocks */
      [data-theme='light'] .code-block {
        background: #1e1e1e;
      }

      [data-theme='light'] .code-header {
        background: #2d2d2d;
        color: #d4d4d4;
      }

      /* â•â•â• CODE BLOCK CONTAINER (Rich Code Blocks) â•â•â• */
      .code-block-container {
        background: #1e1e1e;
        border-radius: 12px;
        margin: 12px 0;
        overflow: hidden;
        border: 1px solid #333;
      }
      .code-block-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 16px;
        background: #252529;
        border-bottom: 1px solid #333;
      }
      .code-lang-badge {
        font-size: 12px;
        color: #888;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.5px;
      }
      .code-block-actions {
        display: flex;
        gap: 8px;
      }
      .code-copy-btn,
      .code-preview-btn {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 4px 10px;
        border-radius: 6px;
        border: none;
        background: #333;
        color: #ccc;
        font-size: 12px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .code-copy-btn:hover {
        background: #444;
      }
      .code-preview-btn {
        background: linear-gradient(135deg, var(--accent-2, #6e84ff), var(--accent-3, #b86bff));
        color: #fff;
      }
      .code-preview-btn:hover {
        background: linear-gradient(135deg, var(--accent-3, #b86bff), var(--accent-2, #6e84ff));
      }
      .code-block-content {
        padding: 16px;
        margin: 0;
        overflow-x: auto;
        font-family: 'Fira Code', 'Cascadia Code', 'JetBrains Mono', 'Consolas', monospace;
        font-size: 13px;
        line-height: 1.6;
        color: #d4d4d4;
        -webkit-overflow-scrolling: touch;
      }
      .code-block-content code {
        background: none !important;
        padding: 0 !important;
        font-size: inherit;
        border: none !important;
      }
      .code-block-content code.hljs {
        background: transparent !important;
        padding: 0 !important;
      }
      /* Light theme code blocks */
      [data-theme='light'] .code-block-container {
        background: #f6f8fa;
        border-color: #d0d7de;
      }
      [data-theme='light'] .code-block-header {
        background: #eaeef2;
        border-color: #d0d7de;
      }
      [data-theme='light'] .code-lang-badge {
        color: #656d76;
      }
      [data-theme='light'] .code-block-content {
        color: #1f2328;
      }
      [data-theme='light'] .code-copy-btn {
        background: #d0d7de;
        color: #1f2328;
      }
      [data-theme='light'] .code-copy-btn:hover {
        background: #bbc0c7;
      }
      @media (prefers-color-scheme: light) {
        [data-theme='system'] .code-block-container {
          background: #f6f8fa;
          border-color: #d0d7de;
        }
        [data-theme='system'] .code-block-header {
          background: #eaeef2;
          border-color: #d0d7de;
        }
        [data-theme='system'] .code-block-content {
          color: #1f2328;
        }
        [data-theme='system'] .code-copy-btn {
          background: #d0d7de;
          color: #1f2328;
        }
      }

      /* â•â•â• CODE PREVIEW OVERLAY (Manus-style) â•â•â• */
      .code-preview-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.2s ease;
      }
      .code-preview-container {
        width: 90vw;
        height: 85vh;
        max-width: 1200px;
        background: #1a1a1e;
        border-radius: 16px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        animation: scaleIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      }
      @keyframes scaleIn {
        from {
          transform: scale(0.95);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      .code-preview-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 20px;
        background: #252529;
        border-bottom: 1px solid #333;
        flex-shrink: 0;
      }
      .code-preview-tabs {
        display: flex;
        gap: 8px;
      }
      .code-preview-tab {
        padding: 6px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 13px;
        color: #aaa;
        background: transparent;
        border: 1px solid #444;
        transition: all 0.2s;
      }
      .code-preview-tab:hover {
        background: #333;
        color: #fff;
      }
      .code-preview-tab.active {
        background: linear-gradient(135deg, var(--accent-2, #6e84ff), var(--accent-3, #b86bff));
        color: white;
        border-color: transparent;
      }
      .code-preview-close-btn {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: 1px solid #444;
        background: transparent;
        color: #aaa;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }
      .code-preview-close-btn:hover {
        background: #ef4444;
        color: white;
        border-color: #ef4444;
      }
      .code-preview-iframe {
        flex: 1;
        width: 100%;
        border: none;
        background: white;
      }
      @media (max-width: 768px) {
        .code-preview-container {
          width: 100vw;
          height: 100dvh;
          border-radius: 0;
          max-width: none;
        }
      }

      /* â•â•â• CODE SIDE PANEL (Manus-style - Desktop) â•â•â• */
      .code-side-panel {
        position: fixed;
        top: 0;
        right: -50vw;
        bottom: 0;
        width: 50vw;
        max-width: 700px;
        background: #1a1a1e;
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 1001;
        display: flex;
        flex-direction: column;
        transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: -10px 0 40px rgba(0, 0, 0, 0.3);
      }
      .code-side-panel.open {
        right: 0;
      }
      .side-panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 20px;
        background: #252529;
        border-bottom: 1px solid #333;
        flex-shrink: 0;
      }
      .side-panel-header .code-preview-tabs {
        display: flex;
        gap: 8px;
      }
      .side-panel-header .code-preview-tab {
        padding: 6px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 13px;
        color: #aaa;
        background: transparent;
        border: 1px solid #444;
        transition: all 0.2s;
      }
      .side-panel-header .code-preview-tab:hover {
        background: #333;
        color: #fff;
      }
      .side-panel-header .code-preview-tab.active {
        background: linear-gradient(135deg, var(--accent-2, #6e84ff), var(--accent-3, #b86bff));
        color: white;
        border-color: transparent;
      }
      .side-panel-iframe {
        flex: 1;
        width: 100%;
        border: none;
        background: white;
      }
      .side-panel-source {
        display: none;
        flex: 1;
        overflow: auto;
        padding: 20px;
        margin: 0;
        background: #1e1e1e;
        color: #d4d4d4;
        font-size: 13px;
        line-height: 1.6;
        font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
        white-space: pre-wrap;
        word-break: break-all;
      }
      /* Chat shrinks when side panel is open */
      body.side-panel-open .main-content {
        margin-right: 50vw;
        transition: margin-right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      body.side-panel-open .chat-header {
        right: 50vw;
        transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      /* Light theme side panel */
      [data-theme='light'] .code-side-panel {
        background: #f6f8fa;
        border-left-color: #d0d7de;
      }
      [data-theme='light'] .side-panel-header {
        background: #eaeef2;
        border-bottom-color: #d0d7de;
      }
      [data-theme='light'] .side-panel-header .code-preview-tab {
        color: #656d76;
        border-color: #d0d7de;
      }
      [data-theme='light'] .side-panel-header .code-preview-tab:hover {
        background: #d0d7de;
        color: #1f2328;
      }
      [data-theme='light'] .side-panel-source {
        background: #f6f8fa;
        color: #1f2328;
      }
      @media (max-width: 768px) {
        .code-side-panel {
          display: none !important;
        }
        body.side-panel-open .main-content {
          margin-right: 0;
        }
        body.side-panel-open .chat-header {
          right: 0;
        }
        .code-stream-pre {
          max-width: 100% !important;
          overflow-x: auto !important;
          font-size: 12px !important;
        }
        .message .code-block-container {
          max-width: calc(100vw - 60px) !important;
          overflow-x: auto;
        }
      }

      /* Light theme code blocks */
      [data-theme='light'] .code-block-container {
        background: #f6f8fa !important;
        border-color: #d0d7de !important;
      }
      [data-theme='light'] .code-block-header {
        background: #eaeef2 !important;
        border-bottom-color: #d0d7de !important;
        color: #1f2328 !important;
      }
      [data-theme='light'] .code-block-content {
        background: #f6f8fa !important;
      }
      [data-theme='light'] .code-block-content code.hljs {
        background: transparent !important;
        color: #24292e !important;
      }
      [data-theme='light'] .message-text code {
        background: rgba(0, 0, 0, 0.06) !important;
        border-color: rgba(0, 0, 0, 0.1) !important;
        color: #24292e !important;
      }

      /* Light theme code buttons */
      [data-theme='light'] .code-copy-btn,
      [data-theme='light'] .code-preview-btn {
        background: #e1e4e8;
        color: #24292e;
        border: 1px solid #d0d7de;
      }
      [data-theme='light'] .code-copy-btn:hover {
        background: #d0d7de;
      }
      [data-theme='light'] .code-preview-btn {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: #fff;
        border: none;
      }
      [data-theme='light'] .code-preview-btn:hover {
        background: linear-gradient(135deg, #8b5cf6, #6366f1);
      }

      /* Light theme preview overlay/container */
      [data-theme='light'] .code-preview-container {
        background: #ffffff;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.2);
      }
      [data-theme='light'] .code-preview-header {
        background: #eaeef2;
        border-bottom-color: #d0d7de;
      }
      [data-theme='light'] .code-preview-header .code-preview-tab {
        color: #656d76;
        border-color: #d0d7de;
      }
      [data-theme='light'] .code-preview-header .code-preview-tab:hover {
        background: #d0d7de;
        color: #1f2328;
      }

      /* Typing indicator desktop visibility */
      body.desktop-centered .typing-indicator {
        display: flex !important;
      }

      /* Light theme - Thinking/reasoning blocks */
      [data-theme='light'] .thinking-block {
        background: rgba(0, 0, 0, 0.03);
        border-color: rgba(0, 0, 0, 0.08);
        color: #4a4a4a;
      }

      /* Light theme - Location badge and other badges */
      [data-theme='light'] .location-badge,
      [data-theme='light'] .model-badge {
        background: rgba(0, 0, 0, 0.06);
        border-color: rgba(0, 0, 0, 0.1);
        color: #4a4a4a;
      }

      /* Light theme - Welcome text */
      [data-theme='light'] .welcome-subtitle {
        color: #4a4a4a;
      }

      /* Light theme - Quick action buttons */
      [data-theme='light'] .quick-action,
      [data-theme='light'] .suggestion-chip {
        background: rgba(0, 0, 0, 0.04);
        border-color: rgba(0, 0, 0, 0.08);
        color: #0a0b0d;
      }

      [data-theme='light'] .quick-action:hover,
      [data-theme='light'] .suggestion-chip:hover {
        background: rgba(0, 0, 0, 0.08);
        border-color: rgba(0, 0, 0, 0.12);
      }

      /* Light theme - User avatar */
      [data-theme='light'] .chat-auth-avatar,
      [data-theme='light'] .user-avatar {
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        color: #ffffff;
      }

      /* Light theme - Desktop specific */
      [data-theme='light'] body.desktop-centered .chat-header {
        background: #ffffff !important;
        backdrop-filter: blur(12px) saturate(180%);
        -webkit-backdrop-filter: blur(12px) saturate(180%);
      }

      [data-theme='light'] .desktop-logo-container .logo-text {
        color: #0a0b0d;
      }

      /* Logo SVG - dark color in light theme */
      [data-theme='light'] .desktop-logo-container .logo-icon {
        color: #0a0b0d;
      }

      /* Input wrapper - light theme capsule */
      [data-theme='light'] .input-wrapper {
        background: #f5f5f7 !important;
        border-color: rgba(0, 0, 0, 0.12) !important;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .input-wrapper:focus-within {
        background: #ffffff !important;
        border-color: rgba(99, 102, 241, 0.4) !important;
        box-shadow:
          0 0 0 3px rgba(99, 102, 241, 0.08),
          0 2px 12px rgba(0, 0, 0, 0.06);
      }

      /* ChatGPT-Style Light Theme Messages: Clean, no bubbles */
      [data-theme='light'] .message {
        border-bottom-color: rgba(0, 0, 0, 0.06) !important;
      }
      [data-theme='light'] .message.assistant .message-text {
        color: #1f2328 !important;
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
      }
      [data-theme='light'] .message.user .message-text {
        color: #1f2328 !important;
        background: rgba(0, 0, 0, 0.05) !important;
        border: none !important;
        box-shadow: none !important;
        border-radius: 18px 18px 4px 18px !important;
        padding: 10px 16px !important;
      }
      [data-theme='light'] .message.user .message-avatar {
        background-color: #10a37f;
      }
      [data-theme='light'] .message.assistant .message-avatar {
        background-color: #6366f1;
      }
      [data-theme='light'] .message.assistant .message-avatar svg {
        stroke: #ffffff;
      }

      /* Message timestamp and actions light theme */
      [data-theme='light'] .message-timestamp {
        color: rgba(0, 0, 0, 0.4);
      }

      [data-theme='light'] .message-actions .message-action-btn {
        color: rgba(0, 0, 0, 0.4);
        border-color: rgba(0, 0, 0, 0.08);
      }

      [data-theme='light'] .message-actions .message-action-btn:hover {
        color: #0a0b0d;
        background: rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .feedback-btn {
        color: rgba(0, 0, 0, 0.4);
      }
      [data-theme='light'] .feedback-btn:hover {
        color: rgba(0, 0, 0, 0.8);
        background: rgba(0, 0, 0, 0.06) !important;
      }
      [data-theme='light'] .feedback-btn.active-up {
        color: #16a34a !important;
      }
      [data-theme='light'] .feedback-btn.active-down {
        color: #dc2626 !important;
      }
      [data-theme='light'] .feedback-separator {
        background: rgba(0, 0, 0, 0.1);
      }

      /* ============================================================
         ðŸ–¥ï¸ SYSTEM THEME - Auto detect user preference
         ============================================================ */
      @media (prefers-color-scheme: light) {
        [data-theme='system'] {
          --bg-0: #ffffff;
          --bg-1: #f5f5f7;
          --glass: rgba(0, 0, 0, 0.03);
          --glass-2: rgba(0, 0, 0, 0.02);
          --stroke: rgba(0, 0, 0, 0.08);
          --txt-1: #0a0b0d;
          --txt-2: #4a4a4a;
          --accent-1: #0a0b0d;
          --accent-2: #4f46e5;
          --accent-3: #7c3aed;
          --warning: #d97706;

          --gradient-primary: linear-gradient(135deg, var(--accent-1), var(--accent-2));
          --gradient-subtle: linear-gradient(135deg, rgba(0, 0, 0, 0.03), rgba(79, 70, 229, 0.05));
          --gradient-accent: linear-gradient(135deg, rgba(0, 0, 0, 0.05), rgba(79, 70, 229, 0.08));

          --bg-primary: var(--bg-0);
          --bg-secondary: var(--bg-1);
          --bg-tertiary: var(--glass);
          --bg-hover: var(--glass);

          --text-primary: var(--txt-1);
          --text-secondary: var(--txt-2);
          --text-tertiary: #666666;
          --text-muted: #888888;

          --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
          --shadow-base: 0 8px 24px rgba(0, 0, 0, 0.1);
          --shadow-md: 0 12px 32px rgba(0, 0, 0, 0.12);
          --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.15);
          --shadow-xl: 0 24px 64px rgba(0, 0, 0, 0.18);
          --shadow-green: 0 8px 24px rgba(0, 0, 0, 0.06);
          --shadow-orange: 0 8px 24px rgba(79, 70, 229, 0.15);
          --shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.1);
          --shadow-neon: none;

          --border-light: 1px solid var(--stroke);
          --border-medium: 1px solid rgba(0, 0, 0, 0.1);
          --border-green: 1px solid rgba(0, 0, 0, 0.15);
          --border-orange: 1px solid var(--accent-2);
        }

        [data-theme='system'] .sidebar,
        [data-theme='system'] .mobile-sidebar {
          background: linear-gradient(180deg, #f5f5f7 0%, #ffffff 100%);
          border-right-color: rgba(0, 0, 0, 0.08);
        }

        [data-theme='system'] .input-area {
          background: rgba(0, 0, 0, 0.03);
          border-color: rgba(0, 0, 0, 0.1);
        }

        [data-theme='system'] .message-ai {
          background: linear-gradient(145deg, #f5f5f7, #ffffff);
          border-color: rgba(0, 0, 0, 0.06);
        }

        [data-theme='system'] .message-user {
          background: linear-gradient(145deg, #0a0b0d, #1a1a1a);
          color: #ffffff;
        }

        [data-theme='system'] .message-user .message-text {
          color: #ffffff;
        }

        [data-theme='system'] .chat-header {
          background: #ffffff;
          border-bottom: none;
        }

        [data-theme='system'] .modal,
        [data-theme='system'] .settings-panel,
        [data-theme='system'] .chat-auth-panel {
          background: linear-gradient(145deg, #171717, #1f1f1f);
          border-color: rgba(255, 255, 255, 0.1);
          color: #ffffff;
        }

        [data-theme='system'] .chat-auth-panel h2,
        [data-theme='system'] .chat-auth-panel h3,
        [data-theme='system'] .chat-auth-panel label,
        [data-theme='system'] .chat-auth-panel .auth-title,
        [data-theme='system'] .chat-auth-panel .auth-subtitle {
          color: #ffffff;
        }

        [data-theme='system'] .chat-auth-panel input,
        [data-theme='system'] .chat-auth-panel select,
        [data-theme='system'] .chat-auth-panel .auth-input {
          background: rgba(255, 255, 255, 0.05);
          border-color: rgba(255, 255, 255, 0.15);
          color: #ffffff;
        }
        [data-theme='system'] .chat-auth-panel .auth-input::placeholder {
          color: rgba(255, 255, 255, 0.3);
        }

        /* System theme: Drawer Panels (Settings/Security) */
        [data-theme='system'] .chat-auth-panel.chat-auth-panel--drawer {
          background: #ffffff;
          border-color: rgba(0, 0, 0, 0.1);
          color: #0a0b0d;
          box-shadow: -4px 0 24px rgba(0, 0, 0, 0.08);
        }
        [data-theme='system'] .chat-auth-panel--drawer > .chat-auth-header {
          background: #ffffff;
          border-bottom-color: rgba(0, 0, 0, 0.08);
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-header h2 {
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-close,
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-back {
          color: #4a4a4a;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-close:hover,
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-back:hover {
          background: rgba(0, 0, 0, 0.06);
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-section-title {
          color: #6b7280;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-setting-label {
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-setting-desc,
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-privacy-desc {
          color: #6b7280;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-setting-row {
          border-bottom-color: rgba(0, 0, 0, 0.06);
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-field label {
          color: #4a4a4a;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-field input,
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-select,
        [data-theme='system'] .chat-auth-panel--drawer select {
          background: #f5f5f7;
          border-color: rgba(0, 0, 0, 0.12);
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-field input:focus,
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-select:focus {
          border-color: #6e84ff;
          box-shadow: 0 0 0 3px rgba(110, 132, 255, 0.1);
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-field input::placeholder {
          color: #9ca3af;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-select option {
          background: #ffffff;
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-toggle {
          background: rgba(0, 0, 0, 0.12);
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-toggle.active {
          background: #6e84ff;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-toggle::after {
          background: #ffffff;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-toggle.active::after {
          background: #ffffff;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-btn {
          background: #0a0b0d;
          color: #ffffff;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-btn:hover:not(:disabled) {
          background: #1a1a1a;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-profile-edit {
          background: rgba(0, 0, 0, 0.02);
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-avatar-actions button {
          background: rgba(0, 0, 0, 0.04);
          border-color: rgba(0, 0, 0, 0.1);
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-security-title {
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-security-desc {
          color: #6b7280;
        }
        [data-theme='system']
          .chat-auth-panel--drawer
          .chat-auth-security-status.warning
          .chat-auth-security-title {
          color: #ea580c;
        }
        [data-theme='system']
          .chat-auth-panel--drawer
          .chat-auth-security-status.good
          .chat-auth-security-title {
          color: #16a34a;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-2fa-title {
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-2fa-desc {
          color: #6b7280;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-session {
          background: rgba(0, 0, 0, 0.02);
          border-color: rgba(0, 0, 0, 0.06);
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-session-device {
          color: #0a0b0d;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-session-details {
          color: #6b7280;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-session-icon {
          background: rgba(0, 0, 0, 0.05);
          color: #4a4a4a;
        }
        [data-theme='system'] .chat-auth-panel--drawer .chat-auth-danger-zone {
          border-top-color: rgba(0, 0, 0, 0.06);
        }
        [data-theme='system']
          .chat-auth-panel--drawer
          .chat-auth-drawer-body::-webkit-scrollbar-thumb {
          background: rgba(0, 0, 0, 0.1);
        }

        [data-theme='system'] .dropdown-menu {
          background: #171717;
          border-color: rgba(255, 255, 255, 0.1);
          color: #ffffff;
        }

        /* Toast stays dark in system theme too */
        [data-theme='system'] .toast-notification {
          background: linear-gradient(145deg, #171717, #1f1f1f);
          border-color: rgba(255, 255, 255, 0.1);
        }

        [data-theme='system'] .toast-title {
          color: #ffffff;
        }

        [data-theme='system'] .toast-subtitle {
          color: rgba(255, 255, 255, 0.6);
        }

        /* System theme light mode - Main content area */
        [data-theme='system'] .chat-container {
          background: #ffffff;
        }

        [data-theme='system'] .welcome-message,
        [data-theme='system'] .welcome-user-name,
        [data-theme='system'] .user-welcome-text {
          color: #0a0b0d;
        }

        [data-theme='system'] .chat-item {
          background: rgba(0, 0, 0, 0.03);
          border-color: rgba(0, 0, 0, 0.06);
          color: #0a0b0d;
        }

        [data-theme='system'] .chat-item:hover {
          background: rgba(0, 0, 0, 0.06);
        }

        [data-theme='system'] .chat-item-title {
          color: #0a0b0d;
        }

        [data-theme='system'] .chat-item-preview {
          color: #4a4a4a;
        }

        [data-theme='system'] .new-chat-btn {
          background: linear-gradient(135deg, #0a0b0d, #1a1a1a);
          color: #ffffff;
        }

        [data-theme='system'] .sidebar-search input {
          background: rgba(0, 0, 0, 0.05);
          border-color: rgba(0, 0, 0, 0.1);
          color: #0a0b0d;
        }

        [data-theme='system'] .user-name {
          color: #0a0b0d;
        }

        [data-theme='system'] .user-email {
          color: #4a4a4a;
        }

        [data-theme='system'] .message-text,
        [data-theme='system'] .message-ai .message-text {
          color: #0a0b0d;
        }

        [data-theme='system'] .logo span {
          color: #0a0b0d;
        }

        [data-theme='system'] .model-badge {
          background: rgba(0, 0, 0, 0.08);
          color: #0a0b0d;
        }

        [data-theme='system'] #messageInput {
          color: #0a0b0d;
        }

        [data-theme='system'] #messageInput::placeholder {
          color: #4a4a4a;
        }

        [data-theme='system'] .typing-indicator {
          background: linear-gradient(145deg, #f5f5f7, #ffffff);
          border-color: rgba(0, 0, 0, 0.06);
        }

        [data-theme='system'] .typing-indicator span {
          background: #4a4a4a;
        }

        /* System theme - Body & Layout */
        [data-theme='system'] body,
        body[data-theme='system'] {
          background: #ffffff !important;
        }

        [data-theme='system'] .chat-header {
          background: #ffffff !important;
          border-bottom: none !important;
          box-shadow: none !important;
        }

        [data-theme='system'] .main-chat {
          background: #ffffff !important;
        }

        [data-theme='system'] .input-container {
          background: #ffffff !important;
          border-top: none !important;
          box-shadow: none !important;
        }

        [data-theme='system'] .input-area {
          background: #f5f5f7 !important;
          border-color: rgba(0, 0, 0, 0.12) !important;
        }

        [data-theme='system'] .ai-disclaimer {
          color: rgba(0, 0, 0, 0.45);
          border-top: none;
        }

        [data-theme='system'] .ai-disclaimer strong {
          color: rgba(0, 0, 0, 0.65);
        }

        [data-theme='system'] .token-counter {
          background: rgba(0, 0, 0, 0.04);
          border-color: rgba(0, 0, 0, 0.08);
          color: #4a4a4a;
        }

        [data-theme='system'] .chat-header svg {
          stroke: #0a0b0d;
          color: #0a0b0d;
        }

        [data-theme='system'] .input-area svg {
          stroke: #4a4a4a;
          color: #4a4a4a;
        }

        [data-theme='system'] .input-footer {
          color: #4a4a4a;
        }

        [data-theme='system'] .footer-stats span {
          color: #4a4a4a;
        }

        [data-theme='system'] .send-btn {
          background: linear-gradient(135deg, #0a0b0d, #1a1a1a);
          color: #ffffff;
        }

        /* System light - Send button (actual ID selector) */
        [data-theme='system'] #sendBtn {
          background: linear-gradient(135deg, #0a0b0d, #1a1a1a);
          border-color: rgba(0, 0, 0, 0.15);
        }

        [data-theme='system'] #sendBtn svg {
          fill: #ffffff;
        }

        [data-theme='system'] #sendBtn:disabled {
          background: rgba(0, 0, 0, 0.06);
          border-color: rgba(0, 0, 0, 0.08);
        }

        [data-theme='system'] #sendBtn:disabled svg {
          fill: rgba(0, 0, 0, 0.25);
        }

        /* System light - Input action buttons */
        [data-theme='system'] .voice-chat-btn {
          color: rgba(0, 0, 0, 0.5);
        }

        [data-theme='system'] .voice-chat-btn:hover {
          background: rgba(0, 0, 0, 0.06);
          color: #0a0b0d;
        }

        [data-theme='system'] .file-upload-btn {
          color: rgba(0, 0, 0, 0.5);
        }

        [data-theme='system'] .file-upload-btn:hover {
          background: rgba(0, 0, 0, 0.06);
          color: #0a0b0d;
        }

        [data-theme='system'] .file-upload-btn svg {
          fill: rgba(0, 0, 0, 0.5);
        }

        [data-theme='system'] .location-badge,
        [data-theme='system'] .model-badge {
          background: rgba(0, 0, 0, 0.06);
          border-color: rgba(0, 0, 0, 0.1);
          color: #4a4a4a;
        }

        [data-theme='system'] .welcome-subtitle {
          color: #4a4a4a;
        }

        [data-theme='system'] body.desktop-centered .chat-header {
          background: transparent !important;
        }

        /* Logo SVG - dark color in system light */
        [data-theme='system'] .desktop-logo-container .logo-icon {
          color: #0a0b0d;
        }

        [data-theme='system'] .desktop-logo-container .logo-text {
          color: #0a0b0d;
        }

        /* Desktop toggle - dark on system light */
        [data-theme='system'] .desktop-history-toggle {
          color: rgba(0, 0, 0, 0.5);
        }

        [data-theme='system'] .desktop-history-toggle:hover {
          color: #0a0b0d;
          background: rgba(0, 0, 0, 0.06);
        }

        [data-theme='system'] .desktop-drawer-logo .logo-icon {
          color: #0a0b0d;
        }

        [data-theme='system'] .desktop-drawer-logo .logo-text {
          color: #0a0b0d;
        }

        /* Input wrapper - system light capsule */
        [data-theme='system'] .input-wrapper {
          background: #f5f5f7 !important;
          border-color: rgba(0, 0, 0, 0.12) !important;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
        }

        [data-theme='system'] .input-wrapper:focus-within {
          background: #ffffff !important;
          border-color: rgba(99, 102, 241, 0.4) !important;
          box-shadow:
            0 0 0 3px rgba(99, 102, 241, 0.08),
            0 2px 12px rgba(0, 0, 0, 0.06);
        }

        [data-theme='system'] .input-disclaimer {
          color: rgba(0, 0, 0, 0.35) !important;
        }

        [data-theme='system'] .recall-status-indicator {
          background: rgba(34, 197, 94, 0.06) !important;
          border-color: rgba(34, 197, 94, 0.12) !important;
        }

        [data-theme='system'] .recall-status-text {
          color: rgba(22, 163, 74, 0.65) !important;
        }

        /* AI response text - fix .message.assistant */
        [data-theme='system'] .message.assistant .message-text {
          color: #0a0b0d !important;
          background: linear-gradient(145deg, #f5f5f7, #ffffff) !important;
          border-color: rgba(0, 0, 0, 0.06) !important;
          border-left-color: rgba(0, 0, 0, 0.1) !important;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        /* User message - fix .message.user */
        [data-theme='system'] .message.user .message-text {
          color: #1f2328 !important;
          background: rgba(0, 0, 0, 0.05) !important;
          border-radius: 18px 18px 4px 18px !important;
          padding: 10px 16px !important;
          border: none !important;
          box-shadow: none !important;
        }

        [data-theme='system'] .message.user .message-avatar {
          background: linear-gradient(135deg, #0a0b0d, #2a2a2a);
        }

        [data-theme='system'] .message.assistant .message-avatar {
          background: linear-gradient(135deg, #f0f0f0, #e5e5e5);
        }

        [data-theme='system'] .message.assistant .message-avatar svg {
          stroke: #0a0b0d;
        }

        /* Message timestamp and actions system light */
        [data-theme='system'] .message-timestamp {
          color: rgba(0, 0, 0, 0.4);
        }

        [data-theme='system'] .message-actions .message-action-btn {
          color: rgba(0, 0, 0, 0.4);
          border-color: rgba(0, 0, 0, 0.08);
        }

        [data-theme='system'] .message-actions .message-action-btn:hover {
          color: #0a0b0d;
          background: rgba(0, 0, 0, 0.06);
        }

        [data-theme='system'] .feedback-btn {
          color: rgba(0, 0, 0, 0.4);
        }
        [data-theme='system'] .feedback-btn:hover {
          color: rgba(0, 0, 0, 0.8);
          background: rgba(0, 0, 0, 0.06) !important;
        }
        [data-theme='system'] .feedback-btn.active-up {
          color: #16a34a !important;
        }
        [data-theme='system'] .feedback-btn.active-down {
          color: #dc2626 !important;
        }
        [data-theme='system'] .feedback-separator {
          background: rgba(0, 0, 0, 0.1);
        }
      }

      /* ============================================================
         ðŸ“± MOBILE LIGHT THEME OVERRIDES
         Forces light styles on mobile elements that use !important
         ============================================================ */
      @media (max-width: 768px) {
        /* Mobile header background - matches body */
        [data-theme='light'] .chat-header {
          background: var(--bg-0) !important;
          border-bottom: none !important;
          box-shadow: none !important;
        }

        /* Mobile logo text - dark on light */
        [data-theme='light'] .mobile-logo-text {
          color: #0a0b0d !important;
        }

        /* Mobile logo SVG - dark in light theme */
        [data-theme='light'] .mobile-logo-toggle .logo-icon {
          color: #0a0b0d !important;
        }

        /* Mobile dropdown trigger */
        [data-theme='light'] .mobile-dropdown-trigger svg {
          fill: #0a0b0d !important;
          stroke: #0a0b0d !important;
        }

        /* Mobile input container - seamless, no border */
        [data-theme='light'] .input-container {
          background: #ffffff !important;
          border-top: none !important;
          box-shadow: none !important;
        }

        /* Mobile input wrapper capsule */
        [data-theme='light'] .input-wrapper {
          background: #f5f5f7 !important;
          border-color: rgba(0, 0, 0, 0.12) !important;
        }

        [data-theme='light'] .input-wrapper:focus-within {
          background: #ffffff !important;
          border-color: rgba(99, 102, 241, 0.4) !important;
          box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.08);
        }

        /* Mobile plus button */
        [data-theme='light'] .mobile-plus-btn,
        [data-theme='light'] #mobilePlusBtn {
          color: rgba(0, 0, 0, 0.5) !important;
          border-color: rgba(0, 0, 0, 0.12) !important;
        }

        [data-theme='light'] .mobile-plus-btn svg,
        [data-theme='light'] #mobilePlusBtn svg {
          fill: rgba(0, 0, 0, 0.5) !important;
        }

        /* Mobile send button */
        [data-theme='light'] #sendBtn {
          background: linear-gradient(135deg, #0a0b0d, #1a1a1a) !important;
          border-color: rgba(0, 0, 0, 0.15) !important;
          color: #ffffff !important;
        }

        [data-theme='light'] #sendBtn svg,
        [data-theme='light'] #sendBtn path {
          fill: #ffffff !important;
        }

        /* Mobile input action icons */
        [data-theme='light'] .input-actions button svg,
        [data-theme='light'] .input-actions button path {
          fill: rgba(0, 0, 0, 0.5) !important;
        }

        /* Mobile disclaimer text */
        [data-theme='light'] .desktop-disclaimer {
          color: rgba(0, 0, 0, 0.4) !important;
        }

        /* Mobile orbit spinner - subtle in light */
        [data-theme='light'] .mini-spinner-container {
          filter: drop-shadow(0 0 16px rgba(79, 70, 229, 0.1)) !important;
        }

        /* Mobile message input placeholder */
        [data-theme='light'] #messageInput {
          color: #0a0b0d !important;
        }

        [data-theme='light'] #messageInput::placeholder {
          color: rgba(0, 0, 0, 0.4) !important;
        }

        /* Mobile hamburger button - dark on light */
        [data-theme='light'] .mobile-hamburger-btn {
          color: #0a0b0d !important;
        }

        [data-theme='light'] .mobile-hamburger-btn:hover,
        [data-theme='light'] .mobile-hamburger-btn:active {
          background: rgba(0, 0, 0, 0.06) !important;
          color: #0a0b0d !important;
        }

        /* Mobile sidebar - full light theme inner elements */
        [data-theme='light'] .mobile-sidebar {
          background: #ffffff !important;
          border-right-color: rgba(0, 0, 0, 0.08) !important;
          box-shadow: 2px 0 16px rgba(0, 0, 0, 0.1) !important;
        }

        [data-theme='light'] .mobile-sidebar-header {
          background: #ffffff !important;
          border-bottom-color: rgba(0, 0, 0, 0.06) !important;
        }

        [data-theme='light'] .mobile-sidebar-title {
          color: #0a0b0d !important;
        }

        [data-theme='light'] .mobile-sidebar-logo .logo-icon {
          color: #0a0b0d !important;
        }

        [data-theme='light'] .mobile-sidebar-logo-text {
          color: #0a0b0d !important;
        }

        [data-theme='light'] .mobile-sidebar-close {
          border-color: rgba(0, 0, 0, 0.2) !important;
        }

        [data-theme='light'] .mobile-sidebar-close svg {
          stroke: #0a0b0d !important;
        }

        [data-theme='light'] .mobile-new-chat-btn {
          color: #0a0b0d !important;
          border-color: rgba(0, 0, 0, 0.15) !important;
        }

        [data-theme='light'] .mobile-new-chat-btn:hover,
        [data-theme='light'] .mobile-new-chat-btn:active {
          background: rgba(0, 0, 0, 0.04) !important;
        }

        [data-theme='light'] .mobile-new-chat-btn svg {
          stroke: #0a0b0d !important;
        }

        [data-theme='light'] .mobile-chat-history {
          scrollbar-color: rgba(0, 0, 0, 0.15) transparent;
        }

        [data-theme='light'] .mobile-chat-item {
          color: rgba(0, 0, 0, 0.7) !important;
        }

        [data-theme='light'] .mobile-chat-item:hover,
        [data-theme='light'] .mobile-chat-item:active {
          background: rgba(0, 0, 0, 0.04) !important;
        }

        [data-theme='light'] .mobile-chat-item svg {
          stroke: rgba(0, 0, 0, 0.5) !important;
        }

        [data-theme='light'] .mobile-sidebar-footer {
          background: #ffffff !important;
          border-top-color: rgba(0, 0, 0, 0.06) !important;
        }

        [data-theme='light'] .mobile-sidebar-user {
          color: rgba(0, 0, 0, 0.8) !important;
        }

        [data-theme='light'] .mobile-sidebar-user-avatar {
          background: linear-gradient(135deg, #0a0b0d, #333) !important;
          color: #ffffff !important;
        }

        [data-theme='light'] .mobile-menu-item {
          color: rgba(0, 0, 0, 0.7) !important;
        }

        [data-theme='light'] .mobile-menu-item:hover {
          background: rgba(0, 0, 0, 0.04) !important;
        }

        [data-theme='light'] .mobile-menu-item svg {
          fill: rgba(0, 0, 0, 0.5) !important;
        }

        /* Mobile sidebar empty state text - light theme */
        [data-theme='light'] .mobile-chat-history div[style*='color: rgba(255,255,255'] {
          color: rgba(0, 0, 0, 0.4) !important;
        }
      }

      /* ðŸ“± MOBILE SYSTEM THEME OVERRIDES */
      @media (max-width: 768px) and (prefers-color-scheme: light) {
        [data-theme='system'] .chat-header {
          background: var(--bg-0) !important;
          border-bottom: none !important;
          box-shadow: none !important;
        }

        [data-theme='system'] .mobile-logo-text {
          color: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-logo-toggle .logo-icon {
          color: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-dropdown-trigger svg {
          fill: #0a0b0d !important;
          stroke: #0a0b0d !important;
        }

        [data-theme='system'] .input-container {
          background: #ffffff !important;
          border-top: none !important;
          box-shadow: none !important;
        }

        [data-theme='system'] .input-wrapper {
          background: #f5f5f7 !important;
          border-color: rgba(0, 0, 0, 0.12) !important;
        }

        [data-theme='system'] .mobile-plus-btn,
        [data-theme='system'] #mobilePlusBtn {
          color: rgba(0, 0, 0, 0.5) !important;
          border-color: rgba(0, 0, 0, 0.12) !important;
        }

        [data-theme='system'] .mobile-plus-btn svg,
        [data-theme='system'] #mobilePlusBtn svg {
          fill: rgba(0, 0, 0, 0.5) !important;
        }

        [data-theme='system'] #sendBtn {
          background: linear-gradient(135deg, #0a0b0d, #1a1a1a) !important;
          border-color: rgba(0, 0, 0, 0.15) !important;
          color: #ffffff !important;
        }

        [data-theme='system'] #sendBtn svg,
        [data-theme='system'] #sendBtn path {
          fill: #ffffff !important;
        }

        [data-theme='system'] .input-actions button svg,
        [data-theme='system'] .input-actions button path {
          fill: rgba(0, 0, 0, 0.5) !important;
        }

        [data-theme='system'] .desktop-disclaimer {
          color: rgba(0, 0, 0, 0.4) !important;
        }

        [data-theme='system'] .mini-spinner-container {
          filter: drop-shadow(0 0 16px rgba(79, 70, 229, 0.1)) !important;
        }

        [data-theme='system'] #messageInput {
          color: #0a0b0d !important;
        }

        [data-theme='system'] #messageInput::placeholder {
          color: rgba(0, 0, 0, 0.4) !important;
        }

        /* Mobile hamburger button - dark on light (system) */
        [data-theme='system'] .mobile-hamburger-btn {
          color: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-hamburger-btn:hover,
        [data-theme='system'] .mobile-hamburger-btn:active {
          background: rgba(0, 0, 0, 0.06) !important;
          color: #0a0b0d !important;
        }

        /* Mobile sidebar - system light theme inner elements */
        [data-theme='system'] .mobile-sidebar {
          background: #ffffff !important;
          border-right-color: rgba(0, 0, 0, 0.08) !important;
          box-shadow: 2px 0 16px rgba(0, 0, 0, 0.1) !important;
        }

        [data-theme='system'] .mobile-sidebar-header {
          background: #ffffff !important;
          border-bottom-color: rgba(0, 0, 0, 0.06) !important;
        }

        [data-theme='system'] .mobile-sidebar-title {
          color: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-sidebar-logo .logo-icon {
          color: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-sidebar-logo-text {
          color: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-sidebar-close {
          border-color: rgba(0, 0, 0, 0.2) !important;
        }

        [data-theme='system'] .mobile-sidebar-close svg {
          stroke: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-new-chat-btn {
          color: #0a0b0d !important;
          border-color: rgba(0, 0, 0, 0.15) !important;
        }

        [data-theme='system'] .mobile-new-chat-btn:hover,
        [data-theme='system'] .mobile-new-chat-btn:active {
          background: rgba(0, 0, 0, 0.04) !important;
        }

        [data-theme='system'] .mobile-new-chat-btn svg {
          stroke: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-chat-search {
          background: rgba(0, 0, 0, 0.04) !important;
          border-color: rgba(0, 0, 0, 0.08) !important;
        }

        [data-theme='system'] .mobile-chat-search input {
          color: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-chat-search input::placeholder {
          color: rgba(0, 0, 0, 0.35) !important;
        }

        [data-theme='system'] .mobile-chat-item-delete {
          color: rgba(0, 0, 0, 0.25) !important;
        }

        [data-theme='system'] .mobile-chat-item-delete:active {
          color: #ef4444 !important;
          background: rgba(239, 68, 68, 0.1) !important;
        }

        [data-theme='system'] .mobile-chat-history {
          scrollbar-color: rgba(0, 0, 0, 0.15) transparent;
        }

        [data-theme='system'] .mobile-chat-item {
          color: rgba(0, 0, 0, 0.7) !important;
        }

        [data-theme='system'] .mobile-chat-item:hover,
        [data-theme='system'] .mobile-chat-item:active {
          background: rgba(0, 0, 0, 0.04) !important;
        }

        [data-theme='system'] .mobile-chat-item svg {
          stroke: rgba(0, 0, 0, 0.5) !important;
        }

        [data-theme='system'] .mobile-sidebar-footer {
          background: #ffffff !important;
          border-top-color: rgba(0, 0, 0, 0.06) !important;
        }

        [data-theme='system'] .mobile-sidebar-user {
          color: rgba(0, 0, 0, 0.8) !important;
        }

        [data-theme='system'] .mobile-sidebar-user-avatar {
          background: linear-gradient(135deg, #0a0b0d, #333) !important;
          color: #ffffff !important;
        }

        [data-theme='system'] .mobile-menu-item {
          color: rgba(0, 0, 0, 0.7) !important;
        }

        [data-theme='system'] .mobile-menu-item:hover {
          background: rgba(0, 0, 0, 0.04) !important;
        }

        [data-theme='system'] .mobile-menu-item svg {
          fill: rgba(0, 0, 0, 0.5) !important;
        }

        [data-theme='system'] .mobile-chat-history div[style*='color: rgba(255,255,255'] {
          color: rgba(0, 0, 0, 0.4) !important;
        }
      }

      /* Theme Transition */
      body,
      .sidebar,
      .mobile-sidebar,
      .chat-main,
      .input-area,
      .input-wrapper,
      .message,
      .chat-header,
      .modal,
      .settings-panel,
      .chat-auth-panel,
      .dropdown-menu,
      .toast-notification {
        transition:
          background 0.3s ease,
          color 0.3s ease,
          border-color 0.3s ease,
          box-shadow 0.3s ease;
      }

      /* ============================================================
   ðŸŒŠ KEYFRAME ANIMATIONS
   ============================================================ */

      @keyframes gradientFlow {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes borderRotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes hoverLift {
        0% {
          transform: translateY(0);
          box-shadow:
            0 1px 3px 0 rgba(0, 0, 0, 0.1),
            0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        100% {
          transform: translateY(-2px);
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
      }

      @keyframes borderShine {
        0%,
        100% {
          border-color: rgba(255, 255, 255, 0.5);
        }
        50% {
          border-color: rgba(255, 255, 255, 0.3);
        }
      }

      @keyframes neonPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInLeft {
        from {
          opacity: 0;
          transform: translateX(-30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes slideOutLeft {
        from {
          opacity: 1;
          transform: translateX(0);
          max-height: 100px;
        }
        to {
          opacity: 0;
          transform: translateX(-20px);
          max-height: 0;
          padding-top: 0;
          padding-bottom: 0;
          margin-bottom: 0;
        }
      }

      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes messageAppear {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      @keyframes typingDot {
        0%,
        60%,
        100% {
          transform: translateY(0);
          opacity: 0.4;
        }
        30% {
          transform: translateY(-12px);
          opacity: 1;
        }
      }

      @keyframes floatParticle {
        0% {
          transform: translateY(100vh) translateX(0) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100vh) translateX(100px) rotate(360deg);
          opacity: 0;
        }
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes shimmer {
        0% {
          background-position: -1000px 0;
        }
        100% {
          background-position: 1000px 0;
        }
      }

      @keyframes scaleIn {
        from {
          transform: scale(0);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes buttonPress {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(0.95);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes subtleGlow {
        0%,
        100% {
          box-shadow:
            0 1px 3px 0 rgba(0, 0, 0, 0.1),
            0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        50% {
          box-shadow:
            0 4px 6px -1px rgba(0, 0, 0, 0.1),
            0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
      }

      /* ðŸ”„ Loading dots animation */
      .loading-dots {
        display: inline-flex;
        align-items: center;
        padding: 1rem;
      }

      /* Plus dropdown show class (matches 'active' functionality) */
      .plus-dropdown.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      /* ============================================================
   ðŸŽ¨ BASE STYLES
   ============================================================ */

      body {
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          'SF Pro Display',
          sans-serif;
        background:
          radial-gradient(1400px 900px at 70% 15%, rgba(184, 107, 255, 0.1), transparent 60%),
          radial-gradient(1200px 700px at 20% 80%, rgba(110, 132, 255, 0.1), transparent 65%),
          var(--bg-0);
        color: var(--txt-1);
        overflow: hidden;
        height: 100vh;
        position: relative;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* ============================================================
   ðŸ“ LAYOUT
   ============================================================ */

      .chat-container {
        display: flex;
        height: 100vh;
        position: relative;
        z-index: 1;
      }

      /* ============================================================
   ðŸŽ¯ CLEAN SIDEBAR (MODERN & MINIMAL)
   ============================================================ */

      /* ========== SIDEBAR (Dark with WHITE text) ========== */
      .sidebar {
        width: 280px;
        background: #1a1a1a;
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        z-index: 100;
        box-shadow: 4px 0 24px rgba(0, 0, 0, 0.3);
      }

      /* Force ALL sidebar text to be WHITE */
      .sidebar,
      .sidebar *,
      .sidebar-header,
      .sidebar-header *,
      .logo,
      .conversation-item,
      .conversation-item *,
      .user-name,
      .user-email {
        color: #ffffff !important;
      }

      .sidebar.collapsed {
        transform: translateX(-280px);
      }

      /* ========== PREMIUM DARK SIDEBAR HEADER ========== */
      .sidebar-header {
        padding: 1.5rem;
        border-bottom: none;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        background: transparent; /* Match chat page background - no dark area */
      }

      .logo {
        font-family: 'Inter', sans-serif !important;
        font-size: 2rem;
        font-weight: 900 !important;
        color: #ffffff; /* White text for dark theme */
        letter-spacing: 0.08em !important;
        transition: all 0.3s ease;
      }

      .logo:hover {
        transform: scale(1.05);
      }

      /* ðŸ”˜ Sidebar Toggle Button - Visible on desktop, inside sidebar */
      .sidebar-toggle {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        width: 40px;
        height: 40px;
        background: transparent;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex !important; /* Show on desktop */
        align-items: center;
        justify-content: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 101;
        padding: 0;
      }

      .sidebar-toggle:hover {
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .sidebar-toggle svg {
        width: 20px;
        height: 20px;
        fill: #ffffff !important;
        transition: all 0.3s;
      }

      .sidebar-toggle .logo-icon {
        width: 32px;
        height: 32px;
      }

      .sidebar-toggle:hover svg {
        fill: #ffffff !important;
      }

      .sidebar-toggle:hover img {
        transform: scale(1.1);
      }

      .sidebar.collapsed .sidebar-toggle {
        left: 1rem !important; /* Stay visible when collapsed */
        position: fixed !important;
        z-index: 1000 !important;
        transform: translateY(-50%) translateX(280px) !important; /* Move out from collapsed sidebar */
      }

      /* Floating Open Button - Visible on Dark Background */
      .sidebar-open-btn {
        position: fixed;
        left: 1.5rem;
        top: 1.5rem;
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 14px;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 99;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      .sidebar.collapsed ~ .main-chat .sidebar-open-btn {
        display: flex;
      }

      .sidebar-open-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.5);
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
      }

      .sidebar-open-btn svg {
        width: 24px;
        height: 24px;
        fill: #ffffff !important;
        filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.5));
      }

      /* â­ New Chat Button - WHITE/GRAY */
      /* ========== PREMIUM NEW CHAT BUTTON (Dark Theme) ========== */
      .new-chat-btn {
        margin: 1.5rem;
        padding: 1.2rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 14px;
        color: #ffffff;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        font-family: 'Inter', sans-serif;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .new-chat-btn:hover {
        transform: translateY(-2px) scale(1.02);
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      .new-chat-btn:active {
        transform: translateY(0);
      }

      .new-chat-btn svg {
        width: 20px;
        height: 20px;
        fill: none;
        stroke: #ffffff;
        position: relative;
        z-index: 1;
        transition: transform 0.3s;
      }

      .new-chat-btn:hover svg {
        transform: rotate(90deg);
      }

      .new-chat-btn span {
        position: relative;
        z-index: 1;
      }

      /* ðŸ“œ Chat History - ChatGPT Style */
      .chat-history {
        flex: 1;
        overflow-y: auto;
        padding: 0.5rem;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
      }

      .chat-history::-webkit-scrollbar {
        width: 4px;
      }

      .chat-history::-webkit-scrollbar-track {
        background: transparent;
      }

      .chat-history::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
      }

      .chat-history::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Chat History Section Headers */
      .chat-history-section {
        margin-bottom: 0.5rem;
      }

      .chat-history-section-title {
        font-size: 0.7rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.4);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 0.75rem 0.75rem 0.5rem;
        margin: 0;
      }

      /* ChatGPT-Style Date Group Headers */
      .chat-date-group-header {
        padding: 8px 12px 4px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: rgba(255, 255, 255, 0.4);
        margin-top: 8px;
      }

      .chat-date-group-header:first-child {
        margin-top: 0;
      }

      [data-theme='light'] .chat-date-group-header {
        color: rgba(0, 0, 0, 0.4);
      }

      /* Chat Item - ChatGPT Style */
      .chat-item {
        padding: 0.65rem 0.75rem;
        margin-bottom: 2px;
        background: transparent;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.15s ease;
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
      }

      .chat-item:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .chat-item.active {
        background: rgba(255, 255, 255, 0.1);
      }

      .chat-item-content {
        flex: 1;
        min-width: 0;
        display: flex;
        align-items: center;
        gap: 0.6rem;
      }

      .chat-item-icon {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
        color: rgba(255, 255, 255, 0.5);
      }

      .chat-item-title {
        font-weight: 400;
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.85);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.4;
      }

      .chat-item:hover .chat-item-title {
        color: #ffffff;
      }

      .chat-item-preview {
        display: none; /* Hidden in ChatGPT style */
      }

      .chat-item-delete {
        width: 26px;
        height: 26px;
        background: transparent;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.15s ease;
        opacity: 0;
        flex-shrink: 0;
        color: rgba(255, 255, 255, 0.5);
      }

      .chat-item:hover .chat-item-delete {
        opacity: 1;
      }

      .chat-item-delete:hover {
        background: rgba(239, 68, 68, 0.15);
        color: #ef4444;
      }

      .chat-item-delete svg {
        width: 14px;
        height: 14px;
        stroke: currentColor;
        fill: none;
        transition: all 0.15s ease;
      }

      .chat-item-delete:hover svg {
        fill: #ffffff;
      }

      /* Chat History Empty State */
      .chat-history-empty {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem 1rem;
        text-align: center;
        color: rgba(255, 255, 255, 0.4);
      }

      .chat-history-empty svg {
        width: 40px;
        height: 40px;
        margin-bottom: 0.75rem;
        opacity: 0.5;
      }

      .chat-history-empty .empty-title {
        font-size: 0.875rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 0.25rem;
      }

      .chat-history-empty .empty-desc {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.3);
      }

      /* Hide empty state when there are chats */
      .chat-history:has(.chat-item) .chat-history-empty {
        display: none;
      }

      /* ðŸ” Sidebar Search */
      .sidebar-search {
        padding: 0.125rem 0.5rem;
        height: 24px;
        min-height: 24px;
        max-height: 24px;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        margin: 1rem;
        transition: all 0.3s;
      }

      .sidebar-search:focus-within {
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
      }

      .sidebar-search svg {
        width: 16px;
        height: 16px;
        fill: #ffffff !important;
        stroke: none !important;
        color: #ffffff !important;
        flex-shrink: 0;
      }

      .sidebar-search input {
        flex: 1;
        border: none;
        background: transparent;
        color: #1f2937;
        font-size: 0.8rem;
        line-height: 1;
        padding: 0;
        outline: none;
      }

      .sidebar-search input::placeholder {
        color: #6b7280;
      }

      /* ðŸ‘¤ Sidebar Footer & User Menu */
      .sidebar-footer {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1rem;
        background: transparent;
      }

      .user-menu {
        position: relative;
      }

      /* ========== PREMIUM USER INFO (Dark Theme) ========== */
      .user-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.05); /* Subtle dark background */
        border: 1px solid rgba(255, 255, 255, 0.1); /* Light border */
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .user-info:hover {
        border-color: rgba(255, 255, 255, 0.4); /* Green hover */
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.1); /* Green glow */
        background: rgba(255, 255, 255, 0.08);
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        background: transparent;
        border: 2px solid #ffffff !important;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .user-avatar svg {
        width: 24px;
        height: 24px;
        fill: none;
        stroke: #ffffff !important;
      }

      .user-details {
        flex: 1;
        min-width: 0;
      }

      .user-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: #ffffff; /* White for dark theme */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .user-email {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.6); /* Light gray for dark theme */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .user-menu-arrow {
        width: 20px;
        height: 20px;
        fill: #ffffff !important;
        transition: transform 0.3s;
      }

      .user-info.active .user-menu-arrow {
        transform: rotate(180deg);
      }

      /* User Dropdown */
      .user-dropdown {
        position: absolute;
        bottom: 100%;
        left: 0;
        right: 0;
        margin-bottom: 0.5rem;
        background: #1a1a1a; /* FIXED: Solid background matching entire interface */
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 14px;
        box-shadow:
          0 20px 25px -5px rgba(0, 0, 0, 0.5),
          0 10px 10px -5px rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
        overflow: hidden;
      }

      .user-dropdown.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem 1rem;
        color: #ffffff !important;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s;
      }

      .dropdown-item:hover {
        background: rgba(255, 255, 255, 0.08);
        color: #ffffff !important;
      }

      .dropdown-item.logout:hover {
        background: rgba(255, 107, 74, 0.1);
        color: #ff6b4a !important;
      }

      .dropdown-item svg {
        width: 20px;
        height: 20px;
        fill: currentColor;
      }

      .dropdown-divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.1);
        margin: 0.5rem 0;
      }

      /* ============================================================
   ðŸ’¬ MAIN CHAT AREA
   ============================================================ */

      /* ========== PREMIUM CHAT AREA BACKGROUND ========== */
      .main-chat {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        background: var(--bg-0);
      }

      /* ðŸŽ¯ Top Header (Dark Theme) */
      .chat-header {
        padding: 1rem 2rem;
        background: var(--bg-0);
        border-bottom: none;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.5rem;
        position: fixed;
        top: 0;
        left: 280px; /* FIXED - Account for sidebar width */
        width: calc(100% - 280px); /* FIXED - Full width minus sidebar */
        z-index: 150; /* FIXED: Higher than sidebar (100) to stay above messages */
        box-shadow: none;
        /* REMOVED: No transition, stays fixed */
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      /* Model selector removed */

      /* ðŸ“Š Token Counter */
      .token-counter {
        padding: 0.75rem 1.25rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .token-counter-label {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
      }

      .token-counter-value {
        font-size: 1rem;
        font-weight: 700;
        font-family: 'JetBrains Mono', monospace;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 0.7) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* ðŸ”§ Header Actions */
      .header-actions {
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }

      .header-btn {
        min-width: 48px;
        height: 48px;
        padding: 0.75rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        color: #ffffff;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        white-space: nowrap;
      }

      .header-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 255, 255, 0.15);
      }

      .header-btn:active {
        transform: translateY(0);
      }

      .header-btn svg {
        width: 20px;
        height: 20px;
        fill: #ffffff;
        stroke: #ffffff;
        transition: all 0.3s;
        flex-shrink: 0;
      }

      .header-btn span {
        display: inline-block;
      }

      /* Prominent Header Buttons (Download & Share) - CYAN like neon icons */
      .header-btn-prominent {
        background: transparent;
        border: 2px solid rgba(255, 255, 255, 0.4);
        color: #ffffff;
        min-width: 110px;
      }

      .header-btn-prominent svg {
        fill: none;
        stroke: #ffffff;
      }

      .header-btn-prominent:hover {
        background: transparent;
        transform: translateY(-2px) scale(1.05);
        box-shadow: none;
      }

      /* ðŸŽ¯ Header Buttons - Minimal Icon-Only Style */
      .header-btn-icon {
        width: 32px;
        height: 32px;
        background: transparent;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.25s ease;
        padding: 0;
      }

      .header-btn-icon svg {
        fill: #ffffff !important; /* White for dark theme */
        transition: transform 0.25s ease;
      }

      .header-btn-icon:hover {
        transform: scale(1.2);
      }

      .header-btn-icon:hover svg {
        transform: scale(1.1);
      }

      .header-btn-icon:active {
        transform: scale(0.95);
      }

      /* ============================================================
   ðŸ’­ MESSAGES AREA
   ============================================================ */

      /* ========== GOOGLE STUDIO LAYOUT: CENTERED CHAT AREA ========== */
      .messages-container {
        flex: 1;
        overflow-y: auto;
        padding: 2rem;
        padding-top: 100px; /* Space below navbar to prevent overlap */
        padding-bottom: 180px; /* Space for fixed bottom input */
        display: flex;
        flex-direction: column;
        gap: 0.5rem; /* ChatGPT-like compact spacing */
        scroll-behavior: smooth;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        /* Center chat area with max-width */
        max-width: 900px;
        margin: 0 auto;
        width: 100%;
        /* Prevent overflow above navbar */
        max-height: calc(100vh - 80px);
        position: relative;
        z-index: 1; /* Below navbar (z-index: 150) */
      }

      .messages-container::-webkit-scrollbar {
        width: 8px;
      }

      .messages-container::-webkit-scrollbar-track {
        background: transparent;
      }

      .messages-container::-webkit-scrollbar-thumb {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 0.7) 100%
        );
        border-radius: 10px;
      }

      /* ðŸŒŸ Empty State */
      .empty-state {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding-top: 2rem;
        gap: 1.5rem;
        position: relative;
        animation: fadeInScale 0.6s ease;
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
      }

      .particles {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        pointer-events: none;
      }

      .particle {
        display: none;
      }

      /* ðŸ§  NEURAL QUANTUM BRAIN LOADER - Centered in Response Area */
      .mini-spinner-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 120px;
        height: 120px;
        animation:
          fadeInScale 0.8s ease,
          floatAnimation 3s ease-in-out infinite;
        z-index: 10;
        filter: drop-shadow(0 0 24px rgba(124, 92, 255, 0.15));
      }

      .mini-spinner {
        width: 100%;
        height: 100%;
        position: relative;
        display: grid;
        place-items: center;
      }

      /* Floating animation for AI brain */
      @keyframes floatAnimation {
        0%,
        100% {
          transform: translate(-50%, -50%) translateY(0px);
        }
        50% {
          transform: translate(-50%, -50%) translateY(-10px);
        }
      }

      /* ðŸŒŒ LYDIAN ORBIT ANIMATION - Premium Interactive SVG Orbit */

      /* ðŸ‘¤ USER WELCOME TEXT - Above Orbit */
      .user-welcome-text {
        position: absolute;
        bottom: 35%;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        z-index: 11;
        pointer-events: none;
        width: 90%;
        max-width: 600px;
      }

      .welcome-user-name {
        display: none;
        font-size: 1.1rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 8px;
        letter-spacing: 0.3px;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.4s ease;
      }

      .welcome-user-name[style*='display: block'] {
        opacity: 1;
        transform: translateY(0);
      }

      .welcome-message {
        font-size: 1.5rem;
        font-weight: 600;
        color: #ffffff;
        letter-spacing: 0.5px;
      }

      /* Personalized Welcome Animation */
      @keyframes welcomeFadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ========== ChatGPT-Style Header Model Dropdown ========== */
      .header-model-selector {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 8px;
        cursor: pointer;
        background: transparent;
        border: 1px solid transparent;
        color: #ffffff;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        position: relative;
      }

      .header-model-selector:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.1);
      }

      .header-model-selector svg {
        width: 16px;
        height: 16px;
        fill: currentColor;
        transition: transform 0.2s;
      }

      .header-model-selector.open svg {
        transform: rotate(180deg);
      }

      .header-model-dropdown {
        position: absolute;
        top: calc(100% + 6px);
        left: 0;
        min-width: 240px;
        background: #1e1e1e;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        padding: 6px;
        z-index: 1000;
        display: none;
        animation: fadeIn 0.15s ease-out;
      }

      .header-model-dropdown.show {
        display: block;
      }

      .model-dropdown-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 14px;
        border-radius: 8px;
        cursor: pointer;
        border: none;
        background: transparent;
        color: rgba(255, 255, 255, 0.8);
        font-size: 13px;
        width: 100%;
        text-align: left;
        transition: background 0.15s;
      }

      .model-dropdown-option:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .model-dropdown-option.active {
        background: rgba(99, 102, 241, 0.15);
        color: #818cf8;
      }

      .model-dropdown-option .model-opt-icon {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 14px;
      }

      .model-dropdown-option .model-opt-info {
        flex: 1;
      }

      .model-dropdown-option .model-opt-name {
        font-weight: 500;
        font-size: 13px;
      }

      .model-dropdown-option .model-opt-desc {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.4);
        margin-top: 2px;
      }

      .model-dropdown-option.active .model-opt-desc {
        color: rgba(129, 140, 248, 0.6);
      }

      /* Light theme */
      [data-theme='light'] .header-model-selector {
        color: #1f2328;
      }
      [data-theme='light'] .header-model-selector:hover {
        background: rgba(0, 0, 0, 0.06);
        border-color: rgba(0, 0, 0, 0.08);
      }
      [data-theme='light'] .header-model-dropdown {
        background: #ffffff;
        border-color: rgba(0, 0, 0, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      }
      [data-theme='light'] .model-dropdown-option {
        color: #1f2328;
      }
      [data-theme='light'] .model-dropdown-option:hover {
        background: rgba(0, 0, 0, 0.04);
      }
      [data-theme='light'] .model-dropdown-option .model-opt-desc {
        color: rgba(0, 0, 0, 0.4);
      }

      /* Hide on mobile */
      @media (max-width: 768px) {
        .header-model-selector {
          display: none;
        }
      }

      /* ðŸŽ‰ PREMIUM TOAST NOTIFICATION SYSTEM */
      .toast-notification {
        position: fixed;
        bottom: 24px;
        right: 24px;
        background: rgba(22, 22, 22, 0.92);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
        z-index: 10010;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        max-width: 340px;
        min-width: 240px;
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
      }

      .toast-notification.show {
        opacity: 1;
        transform: translateX(0);
      }

      .toast-notification.hide {
        opacity: 0;
        transform: translateY(10px) scale(0.95);
      }

      .toast-notification.welcome {
        border-left: 3px solid rgba(255, 255, 255, 0.4);
      }

      .toast-notification.success {
        border-left: 3px solid rgba(255, 255, 255, 0.3);
      }

      .toast-notification.error {
        border-left: 3px solid rgba(255, 255, 255, 0.15);
      }

      .toast-notification.info {
        border-left: 3px solid rgba(255, 255, 255, 0.2);
      }

      .toast-avatar {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.08);
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
      }

      .toast-content {
        flex: 1;
        min-width: 0;
      }

      .toast-title {
        font-size: 13px;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.4;
      }

      .toast-subtitle {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.4);
        line-height: 1.3;
        margin-top: 2px;
      }

      .toast-close {
        width: 24px;
        height: 24px;
        border-radius: 6px;
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.25);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        transition: all 0.2s;
      }

      .toast-close:hover {
        background: rgba(255, 255, 255, 0.08);
        color: rgba(255, 255, 255, 0.6);
      }

      .toast-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 2px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 0 0 0 12px;
        animation: toastProgress 3s linear forwards;
      }

      @keyframes toastProgress {
        from {
          width: 100%;
        }
        to {
          width: 0%;
        }
      }

      /* Mobile Toast Position */
      @media (max-width: 768px) {
        .toast-notification {
          bottom: auto;
          top: 12px;
          right: 12px;
          left: 12px;
          max-width: none;
          min-width: auto;
          transform: translateY(-100%);
          padding: 10px 14px;
        }

        .toast-notification.show {
          transform: translateY(0);
        }

        .toast-notification.hide {
          transform: translateY(-10px) scale(0.95);
        }
      }

      /* LyDian Orbit SVG Animations */
      .lydian-orbit-ring-1 {
        transform-origin: center;
        animation: orbitRotate1 36s linear infinite;
      }

      .lydian-orbit-ring-2 {
        transform-origin: center;
        animation: orbitRotate2 24s linear infinite reverse;
      }

      .lydian-orbit-ring-3 {
        transform-origin: center;
        animation: orbitRotate3 12s linear infinite;
      }

      @keyframes orbitRotate1 {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes orbitRotate2 {
        from {
          transform: rotate(360deg);
        }
        to {
          transform: rotate(0deg);
        }
      }

      @keyframes orbitRotate3 {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(-360deg);
        }
      }

      /* Lissajous satellite motion */
      .lydian-lissajous {
        animation: lissajousFly 10s linear infinite;
      }

      @keyframes lissajousFly {
        0% {
          transform: translate(0, 0);
        }
        25% {
          transform: translate(45px, -35px);
        }
        50% {
          transform: translate(0, -60px);
        }
        75% {
          transform: translate(-45px, -35px);
        }
        100% {
          transform: translate(0, 0);
        }
      }

      /* Pyramid animations removed - replaced with LyDian Orbit */

      .suggestion-chip:active {
        transform: translateY(0);
      }

      /* ============================================================
   ðŸ’¬ MESSAGE BUBBLES (CLEAN DESIGN)
   ============================================================ */

      /* ========== ORIGINAL CENTERED LAYOUT (No Icons) ========== */
      /* ========== ChatGPT-Style Messages: No Bubbles, Left-Aligned ========== */
      .message {
        display: flex;
        gap: 0.75rem;
        animation: messageAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        max-width: 100%;
        padding: 16px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }

      .message:last-child {
        border-bottom: none;
      }

      /* User: Right aligned */
      .message.user {
        align-self: flex-end;
        flex-direction: row-reverse;
      }

      /* AI: Left aligned */
      .message.assistant {
        align-self: flex-start;
        flex-direction: row;
        max-width: 100%;
      }

      /* ========== ChatGPT-Style Avatars: Small, Clean, Visible ========== */
      .message-avatar {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        min-width: 28px;
        border-radius: 50%;
        flex-shrink: 0;
        font-size: 13px;
        font-weight: 600;
        color: #ffffff;
        margin-top: 2px;
        background-size: cover;
        background-position: center;
        overflow: hidden;
      }

      .message.user .message-avatar {
        background: linear-gradient(135deg, #10a37f, #0d8c6d);
      }

      .message.assistant .message-avatar {
        background: linear-gradient(135deg, #8b5cf6, #6366f1);
      }

      .message-avatar svg {
        width: 16px;
        height: 16px;
      }

      .message.user .message-avatar svg {
        fill: #ffffff;
      }

      .message.assistant .message-avatar svg {
        fill: #ffffff;
        stroke: none;
      }

      /* Typewriter cursor */
      .tw-cursor {
        display: inline-block;
        width: 2px;
        height: 1.1em;
        background: var(--accent-2, #6e84ff);
        margin-left: 2px;
        vertical-align: text-bottom;
        animation: twBlink 0.6s ease-in-out infinite;
      }
      @keyframes twBlink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0;
        }
      }

      /* ðŸ’¬ Message Content */
      .message-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      /* ðŸ“Ž File Preview in Messages (ChatGPT Style) */
      .message-file-preview {
        margin-bottom: 0.5rem;
        border-radius: 12px;
        overflow: hidden;
      }

      .message-image-preview {
        max-width: 300px;
        max-height: 300px;
        border-radius: 12px;
        cursor: pointer;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .message-image-preview:hover {
        transform: scale(1.02);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      }

      .message-file-doc {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        max-width: 280px;
      }

      .message-file-doc .file-name {
        flex: 1;
        font-size: 0.9rem;
        color: #fff;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .message-file-doc .file-size {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
      }

      /* ðŸ–¼ï¸ Image Modal */
      .image-modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100000;
        padding: 2rem;
        animation: fadeIn 0.2s ease-out;
      }

      .image-modal-content {
        position: relative;
        max-width: 90vw;
        max-height: 90vh;
      }

      .image-modal-content img {
        max-width: 100%;
        max-height: 90vh;
        border-radius: 8px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }

      .image-modal-close {
        position: absolute;
        top: -40px;
        right: 0;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: #fff;
        transition: background 0.2s;
      }

      .image-modal-close:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      @media (max-width: 768px) {
        .message-image-preview {
          max-width: 100%;
          max-height: 250px;
        }

        .message-file-doc {
          max-width: 100%;
        }
      }

      /* ========== ChatGPT-Style: Clean Text, No Bubbles ========== */
      .message-text {
        padding: 0;
        background: transparent;
        border-radius: 0;
        line-height: 1.7;
        font-size: 0.95rem;
        position: relative;
        color: #ffffff;
        border: none;
        box-shadow: none;
      }

      .message.user .message-text {
        color: #ffffff;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 18px 18px 4px 18px;
        padding: 10px 16px;
      }

      .message.assistant .message-text {
        color: #ffffff;
        font-weight: 400;
        letter-spacing: 0.01em;
      }

      .message-text p {
        margin-bottom: 0.75rem;
      }

      .message-text p:last-child {
        margin-bottom: 0;
      }

      .message-text strong {
        font-weight: 700;
        color: #ffffff; /* Clean white, no colors */
      }

      .message-text em {
        font-style: italic;
        color: #ffffff; /* Clean white, no colors */
      }

      .message-text code {
        background: rgba(255, 255, 255, 0.08);
        padding: 0.2rem 0.5rem;
        border-radius: 6px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.875rem;
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: #ffffff; /* Clean white, no colors */
      }

      /* ðŸ•’ Message Timestamp */
      .message-timestamp {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.6);
        margin-top: 0.5rem;
        opacity: 0.7;
        font-weight: 400;
      }

      /* ðŸ“Š RESPONSE CONFIDENCE BADGE */
      .response-confidence {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-top: 0.75rem;
        margin-bottom: 0.25rem;
      }

      .confidence-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.35rem 0.75rem;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 20px;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      .confidence-badge svg {
        flex-shrink: 0;
      }

      .confidence-badge.confidence-high {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: #ffffff;
      }

      .confidence-badge.confidence-medium {
        background: rgba(255, 193, 7, 0.15);
        border: 1px solid rgba(255, 193, 7, 0.3);
        color: #ffc107;
      }

      .confidence-badge.confidence-low {
        background: rgba(239, 68, 68, 0.15);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
      }

      .research-tip {
        display: inline-flex;
        align-items: center;
        padding: 0.3rem 0.6rem;
        font-size: 0.7rem;
        font-weight: 500;
        background: rgba(139, 92, 246, 0.15);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 16px;
        color: #a78bfa;
      }

      /* âš¡ Message Actions */
      .message-actions {
        display: flex;
        gap: 0.375rem;
        opacity: 0;
        transform: translateY(-5px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        margin-top: 0.5rem;
      }

      .message-content:hover .message-actions {
        opacity: 1;
        transform: translateY(0);
      }

      /* User message actions - align right */
      .message-actions.user-actions {
        justify-content: flex-end;
      }

      .message-action-btn {
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Small copy button - icon only */
      .copy-btn-small {
        padding: 0.35rem !important;
        background: transparent !important;
        border: none !important;
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .copy-btn-small:hover {
        background: rgba(255, 255, 255, 0.1) !important;
        color: rgba(255, 255, 255, 0.9);
      }

      .copy-btn-small svg {
        fill: currentColor;
      }

      .message-action-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.4);
        color: #ffffff;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.15);
      }

      .message-action-btn svg {
        width: 14px;
        height: 14px;
        fill: currentColor;
      }

      /* Feedback buttons (thumbs up/down) */
      .feedback-btn {
        padding: 0.35rem !important;
        background: transparent !important;
        border: none !important;
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .feedback-btn:hover {
        background: rgba(255, 255, 255, 0.1) !important;
        color: rgba(255, 255, 255, 0.9);
      }

      .feedback-btn.active-up {
        color: #4ade80 !important;
      }

      .feedback-btn.active-down {
        color: #f87171 !important;
      }

      .feedback-btn svg {
        fill: currentColor;
      }

      .feedback-separator {
        width: 1px;
        height: 14px;
        background: rgba(255, 255, 255, 0.1);
        margin: 0 0.125rem;
        align-self: center;
      }

      /* ðŸ”„ Typing Indicator - ChatGPT Style "DÃ¼ÅŸÃ¼nÃ¼yor..." */
      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
      }

      .typing-text {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.95rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 2px;
      }

      .typing-dots {
        display: inline-flex;
        gap: 2px;
        margin-left: 2px;
      }

      .typing-dots span {
        display: inline-block;
        width: 4px;
        height: 4px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        animation: typingDotBounce 1.4s infinite ease-in-out;
      }

      .typing-dots span:nth-child(1) {
        animation-delay: 0s;
      }
      .typing-dots span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dots span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typingDotBounce {
        0%,
        60%,
        100% {
          transform: translateY(0);
          opacity: 0.4;
        }
        30% {
          transform: translateY(-4px);
          opacity: 1;
        }
      }

      /* Legacy typing dots (keeping for compatibility) */
      .typing-dot {
        width: 10px;
        height: 10px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        animation: typingDot 1.4s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      /* ============================================================
   âœï¸ INPUT AREA (CLEAN & MODERN)
   ============================================================ */

      /* ========== GOOGLE STUDIO LAYOUT: FIXED BOTTOM INPUT ========== */
      .input-container {
        padding: 1rem 2rem 1rem;
        position: fixed; /* Fixed at bottom like Google Studio */
        bottom: 0;
        left: 280px; /* Account for sidebar width - FIXED */
        width: calc(100% - 280px); /* Full width minus sidebar - FIXED */
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        background: var(--bg-0); /* Unified with main-chat background */
        border-top: none; /* Remove border for cleaner look */
        z-index: 50;
        /* REMOVED: No transition, stays fixed */
      }

      /* Input container iÃ§inde empty state'de olduÄŸunda */
      .empty-state .input-container {
        padding: 0;
        max-width: 900px;
      }

      /* Footer info row below input */
      .input-footer-info {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin: -4px 0 0;
      }

      .input-disclaimer {
        text-align: center;
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.35);
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        font-weight: 400;
        margin: 0;
        padding: 0;
        letter-spacing: 0;
        line-height: 1.4;
      }

      [data-theme='light'] .input-disclaimer {
        color: rgba(0, 0, 0, 0.35) !important;
      }

      /* Recall status - green premium pill */
      .recall-status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 2px 8px;
        border-radius: 9999px;
        background: rgba(34, 197, 94, 0.08);
        border: 1px solid rgba(34, 197, 94, 0.15);
        cursor: default;
        flex-shrink: 0;
      }

      .recall-status-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #22c55e;
        box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
        animation: statusPulse 2s ease-in-out infinite;
      }

      @keyframes statusPulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .recall-status-text {
        font-size: 0.65rem;
        font-weight: 500;
        color: rgba(34, 197, 94, 0.7);
        font-family: 'Inter', sans-serif;
        letter-spacing: 0.2px;
      }

      [data-theme='light'] .recall-status-indicator {
        background: rgba(34, 197, 94, 0.06) !important;
        border-color: rgba(34, 197, 94, 0.12) !important;
      }

      [data-theme='light'] .recall-status-text {
        color: rgba(22, 163, 74, 0.65) !important;
      }

      /* ðŸ“‹ LYDIAN AI DISCLAIMER - Professional Corporate Notice */
      .ai-disclaimer {
        margin-top: 0.5rem;
        padding: 0.625rem 1rem;
        text-align: center;
        font-size: 0.75rem;
        line-height: 1.5;
        color: rgba(255, 255, 255, 0.45);
        font-weight: 400;
        letter-spacing: 0.3px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
      }

      .ai-disclaimer strong {
        font-weight: 600;
        color: rgba(255, 255, 255, 0.65);
      }

      .ai-disclaimer a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        border-bottom: 1px dotted rgba(255, 255, 255, 0.15);
        transition: all 0.2s ease;
      }

      .ai-disclaimer a:hover {
        color: #ffffff;
        border-bottom-color: #ffffff;
      }

      /* âš¡ AI MODE SELECTORS */
      .input-mode-selectors {
        display: none; /* HIDDEN - Replaced with inline neon icons */
        gap: 0.75rem;
        align-items: center;
        justify-content: center;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        flex-wrap: wrap;
      }

      .mode-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.875rem 1.25rem;
        background: transparent;
        border: 1px solid transparent;
        border-radius: 12px;
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 600;
        color: #4b5563;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        white-space: nowrap;
      }

      .mode-btn svg {
        width: 20px;
        height: 20px;
        fill: #4b5563;
        transition: all 0.3s;
      }

      .mode-btn:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.15);
        color: #ffffff;
        transform: translateY(-2px);
      }

      .mode-btn:hover svg {
        fill: #ffffff;
      }

      .mode-btn.active {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 0.7) 100%
        );
        border-color: transparent;
        color: #ffffff;
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.12);
      }

      .mode-btn.active svg {
        fill: #ffffff;
      }

      .mode-btn:active {
        transform: translateY(0);
      }

      /* ðŸ”„ PROMINENT LOADING ANIMATION */
      .loading-indicator {
        display: none;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        padding: 1.5rem 2rem;
        margin: 1rem 0;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08) 0%,
          rgba(255, 107, 74, 0.1) 100%
        );
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px;
        animation: fadeInScale 0.3s ease;
      }

      .loading-indicator.active {
        display: flex;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #e5e7eb;
        border-top-color: #ffffff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .loading-text {
        font-size: 1rem;
        font-weight: 600;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .loading-dots {
        display: inline-flex;
        gap: 0.25rem;
      }

      .loading-dots span {
        width: 8px;
        height: 8px;
        background: #1f2937;
        border-radius: 50%;
        animation: bounce 1.4s infinite ease-in-out both;
      }

      .loading-dots span:nth-child(1) {
        animation-delay: -0.32s;
      }

      .loading-dots span:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* ========== PREMIUM CHATGPT-STYLE INPUT ========== */
      .input-wrapper {
        max-width: 680px;
        width: calc(100% - 3rem);
        margin: 0 auto;
        /* Dark theme matching - subtle glass */
        background: rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(16px) saturate(180%);
        -webkit-backdrop-filter: blur(16px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 26px;
        padding: 0.75rem 1rem;
        /* Premium shadow */
        box-shadow:
          0 0 0 1px rgba(0, 0, 0, 0.2),
          0 4px 16px rgba(0, 0, 0, 0.4),
          0 12px 32px rgba(0, 0, 0, 0.3);
        position: relative;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        /* Flex layout for components */
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .input-wrapper:focus-within {
        background: rgba(40, 41, 45, 0.98);
        border-color: rgba(100, 120, 200, 0.3);
        box-shadow:
          0 0 0 1px rgba(100, 120, 200, 0.15),
          0 4px 16px rgba(0, 0, 0, 0.4),
          0 12px 32px rgba(0, 0, 0, 0.3),
          0 0 30px rgba(100, 120, 200, 0.08);
      }

      /* ðŸ“Š STATS - Hidden completely */
      .mobile-input-stats {
        display: none !important;
      }

      /* ðŸ“Š Desktop Stats & Disclaimer - Visible with disclaimer */
      .desktop-stats-disclaimer {
        display: flex;
        justify-content: center;
        margin-top: 0.5rem;
      }

      .desktop-stats-row {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 20px;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.5);
      }

      .desktop-stat-item {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-family: 'JetBrains Mono', monospace;
        white-space: nowrap;
      }

      .desktop-stat-item svg {
        opacity: 0.6;
      }

      .desktop-stat-item.token-stat {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 0.7) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 600;
      }

      .desktop-stat-item.token-stat svg {
        stroke: rgba(255, 255, 255, 0.7);
        opacity: 0.8;
      }

      .desktop-stat-divider {
        color: rgba(255, 255, 255, 0.2);
        font-weight: 300;
      }

      .desktop-disclaimer {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        color: rgba(255, 255, 255, 0.4);
        font-size: 0.75rem;
        white-space: nowrap;
      }

      .desktop-disclaimer svg {
        opacity: 0.5;
        color: rgba(255, 200, 100, 0.6);
        stroke: currentColor;
      }

      /* Mobile responsive */
      @media (max-width: 768px) {
        /* Hide file/voice/code buttons in input-actions on mobile - use + dropdown instead */
        .file-upload-btn,
        .voice-chat-btn,
        .code-write-btn {
          display: none !important;
        }
      }

      .input-area {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .input-row {
        display: flex;
        gap: 1rem;
        align-items: flex-end;
      }

      /* ========== CHATGPT-STYLE AUTO-GROW TEXTAREA ========== */
      #messageInput {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        color: #ffffff;
        font-size: 1rem;
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        line-height: 1.5;
        resize: none;
        min-height: 24px;
        max-height: 200px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        padding: 0.5rem 0;
        padding-right: 120px; /* Space for buttons on right */
      }

      #messageInput::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      #messageInput::-webkit-scrollbar {
        width: 6px;
      }

      #messageInput::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.8);
        border-radius: 10px;
      }

      /* ðŸŽ¬ Input Actions - RIGHT SIDE, FLEX ALIGNED */
      .input-actions {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        z-index: 60;
        pointer-events: auto;
        flex-shrink: 0;
      }

      /* ðŸš« NEON AI MODE ICONS - COMPLETELY HIDDEN */
      .neon-icons-container {
        display: none !important;
        visibility: hidden !important;
      }

      /* ðŸŒŸ MOBILE ONLY ELEMENTS - Hidden on desktop */
      .mobile-plus-btn,
      .mobile-plus-container,
      .mobile-plus-dropdown,
      .mobile-search-btn,
      .mobile-toggle-btn,
      .mobile-hamburger-btn,
      .mobile-logo-toggle,
      .mobile-logo-text,
      .mobile-logo-container,
      .mobile-dropdown-trigger,
      .mobile-dropdown-menu,
      .mobile-sidebar,
      .mobile-sidebar-overlay {
        display: none;
      }

      /* ðŸŒŸ NEON ICONS - COMPACT PREMIUM DESIGN */
      .neon-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        background: transparent;
        border: none;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        padding: 0;
        opacity: 0.7;
      }

      .neon-icon svg {
        width: 20px;
        height: 20px;
        transition: transform 0.2s ease;
        fill: #ffffff !important; /* White for dark theme */
      }

      .neon-icon:hover {
        transform: scale(1.15);
        opacity: 1;
      }

      .neon-icon:hover svg {
        transform: scale(1.05);
      }

      .neon-icon:active {
        transform: scale(0.95);
      }

      /* Active state for neon icons - WITH PULSE ANIMATION */
      .neon-icon.active {
        opacity: 1;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        animation: iconPulse 2s ease-in-out infinite;
      }

      .neon-icon.active svg {
        fill: #ffffff !important; /* Teal highlight when active */
        animation: iconRotate 3s ease-in-out infinite;
      }

      /* Pulse animation for active icon */
      @keyframes iconPulse {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.3);
          transform: scale(1);
        }
        50% {
          box-shadow: 0 0 0 8px rgba(255, 255, 255, 0);
          transform: scale(1.05);
        }
      }

      /* Subtle rotate/bounce for SVG inside */
      @keyframes iconRotate {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
        }
        25% {
          transform: scale(1.1) rotate(-5deg);
        }
        50% {
          transform: scale(1.15) rotate(0deg);
        }
        75% {
          transform: scale(1.1) rotate(5deg);
        }
      }

      /* Ripple animation on icon click */
      @keyframes rippleAnimation {
        from {
          transform: scale(0);
          opacity: 1;
        }
        to {
          transform: scale(2.5);
          opacity: 0;
        }
      }

      /* REMOVED: Plus Button & Dropdown - CSS kaldÄ±rÄ±ldÄ±, boÅŸ iÅŸlevi yok */

      .input-action-btn {
        width: 40px;
        height: 40px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08) 0%,
          rgba(255, 107, 74, 0.1) 100%
        );
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
      }

      .input-action-btn:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 0.7) 100%
        );
        border-color: transparent;
        transform: scale(1.1);
        box-shadow:
          0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      .input-action-btn:hover svg {
        fill: #ffffff;
      }

      .input-action-btn svg {
        width: 20px;
        height: 20px;
        fill: #1f2937;
        stroke: #1f2937;
        transition: all 0.3s;
      }

      /* ðŸš€ Send Button - Gray Neon Style */
      #sendBtn {
        width: 36px;
        height: 36px;
        background: rgba(120, 130, 150, 0.3);
        border: 1px solid rgba(150, 160, 180, 0.3);
        border-radius: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      #sendBtn:hover {
        background: rgba(140, 150, 170, 0.4);
        border-color: rgba(180, 190, 210, 0.4);
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(120, 130, 150, 0.3);
      }

      #sendBtn:active {
        transform: scale(0.95);
      }

      #sendBtn:disabled {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.08);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      #sendBtn:disabled svg {
        fill: rgba(255, 255, 255, 0.2);
      }

      #sendBtn svg {
        width: 18px;
        height: 18px;
        fill: rgba(255, 255, 255, 0.8);
      }

      /* ðŸŽ¤ Voice Chat Button - Premium Teal */
      .voice-chat-btn {
        width: 36px;
        height: 36px;
        background: transparent;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        color: rgba(255, 255, 255, 0.6);
      }

      .voice-chat-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #ffffff;
      }

      .voice-chat-btn:active {
        transform: scale(0.95);
      }

      .voice-chat-btn svg {
        width: 20px;
        height: 20px;
        fill: currentColor;
      }

      /* ðŸ“ File Upload Button */
      .file-upload-btn {
        width: 36px;
        height: 36px;
        background: transparent;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        color: rgba(255, 255, 255, 0.6);
      }

      .file-upload-btn:hover {
        background: rgba(110, 132, 255, 0.2);
        color: #6e84ff;
      }

      .file-upload-btn:active {
        transform: scale(0.95);
      }

      .file-upload-btn svg {
        width: 20px;
        height: 20px;
        fill: currentColor;
      }

      /* ðŸ’» Code Write Button (Desktop) */
      .code-write-btn {
        width: 36px;
        height: 36px;
        background: transparent;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        color: rgba(255, 255, 255, 0.6);
      }
      .code-write-btn:hover {
        background: rgba(110, 132, 255, 0.2);
        color: var(--accent-2, #6e84ff);
      }
      .code-write-btn:active {
        transform: scale(0.95);
      }
      .code-write-btn.active {
        background: rgba(110, 132, 255, 0.3);
        color: var(--accent-2, #6e84ff);
      }
      .code-write-btn svg {
        width: 20px;
        height: 20px;
        fill: currentColor;
      }

      /* ðŸ“Š Input Stats - BELOW INPUT FORM */
      .input-stats {
        display: none; /* Hidden on desktop by default - shown above form on mobile */
      }

      .char-count {
        font-family: 'JetBrains Mono', monospace;
      }

      .token-count {
        font-family: 'JetBrains Mono', monospace;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 0.7) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 600;
      }

      /* ============================================================
   ðŸŽ¨ MODALS & OVERLAYS
   ============================================================ */

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(20px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeInScale 0.3s ease;
      }

      .modal-overlay.active {
        display: flex;
      }

      .modal {
        background: rgba(26, 26, 26, 0.98);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 24px;
        padding: 2rem;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow:
          0 20px 25px -5px rgba(0, 0, 0, 0.5),
          0 10px 10px -5px rgba(0, 0, 0, 0.4);
        animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 800;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 0.7) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .modal-close {
        width: 36px;
        height: 36px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .modal-close:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: #ff6b4a;
        transform: rotate(90deg);
        box-shadow: 0 4px 12px rgba(255, 107, 74, 0.3);
      }

      .modal-close svg {
        width: 20px;
        height: 20px;
        fill: #ffffff;
        transition: fill 0.3s;
      }

      .modal-close:hover svg {
        fill: #ff6b4a;
      }

      /* ðŸ“¤ SHARE MODAL STYLES */
      .share-modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 1rem;
        animation: fadeIn 0.2s ease;
      }

      .share-modal {
        background: rgba(32, 33, 36, 0.98);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        max-width: 480px;
        width: 100%;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        animation: slideUp 0.3s ease;
      }

      .share-modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .share-modal-header h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #fff;
        margin: 0;
      }

      .share-modal-close {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 10px;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .share-modal-close:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .share-modal-close svg {
        fill: rgba(255, 255, 255, 0.7);
      }

      .share-modal-content {
        padding: 1.5rem;
      }

      .share-warning {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.3);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1.25rem;
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.5;
      }

      .share-warning svg {
        flex-shrink: 0;
        color: #ffc107;
      }

      .share-url-box {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .share-url-box input {
        flex: 1;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        padding: 0.75rem 1rem;
        color: #fff;
        font-size: 0.875rem;
        font-family: 'SF Mono', 'Menlo', monospace;
      }

      .share-url-box input:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.4);
      }

      .copy-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        color: #ffffff;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
      }

      .copy-btn:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .copy-btn svg {
        fill: #ffffff;
      }

      .whatsapp-share-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        width: 100%;
        padding: 1rem 1.5rem;
        background: #25d366;
        border: none;
        border-radius: 12px;
        color: #fff;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.2s;
        margin-bottom: 1rem;
      }

      .whatsapp-share-btn:hover {
        background: #22c55e;
        transform: translateY(-1px);
      }

      .whatsapp-share-btn svg {
        fill: #fff;
      }

      .share-expiry {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.5);
      }

      .share-expiry svg {
        stroke: rgba(255, 255, 255, 0.5);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* ðŸŽ¨ Theme Options */
      .theme-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1rem;
      }

      .theme-option {
        padding: 1.25rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 14px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-align: center;
      }

      .theme-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.4);
      }

      .theme-option.active {
        border-color: rgba(255, 255, 255, 0.4);
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.12);
      }

      .theme-preview {
        width: 100%;
        height: 60px;
        border-radius: 8px;
        margin-bottom: 0.75rem;
        display: flex;
        gap: 4px;
        padding: 8px;
      }

      .theme-preview-color {
        flex: 1;
        border-radius: 4px;
      }

      .theme-name {
        font-weight: 600;
        font-size: 0.9rem;
        color: #ffffff;
      }

      /* ============================================================
   ðŸ“± RESPONSIVE DESIGN
   ============================================================ */

      /* ============================================================
   ðŸ“± RESPONSIVE DESIGN - MOBILE FIRST
   ============================================================ */

      /* Safe Area Support for iPhone X+ notch */
      @supports (padding: env(safe-area-inset-top)) {
        body {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }

        .chat-header {
          padding-top: max(0.75rem, env(safe-area-inset-top));
        }

        .input-container {
          padding-bottom: max(1rem, env(safe-area-inset-bottom));
        }

        .sidebar {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
        }
      }

      /* Touch-friendly scrolling for iOS */
      .messages-container,
      .sidebar {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
      }

      /* ðŸ“± Mobile: Uniform flat background - no gradient */
      @media (max-width: 768px) {
        body {
          background: var(--bg-0) !important;
        }
      }

      /* Tablet & Below (768px) */
      @media (max-width: 768px) {
        .sidebar {
          position: fixed;
          left: 0;
          top: 0;
          transform: translateX(-280px); /* Start hidden on mobile */
          height: 100vh;
          width: 280px;
          z-index: 1000;
          transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar.collapsed {
          transform: translateX(-100%);
        }

        /* Sidebar toggle remains hidden on mobile - use .mobile-logo-toggle instead */
        .sidebar-toggle {
          display: none !important;
        }

        .main-content {
          margin-left: 0;
          width: 100%;
        }

        .chat-container {
          padding: 0;
        }

        .chat-header {
          padding: 0.75rem 1rem;
          padding-left: 140px; /* Space for mobile logo container */
          flex-wrap: nowrap;
          gap: 0.5rem;
          justify-content: flex-end;
          background: transparent !important;
          border: none !important;
          position: relative;
          z-index: 100;
        }

        /* Uniform dark theme - transparent so body gradient shows through */
        .main-chat {
          background: transparent !important;
        }

        .header-left {
          display: none; /* Hide on mobile */
        }

        .header-actions {
          gap: 0.25rem;
          width: auto;
          justify-content: flex-end;
          background: transparent !important;
          flex-shrink: 0;
        }

        /* ðŸ“± MOBILE: Hide download/share from header - they're in sidebar menu */
        .header-btn-icon#downloadBtn,
        .header-btn-icon#shareBtn {
          display: none !important;
        }

        /* Compact recall status on mobile */
        /* Mobile: keep status compact */
        .recall-status-indicator {
          padding: 2px 6px !important;
        }

        .header-btn {
          width: 44px;
          height: 44px;
          padding: 0.5rem;
          min-width: 44px;
          background: transparent !important; /* No background */
          border: none !important; /* No border */
          -webkit-tap-highlight-color: transparent;
        }

        .header-btn:active {
          transform: scale(0.95);
        }

        .header-btn-icon {
          width: 44px;
          height: 44px;
          min-width: 44px;
          background: transparent !important;
          border: none !important;
          -webkit-tap-highlight-color: transparent;
        }

        .header-btn-icon:active {
          transform: scale(0.95);
        }

        .header-btn svg,
        .header-btn-icon svg {
          width: 20px;
          height: 20px;
          fill: #ffffff; /* White icons */
        }

        .logo {
          font-size: 1.5rem;
        }

        .messages-container {
          padding: 0.5rem;
          padding-top: 70px; /* Space for fixed header */
          padding-bottom: 220px; /* More space for input + suggestions */
          min-height: 100vh;
          min-height: 100dvh;
          max-height: none;
          overflow-y: auto;
          box-sizing: border-box;
        }

        .message {
          max-width: 100%;
          padding: 0.375rem 0.625rem;
          margin-bottom: 0 !important; /* No spacing */
        }

        .message-content {
          font-size: 0.875rem;
          line-height: 1.4;
        }

        .message-actions {
          gap: 0.25rem;
          margin-top: 0.25rem !important;
        }

        .action-btn {
          padding: 0.2rem;
          font-size: 0.6rem;
        }

        /* User message - NO gap below */
        .user-message {
          margin-bottom: 0 !important;
          padding-bottom: 0.125rem !important;
        }

        /* Assistant message - ZERO gap from user */
        .assistant-message {
          margin-top: 0.125rem !important;
          margin-bottom: 0.375rem !important;
          padding-top: 0.25rem !important;
        }

        /* Suggestion chips - ensure visibility */
        .suggestion-chips-container {
          margin-bottom: 1rem !important;
        }

        .input-wrapper {
          padding: 0.5rem;
          margin: 0;
          width: 100%;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .input-container {
          position: fixed !important;
          bottom: 0 !important;
          left: 0 !important;
          right: 0 !important;
          width: 100% !important;
          max-width: 100% !important;
          padding: 0.75rem;
          gap: 0.5rem;
          margin: 0;
          background: var(--bg-0);
          z-index: 9999 !important;
          box-sizing: border-box;
          padding-bottom: max(0.75rem, env(safe-area-inset-bottom));
          border-top: none !important;
        }

        /* Clean mobile input - no neon glow */
        .input-wrapper {
          border: 1px solid rgba(255, 255, 255, 0.12) !important;
          border-radius: 16px !important;
          background: rgba(255, 255, 255, 0.06) !important;
          box-shadow: none !important;
        }
        .input-wrapper:focus-within {
          border-color: rgba(100, 120, 200, 0.4) !important;
          box-shadow: 0 0 0 2px rgba(100, 120, 200, 0.15) !important;
        }

        /* Clean plus button - no neon glow */
        .mobile-plus-btn,
        #mobilePlusBtn,
        .neon-icon-btn {
          color: rgba(255, 255, 255, 0.8) !important;
          border: 1px solid rgba(255, 255, 255, 0.2) !important;
          background: transparent !important;
          border-radius: 10px !important;
          box-shadow: none !important;
        }

        .mobile-plus-btn svg,
        #mobilePlusBtn svg,
        .neon-icon-btn svg {
          fill: rgba(255, 255, 255, 0.8) !important;
          filter: none !important;
        }

        /* Clean send button - no neon glow */
        #sendBtn {
          color: rgba(255, 255, 255, 0.8) !important;
          border: 1px solid rgba(255, 255, 255, 0.2) !important;
          background: transparent !important;
          border-radius: 10px !important;
          box-shadow: none !important;
        }

        #sendBtn svg,
        #sendBtn path {
          fill: rgba(255, 255, 255, 0.8) !important;
          filter: none !important;
        }

        /* Input actions icons - clean */
        .input-actions button svg,
        .input-actions button path {
          fill: rgba(255, 255, 255, 0.7) !important;
          filter: none !important;
        }

        /* Mobile disclaimer styling */
        .desktop-stats-disclaimer {
          display: flex !important;
          justify-content: center;
          margin-top: 0.375rem;
          padding: 0 0.5rem;
        }

        .desktop-stats-row {
          padding: 0.25rem 0.75rem;
          font-size: 0.7rem;
          background: transparent;
          border: none;
        }

        /* Hide stats on mobile, only show disclaimer */
        .desktop-stat-item,
        .desktop-stat-divider {
          display: none !important;
        }

        .desktop-disclaimer {
          display: flex !important;
          font-size: 0.7rem;
          color: rgba(255, 255, 255, 0.4);
        }

        .desktop-disclaimer svg {
          width: 12px;
          height: 12px;
        }

        .chat-header {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          width: 100% !important;
          z-index: 10000 !important;
          background: var(--bg-0) !important;
        }

        /* Input area as flex column */
        .input-area {
          display: flex;
          flex-direction: column;
          gap: 0;
        }

        .input-row {
          order: 2;
        }

        #messageInput {
          font-size: 1rem;
          min-height: 44px;
          padding: 0.75rem 0.5rem !important;
          flex: 1;
          line-height: 1.5;
          border-radius: 12px;
          text-align: left;
        }

        #messageInput::placeholder {
          font-size: 0.95rem;
          opacity: 0.7;
          letter-spacing: 0.01em;
          text-align: left;
        }

        .input-actions {
          position: relative;
          left: auto;
          top: auto;
          transform: none;
          gap: 0.25rem;
          z-index: 10;
          flex-shrink: 0;
        }

        /* ðŸš« Hide non-functional neon icons on mobile */
        .neon-icons-container {
          display: none !important;
        }

        /* ðŸŽ¯ MOBILE PLUS BUTTON - Grey tone, no green glow */
        .mobile-plus-btn {
          display: flex !important;
          align-items: center;
          justify-content: center;
          width: 44px;
          height: 44px;
          background: rgba(255, 255, 255, 0.08);
          border: 1.5px solid rgba(255, 255, 255, 0.2);
          border-radius: 12px;
          cursor: pointer;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          box-shadow: none;
        }

        .mobile-plus-btn svg {
          width: 24px;
          height: 24px;
          fill: rgba(255, 255, 255, 0.8);
          transition: transform 0.3s ease;
        }

        .mobile-plus-btn.active svg {
          transform: rotate(45deg);
        }

        .mobile-plus-btn:active {
          transform: scale(0.95);
        }

        /* ðŸ“± MOBILE PLUS CONTAINER */
        .mobile-plus-container {
          position: relative;
          display: flex;
          align-items: center;
          flex-shrink: 0;
        }

        /* ðŸ“‹ MOBILE PLUS DROPDOWN */
        .mobile-plus-dropdown {
          position: absolute;
          bottom: calc(100% + 0.5rem);
          left: 0;
          background: rgba(32, 33, 36, 0.98);
          border: 1px solid rgba(255, 255, 255, 0.12);
          border-radius: 16px;
          padding: 0.5rem;
          display: none;
          flex-direction: column;
          gap: 0.25rem;
          min-width: 160px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          z-index: 1000;
          animation: slideUp 0.2s ease-out;
        }

        .mobile-plus-dropdown.show {
          display: flex;
        }

        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(8px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .plus-dropdown-item {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.75rem 1rem;
          background: transparent;
          border: none;
          border-radius: 12px;
          color: rgba(255, 255, 255, 0.9);
          font-size: 0.9rem;
          font-family: inherit;
          cursor: pointer;
          transition: all 0.2s ease;
          white-space: nowrap;
        }

        .plus-dropdown-item:hover,
        .plus-dropdown-item:active {
          background: rgba(255, 255, 255, 0.1);
        }

        .plus-dropdown-item.active-mode {
          background: rgba(110, 132, 255, 0.25);
          color: var(--accent-2, #6e84ff);
        }
        .plus-dropdown-item.active-mode svg {
          fill: var(--accent-2, #6e84ff);
        }

        .plus-dropdown-item svg {
          width: 20px;
          height: 20px;
          fill: #ffffff;
          flex-shrink: 0;
        }

        .plus-dropdown-item span {
          color: rgba(255, 255, 255, 0.9);
        }

        /* ðŸš« COMPLETELY HIDE NEON ICONS ON MOBILE - Not functional */
        .neon-icons-container,
        .neon-icons-container.show,
        .neon-icon {
          display: none !important;
          visibility: hidden !important;
          opacity: 0 !important;
          pointer-events: none !important;
          width: 0 !important;
          height: 0 !important;
          overflow: hidden !important;
        }

        .neon-icon:hover {
          background: rgba(255, 255, 255, 0.1);
          border-color: rgba(255, 255, 255, 0.2);
        }

        .neon-icon svg {
          width: 28px;
          height: 28px;
        }

        /* Active state on mobile - more visible */
        .neon-icon.active {
          background: rgba(255, 255, 255, 0.15);
          border-color: rgba(255, 255, 255, 0.8);
          box-shadow: 0 0 16px rgba(255, 255, 255, 0.25);
        }

        /* Token/char counter - Below input, no background */
        .input-stats {
          position: relative !important;
          display: flex !important;
          justify-content: center !important;
          gap: 1rem !important;
          margin-top: 0.5rem !important;
          padding: 0 !important;
          background: transparent !important;
          border: none !important;
          backdrop-filter: none !important;
          font-size: 0.75rem !important;
          order: 3 !important;
        }

        .input-stats span {
          color: rgba(255, 255, 255, 0.6) !important;
          opacity: 1 !important;
          white-space: nowrap !important;
          font-weight: 400 !important;
        }

        /* Mobilde sadece sayÄ±lar ve ikonlar - yazÄ±larÄ± gizle */
        .input-stats .count-label {
          display: none !important;
        }

        .input-stats svg {
          opacity: 0.8 !important;
        }

        /* ðŸŽ¤ Voice Chat Button - Mobile optimized */
        .voice-chat-btn {
          position: relative !important;
          right: auto !important;
          top: auto !important;
          transform: none !important;
          width: 44px !important;
          height: 44px !important;
          flex-shrink: 0;
          order: 2;
        }

        /* Hide mobile search button */
        .mobile-search-btn {
          display: none !important;
        }

        /* ðŸŽ›ï¸ MOBILE TOGGLE BUTTON - Hide old one */
        .mobile-toggle-btn {
          display: none !important;
        }

        /* ðŸ“± HAMBURGER MENU BUTTON - ChatGPT Style */
        .mobile-hamburger-btn {
          display: flex !important;
          align-items: center;
          justify-content: center;
          width: 36px !important;
          height: 36px !important;
          background: transparent !important;
          border: none !important;
          border-radius: 8px !important;
          padding: 0 !important;
          cursor: pointer;
          color: rgba(255, 255, 255, 0.85);
          transition:
            background 0.15s ease,
            color 0.15s ease;
          flex-shrink: 0;
          margin-right: 0.25rem;
        }

        .mobile-hamburger-btn:hover,
        .mobile-hamburger-btn:active {
          background: rgba(255, 255, 255, 0.1) !important;
          color: #ffffff;
        }

        .mobile-hamburger-btn svg {
          width: 20px;
          height: 20px;
        }

        /* ðŸ“± Mobile Logo Toggle - Show on mobile, aligned with header */
        .mobile-logo-toggle {
          display: flex !important;
          position: relative !important; /* Changed from fixed to relative */
          width: auto !important; /* Auto width for logo + text */
          height: 36px !important;
          background: transparent !important;
          border: none !important;
          padding: 0 !important;
          align-items: center;
          justify-content: flex-start;
          gap: 0.5rem; /* Space between logo and text */
        }

        .mobile-logo-toggle .logo-icon {
          width: 36px !important;
          height: 36px !important;
          flex-shrink: 0;
          color: #ffffff !important;
        }

        .mobile-logo-text {
          display: inline-block !important;
          font-size: 1.125rem !important;
          font-weight: 900 !important;
          color: #ffffff !important;
          white-space: nowrap;
          letter-spacing: -0.3px;
        }

        .mobile-logo-toggle {
          transition:
            opacity 0.2s ease,
            transform 0.15s ease;
        }

        .mobile-logo-toggle:active {
          opacity: 0.7;
          transform: scale(0.95);
        }

        /* ðŸ“± Mobile Logo Container - Flex wrapper */
        .mobile-logo-container {
          display: flex !important;
          position: fixed !important;
          top: 0.75rem !important;
          left: 1rem !important;
          z-index: 10001 !important; /* Above header */
          align-items: center;
          gap: 0.25rem;
        }

        /* ðŸ“± Mobile Dropdown Trigger - V icon button */
        .mobile-dropdown-trigger {
          display: flex !important;
          align-items: center;
          justify-content: center;
          width: 20px !important;
          height: 20px !important;
          background: transparent !important;
          border: none !important;
          padding: 0 !important;
          cursor: pointer;
          transition: transform 0.2s;
        }

        .mobile-dropdown-trigger:active {
          transform: scale(0.9);
        }

        .mobile-dropdown-trigger.open {
          transform: rotate(180deg);
        }

        /* ðŸ“± Mobile Dropdown Menu - Simple list, no shadow/border */
        .mobile-dropdown-menu {
          display: none;
          position: fixed;
          top: 2.75rem; /* Right below logo text */
          left: 4rem; /* Align with logo text, not icon */
          z-index: 10002 !important; /* Above logo container */
          background: rgba(26, 26, 26, 0.95);
          backdrop-filter: blur(10px);
          flex-direction: column;
          gap: 0.15rem;
          padding: 0.5rem;
          border-radius: 8px;
        }

        .mobile-dropdown-menu.show {
          display: flex !important;
        }

        /* ðŸ“± Mobile Dropdown Items - Minimal style */
        .mobile-dropdown-item {
          font-size: 0.875rem !important;
          font-weight: 400 !important;
          color: #ffffff !important;
          text-decoration: none !important;
          padding: 0.25rem 0 !important;
          background: transparent !important;
          border: none !important;
          white-space: nowrap;
          transition: opacity 0.2s;
        }

        .mobile-dropdown-item:hover {
          opacity: 0.7;
        }

        /* ðŸ“± MOBILE SIDEBAR OVERLAY - ChatGPT Style */
        .mobile-sidebar-overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.5);
          z-index: 10003;
          opacity: 0;
          transition: opacity 0.3s ease;
        }

        .mobile-sidebar-overlay.show {
          display: block;
          opacity: 1;
        }

        /* ðŸ“± MOBILE SIDEBAR MENU - ChatGPT Style (Slide from LEFT) */
        .mobile-sidebar {
          display: flex !important;
          position: fixed;
          top: 0;
          left: -265px; /* Hidden to left */
          width: 260px; /* ChatGPT mobile width */
          height: 100vh;
          height: 100dvh;
          background: var(--bg-0); /* Uniform with body */
          border-right: 1px solid rgba(255, 255, 255, 0.08);
          box-shadow: 2px 0 16px rgba(0, 0, 0, 0.4);
          transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          z-index: 10004;
          flex-direction: column;
          padding: 0;
          overflow: hidden;
        }

        .mobile-sidebar.open {
          left: 0;
        }

        /* ChatGPT Style Sidebar Header */
        .mobile-sidebar-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.875rem 1rem;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          background: var(--bg-0);
          min-height: 56px;
        }

        .mobile-sidebar-title {
          font-size: 1rem;
          font-weight: 600;
          color: #ffffff;
          letter-spacing: -0.01em;
        }

        .mobile-sidebar-logo {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .mobile-sidebar-logo .logo-icon {
          width: 30px;
          height: 30px;
          color: #ffffff;
        }

        .mobile-sidebar-logo-text {
          font-family:
            'Inter',
            'SF Pro Display',
            -apple-system,
            BlinkMacSystemFont,
            sans-serif;
          font-size: 1.15rem;
          font-weight: 900;
          letter-spacing: -0.5px;
          color: #ffffff;
        }

        .mobile-sidebar-close {
          width: 32px;
          height: 32px;
          display: flex !important;
          align-items: center;
          justify-content: center;
          background: transparent;
          border: 1px solid rgba(255, 255, 255, 0.9);
          border-radius: 6px;
          cursor: pointer;
          transition: opacity 0.15s ease;
        }

        .mobile-sidebar-close:hover,
        .mobile-sidebar-close:active {
          opacity: 0.7;
        }

        .mobile-sidebar-close svg {
          width: 16px;
          height: 16px;
          stroke: #ffffff;
          stroke-width: 2;
          fill: none;
        }

        /* New Chat Button - ChatGPT Style */
        .mobile-new-chat-btn {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          margin: 0.75rem;
          padding: 0.75rem 1rem;
          background: transparent;
          border: 1px solid rgba(255, 255, 255, 0.2);
          border-radius: 8px;
          color: #ffffff;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          transition: background 0.2s ease;
        }

        .mobile-new-chat-btn:hover,
        .mobile-new-chat-btn:active {
          background: rgba(255, 255, 255, 0.08);
        }

        .mobile-new-chat-btn svg {
          width: 18px;
          height: 18px;
          stroke: currentColor;
          fill: none;
        }

        /* Chat History List - ChatGPT Style */
        .mobile-chat-search {
          display: flex;
          align-items: center;
          gap: 8px;
          margin: 0 0.75rem;
          padding: 8px 12px;
          background: rgba(255, 255, 255, 0.06);
          border: 1px solid rgba(255, 255, 255, 0.08);
          border-radius: 10px;
        }

        .mobile-search-icon {
          opacity: 0.4;
          flex-shrink: 0;
        }

        .mobile-chat-search input {
          flex: 1;
          background: none;
          border: none;
          outline: none;
          color: #ffffff;
          font-size: 0.85rem;
          font-family: 'Inter', sans-serif;
        }

        .mobile-chat-search input::placeholder {
          color: rgba(255, 255, 255, 0.35);
        }

        [data-theme='light'] .mobile-chat-search {
          background: rgba(0, 0, 0, 0.04) !important;
          border-color: rgba(0, 0, 0, 0.08) !important;
        }

        [data-theme='light'] .mobile-chat-search input {
          color: #0a0b0d !important;
        }

        [data-theme='light'] .mobile-chat-search input::placeholder {
          color: rgba(0, 0, 0, 0.35) !important;
        }

        .mobile-chat-history {
          flex: 1;
          overflow-y: auto;
          padding: 0.5rem;
        }

        .mobile-chat-history::-webkit-scrollbar {
          width: 4px;
        }

        .mobile-chat-history::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 2px;
        }

        .mobile-chat-item {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.625rem 0.75rem;
          border-radius: 8px;
          color: rgba(255, 255, 255, 0.8);
          font-size: 0.875rem;
          cursor: pointer;
          transition: background 0.15s ease;
          text-overflow: ellipsis;
          white-space: nowrap;
          overflow: hidden;
        }

        .mobile-chat-item:hover,
        .mobile-chat-item:active {
          background: rgba(255, 255, 255, 0.08);
        }

        .mobile-chat-item.active {
          background: rgba(255, 255, 255, 0.1);
        }

        .mobile-chat-item svg {
          width: 16px;
          height: 16px;
          flex-shrink: 0;
          opacity: 0.7;
        }

        .mobile-chat-item-title {
          flex: 1;
          min-width: 0;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .mobile-chat-item-delete {
          background: none;
          border: none;
          padding: 6px;
          color: rgba(255, 255, 255, 0.3);
          cursor: pointer;
          border-radius: 6px;
          flex-shrink: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.15s ease;
          -webkit-tap-highlight-color: transparent;
        }

        .mobile-chat-item-delete:active {
          color: #ef4444;
          background: rgba(239, 68, 68, 0.15);
        }

        .mobile-chat-item-delete svg {
          opacity: 1 !important;
        }

        [data-theme='light'] .mobile-chat-item-delete {
          color: rgba(0, 0, 0, 0.25) !important;
        }

        [data-theme='light'] .mobile-chat-item-delete:active {
          color: #ef4444 !important;
          background: rgba(239, 68, 68, 0.1) !important;
        }

        /* Sidebar Footer - ChatGPT Style */
        .mobile-sidebar-footer {
          padding: 0.75rem;
          border-top: 1px solid rgba(255, 255, 255, 0.08);
          background: #171717;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .mobile-sidebar-user {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.625rem 0.75rem;
          border-radius: 8px;
          color: rgba(255, 255, 255, 0.9);
          cursor: pointer;
          transition: background 0.15s ease;
        }

        .mobile-sidebar-user:hover {
          background: rgba(255, 255, 255, 0.08);
        }

        .mobile-sidebar-user-avatar {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(200, 200, 200, 0.7));
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.875rem;
          font-weight: 600;
          color: #fff;
        }

        .mobile-sidebar-user-name {
          font-size: 0.875rem;
          font-weight: 500;
        }

        .mobile-menu-item {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.625rem 0.75rem;
          background: transparent;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.15s ease;
          color: rgba(255, 255, 255, 0.9);
          font-size: 0.875rem;
        }

        .mobile-menu-item:hover,
        .mobile-menu-item:active {
          background: rgba(255, 255, 255, 0.08);
        }

        .mobile-menu-item:active {
          transform: scale(0.98);
        }

        .mobile-menu-item svg {
          width: 18px;
          height: 18px;
          fill: rgba(255, 255, 255, 0.7);
        }

        /* Hide header actions when sidebar is open */
        .header-actions.hide-on-sidebar-open {
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.3s ease;
        }

        .input-action-btn,
        #sendBtn {
          min-width: 40px;
          min-height: 40px;
          width: 40px;
          height: 40px;
          padding: 0.5rem;
          position: relative;
          right: auto;
          top: auto;
          transform: none;
          flex-shrink: 0;
        }

        .plus-dropdown {
          min-width: 200px;
          left: 0;
          right: auto;
        }

        .plus-dropdown-item {
          padding: 0.75rem 1rem;
          font-size: 0.9rem;
        }

        .empty-state {
          padding-top: 1rem;
          gap: 1rem;
          padding-left: 1rem;
          padding-right: 1rem;
        }

        .mini-spinner-container {
          width: 80px;
          height: 80px;
        }

        .chat-item {
          padding: 0.875rem;
          margin-bottom: 0.5rem;
        }

        .chat-item-title {
          font-size: 0.9rem;
        }

        .chat-item-preview {
          font-size: 0.75rem;
        }

        .new-chat-btn {
          padding: 0.875rem;
          font-size: 0.9rem;
        }

        .sidebar-footer {
          padding: 0.875rem;
        }

        .user-menu {
          padding: 0.75rem;
        }

        .user-name {
          font-size: 0.9rem;
        }

        .user-email {
          font-size: 0.75rem;
        }

        .user-dropdown {
          bottom: 100%;
          top: auto;
          margin-bottom: 0.5rem;
        }

        .input-stats {
          padding: 0.5rem 1rem;
          font-size: 0.75rem;
          flex-wrap: wrap;
        }
      }

      /* Mobile Small (480px) */
      @media (max-width: 480px) {
        .sidebar {
          width: 85vw;
          max-width: 280px;
        }

        .logo {
          font-size: 1.25rem;
        }

        .chat-header {
          padding: 0.5rem 0.75rem;
          padding-left: 120px; /* Smaller space for mobile logo on small screens */
        }

        .header-btn {
          width: 40px;
          height: 40px;
          padding: 0.4rem;
        }

        /* Even more compact header on small screens */
        .header-actions {
          gap: 0.125rem;
        }

        /* Visitor badge compact on small screens */
        .visitor-city-badge {
          padding: 4px 8px !important;
          font-size: 10px !important;
          min-height: 36px !important;
        }

        .visitor-city-text {
          max-width: 50px !important;
        }

        .visitor-device-icon {
          display: none !important;
        }

        .messages-container {
          padding: 0.5rem;
          padding-top: 65px !important; /* Keep space for fixed header */
          padding-bottom: 130px !important; /* Keep space for fixed input */
        }

        .message {
          padding: 0.875rem;
          border-radius: 12px;
          max-width: 95%; /* Wider on mobile */
        }

        .message.assistant {
          max-width: 100%; /* Full width for AI on mobile */
        }

        .message-content {
          font-size: 0.9rem;
        }

        .input-wrapper {
          padding: 0.5rem 0.75rem;
        }

        .input-container {
          padding: 0.5rem !important;
          position: fixed !important;
          bottom: 0 !important;
          left: 0 !important;
          right: 0 !important;
          width: 100% !important;
        }

        #messageInput {
          font-size: 16px;
          padding: 0.625rem 0.875rem;
        }

        .input-action-btn,
        #sendBtn {
          min-width: 36px;
          min-height: 36px;
          padding: 0.4rem;
        }

        .plus-dropdown {
          min-width: 180px;
        }

        .plus-dropdown-item {
          padding: 0.625rem 0.875rem;
          font-size: 0.85rem;
        }

        .mini-spinner-container {
          width: 70px;
          height: 70px;
        }

        .empty-state {
          padding-top: 0.75rem;
          gap: 0.75rem;
        }

        .chat-item {
          padding: 0.75rem;
        }

        .new-chat-btn {
          padding: 0.75rem;
          font-size: 0.85rem;
        }

        .sidebar-footer {
          padding: 0.75rem;
        }

        .input-stats {
          font-size: 0.7rem;
          gap: 0.75rem;
        }
      }

      /* Landscape Mobile */
      @media (max-width: 768px) and (orientation: landscape) {
        .messages-container {
          max-height: calc(100vh - 160px);
        }

        .sidebar {
          width: 260px;
        }
      }

      /* Tablet Portrait (769px - 1024px) */
      @media (min-width: 769px) and (max-width: 1024px) {
        .sidebar {
          width: 280px;
        }

        .main-content {
          margin-left: 280px;
        }

        .messages-container {
          padding: 1.5rem;
        }

        .message {
          max-width: 90%;
        }

        .input-container {
          max-width: 900px;
        }
      }

      /* ============================================================
         DESKTOP CENTERED LAYOUT - ChatGPT Style
         Only affects desktop (min-width: 769px)
         Mobile layout remains unchanged
         ============================================================ */
      @media (min-width: 769px) {
        /* Hide sidebar on desktop */
        body.desktop-centered .sidebar {
          display: none !important;
        }

        /* Chat container takes full width when sidebar hidden */
        body.desktop-centered .chat-container {
          margin-left: 0 !important;
          width: 100% !important;
        }

        /* Desktop logo container - always visible top-left */
        .desktop-logo-container {
          position: fixed;
          top: 1.25rem;
          left: 1.5rem;
          display: flex;
          align-items: center;
          gap: 0.75rem;
          z-index: 1001;
          cursor: pointer;
        }

        .desktop-logo-container .logo-icon {
          width: 44px;
          height: 44px;
        }

        .desktop-logo-container .logo-text {
          font-family: 'Inter', sans-serif;
          font-weight: 900;
          font-size: 1.6rem;
          color: #ffffff;
          letter-spacing: -0.3px;
        }

        .desktop-logo-container:hover {
          opacity: 0.8;
        }

        .desktop-logo-container:active {
          opacity: 0.65;
          transform: scale(0.97);
        }

        .desktop-logo-container {
          transition:
            opacity 0.2s ease,
            transform 0.15s ease;
        }

        /* Adjust header for no sidebar */
        body.desktop-centered .chat-header {
          left: 0 !important;
          width: 100% !important;
          max-width: 100%;
          background: var(--bg-0);
          backdrop-filter: blur(12px) saturate(180%);
          -webkit-backdrop-filter: blur(12px) saturate(180%);
          justify-content: flex-end;
          padding-right: 1.5rem;
        }

        /* Initial State - Input centered in middle */
        body.desktop-centered.chat-initial .chat-header {
          opacity: 0.7;
        }

        body.desktop-centered.chat-initial .messages-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: calc(100vh - 200px);
          padding-top: 0;
          padding-bottom: 250px;
        }

        body.desktop-centered.chat-initial .empty-state {
          display: flex !important;
          flex-direction: column;
          align-items: center;
          justify-content: flex-end;
          position: fixed;
          top: 0;
          left: 50%;
          transform: translateX(-50%);
          max-width: 760px;
          width: 100%;
          height: 50%;
          padding: 2rem 2rem 0;
          pointer-events: none;
          z-index: 10;
          animation: none;
        }

        body.desktop-centered.chat-initial .user-welcome-text {
          position: static;
          transform: none;
          margin-bottom: 1rem;
          pointer-events: auto;
        }

        body.desktop-centered.chat-initial .welcome-message {
          font-size: 2rem;
          font-weight: 500;
        }

        body.desktop-centered.chat-initial .mini-spinner-container {
          display: none;
        }

        body.desktop-centered.chat-initial .input-container {
          position: fixed;
          top: 50%;
          bottom: auto !important;
          left: 50% !important;
          transform: translate(-50%, 0);
          width: 100% !important;
          max-width: 760px;
          padding: 0 1.5rem;
          background: transparent !important;
          border: none !important;
          box-shadow: none !important;
          z-index: 100;
          transition: none;
        }
        body.desktop-centered.chat-initial.transitions-ready .input-container {
          transition:
            top 0.4s cubic-bezier(0.4, 0, 0.2, 1),
            transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
            opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.desktop-centered.chat-initial .input-area {
          /* Keep original styling - no extra background */
        }

        body.desktop-centered.chat-initial .mode-selector-container,
        body.desktop-centered.chat-initial .input-footer {
          max-width: 760px;
          margin: 0 auto;
        }

        /* Active State - Input at bottom, messages visible */
        body.desktop-centered.chat-active .messages-container {
          display: flex;
          padding-top: 100px;
          padding-bottom: 180px;
          max-width: 900px;
          margin: 0 auto;
        }

        body.desktop-centered.chat-active .empty-state {
          display: none !important;
        }

        body.desktop-centered.chat-active .chat-header {
          opacity: 1;
        }

        body.desktop-centered.chat-active .input-container {
          position: fixed;
          bottom: 42px !important; /* Above the global footer */
          top: auto !important;
          left: 50% !important;
          transform: translateX(-50%);
          width: 100% !important;
          max-width: 900px;
          padding: 1rem 1.5rem 0.75rem;
          background: transparent !important;
          border: none !important;
          transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
          z-index: 1001;
        }

        body.desktop-centered.chat-active .input-area {
          /* Keep original styling */
        }

        body.desktop-centered.chat-active .message {
          max-width: 100%;
        }
      }

      /* Hide desktop logo on mobile */
      @media (max-width: 768px) {
        .desktop-logo-container {
          display: none !important;
        }
      }

      /* Desktop New Chat Button */
      .desktop-new-chat-btn {
        display: none;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        color: #ffffff;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .desktop-new-chat-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.25);
      }

      .desktop-new-chat-btn svg {
        opacity: 0.9;
      }

      /* Only show desktop new chat button when in desktop active mode */
      @media (min-width: 769px) {
        body.desktop-centered.chat-active .desktop-new-chat-btn {
          display: flex;
        }
      }

      /* Hide on mobile */
      @media (max-width: 768px) {
        .desktop-new-chat-btn {
          display: none !important;
        }
      }

      /* ============================================================
         Desktop Chat History Drawer
         ============================================================ */
      .desktop-history-drawer {
        position: fixed;
        top: 0;
        left: 0;
        width: 320px;
        height: 100vh;
        background: linear-gradient(180deg, #111214 0%, #0a0b0d 100%);
        border-right: 1px solid rgba(255, 255, 255, 0.08);
        z-index: 2000;
        transform: translateX(-100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        box-shadow: 4px 0 32px rgba(0, 0, 0, 0.5);
      }

      .desktop-history-drawer.open {
        transform: translateX(0);
      }

      .desktop-history-drawer-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .desktop-history-drawer-backdrop.open {
        opacity: 1;
        pointer-events: auto;
      }

      .desktop-history-header {
        padding: 1.25rem 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }

      .desktop-history-header h3 {
        font-size: 1rem;
        font-weight: 600;
        color: #ffffff;
        margin: 0;
      }

      .desktop-drawer-logo {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .desktop-drawer-logo .logo-icon {
        width: 32px;
        height: 32px;
        color: #ffffff;
      }

      .desktop-drawer-logo .logo-text {
        font-family:
          'Inter',
          'SF Pro Display',
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        font-size: 1.15rem;
        font-weight: 900;
        letter-spacing: -0.5px;
        color: #ffffff;
      }

      .desktop-history-close {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        cursor: pointer;
        padding: 4px;
        border-radius: 6px;
        transition: all 0.2s;
      }

      .desktop-history-close:hover {
        color: #ffffff;
        background: rgba(255, 255, 255, 0.1);
      }

      .desktop-history-close svg {
        width: 20px;
        height: 20px;
      }

      .desktop-history-search {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      }

      .desktop-history-search input {
        width: 100%;
        padding: 0.6rem 0.75rem;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 8px;
        color: #ffffff;
        font-size: 0.85rem;
        font-family: inherit;
        outline: none;
        transition: border-color 0.2s;
        box-sizing: border-box;
      }

      .desktop-history-search input::placeholder {
        color: rgba(255, 255, 255, 0.35);
      }

      .desktop-history-search input:focus {
        border-color: rgba(255, 255, 255, 0.2);
      }

      .desktop-history-list {
        flex: 1;
        overflow-y: auto;
        padding: 0.5rem;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.15) transparent;
      }

      .desktop-history-list::-webkit-scrollbar {
        width: 4px;
      }

      .desktop-history-list::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 4px;
      }

      .desktop-history-item {
        padding: 0.75rem;
        margin-bottom: 2px;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.15s;
      }

      .desktop-history-item:hover {
        background: rgba(255, 255, 255, 0.06);
      }

      .desktop-history-item.active {
        background: rgba(255, 255, 255, 0.08);
      }

      .desktop-history-item-title {
        font-size: 0.85rem;
        font-weight: 500;
        color: #ffffff;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 2px;
      }

      .desktop-history-item-time {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.35);
      }

      .desktop-history-item-delete {
        opacity: 0;
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.4);
        cursor: pointer;
        padding: 2px;
        border-radius: 4px;
        transition: all 0.15s;
      }

      .desktop-history-item:hover .desktop-history-item-delete {
        opacity: 1;
      }

      .desktop-history-item-delete:hover {
        color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
      }

      .desktop-history-empty {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem 1rem;
        text-align: center;
      }

      .desktop-history-empty svg {
        width: 48px;
        height: 48px;
        margin-bottom: 1rem;
        opacity: 0.3;
        stroke: rgba(255, 255, 255, 0.3);
      }

      .desktop-history-empty p {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.4);
      }

      .desktop-history-new-chat {
        margin: 0.5rem;
        padding: 0.7rem;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: #ffffff;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.2s;
        font-family: inherit;
      }

      .desktop-history-new-chat:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.2);
      }

      /* Light theme overrides for drawer */
      [data-theme='light'] .desktop-history-drawer {
        background: linear-gradient(180deg, #f5f5f7 0%, #ffffff 100%);
        border-right-color: rgba(0, 0, 0, 0.08);
      }

      [data-theme='light'] .desktop-history-header {
        border-bottom-color: rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .desktop-history-header h3 {
        color: #0a0b0d;
      }

      [data-theme='light'] .desktop-drawer-logo .logo-icon {
        color: #0a0b0d;
      }

      [data-theme='light'] .desktop-drawer-logo .logo-text {
        color: #0a0b0d;
      }

      [data-theme='light'] .desktop-history-close {
        color: rgba(0, 0, 0, 0.5);
      }

      [data-theme='light'] .desktop-history-close:hover {
        color: #0a0b0d;
        background: rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .desktop-history-search input {
        background: rgba(0, 0, 0, 0.04);
        border-color: rgba(0, 0, 0, 0.08);
        color: #0a0b0d;
      }

      [data-theme='light'] .desktop-history-search input::placeholder {
        color: rgba(0, 0, 0, 0.35);
      }

      [data-theme='light'] .desktop-history-item:hover {
        background: rgba(0, 0, 0, 0.04);
      }

      [data-theme='light'] .desktop-history-item.active {
        background: rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .desktop-history-item-title {
        color: #0a0b0d;
      }

      [data-theme='light'] .desktop-history-item-time {
        color: rgba(0, 0, 0, 0.4);
      }

      [data-theme='light'] .desktop-history-new-chat {
        background: rgba(0, 0, 0, 0.04);
        border-color: rgba(0, 0, 0, 0.08);
        color: #0a0b0d;
      }

      [data-theme='light'] .desktop-history-empty svg {
        stroke: rgba(0, 0, 0, 0.3);
      }

      [data-theme='light'] .desktop-history-empty p {
        color: rgba(0, 0, 0, 0.4);
      }

      /* Only show on desktop */
      @media (max-width: 768px) {
        .desktop-history-drawer,
        .desktop-history-drawer-backdrop,
        .desktop-history-toggle {
          display: none !important;
        }
      }

      /* ============================================================
         â“ HELP DROPDOWN - Desktop Only
         ============================================================ */
      .help-dropdown-container {
        position: relative;
        display: none;
      }

      @media (min-width: 769px) {
        .help-dropdown-container {
          display: block;
        }
      }

      .help-trigger {
        position: relative;
      }

      .help-dropdown-menu {
        position: absolute;
        top: calc(100% + 8px);
        right: 0;
        min-width: 240px;
        background: linear-gradient(145deg, #1a1a1a, #141414);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        box-shadow:
          0 10px 40px rgba(0, 0, 0, 0.5),
          0 0 0 1px rgba(255, 255, 255, 0.05) inset;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px) scale(0.95);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1002;
        overflow: hidden;
      }

      .help-dropdown-container.active .help-dropdown-menu {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
      }

      .help-dropdown-header {
        padding: 12px 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(139, 92, 246, 0.1);
      }

      .help-dropdown-title {
        font-size: 0.75rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.5);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .help-dropdown-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        color: #ffffff;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.15s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      }

      .help-dropdown-item:last-child {
        border-bottom: none;
      }

      .help-dropdown-item:hover {
        background: rgba(139, 92, 246, 0.15);
      }

      .help-dropdown-item svg {
        opacity: 0.7;
        flex-shrink: 0;
      }

      .help-dropdown-item span:first-of-type {
        flex: 1;
      }

      .help-dropdown-url {
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.35);
        font-family: 'JetBrains Mono', 'SF Mono', monospace;
      }

      /* Light theme for help dropdown */
      [data-theme='light'] .help-dropdown-menu {
        background: linear-gradient(145deg, #ffffff, #f5f5f5);
        border-color: rgba(0, 0, 0, 0.1);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      }

      [data-theme='light'] .help-dropdown-header {
        background: rgba(139, 92, 246, 0.08);
        border-bottom-color: rgba(0, 0, 0, 0.06);
      }

      [data-theme='light'] .help-dropdown-item {
        color: #0a0b0d;
        border-bottom-color: rgba(0, 0, 0, 0.04);
      }

      [data-theme='light'] .help-dropdown-item:hover {
        background: rgba(139, 92, 246, 0.1);
      }

      [data-theme='light'] .help-dropdown-url {
        color: rgba(0, 0, 0, 0.4);
      }

      /* ============================================================
         ðŸ”‘ MOBILE LOGIN TRIGGER
         ============================================================ */
      .mobile-login-trigger {
        display: none;
      }

      @media (max-width: 768px) {
        .mobile-login-trigger {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          background: none;
          border: none;
          color: rgba(255, 255, 255, 0.7);
          cursor: pointer;
          border-radius: 8px;
          padding: 0;
          transition: all 0.2s ease;
          -webkit-tap-highlight-color: transparent;
        }

        .mobile-login-trigger:active {
          background: rgba(255, 255, 255, 0.1);
          color: #ffffff;
        }
      }

      /* Light theme */
      [data-theme='light'] .mobile-login-trigger {
        color: rgba(0, 0, 0, 0.5) !important;
      }

      [data-theme='light'] .mobile-login-trigger:active {
        background: rgba(0, 0, 0, 0.06) !important;
        color: #0a0b0d !important;
      }

      /* ============================================================
         â“ MOBILE HELP TRIGGER + BOTTOM SHEET
         ============================================================ */
      .mobile-help-trigger {
        display: none;
      }

      @media (max-width: 768px) {
        .mobile-help-trigger {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          background: none;
          border: none;
          color: rgba(255, 255, 255, 0.7);
          cursor: pointer;
          border-radius: 8px;
          padding: 0;
          transition: all 0.2s ease;
          -webkit-tap-highlight-color: transparent;
        }

        .mobile-help-trigger:active {
          background: rgba(255, 255, 255, 0.1);
          color: #ffffff;
        }
      }

      /* Light theme trigger */
      [data-theme='light'] .mobile-help-trigger {
        color: rgba(0, 0, 0, 0.5) !important;
      }

      [data-theme='light'] .mobile-help-trigger:active {
        background: rgba(0, 0, 0, 0.06) !important;
        color: #0a0b0d !important;
      }

      /* Bottom Sheet Overlay */
      .mobile-help-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 10010;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        -webkit-backdrop-filter: blur(4px);
        backdrop-filter: blur(4px);
      }

      .mobile-help-overlay.open {
        opacity: 1;
        visibility: visible;
      }

      /* Bottom Sheet */
      .mobile-help-sheet {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 10011;
        background: linear-gradient(145deg, #1a1a1a, #141414);
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
        transform: translateY(100%);
        transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        max-height: 60vh;
        overflow-y: auto;
        padding-bottom: env(safe-area-inset-bottom, 0px);
        box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.4);
      }

      .mobile-help-sheet.open {
        transform: translateY(0);
      }

      /* Handle bar */
      .mobile-help-handle {
        width: 36px;
        height: 4px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 9999px;
        margin: 12px auto 0;
      }

      /* Header */
      .mobile-help-header {
        padding: 16px 20px 12px;
      }

      .mobile-help-title {
        font-size: 0.75rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.45);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-family: 'Inter', sans-serif;
      }

      /* Menu items */
      .mobile-help-item {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 20px;
        color: #ffffff;
        text-decoration: none;
        transition: background 0.15s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        -webkit-tap-highlight-color: transparent;
      }

      .mobile-help-item:last-child {
        border-bottom: none;
        margin-bottom: 8px;
      }

      .mobile-help-item:active {
        background: rgba(139, 92, 246, 0.15);
      }

      .mobile-help-item > svg:first-child {
        opacity: 0.7;
        flex-shrink: 0;
      }

      .mobile-help-item-text {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .mobile-help-item-label {
        font-size: 0.95rem;
        font-weight: 500;
        font-family: 'Inter', sans-serif;
      }

      .mobile-help-item-url {
        display: none;
      }

      .mobile-help-arrow {
        opacity: 0.3;
        flex-shrink: 0;
      }

      /* Light theme bottom sheet */
      [data-theme='light'] .mobile-help-sheet {
        background: linear-gradient(145deg, #ffffff, #f5f5f5) !important;
        box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.15) !important;
      }

      [data-theme='light'] .mobile-help-handle {
        background: rgba(0, 0, 0, 0.15) !important;
      }

      [data-theme='light'] .mobile-help-title {
        color: rgba(0, 0, 0, 0.45) !important;
      }

      [data-theme='light'] .mobile-help-item {
        color: #0a0b0d !important;
        border-bottom-color: rgba(0, 0, 0, 0.04) !important;
      }

      [data-theme='light'] .mobile-help-item:active {
        background: rgba(139, 92, 246, 0.1) !important;
      }

      [data-theme='light'] .mobile-help-item-url {
        color: rgba(0, 0, 0, 0.4) !important;
      }

      /* System theme bottom sheet */
      @media (prefers-color-scheme: light) {
        [data-theme='system'] .mobile-help-sheet {
          background: linear-gradient(145deg, #ffffff, #f5f5f5) !important;
          box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.15) !important;
        }

        [data-theme='system'] .mobile-help-handle {
          background: rgba(0, 0, 0, 0.15) !important;
        }

        [data-theme='system'] .mobile-help-title {
          color: rgba(0, 0, 0, 0.45) !important;
        }

        [data-theme='system'] .mobile-help-item {
          color: #0a0b0d !important;
          border-bottom-color: rgba(0, 0, 0, 0.04) !important;
        }

        [data-theme='system'] .mobile-help-item:active {
          background: rgba(139, 92, 246, 0.1) !important;
        }

        [data-theme='system'] .mobile-help-item-url {
          color: rgba(0, 0, 0, 0.4) !important;
        }

        [data-theme='system'] .mobile-help-trigger {
          color: rgba(0, 0, 0, 0.5) !important;
        }

        [data-theme='system'] .mobile-help-trigger:active {
          background: rgba(0, 0, 0, 0.06) !important;
          color: #0a0b0d !important;
        }

        [data-theme='system'] .mobile-login-trigger {
          color: rgba(0, 0, 0, 0.5) !important;
        }

        [data-theme='system'] .mobile-login-trigger:active {
          background: rgba(0, 0, 0, 0.06) !important;
          color: #0a0b0d !important;
        }
      }

      /* ============================================================
         ðŸ‘¤ HEADER USER AUTH - Desktop Only
         ============================================================ */
      .header-user-auth {
        display: none;
        position: relative;
      }

      @media (min-width: 769px) {
        .header-user-auth {
          display: block;
        }
      }

      .header-login-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1.25rem;
        background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 50%, #ffffff 100%);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        color: #0a0b0d;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow:
          0 0 15px rgba(255, 255, 255, 0.4),
          0 0 30px rgba(255, 255, 255, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.8);
        text-shadow: none;
      }

      .header-login-btn:hover {
        background: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
        transform: translateY(-2px);
        box-shadow:
          0 0 20px rgba(255, 255, 255, 0.6),
          0 0 40px rgba(255, 255, 255, 0.3),
          0 0 60px rgba(255, 255, 255, 0.15),
          inset 0 1px 0 rgba(255, 255, 255, 1);
      }

      .header-login-btn svg {
        fill: #0a0b0d;
      }

      .header-user-menu {
        position: relative;
      }

      .header-user-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.35rem 0.75rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        color: #ffffff;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .header-user-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.15);
      }

      .header-user-avatar {
        width: 28px;
        height: 28px;
        background: linear-gradient(135deg, #8b5cf6, #6366f1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: 600;
        color: #ffffff;
      }

      .header-user-name {
        max-width: 100px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .header-user-dropdown {
        position: absolute;
        top: calc(100% + 8px);
        right: 0;
        min-width: 200px;
        background: linear-gradient(145deg, #1a1a1a, #141414);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px) scale(0.95);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1002;
        overflow: hidden;
      }

      .header-user-menu.active .header-user-dropdown {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
      }

      .header-user-dropdown-item {
        display: flex;
        align-items: center;
        gap: 12px;
        width: 100%;
        padding: 12px 16px;
        background: transparent;
        border: none;
        color: #ffffff;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.15s ease;
        text-align: left;
      }

      .header-user-dropdown-item:hover {
        background: rgba(139, 92, 246, 0.15);
      }

      .header-user-dropdown-item.danger {
        color: #ef4444;
      }

      .header-user-dropdown-item.danger:hover {
        background: rgba(239, 68, 68, 0.15);
      }

      .header-user-dropdown-divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.08);
        margin: 4px 0;
      }

      /* Light theme */
      [data-theme='light'] .header-user-btn {
        background: rgba(0, 0, 0, 0.05);
        border-color: rgba(0, 0, 0, 0.1);
        color: #0a0b0d;
      }

      [data-theme='light'] .header-user-btn:hover {
        background: rgba(0, 0, 0, 0.08);
      }

      [data-theme='light'] .header-user-dropdown {
        background: #ffffff;
        border-color: rgba(0, 0, 0, 0.1);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      }

      [data-theme='light'] .header-user-dropdown-item {
        color: #0a0b0d;
      }

      [data-theme='light'] .header-user-dropdown-divider {
        background: rgba(0, 0, 0, 0.08);
      }

      /* ============================================================
         ðŸ“Š GLOBAL FIXED FOOTER - Always at bottom
         ============================================================ */
      .global-footer-disclaimer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        padding: 0.6rem 1rem;
        background: linear-gradient(
          to top,
          rgba(10, 11, 13, 1) 0%,
          rgba(10, 11, 13, 0.98) 60%,
          rgba(10, 11, 13, 0.9) 100%
        );
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        display: none; /* Hidden on mobile by default */
      }

      @media (min-width: 769px) {
        .global-footer-disclaimer {
          display: block;
        }
      }

      .global-footer-content {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.5);
      }

      .footer-stat-item {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-family: 'JetBrains Mono', 'SF Mono', monospace;
      }

      .footer-stat-item svg {
        opacity: 0.6;
      }

      .footer-stat-item.token-highlight {
        color: rgba(255, 255, 255, 0.7);
        font-weight: 500;
      }

      .footer-divider {
        color: rgba(255, 255, 255, 0.2);
      }

      .footer-disclaimer-text {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        color: rgba(255, 255, 255, 0.4);
      }

      .footer-disclaimer-text svg {
        opacity: 0.5;
      }

      /* Light theme for global footer */
      [data-theme='light'] .global-footer-disclaimer {
        background: linear-gradient(
          to top,
          rgba(245, 245, 245, 1) 0%,
          rgba(245, 245, 245, 0.98) 60%,
          rgba(245, 245, 245, 0.9) 100%
        );
        border-top-color: rgba(0, 0, 0, 0.05);
      }

      [data-theme='light'] .global-footer-content {
        color: rgba(0, 0, 0, 0.5);
      }

      [data-theme='light'] .footer-stat-item.token-highlight {
        color: rgba(0, 0, 0, 0.7);
      }

      [data-theme='light'] .footer-divider {
        color: rgba(0, 0, 0, 0.2);
      }

      [data-theme='light'] .footer-disclaimer-text {
        color: rgba(0, 0, 0, 0.4);
      }

      /* ============================================================
   ðŸŽ¯ UTILITY CLASSES
   ============================================================ */

      .hidden {
        display: none !important;
      }

      .fade-in {
        animation: fadeInScale 0.5s ease;
      }

      .slide-in-up {
        animation: slideInUp 0.5s ease;
      }

      .slide-in-left {
        animation: slideInLeft 0.5s ease;
      }

      .slide-in-right {
        animation: slideInRight 0.5s ease;
      }

      /* ============================================================
   ðŸŒŸ SPECIAL EFFECTS
   ============================================================ */

      /* Clean Gradient Text */
      .gradient-text {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 0.7) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Border Shine Animation */
      @keyframes borderPulse {
        0%,
        100% {
          border-color: rgba(255, 255, 255, 0.4);
        }
        50% {
          border-color: #ff6b4a;
        }
      }

      .border-animated {
        animation: borderPulse 3s ease-in-out infinite;
      }

      /* ============================================================
   ðŸ’¡ SUGGESTION CHIPS - ChatGPT Kompakt Stil
   ============================================================ */

      .suggestion-chips-container {
        display: flex;
        flex-direction: column;
        gap: 0.375rem;
        margin-top: 0.75rem;
        padding: 0;
        animation: fadeInUp 0.3s ease-out;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .suggestion-chip {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 0.875rem;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 18px;
        color: rgba(255, 255, 255, 0.75);
        font-size: 0.8125rem;
        font-weight: 400;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: left;
        width: fit-content;
        line-height: 1.3;
      }

      .suggestion-chip:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.25);
        color: #ffffff;
      }

      .suggestion-chip:active {
        transform: scale(0.98);
      }

      /* Mobile'da suggestion chips */
      @media (max-width: 768px) {
        .suggestion-chips-container {
          gap: 0.25rem;
          margin-top: 0.5rem;
        }

        .suggestion-chip {
          padding: 0.4rem 0.75rem;
          font-size: 0.75rem;
          border-radius: 16px;
        }
      }

      /* Suggestion chips header */
      .suggestions-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.75rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .suggestions-header svg {
        width: 14px;
        height: 14px;
        opacity: 0.6;
      }

      /* ============================================================
   ðŸŽ¬ LOADING STATES
   ============================================================ */

      .loading {
        pointer-events: none;
        opacity: 0.6;
      }

      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      /* ============================================================
   âœ¨ FIRE SPARKS ANIMATION
   ============================================================ */

      .fire-sparks {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
        overflow: hidden;
      }

      .spark {
        position: absolute;
        bottom: 0;
        width: 5px;
        height: 5px;
        background: var(--text-secondary);
        border-radius: 50%;
        opacity: 0;
        animation: sparkRise linear forwards;
        box-shadow: 0 0 4px var(--text-secondary);
      }

      @keyframes sparkRise {
        0% {
          transform: translateY(0) translateX(0) scale(1);
          opacity: 0.8;
        }
        50% {
          opacity: 0.6;
        }
        100% {
          transform: translateY(-100vh) translateX(var(--drift)) scale(0.3);
          opacity: 0;
        }
      }

      /* ========== SIDEBAR SEARCH OVERRIDE (ULTRA PRIORITY) ========== */
      .chat-sidebar .sidebar-search {
        padding: 0.125rem 0.5rem !important;
        height: 24px !important;
        min-height: 24px !important;
        max-height: 24px !important;
        line-height: 1 !important;
      }

      .chat-sidebar .sidebar-search svg {
        width: 16px !important;
        height: 16px !important;
        fill: #ffffff !important;
        stroke: none !important;
      }

      .chat-sidebar .sidebar-search input {
        font-size: 0.8rem !important;
        line-height: 1 !important;
        padding: 0 !important;
      }

      /* ========== MICROPHONE RECORDING ANIMATION ========== */
      .neon-mic.recording {
        animation: pulse-recording 1s ease-in-out infinite;
        background: rgba(239, 68, 68, 0.2) !important;
      }

      /* ============================================================
   â±ï¸ GUEST TIMER COUNTDOWN - 5 MINUTE LIMIT
   ============================================================ */
      .guest-timer {
        position: fixed;
        top: 20px;
        right: 20px;
        color: #ff6b4a;
        font-weight: 700;
        font-size: 14px;
        z-index: 10001;
        display: flex;
        align-items: center;
        gap: 10px;
        animation: slideInFromRight 0.5s ease-out;
      }

      .guest-timer.warning {
        animation: pulseWarning 1s ease-in-out infinite;
      }

      .guest-timer.warning .guest-timer-time {
        color: #ef4444;
      }

      /* Modern Premium Hourglass Icon */
      .guest-timer-icon {
        width: 32px;
        height: 32px;
        position: relative;
        animation: hourglassFlip 3s ease-in-out infinite;
      }

      @keyframes hourglassFlip {
        0%,
        100% {
          transform: rotate(0deg);
        }
        50% {
          transform: rotate(180deg);
        }
      }

      .guest-timer-text {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
      }

      .guest-timer-label {
        font-size: 10px;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .guest-timer-time {
        font-size: 20px;
        font-weight: 900 !important;
        letter-spacing: 1px;
        font-family: 'JetBrains Mono', monospace;
      }

      @keyframes slideInFromRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes pulseWarning {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
      }

      /* Mobile responsive */
      @media (max-width: 768px) {
        .guest-timer {
          top: 10px;
          right: 10px;
          padding: 10px 16px;
          font-size: 12px;
        }

        .guest-timer-icon {
          font-size: 16px;
        }

        .guest-timer-label {
          font-size: 9px;
        }

        .guest-timer-time {
          font-size: 18px;
        }
      }

      @media (max-width: 480px) {
        .guest-timer {
          top: 70px;
          right: 10px;
          padding: 8px 14px;
        }

        .guest-timer-text {
          gap: 0;
        }

        .guest-timer-time {
          font-size: 16px;
        }
      }

      @keyframes pulse-recording {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        }
        50% {
          transform: scale(1.1);
          box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
        }
      }

      .neon-mic.recording svg {
        fill: #ef4444 !important;
      }

      /* ============================================================
         ðŸ” CHAT AUTH PANEL SYSTEM - %100 Chat Page Compatible
         ============================================================ */

      /* ====== AUTH OVERLAY & PANEL (ChatGPT Style) ====== */
      .chat-auth-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10005;
        padding: 1rem;
      }
      .chat-auth-overlay.active {
        display: flex;
      }

      .chat-auth-panel {
        display: none;
        background: linear-gradient(145deg, #1a1a1e, #222226);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        width: 100%;
        max-width: 400px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 24px 80px rgba(0, 0, 0, 0.5);
        position: relative;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.15) transparent;
      }
      .chat-auth-panel::-webkit-scrollbar {
        width: 5px;
      }
      .chat-auth-panel::-webkit-scrollbar-track {
        background: transparent;
      }
      .chat-auth-panel::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 3px;
      }
      .chat-auth-panel.active {
        display: block;
        animation: authFadeIn 0.25s ease;
      }
      @keyframes authFadeIn {
        from {
          opacity: 0;
          transform: scale(0.96);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Auth Steps */
      .auth-step {
        display: none;
        padding: 2.25rem 1.75rem 1.75rem;
        flex-direction: column;
        gap: 0.625rem;
      }
      .auth-step.active {
        display: flex;
        animation: authStepIn 0.3s ease;
      }
      @keyframes authStepIn {
        from {
          opacity: 0;
          transform: translateX(16px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      @keyframes authStepOut {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(-16px);
        }
      }

      /* Close button */
      .auth-close-btn {
        position: absolute;
        top: 14px;
        right: 14px;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        color: rgba(255, 255, 255, 0.4);
        transition: all 0.2s;
        z-index: 10;
      }
      .auth-close-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
      }
      .auth-close-btn svg {
        width: 18px;
        height: 18px;
        stroke: currentColor;
        stroke-width: 2;
        fill: none;
      }

      /* Title & Subtitle */
      .auth-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #ffffff;
        text-align: center;
        margin: 0 0 0.125rem;
        font-family: 'Inter', sans-serif;
        line-height: 1.3;
      }
      .auth-subtitle {
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.55);
        text-align: center;
        line-height: 1.5;
        margin-bottom: 0.75rem;
      }

      /* Social Buttons */
      .auth-social-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        width: 100%;
        height: 48px;
        padding: 0 1rem;
        border-radius: 9999px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.06);
        color: #ffffff;
        font-size: 0.9375rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Inter', sans-serif;
      }
      .auth-social-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.25);
      }
      .auth-social-btn svg {
        width: 20px;
        height: 20px;
        flex-shrink: 0;
      }

      /* Divider */
      .auth-divider {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin: 0.375rem 0;
      }
      .auth-divider::before,
      .auth-divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: rgba(255, 255, 255, 0.1);
      }
      .auth-divider span {
        font-size: 0.8125rem;
        color: rgba(255, 255, 255, 0.35);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Input Fields */
      .auth-input-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .auth-input {
        width: 100%;
        height: 48px;
        padding: 0 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 9999px;
        color: #ffffff;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
        outline: none;
        transition:
          border-color 0.2s,
          box-shadow 0.2s;
        box-sizing: border-box;
      }
      .auth-input:focus {
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.06);
      }
      .auth-input::placeholder {
        color: rgba(255, 255, 255, 0.3);
      }

      /* Email display row (Step 2) */
      .auth-email-display {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 9999px;
      }
      .auth-email-text {
        font-size: 0.9375rem;
        color: rgba(255, 255, 255, 0.75);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .auth-email-edit {
        font-size: 0.8125rem;
        color: #60a5fa;
        cursor: pointer;
        background: none;
        border: none;
        padding: 2px 6px;
        border-radius: 4px;
        transition: all 0.2s;
        font-family: 'Inter', sans-serif;
        flex-shrink: 0;
      }
      .auth-email-edit:hover {
        color: #93bbfc;
        background: rgba(96, 165, 250, 0.1);
      }

      /* Password wrapper with eye toggle */
      .auth-password-wrapper {
        position: relative;
      }
      .auth-password-wrapper .auth-input {
        padding-right: 48px;
      }
      .auth-password-toggle {
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: rgba(255, 255, 255, 0.35);
        padding: 4px;
        display: flex;
        align-items: center;
        transition: color 0.2s;
      }
      .auth-password-toggle:hover {
        color: rgba(255, 255, 255, 0.7);
      }
      .auth-password-toggle svg {
        width: 20px;
        height: 20px;
        stroke: currentColor;
        fill: none;
        stroke-width: 1.5;
      }

      /* Primary CTA (white bg) */
      .auth-btn-primary {
        width: 100%;
        height: 48px;
        padding: 0 1.5rem;
        background: #ffffff;
        border: none;
        border-radius: 9999px;
        color: #1a1a1a;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Inter', sans-serif;
        margin-top: 0.25rem;
      }
      .auth-btn-primary:hover:not(:disabled) {
        background: #e8e8e8;
        transform: translateY(-1px);
        box-shadow: 0 4px 16px rgba(255, 255, 255, 0.1);
      }
      .auth-btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .auth-btn-primary.loading {
        position: relative;
        color: transparent;
      }
      .auth-btn-primary.loading::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid rgba(0, 0, 0, 0.2);
        border-top-color: #1a1a1a;
        border-radius: 50%;
        animation: authSpinner 0.6s linear infinite;
      }
      @keyframes authSpinner {
        to {
          transform: rotate(360deg);
        }
      }

      /* Secondary CTA (dark bg) */
      .auth-btn-secondary {
        width: 100%;
        height: 48px;
        padding: 0 1.5rem;
        background: #1a1a1a;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 9999px;
        color: #ffffff;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Inter', sans-serif;
      }
      .auth-btn-secondary:hover:not(:disabled) {
        background: #000000;
        border-color: rgba(255, 255, 255, 0.3);
      }
      .auth-btn-secondary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .auth-btn-secondary.loading {
        position: relative;
        color: transparent;
      }
      .auth-btn-secondary.loading::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-top-color: #ffffff;
        border-radius: 50%;
        animation: authSpinner 0.6s linear infinite;
      }

      /* Link buttons */
      .auth-link-btn {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.45);
        font-size: 0.8125rem;
        cursor: pointer;
        text-align: center;
        padding: 8px;
        transition: color 0.2s;
        font-family: 'Inter', sans-serif;
      }
      .auth-link-btn:hover {
        color: #ffffff;
      }

      /* Footer */
      .auth-footer {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        padding-top: 0.75rem;
        margin-top: 0.5rem;
      }
      .auth-footer a {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.35);
        text-decoration: none;
        transition: color 0.2s;
      }
      .auth-footer a:hover {
        color: rgba(255, 255, 255, 0.7);
      }
      .auth-footer-sep {
        width: 1px;
        height: 12px;
        background: rgba(255, 255, 255, 0.15);
      }

      /* Error message */
      .auth-error-msg {
        font-size: 0.8125rem;
        color: #ef4444;
        text-align: center;
        padding: 8px 12px;
        background: rgba(239, 68, 68, 0.1);
        border-radius: 8px;
        display: none;
      }
      .auth-error-msg.visible {
        display: block;
      }

      /* Phone login */
      .auth-phone-input-row {
        display: flex;
        gap: 8px;
      }
      .auth-country-code {
        width: 88px;
        height: 48px;
        padding: 0 10px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 9999px;
        color: #ffffff;
        font-size: 0.9375rem;
        font-family: 'Inter', sans-serif;
        outline: none;
        cursor: pointer;
        appearance: none;
        -webkit-appearance: none;
        flex-shrink: 0;
        text-align: center;
      }
      .auth-country-code:focus {
        border-color: rgba(255, 255, 255, 0.4);
      }
      .auth-country-code option {
        background: #2d2d2d;
        color: #ffffff;
      }
      .auth-phone-input-row .auth-input {
        flex: 1;
        min-width: 0;
      }

      /* OTP digits */
      .auth-otp-row {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 0.75rem 0;
      }
      .auth-otp-digit {
        width: 46px;
        height: 54px;
        text-align: center;
        font-size: 1.375rem;
        font-weight: 600;
        font-family: 'JetBrains Mono', monospace;
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        color: #ffffff;
        outline: none;
        transition: border-color 0.2s;
        caret-color: #ffffff;
      }
      .auth-otp-digit:focus {
        border-color: rgba(255, 255, 255, 0.5);
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.06);
      }

      /* Password strength (reused by register step) */
      .password-strength {
        height: 3px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 2px;
        margin-top: 6px;
        overflow: hidden;
      }
      .password-strength-bar {
        height: 100%;
        width: 0;
        border-radius: 2px;
        transition:
          width 0.3s,
          background 0.3s;
      }
      .password-strength-bar.weak {
        width: 33%;
        background: #ef4444;
      }
      .password-strength-bar.medium {
        width: 66%;
        background: #f59e0b;
      }
      .password-strength-bar.strong {
        width: 100%;
        background: #22c55e;
      }

      /* Legacy Auth Styles (forgot, reset, settings, security panels) */
      .chat-auth-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.25rem 1.25rem 0.75rem;
        gap: 0.5rem;
      }
      .chat-auth-header h2 {
        font-size: 1.125rem;
        font-weight: 600;
        color: #ffffff;
        flex: 1;
        text-align: center;
        margin: 0;
      }
      .chat-auth-close,
      .chat-auth-back {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        color: rgba(255, 255, 255, 0.5);
        transition: all 0.2s;
        flex-shrink: 0;
      }
      .chat-auth-close:hover,
      .chat-auth-back:hover {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
      }
      .chat-auth-close svg,
      .chat-auth-back svg {
        width: 18px;
        height: 18px;
        stroke: currentColor;
        stroke-width: 2;
        fill: none;
      }
      .chat-auth-header-spacer {
        width: 32px;
        height: 32px;
        flex-shrink: 0;
      }
      .chat-auth-form {
        padding: 0.75rem 1.25rem 1.25rem;
        display: flex;
        flex-direction: column;
        gap: 0.875rem;
      }
      .chat-auth-field {
        display: flex;
        flex-direction: column;
        gap: 0.375rem;
      }
      .chat-auth-field label {
        font-size: 0.8125rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.6);
      }
      .chat-auth-field input {
        width: 100%;
        height: 44px;
        padding: 0 14px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 10px;
        color: #ffffff;
        font-size: 0.9375rem;
        font-family: 'Inter', sans-serif;
        outline: none;
        transition: border-color 0.2s;
        box-sizing: border-box;
      }
      .chat-auth-field input:focus {
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.06);
      }
      .chat-auth-field input::placeholder {
        color: rgba(255, 255, 255, 0.3);
      }
      .chat-auth-btn {
        width: 100%;
        height: 44px;
        padding: 0 1.25rem;
        background: #ffffff;
        border: none;
        border-radius: 9999px;
        color: #1a1a1a;
        font-size: 0.9375rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-family: 'Inter', sans-serif;
        margin-top: 0.25rem;
      }
      .chat-auth-btn:hover:not(:disabled) {
        background: #e8e8e8;
        transform: translateY(-1px);
      }
      .chat-auth-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .chat-auth-btn.loading {
        position: relative;
        color: transparent;
      }
      .chat-auth-btn.loading::after {
        content: '';
        position: absolute;
        left: 50%;
        top: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid rgba(0, 0, 0, 0.2);
        border-top-color: #1a1a1a;
        border-radius: 50%;
        animation: authSpinner 0.6s linear infinite;
      }
      .chat-auth-links {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        padding-top: 0.25rem;
      }
      .chat-auth-links a {
        font-size: 0.8125rem;
        color: rgba(255, 255, 255, 0.5);
        text-decoration: none;
        transition: color 0.2s;
      }
      .chat-auth-links a:hover {
        color: #ffffff;
      }

      /* Profile Section */
      .chat-auth-profile-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2rem 1.25rem 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }

      .chat-auth-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(200, 200, 200, 0.7));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 1rem;
      }

      .chat-auth-profile-name {
        font-size: 1.25rem;
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 0.25rem;
      }

      .chat-auth-profile-email {
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.6);
      }

      /* Menu Items */
      .chat-auth-menu {
        padding: 1rem;
      }

      .chat-auth-menu-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem 1rem;
        background: transparent;
        border: none;
        border-radius: 8px;
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.9375rem;
        font-family: inherit;
        cursor: pointer;
        width: 100%;
        text-align: left;
        transition: background 0.2s;
      }

      .chat-auth-menu-item:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .chat-auth-menu-item svg {
        width: 20px;
        height: 20px;
        fill: currentColor;
        opacity: 0.8;
      }

      .chat-auth-menu-item.danger {
        color: #ef4444;
      }

      /* ========== ChatGPT-Style Settings Tabs ========== */
      .settings-tab-bar {
        display: flex;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin: 0 1.25rem;
        overflow-x: auto;
        gap: 0;
        -webkit-overflow-scrolling: touch;
      }

      .settings-tab-bar::-webkit-scrollbar {
        display: none;
      }

      .settings-tab-btn {
        padding: 10px 16px;
        font-size: 13px;
        font-weight: 500;
        border: none;
        background: transparent;
        color: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        white-space: nowrap;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
      }

      .settings-tab-btn:hover {
        color: rgba(255, 255, 255, 0.8);
      }

      .settings-tab-btn.active {
        color: #6366f1;
        border-bottom-color: #6366f1;
      }

      .settings-tab-content {
        display: none;
      }

      .settings-tab-content.active {
        display: block;
      }

      [data-theme='light'] .settings-tab-bar {
        border-bottom-color: rgba(0, 0, 0, 0.1);
      }

      [data-theme='light'] .settings-tab-btn {
        color: rgba(0, 0, 0, 0.4);
      }

      [data-theme='light'] .settings-tab-btn:hover {
        color: rgba(0, 0, 0, 0.7);
      }

      [data-theme='light'] .settings-tab-btn.active {
        color: #6366f1;
      }

      /* Settings Section */
      .chat-auth-settings {
        padding: 1rem 1.25rem;
      }

      .chat-auth-setting-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }

      .chat-auth-setting-row:last-child {
        border-bottom: none;
      }

      .chat-auth-setting-label {
        font-size: 0.9375rem;
        color: rgba(255, 255, 255, 0.9);
      }

      .chat-auth-setting-desc {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.5);
        margin-top: 0.25rem;
      }

      /* Toggle Switch - Fixed visibility */
      .chat-auth-toggle {
        position: relative;
        width: 44px;
        height: 24px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .chat-auth-toggle.active {
        background: rgba(255, 255, 255, 0.9);
      }

      .chat-auth-toggle::after {
        content: '';
        position: absolute;
        left: 2px;
        top: 2px;
        width: 20px;
        height: 20px;
        background: #888888;
        border-radius: 50%;
        transition:
          transform 0.2s,
          background 0.2s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      .chat-auth-toggle.active::after {
        transform: translateX(20px);
        background: #171717;
      }

      /* Select Dropdown */
      .chat-auth-select {
        padding: 0.5rem 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        color: #ffffff;
        font-size: 0.875rem;
        font-family: inherit;
        cursor: pointer;
        outline: none;
      }

      .chat-auth-select:focus {
        border-color: rgba(255, 255, 255, 0.4);
      }

      .chat-auth-select option {
        background: #171717;
        color: #ffffff;
      }

      /* Custom Settings CSS Variables */
      :root {
        --chat-font-size: 15px;
      }

      /* Font Size applied to messages */
      .message-text {
        font-size: var(--chat-font-size) !important;
      }

      /* Message Density */
      [data-density='compact'] .message {
        padding: 8px 16px !important;
        margin: 2px 0 !important;
      }
      [data-density='comfortable'] .message {
        padding: 16px !important;
        margin: 8px 0 !important;
      }
      [data-density='spacious'] .message {
        padding: 24px 16px !important;
        margin: 16px 0 !important;
      }

      /* Chat Width */
      [data-chat-width='narrow'] .messages-container {
        max-width: 640px !important;
        margin: 0 auto;
      }
      [data-chat-width='medium'] .messages-container {
        max-width: 768px !important;
        margin: 0 auto;
      }
      [data-chat-width='wide'] .messages-container {
        max-width: 960px !important;
        margin: 0 auto;
      }

      /* Bio textarea */
      .settings-bio-textarea {
        width: 100%;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        color: #fff;
        padding: 10px 12px;
        font-size: 13px;
        font-family: inherit;
        resize: none;
        outline: none;
        transition: border-color 0.2s;
      }
      .settings-bio-textarea:focus {
        border-color: rgba(99, 102, 241, 0.5);
      }
      .settings-bio-textarea::placeholder {
        color: rgba(255, 255, 255, 0.3);
      }

      /* Light theme overrides */
      [data-theme='light'] .settings-bio-textarea {
        background: rgba(0, 0, 0, 0.03) !important;
        border-color: rgba(0, 0, 0, 0.1) !important;
        color: #1f2328 !important;
      }
      [data-theme='light'] .settings-bio-textarea::placeholder {
        color: rgba(0, 0, 0, 0.3) !important;
      }

      /* Danger button small - warning variant */
      .chat-auth-warning-btn-sm {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        background: rgba(245, 158, 11, 0.15);
        color: #f59e0b;
        border: 1px solid rgba(245, 158, 11, 0.3);
        border-radius: 8px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
      }
      .chat-auth-warning-btn-sm:hover {
        background: rgba(245, 158, 11, 0.25);
      }

      /* Success/Info Messages */
      .chat-auth-message {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-size: 0.875rem;
      }

      .chat-auth-message.success {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: #ffffff;
      }

      .chat-auth-message.error {
        background: rgba(239, 68, 68, 0.15);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #ef4444;
      }

      /* ============================================================
         ðŸ›¡ï¸ ENHANCED SETTINGS & SECURITY PANELS
         ============================================================ */

      /* Settings Section Headers */
      .chat-auth-section-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: rgba(255, 255, 255, 0.5);
        padding: 1rem 1.25rem 0.5rem;
        margin-top: 0.5rem;
      }

      .chat-auth-section-title svg {
        width: 14px;
        height: 14px;
        stroke: currentColor;
        fill: none;
      }

      /* Profile Edit Section */
      .chat-auth-profile-edit {
        padding: 1.25rem;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        margin: 0.75rem 1.25rem;
      }

      .chat-auth-avatar-edit {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 1rem;
      }

      .chat-auth-avatar-large {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ffffff, #e0e0e0);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0a0b0d;
        font-size: 24px;
        font-weight: 700;
        flex-shrink: 0;
      }

      .chat-auth-avatar-actions {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .chat-auth-avatar-actions button {
        padding: 6px 12px;
        font-size: 0.8rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 6px;
        color: #ffffff;
        cursor: pointer;
        transition: all 0.2s;
      }

      .chat-auth-avatar-actions button:hover {
        background: rgba(255, 255, 255, 0.12);
      }

      /* Security Status Badge */
      .chat-auth-security-status {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.2);
        border-radius: 10px;
        margin: 0.75rem 1.25rem;
      }

      .chat-auth-security-status.warning {
        background: rgba(251, 146, 60, 0.1);
        border-color: rgba(251, 146, 60, 0.2);
      }

      .chat-auth-security-status.good {
        background: rgba(34, 197, 94, 0.08);
        border: 1px solid rgba(34, 197, 94, 0.2);
      }

      .chat-auth-security-status.good .chat-auth-security-icon {
        color: #22c55e;
      }

      .chat-auth-security-status.good .chat-auth-security-title {
        color: #22c55e;
      }

      .chat-auth-security-status.danger {
        background: rgba(239, 68, 68, 0.08);
        border: 1px solid rgba(239, 68, 68, 0.2);
      }

      .chat-auth-security-status.danger .chat-auth-security-icon {
        color: #ef4444;
      }

      .chat-auth-security-status.danger .chat-auth-security-title {
        color: #ef4444;
      }

      .chat-auth-security-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(34, 197, 94, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #22c55e;
      }

      .chat-auth-security-status.warning .chat-auth-security-icon {
        background: rgba(251, 146, 60, 0.2);
        color: #fb923c;
      }

      .chat-auth-security-info {
        flex: 1;
      }

      .chat-auth-security-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: #ffffff;
      }

      .chat-auth-security-desc {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.6);
        margin-top: 2px;
      }

      /* 2FA Setup Card */
      .chat-auth-2fa-card {
        padding: 1.25rem;
        background: linear-gradient(145deg, rgba(79, 70, 229, 0.1), rgba(79, 70, 229, 0.05));
        border: 1px solid rgba(79, 70, 229, 0.2);
        border-radius: 12px;
        margin: 0.75rem 1.25rem;
      }

      .chat-auth-2fa-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }

      .chat-auth-2fa-title {
        font-size: 0.9375rem;
        font-weight: 600;
        color: #ffffff;
      }

      .chat-auth-2fa-status {
        padding: 4px 10px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        border-radius: 4px;
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }

      .chat-auth-2fa-status.active {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
      }

      .chat-auth-2fa-desc {
        font-size: 0.8125rem;
        color: rgba(255, 255, 255, 0.6);
        line-height: 1.5;
        margin-bottom: 16px;
      }

      .chat-auth-2fa-btn {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        border: none;
        border-radius: 8px;
        color: #ffffff;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .chat-auth-2fa-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
      }

      /* Active Sessions List */
      .chat-auth-sessions {
        padding: 0 1.25rem;
      }

      .chat-auth-session {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 10px;
        margin-bottom: 8px;
      }

      .chat-auth-session.current {
        border-color: rgba(34, 197, 94, 0.3);
        background: rgba(34, 197, 94, 0.05);
      }

      .chat-auth-session-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.08);
        display: flex;
        align-items: center;
        justify-content: center;
        color: rgba(255, 255, 255, 0.7);
        font-size: 18px;
      }

      .chat-auth-session-info {
        flex: 1;
        min-width: 0;
      }

      .chat-auth-session-device {
        font-size: 0.875rem;
        font-weight: 500;
        color: #ffffff;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .chat-auth-session-device .current-badge {
        padding: 2px 6px;
        font-size: 0.65rem;
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
        border-radius: 4px;
      }

      .chat-auth-session-details {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
        margin-top: 2px;
      }

      .chat-auth-session-logout {
        padding: 6px 10px;
        font-size: 0.75rem;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        border-radius: 6px;
        color: #ef4444;
        cursor: pointer;
        transition: all 0.2s;
      }

      .chat-auth-session-logout:hover {
        background: rgba(239, 68, 68, 0.2);
      }

      /* Delete Account Button */
      .chat-auth-danger-zone {
        padding: 1rem 1.25rem;
        margin-top: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
      }

      .chat-auth-danger-btn {
        width: 100%;
        padding: 12px;
        background: transparent;
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 8px;
        color: #ef4444;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .chat-auth-danger-btn:hover {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.5);
      }

      /* Export and Small Danger Buttons */
      .chat-auth-export-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.8rem;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .chat-auth-export-btn:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.25);
        color: #ffffff;
      }

      .chat-auth-danger-btn-sm {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 6px;
        color: #ef4444;
        font-size: 0.8rem;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .chat-auth-danger-btn-sm:hover {
        background: rgba(239, 68, 68, 0.2);
        border-color: rgba(239, 68, 68, 0.5);
      }

      /* Privacy Toggle Row */
      .chat-auth-privacy-row {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        padding: 1rem 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }

      .chat-auth-privacy-info {
        flex: 1;
        padding-right: 1rem;
      }

      .chat-auth-privacy-label {
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 4px;
      }

      .chat-auth-privacy-desc {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.5);
        line-height: 1.4;
      }

      .chat-auth-message.info {
        background: rgba(110, 132, 255, 0.15);
        border: 1px solid rgba(110, 132, 255, 0.3);
        color: #6e84ff;
      }

      /* Mobile Responsive - Centered Scale Animation */
      @media (max-width: 768px) {
        .chat-auth-overlay {
          align-items: center;
          justify-content: center;
          padding: 0.75rem;
        }

        .chat-auth-panel {
          max-width: 92%;
          width: 380px;
          max-height: calc(100vh - 2rem);
          max-height: calc(100dvh - 2rem);
          border-radius: 16px;
          overflow: hidden;
          animation: authScaleIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chat-auth-panel::-webkit-scrollbar {
          display: none;
        }

        .chat-auth-panel .auth-step {
          padding: 1.5rem 1.25rem 1.25rem;
          gap: 0.5rem;
          max-height: calc(100vh - 3.5rem);
          max-height: calc(100dvh - 3.5rem);
          overflow-y: auto;
          scrollbar-width: none;
          -ms-overflow-style: none;
        }

        .chat-auth-panel .auth-step::-webkit-scrollbar {
          display: none;
        }

        .chat-auth-panel .auth-title {
          font-size: 1.25rem;
        }

        .chat-auth-panel .auth-subtitle {
          font-size: 0.8125rem;
          margin-bottom: 0.5rem;
        }

        .chat-auth-panel .auth-social-btn {
          height: 44px;
          font-size: 0.875rem;
        }

        .chat-auth-panel .auth-input {
          height: 44px;
          font-size: 0.9375rem;
        }

        .chat-auth-panel .auth-btn-primary,
        .chat-auth-panel .auth-btn-secondary {
          height: 44px;
          font-size: 0.9375rem;
        }

        @keyframes authScaleIn {
          from {
            opacity: 0;
            transform: scale(0.9);
          }
          to {
            opacity: 1;
            transform: scale(1);
          }
        }

        .chat-auth-form {
          padding: 1rem 0.875rem 1.5rem;
        }
      }

      /* Small screens - even more compact auth */
      @media (max-width: 480px) {
        .chat-auth-panel {
          max-width: 96%;
          border-radius: 12px;
        }

        .chat-auth-panel .auth-step {
          padding: 1.25rem 1rem 1rem;
          gap: 0.375rem;
        }

        .chat-auth-panel .auth-title {
          font-size: 1.125rem;
        }
      }

      /* ============================================================
         ChatGPT-Style Drawer Panel System (Settings & Security)
         ============================================================ */

      /* Overlay modifier for drawer panels */
      .chat-auth-overlay.chat-auth-overlay--drawer {
        justify-content: flex-end;
        padding: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
      }

      /* Base drawer panel - overrides .chat-auth-panel */
      .chat-auth-panel.chat-auth-panel--drawer {
        max-width: 480px;
        width: 100%;
        height: 100%;
        max-height: 100vh;
        max-height: 100dvh;
        border-radius: 0;
        display: none;
        flex-direction: column;
        overflow: hidden;
        transform: translateX(100%);
        transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: -8px 0 32px rgba(0, 0, 0, 0.4);
        animation: none !important;
        border: none;
        border-left: 1px solid rgba(255, 255, 255, 0.08);
      }

      /* Slide in from right when active */
      .chat-auth-panel.chat-auth-panel--drawer.active {
        display: flex;
        transform: translateX(0);
      }

      /* Slide out for closing */
      .chat-auth-panel.chat-auth-panel--drawer.closing {
        display: flex;
        transform: translateX(100%);
      }

      /* Fixed header inside drawer */
      .chat-auth-panel--drawer > .chat-auth-header {
        position: sticky;
        top: 0;
        z-index: 10;
        background: inherit;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        flex-shrink: 0;
      }

      /* Scrollable content body */
      .chat-auth-drawer-body {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.15) transparent;
        padding-bottom: env(safe-area-inset-bottom, 0);
      }

      .chat-auth-drawer-body::-webkit-scrollbar {
        width: 5px;
      }
      .chat-auth-drawer-body::-webkit-scrollbar-track {
        background: transparent;
      }
      .chat-auth-drawer-body::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.12);
        border-radius: 3px;
      }
      .chat-auth-drawer-body::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.25);
      }

      /* Desktop: right-side drawer */
      @media (min-width: 769px) {
        .chat-auth-panel.chat-auth-panel--drawer {
          max-width: 480px;
        }
      }

      /* Mobile: full-screen drawer */
      @media (max-width: 768px) {
        .chat-auth-panel.chat-auth-panel--drawer {
          max-width: 100%;
          width: 100%;
          max-height: 100vh;
          max-height: 100dvh;
          border-left: none;
          border-radius: 0 !important;
          overflow: hidden !important;
        }

        .chat-auth-panel--drawer > .chat-auth-header {
          padding-top: max(0.875rem, env(safe-area-inset-top));
        }
      }
    </style>

    <!-- ðŸ¤– Ailydian AI Client - LyDian Acceleration-first Fallback Strategy -->
    <script src="/js/ai-client-unified.js"></script>
    <!-- ðŸ§  AI Recall Client - RAG with Online/Offline Support -->
    <script src="/js/recall-client.js"></script>

    <!-- SEO Meta Tags (TR) -->
    <title>AI Chat â€” Ã‡ok Modelli Yapay Zeka | LyDian Ultra AI Platform</title>
    <meta
      name="description"
      content="10+ AI modeli tek platformda. LyDian Quantum Reasoning, LyDian Velocity Engine, LyDian Vision. GÃ¶rsel, kod, analiz. Ãœcretsiz baÅŸla ve AI gÃ¼cÃ¼nÃ¼ keÅŸfet."
    />
    <meta
      name="keywords"
      content="ai chat, yapay zeka sohbet, lydian ai, Ã§ok modelli ai, quantum ai, velocity engine"
    />
    <link rel="canonical" href="https://www.ailydian.com/chat" />

    <!-- GEO Targeting -->
    <meta name="geo.region" content="TR" />
    <meta name="geo.placename" content="Ä°stanbul" />
    <meta name="geo.position" content="41.0082;28.9784" />
    <meta name="ICBM" content="41.0082;28.9784" />

    <!-- Open Graph -->
    <meta
      property="og:title"
      content="AI Chat â€” Ã‡ok Modelli Yapay Zeka | LyDian Ultra AI Platform"
    />
    <meta
      property="og:description"
      content="10+ AI modeli tek platformda. LyDian Quantum Reasoning, LyDian Velocity Engine, LyDian Vision. GÃ¶rsel, kod, analiz. Ãœcretsiz baÅŸla ve AI gÃ¼cÃ¼nÃ¼ keÅŸfet."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.ailydian.com/chat" />
    <meta property="og:image" content="https://www.ailydian.com/og-images/chat-tr.png" />
    <meta property="og:locale" content="tr_TR" />
    <meta property="og:site_name" content="LyDian AI" />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lydianai" />
    <meta name="twitter:title" content="AI Chat â€” Ã‡ok Modelli Yapay Zeka | LyDian Ultra AI" />
    <meta
      name="twitter:description"
      content="10+ AI modeli tek platformda. LyDian Quantum, LyDian Ultra, LyDian Vision Pro. GÃ¶rsel, kod, analiz. Ãœcretsiz baÅŸla ve AI gÃ¼cÃ¼nÃ¼ keÅŸfet."
    />
    <meta name="twitter:image" content="https://www.ailydian.com/twitter-cards/chat-tr.png" />

    <!-- Additional Meta -->
    <meta
      name="robots"
      content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
    />
    <meta name="googlebot" content="index, follow" />
    <meta name="bingbot" content="index, follow" />
    <meta name="author" content="LyDian AI Ecosystem" />
    <meta name="language" content="TR" />

    <!-- Schema.org: Organization -->

    <meta name="msapplication-TileImage" content="https://www.ailydian.com/mstile/chat.png" />
    <meta
      name="msapplication-square70x70logo"
      content="https://www.ailydian.com/mstile-70/chat.png"
    />
    <meta
      name="msapplication-square150x150logo"
      content="https://www.ailydian.com/mstile-150/chat.png"
    />

    <!-- ðŸ† Premium SEO - LyDian AI Ecosystem -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "AI Chat â€” Ã‡ok Modelli Yapay Zeka | LyDian Ultra AI Platform",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web Browser, iOS, Android",
        "description": "AI sohbet asistanÄ± - AkÄ±llÄ± konuÅŸma ve destek",
        "image": [
          "https://www.ailydian.com/images/gallery/chat-1.jpg",
          "https://www.ailydian.com/images/gallery/chat-2.jpg",
          "https://www.ailydian.com/images/gallery/chat-3.jpg"
        ],
        "screenshot": [
          "https://www.ailydian.com/images/gallery/chat-1.jpg",
          "https://www.ailydian.com/images/gallery/chat-2.jpg",
          "https://www.ailydian.com/images/gallery/chat-3.jpg"
        ],
        "url": "https://www.ailydian.com/chat",
        "publisher": {
          "@type": "Organization",
          "name": "LyDian AI",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.ailydian.com/images/logo/lydian-ai.png",
            "width": 512,
            "height": 512
          }
        },
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "TRY",
          "availability": "https://schema.org/InStock"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.9",
          "reviewCount": "1542",
          "bestRating": "5"
        },
        "inLanguage": ["tr", "en", "de", "ru", "uk", "zh", "it"]
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "AI Chat â€” Ã‡ok Modelli Yapay Zeka | LyDian Ultra AI Platform",
        "description": "AI sohbet asistanÄ± - AkÄ±llÄ± konuÅŸma ve destek",
        "image": {
          "@type": "ImageObject",
          "url": "https://www.ailydian.com/images/hero/chat.jpg",
          "width": 1200,
          "height": 630,
          "caption": "AI Chat â€” Ã‡ok Modelli Yapay Zeka | LyDian Ultra AI Platform"
        },
        "publisher": {
          "@type": "Organization",
          "name": "LyDian AI",
          "logo": {
            "@type": "ImageObject",
            "url": "https://www.ailydian.com/images/logo/lydian-ai.png",
            "width": 512,
            "height": 512
          }
        },
        "datePublished": "2024-01-15",
        "dateModified": "2025-12-20",
        "inLanguage": "tr-TR"
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "VideoObject",
        "name": "AI Chat â€” Ã‡ok Modelli Yapay Zeka | LyDian Ultra AI Platform - Video Rehber",
        "description": "AI sohbet asistanÄ± - AkÄ±llÄ± konuÅŸma ve destek",
        "thumbnailUrl": "https://www.ailydian.com/images/video/chat-preview.jpg",
        "uploadDate": "2024-01-15",
        "duration": "PT8M",
        "contentUrl": "https://www.ailydian.com/videos/chat.mp4",
        "embedUrl": "https://www.ailydian.com/chat#video",
        "publisher": {
          "@type": "Organization",
          "name": "LyDian AI"
        }
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Ana Sayfa",
            "item": "https://www.ailydian.com"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Chat",
            "item": "https://www.ailydian.com/chat"
          }
        ]
      }
    </script>

    <!-- /Premium SEO -->
    <!-- Font preload removed - file does not exist -->
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#C4A962" />
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="aiLyDian AI" />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/apple-touch-icon-167.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180.png" />
    <!-- Apple Splash Screens -->
    <link
      rel="apple-touch-startup-image"
      href="/icons/splash/iphone-x.png"
      media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/icons/splash/iphone-xr.png"
      media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/icons/splash/iphone-12.png"
      media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/icons/splash/ipad.png"
      media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/icons/splash/ipad-pro-11.png"
      media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)"
    />
    <link
      rel="apple-touch-startup-image"
      href="/icons/splash/ipad-pro-12.png"
      media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)"
    />
    <!-- Android/Chrome -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="aiLyDian AI" />
    <!-- Microsoft -->
    <meta name="msapplication-TileColor" content="#C4A962" />
    <meta name="msapplication-TileImage" content="/icons/ms-icon-144.png" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
    <!-- Favicon (SVG preferred + PNG fallbacks) -->
    <link rel="icon" type="image/svg+xml" href="/icons/grape-icon-simple.svg" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/grape-favicon-16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/grape-favicon-32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="/icons/grape-favicon-48.png" />
    <link rel="icon" type="image/x-icon" href="/icons/grape-favicon.ico" />
    <link rel="shortcut icon" type="image/svg+xml" href="/icons/grape-icon-simple.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/grape-favicon-180.png" />
    <!-- Highlight.js - Syntax Highlighting -->
    <link
      id="hljs-dark-theme"
      rel="stylesheet"
      href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/vs2015.min.css"
    />
    <link
      id="hljs-light-theme"
      rel="stylesheet"
      href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/github.min.css"
      disabled
    />
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
    <!-- Schema.org: SoftwareApplication + BreadcrumbList -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "SoftwareApplication",
            "name": "LyDian AI Chat",
            "applicationCategory": "BusinessApplication",
            "operatingSystem": "Web",
            "url": "https://www.ailydian.com/chat",
            "description": "Multi-model AI chat platform with voice, vision, code generation, web search and file analysis capabilities.",
            "featureList": [
              "Multi-Model AI Chat",
              "Voice Interaction",
              "Code Generation",
              "Web Search",
              "File Analysis",
              "Real-time Streaming",
              "32+ Language Support"
            ],
            "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
            "publisher": { "@id": "https://www.ailydian.com/#organization" }
          },
          {
            "@type": "BreadcrumbList",
            "itemListElement": [
              {
                "@type": "ListItem",
                "position": 1,
                "name": "Ana Sayfa",
                "item": "https://www.ailydian.com/"
              },
              {
                "@type": "ListItem",
                "position": 2,
                "name": "AI Chat",
                "item": "https://www.ailydian.com/chat"
              }
            ]
          }
        ]
      }
    </script>
  </head>
  <body>
    <!-- Desktop Logo - Always visible in top-left on desktop -->
    <div class="desktop-logo-container" id="desktopLogo">
      <svg
        class="logo-icon"
        viewBox="0 0 512 512"
        width="44"
        height="44"
        fill="none"
        stroke="currentColor"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden="true"
      >
        <circle cx="256" cy="256" r="230" stroke-width="6" />
        <circle cx="256" cy="256" r="210" stroke-width="4" />
        <g stroke-width="5">
          <path d="M 256 80 Q 245 100, 250 120" stroke-linecap="round" />
          <path d="M 230 110 Q 210 105, 195 120 Q 188 135, 200 150 Q 215 160, 232 148 Z" />
          <path d="M 275 105 Q 295 100, 310 115 Q 317 130, 305 145 Q 290 155, 273 143 Z" />
          <path d="M 253 95 Q 265 90, 275 100 Q 280 110, 272 120 Q 263 125, 255 118 Z" />
          <circle cx="256" cy="160" r="24" />
          <circle cx="220" cy="200" r="23" />
          <circle cx="256" cy="205" r="23" />
          <circle cx="292" cy="200" r="23" />
          <circle cx="190" cy="245" r="22" />
          <circle cx="230" cy="250" r="22" />
          <circle cx="282" cy="250" r="22" />
          <circle cx="322" cy="245" r="22" />
          <circle cx="218" cy="295" r="21" />
          <circle cx="256" cy="300" r="21" />
          <circle cx="294" cy="295" r="21" />
          <circle cx="235" cy="340" r="20" />
          <circle cx="277" cy="340" r="20" />
          <circle cx="256" cy="380" r="19" />
        </g>
      </svg>
      <span class="logo-text">LyDian</span>
    </div>

    <!-- Desktop History Toggle - Modern Sidebar Icon -->
    <button class="desktop-history-toggle" id="desktopHistoryToggle" title="Sohbet Gecmisi">
      <svg
        viewBox="0 0 24 24"
        width="22"
        height="22"
        fill="none"
        stroke="currentColor"
        stroke-width="1.8"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <rect x="3" y="3" width="18" height="18" rx="2.5"></rect>
        <path d="M9 3v18"></path>
        <line x1="13" y1="8" x2="18" y2="8"></line>
        <line x1="13" y1="12" x2="16" y2="12"></line>
      </svg>
    </button>

    <!-- ðŸš€ MAIN CHAT CONTAINER -->
    <div class="chat-container">
      <!-- ðŸ“‚ SIDEBAR -->
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <button class="sidebar-toggle" id="sidebarToggle">
            <svg
              class="logo-icon"
              viewBox="0 0 512 512"
              width="32"
              height="32"
              fill="none"
              stroke="currentColor"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
            >
              <circle cx="256" cy="256" r="230" stroke-width="6" />
              <circle cx="256" cy="256" r="210" stroke-width="4" />
              <g stroke-width="5">
                <path d="M 256 80 Q 245 100, 250 120" stroke-linecap="round" />
                <path d="M 230 110 Q 210 105, 195 120 Q 188 135, 200 150 Q 215 160, 232 148 Z" />
                <path d="M 275 105 Q 295 100, 310 115 Q 317 130, 305 145 Q 290 155, 273 143 Z" />
                <path d="M 253 95 Q 265 90, 275 100 Q 280 110, 272 120 Q 263 125, 255 118 Z" />
                <circle cx="256" cy="160" r="24" />
                <circle cx="220" cy="200" r="23" />
                <circle cx="256" cy="205" r="23" />
                <circle cx="292" cy="200" r="23" />
                <circle cx="190" cy="245" r="22" />
                <circle cx="230" cy="250" r="22" />
                <circle cx="282" cy="250" r="22" />
                <circle cx="322" cy="245" r="22" />
                <circle cx="218" cy="295" r="21" />
                <circle cx="256" cy="300" r="21" />
                <circle cx="294" cy="295" r="21" />
                <circle cx="235" cy="340" r="20" />
                <circle cx="277" cy="340" r="20" />
                <circle cx="256" cy="380" r="19" />
              </g>
            </svg>
          </button>
          <div
            class="logo"
            style="
              display: flex;
              align-items: center;
              gap: 8px;
              font-family: 'Inter', sans-serif !important;
              font-weight: 900 !important;
            "
          >
            <span>LyDian</span>
          </div>
        </div>

        <button class="new-chat-btn" id="newChatBtn">
          <svg viewBox="0 0 24 24">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
          </svg>
          <span>Yeni Sohbet</span>
        </button>

        <div class="chat-history" id="chatHistory">
          <!-- Empty state - shown when no chats -->
          <div class="chat-history-empty" id="chatHistoryEmpty">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span class="empty-title">Sohbet geÃ§miÅŸi yok</span>
            <span class="empty-desc">Yeni bir sohbet baÅŸlatÄ±n</span>
          </div>
          <!-- Chat history items will be added here -->
        </div>

        <!-- ðŸ‘¤ USER MENU (Bottom of sidebar) -->
        <div class="sidebar-footer">
          <div class="sidebar-search">
            <svg viewBox="0 0 24 24">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
              ></path>
            </svg>
            <input type="text" placeholder="Ara..." id="sidebarSearch" />
          </div>

          <div class="user-menu">
            <div class="user-info" id="userMenuBtn">
              <div class="user-avatar">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                  ></path>
                </svg>
              </div>
              <div class="user-details">
                <div class="user-name">KullanÄ±cÄ±</div>
                <div class="user-email">user@example.com</div>
              </div>
              <svg class="user-menu-arrow" viewBox="0 0 24 24">
                <path d="M7 10l5 5 5-5z"></path>
              </svg>
            </div>

            <div class="user-dropdown" id="userDropdown">
              <a href="/settings.html" class="dropdown-item">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
                  ></path>
                </svg>
                Ayarlar
              </a>
              <a href="/billing.html" class="dropdown-item">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"
                  ></path>
                </svg>
                Ã–deme &amp; Plan
              </a>
              <a href="/api-reference.html" class="dropdown-item">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"
                  ></path>
                </svg>
                API AnahtarlarÄ±
              </a>
              <a href="/help.html" class="dropdown-item">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"
                  ></path>
                </svg>
                YardÄ±m &amp; Destek
              </a>
              <div class="dropdown-divider"></div>
              <a href="/login.html" class="dropdown-item logout">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
                  ></path>
                </svg>
                Ã‡Ä±kÄ±ÅŸ Yap
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- ðŸ’¬ MAIN CHAT AREA -->
      <div class="main-chat">
        <!-- ðŸŽ¯ HEADER -->
        <!-- ðŸŽ›ï¸ MOBILE HAMBURGER + LOGO (ChatGPT Style) -->
        <div class="mobile-logo-container">
          <!-- ðŸ“± HAMBURGER MENU BUTTON - Opens sidebar from LEFT -->
          <button class="mobile-hamburger-btn" id="mobileHamburgerBtn" aria-label="MenÃ¼yÃ¼ aÃ§">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <button class="mobile-logo-toggle" id="mobileToggleBtn" title="MenÃ¼">
            <svg
              class="logo-icon"
              viewBox="0 0 512 512"
              width="36"
              height="36"
              fill="none"
              stroke="currentColor"
              xmlns="http://www.w3.org/2000/svg"
              aria-hidden="true"
            >
              <circle cx="256" cy="256" r="230" stroke-width="6" />
              <circle cx="256" cy="256" r="210" stroke-width="4" />
              <g stroke-width="5">
                <path d="M 256 80 Q 245 100, 250 120" stroke-linecap="round" />
                <path d="M 230 110 Q 210 105, 195 120 Q 188 135, 200 150 Q 215 160, 232 148 Z" />
                <path d="M 275 105 Q 295 100, 310 115 Q 317 130, 305 145 Q 290 155, 273 143 Z" />
                <path d="M 253 95 Q 265 90, 275 100 Q 280 110, 272 120 Q 263 125, 255 118 Z" />
                <circle cx="256" cy="160" r="24" />
                <circle cx="220" cy="200" r="23" />
                <circle cx="256" cy="205" r="23" />
                <circle cx="292" cy="200" r="23" />
                <circle cx="190" cy="245" r="22" />
                <circle cx="230" cy="250" r="22" />
                <circle cx="282" cy="250" r="22" />
                <circle cx="322" cy="245" r="22" />
                <circle cx="218" cy="295" r="21" />
                <circle cx="256" cy="300" r="21" />
                <circle cx="294" cy="295" r="21" />
                <circle cx="235" cy="340" r="20" />
                <circle cx="277" cy="340" r="20" />
                <circle cx="256" cy="380" r="19" />
              </g>
            </svg>
            <span class="mobile-logo-text">LyDian</span>
          </button>
          <button class="mobile-dropdown-trigger" id="mobileDropdownBtn" aria-label="MenÃ¼">
            <svg
              width="12"
              height="8"
              viewBox="0 0 12 8"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1 1L6 6L11 1"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </button>
          <div class="mobile-dropdown-menu" id="mobileDropdownMenu">
            <a
              href="/lydian-iq.html"
              target="_blank"
              rel="noopener noreferrer"
              class="mobile-dropdown-item"
              >IQ</a
            >
            <a
              href="/medical-expert.html"
              target="_blank"
              rel="noopener noreferrer"
              class="mobile-dropdown-item"
              >TIP</a
            >
            <a
              href="/knowledge-base.html"
              target="_blank"
              rel="noopener noreferrer"
              class="mobile-dropdown-item"
              >BANK</a
            >
          </div>
        </div>

        <!-- â“ MOBILE HELP BOTTOM SHEET -->
        <div class="mobile-help-overlay" id="mobileHelpOverlay"></div>
        <div class="mobile-help-sheet" id="mobileHelpSheet">
          <div class="mobile-help-handle"></div>
          <div class="mobile-help-header">
            <span class="mobile-help-title">Baglantilar</span>
          </div>
          <a
            href="https://www.ailydian.com"
            target="_blank"
            rel="noopener noreferrer"
            class="mobile-help-item"
          >
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
            </svg>
            <div class="mobile-help-item-text">
              <span class="mobile-help-item-label">Projeler</span>
              <span class="mobile-help-item-url">ailydian.com</span>
            </div>
            <svg
              class="mobile-help-arrow"
              viewBox="0 0 24 24"
              width="16"
              height="16"
              fill="currentColor"
            >
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z" />
            </svg>
          </a>
          <a
            href="https://www.ailydian.com/api-reference"
            target="_blank"
            rel="noopener noreferrer"
            class="mobile-help-item"
          >
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
              <path
                d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"
              />
            </svg>
            <div class="mobile-help-item-text">
              <span class="mobile-help-item-label">API Docs</span>
              <span class="mobile-help-item-url">api-reference</span>
            </div>
            <svg
              class="mobile-help-arrow"
              viewBox="0 0 24 24"
              width="16"
              height="16"
              fill="currentColor"
            >
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z" />
            </svg>
          </a>
          <a
            href="https://www.ailydian.com/privacy"
            target="_blank"
            rel="noopener noreferrer"
            class="mobile-help-item"
          >
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
              <path
                d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"
              />
            </svg>
            <div class="mobile-help-item-text">
              <span class="mobile-help-item-label">Gizlilik</span>
              <span class="mobile-help-item-url">privacy</span>
            </div>
            <svg
              class="mobile-help-arrow"
              viewBox="0 0 24 24"
              width="16"
              height="16"
              fill="currentColor"
            >
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z" />
            </svg>
          </a>
          <a
            href="https://www.ailydian.com/status"
            target="_blank"
            rel="noopener noreferrer"
            class="mobile-help-item"
          >
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
              <path
                d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM10 17l-3.5-3.5 1.41-1.41L10 14.17l4.59-4.59L16 11l-6 6z"
              />
            </svg>
            <div class="mobile-help-item-text">
              <span class="mobile-help-item-label">Durum</span>
              <span class="mobile-help-item-url">status</span>
            </div>
            <svg
              class="mobile-help-arrow"
              viewBox="0 0 24 24"
              width="16"
              height="16"
              fill="currentColor"
            >
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z" />
            </svg>
          </a>
        </div>

        <!-- ðŸ“± MOBILE SIDEBAR OVERLAY -->
        <div class="mobile-sidebar-overlay" id="mobileSidebarOverlay"></div>

        <!-- ðŸ“± MOBILE SIDEBAR MENU (ChatGPT Style - Slide from LEFT) -->
        <div class="mobile-sidebar" id="mobileSidebar">
          <!-- Header -->
          <div class="mobile-sidebar-header">
            <div class="mobile-sidebar-logo">
              <svg
                class="logo-icon"
                viewBox="0 0 512 512"
                width="30"
                height="30"
                fill="none"
                stroke="currentColor"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <circle cx="256" cy="256" r="230" stroke-width="6" />
                <circle cx="256" cy="256" r="210" stroke-width="4" />
                <g stroke-width="5">
                  <path d="M 256 80 Q 245 100, 250 120" stroke-linecap="round" />
                  <path d="M 230 110 Q 210 105, 195 120 Q 188 135, 200 150 Q 215 160, 232 148 Z" />
                  <path d="M 275 105 Q 295 100, 310 115 Q 317 130, 305 145 Q 290 155, 273 143 Z" />
                  <path d="M 253 95 Q 265 90, 275 100 Q 280 110, 272 120 Q 263 125, 255 118 Z" />
                  <circle cx="256" cy="160" r="24" />
                  <circle cx="220" cy="200" r="23" />
                  <circle cx="256" cy="205" r="23" />
                  <circle cx="292" cy="200" r="23" />
                  <circle cx="190" cy="245" r="22" />
                  <circle cx="230" cy="250" r="22" />
                  <circle cx="282" cy="250" r="22" />
                  <circle cx="322" cy="245" r="22" />
                  <circle cx="218" cy="295" r="21" />
                  <circle cx="256" cy="300" r="21" />
                  <circle cx="294" cy="295" r="21" />
                  <circle cx="235" cy="340" r="20" />
                  <circle cx="277" cy="340" r="20" />
                  <circle cx="256" cy="380" r="19" />
                </g>
              </svg>
              <span class="mobile-sidebar-logo-text">LyDian</span>
            </div>
            <button class="mobile-sidebar-close" id="mobileSidebarClose" aria-label="MenÃ¼yÃ¼ kapat">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
          </div>

          <!-- New Chat Button -->
          <button class="mobile-new-chat-btn" id="mobileNewChatBtn">
            <svg viewBox="0 0 24 24" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span>Yeni Sohbet</span>
          </button>

          <!-- Chat Search -->
          <div class="mobile-chat-search">
            <svg
              viewBox="0 0 24 24"
              width="16"
              height="16"
              fill="currentColor"
              class="mobile-search-icon"
            >
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
              />
            </svg>
            <input
              type="text"
              id="mobileChatSearch"
              placeholder="Sohbetlerde ara..."
              autocomplete="off"
            />
          </div>

          <!-- Chat History -->
          <div class="mobile-chat-history" id="mobileChatHistory">
            <!-- Chat items will be dynamically added here -->
          </div>

          <!-- Footer with Actions -->
          <div class="mobile-sidebar-footer">
            <div class="mobile-menu-item" id="menuDownload">
              <svg viewBox="0 0 24 24" width="18" height="18">
                <path
                  fill="currentColor"
                  d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"
                ></path>
              </svg>
              <span>Sohbeti Ä°ndir</span>
            </div>
            <div class="mobile-menu-item" id="menuShare">
              <svg viewBox="0 0 24 24" width="18" height="18">
                <path
                  fill="currentColor"
                  d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"
                ></path>
              </svg>
              <span>Sohbeti PaylaÅŸ</span>
            </div>
            <div class="mobile-sidebar-user" id="mobileUserProfile">
              <div class="mobile-sidebar-user-avatar">U</div>
              <span class="mobile-sidebar-user-name">KullanÄ±cÄ±</span>
            </div>
          </div>
        </div>

        <!-- ðŸ” CHAT AUTH PANEL OVERLAY -->
        <div class="chat-auth-overlay" id="chatAuthOverlay">
          <!-- BÄ°RLEÅžÄ°K AUTH PANELÄ° (ChatGPT Style) -->
          <div class="chat-auth-panel" id="chatAuthMainPanel">
            <button class="auth-close-btn" onclick="ChatAuth.closePanel()" aria-label="Kapat">
              <svg viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>

            <!-- ADIM 1: Sosyal + Email -->
            <div class="auth-step active" id="authStep1">
              <h2 class="auth-title">Oturum aÃ§ veya kaydol</h2>
              <p class="auth-subtitle">
                Sohbet geÃ§miÅŸinizi kaydedin, kiÅŸiselleÅŸtirilmiÅŸ Ã¶neriler alÄ±n ve daha fazlasÄ±nÄ±
                keÅŸfedin.
              </p>

              <button
                type="button"
                class="auth-social-btn"
                onclick="ChatAuth.socialLogin('google')"
              >
                <svg viewBox="0 0 24 24">
                  <path
                    d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"
                    fill="#4285F4"
                  />
                  <path
                    d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                    fill="#34A853"
                  />
                  <path
                    d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                    fill="#FBBC05"
                  />
                  <path
                    d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                    fill="#EA4335"
                  />
                </svg>
                Google ile devam et
              </button>

              <button type="button" class="auth-social-btn" onclick="ChatAuth.openPhoneLogin()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <rect x="5" y="2" width="14" height="20" rx="2" ry="2" />
                  <line x1="12" y1="18" x2="12.01" y2="18" />
                </svg>
                Telefonla devam et
              </button>

              <div class="auth-divider"><span>YA DA</span></div>

              <div class="auth-input-group">
                <input
                  type="email"
                  class="auth-input"
                  id="authEmailInput"
                  placeholder="E-posta adresi"
                  autocomplete="email"
                  required
                />
              </div>

              <div class="auth-error-msg" id="authStep1Error"></div>

              <button
                type="button"
                class="auth-btn-primary"
                id="authContinueBtn"
                onclick="ChatAuth.handleEmailContinue()"
              >
                Devam
              </button>
            </div>

            <!-- ADIM 2a: Giris (email kayitli) -->
            <div class="auth-step" id="authStep2Login">
              <h2 class="auth-title">HoÅŸ geldiniz</h2>

              <div class="auth-email-display">
                <span class="auth-email-text" id="authLoginEmailDisplay"></span>
                <button type="button" class="auth-email-edit" onclick="ChatAuth.goBackToStep1()">
                  Duzenle
                </button>
              </div>

              <div class="auth-input-group">
                <div class="auth-password-wrapper">
                  <input
                    type="password"
                    class="auth-input"
                    id="authLoginPassword"
                    placeholder="Sifre"
                    autocomplete="current-password"
                    required
                  />
                  <button
                    type="button"
                    class="auth-password-toggle"
                    onclick="ChatAuth.togglePasswordVisibility('authLoginPassword', this)"
                  >
                    <svg viewBox="0 0 24 24">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                  </button>
                </div>
              </div>

              <div class="auth-error-msg" id="authStep2LoginError"></div>

              <button
                type="button"
                class="auth-btn-secondary"
                id="authLoginBtn"
                onclick="ChatAuth.handleLoginSubmit()"
              >
                Devam et
              </button>

              <div class="auth-divider"><span>YA DA</span></div>

              <button type="button" class="auth-link-btn" onclick="ChatAuth.openPanel('forgot')">
                Sifremi unuttum
              </button>

              <div class="auth-footer">
                <a href="/terms.html" target="_blank">KullanÄ±m ÅžartlarÄ±</a>
                <div class="auth-footer-sep"></div>
                <a href="/privacy.html" target="_blank">Gizlilik PolitikasÄ±</a>
              </div>
            </div>

            <!-- ADIM 2b: Kayit (yeni email) -->
            <div class="auth-step" id="authStep2Register">
              <h2 class="auth-title">HesabÄ±nÄ±zÄ± oluÅŸturun</h2>

              <div class="auth-email-display">
                <span class="auth-email-text" id="authRegisterEmailDisplay"></span>
                <button type="button" class="auth-email-edit" onclick="ChatAuth.goBackToStep1()">
                  Duzenle
                </button>
              </div>

              <div class="auth-input-group">
                <input
                  type="text"
                  class="auth-input"
                  id="authRegisterName"
                  placeholder="Ad Soyad"
                  autocomplete="name"
                  required
                  minlength="2"
                  maxlength="100"
                />
              </div>

              <div class="auth-input-group">
                <div class="auth-password-wrapper">
                  <input
                    type="password"
                    class="auth-input"
                    id="authRegisterPassword"
                    placeholder="Sifre (en az 8 karakter)"
                    autocomplete="new-password"
                    required
                    minlength="8"
                  />
                  <button
                    type="button"
                    class="auth-password-toggle"
                    onclick="ChatAuth.togglePasswordVisibility('authRegisterPassword', this)"
                  >
                    <svg viewBox="0 0 24 24">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                  </button>
                </div>
                <div class="password-strength" id="authRegisterStrength">
                  <div class="password-strength-bar"></div>
                </div>
              </div>

              <div class="auth-input-group">
                <div class="auth-password-wrapper">
                  <input
                    type="password"
                    class="auth-input"
                    id="authRegisterPasswordConfirm"
                    placeholder="Sifre tekrar"
                    autocomplete="new-password"
                    required
                  />
                  <button
                    type="button"
                    class="auth-password-toggle"
                    onclick="ChatAuth.togglePasswordVisibility('authRegisterPasswordConfirm', this)"
                  >
                    <svg viewBox="0 0 24 24">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                  </button>
                </div>
              </div>

              <div class="auth-error-msg" id="authStep2RegisterError"></div>

              <button
                type="button"
                class="auth-btn-secondary"
                id="authRegisterBtn"
                onclick="ChatAuth.handleRegisterSubmit()"
              >
                Hesap oluÅŸtur
              </button>

              <div class="auth-footer">
                <a href="/terms.html" target="_blank">KullanÄ±m ÅžartlarÄ±</a>
                <div class="auth-footer-sep"></div>
                <a href="/privacy.html" target="_blank">Gizlilik PolitikasÄ±</a>
              </div>
            </div>
          </div>

          <!-- TELEFON GÄ°RÄ°Åž PANELÄ° -->
          <div class="chat-auth-panel" id="chatAuthPhonePanel">
            <button class="auth-close-btn" onclick="ChatAuth.closePanel()" aria-label="Kapat">
              <svg viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>

            <div class="auth-step active" id="phoneStep1">
              <h2 class="auth-title">Telefon ile giriÅŸ</h2>
              <p class="auth-subtitle">Telefon numaranÄ±za bir doÄŸrulama kodu gÃ¶ndereceÄŸiz.</p>

              <div class="auth-phone-input-row">
                <select class="auth-country-code" id="phoneCountryCode">
                  <option value="+90" selected>+90</option>
                  <option value="+1">+1</option>
                  <option value="+44">+44</option>
                  <option value="+49">+49</option>
                  <option value="+33">+33</option>
                  <option value="+34">+34</option>
                  <option value="+39">+39</option>
                  <option value="+81">+81</option>
                  <option value="+82">+82</option>
                  <option value="+86">+86</option>
                  <option value="+91">+91</option>
                  <option value="+7">+7</option>
                  <option value="+55">+55</option>
                  <option value="+61">+61</option>
                  <option value="+966">+966</option>
                  <option value="+971">+971</option>
                </select>
                <input
                  type="tel"
                  class="auth-input"
                  id="phoneNumberInput"
                  placeholder="5XX XXX XX XX"
                  autocomplete="tel"
                  inputmode="numeric"
                />
              </div>

              <div class="auth-error-msg" id="phoneStep1Error"></div>

              <button type="button" class="auth-btn-primary" onclick="ChatAuth.sendPhoneOTP()">
                Kod gÃ¶nder
              </button>
            </div>

            <div class="auth-step" id="phoneStep2">
              <h2 class="auth-title">DoÄŸrulama kodu</h2>
              <p class="auth-subtitle">Telefonunuza gÃ¶nderilen 6 haneli kodu girin.</p>

              <div class="auth-otp-row">
                <input
                  type="text"
                  class="auth-otp-digit"
                  maxlength="1"
                  inputmode="numeric"
                  pattern="[0-9]"
                />
                <input
                  type="text"
                  class="auth-otp-digit"
                  maxlength="1"
                  inputmode="numeric"
                  pattern="[0-9]"
                />
                <input
                  type="text"
                  class="auth-otp-digit"
                  maxlength="1"
                  inputmode="numeric"
                  pattern="[0-9]"
                />
                <input
                  type="text"
                  class="auth-otp-digit"
                  maxlength="1"
                  inputmode="numeric"
                  pattern="[0-9]"
                />
                <input
                  type="text"
                  class="auth-otp-digit"
                  maxlength="1"
                  inputmode="numeric"
                  pattern="[0-9]"
                />
                <input
                  type="text"
                  class="auth-otp-digit"
                  maxlength="1"
                  inputmode="numeric"
                  pattern="[0-9]"
                />
              </div>

              <div class="auth-error-msg" id="phoneStep2Error"></div>

              <button type="button" class="auth-btn-primary" onclick="ChatAuth.verifyPhoneOTP()">
                DoÄŸrula
              </button>

              <button
                type="button"
                class="auth-link-btn"
                id="phoneResendBtn"
                onclick="ChatAuth.resendPhoneOTP()"
                disabled
              >
                Kodu tekrar gÃ¶nder (60s)
              </button>
            </div>
          </div>

          <!-- ÅžÄ°FREMÄ° UNUTTUM PANELÄ° -->
          <div class="chat-auth-panel" id="chatAuthForgotPanel">
            <div class="chat-auth-header">
              <button class="chat-auth-back" onclick="ChatAuth.openPanel('main')" aria-label="Geri">
                <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
              </button>
              <h2>Åžifremi Unuttum</h2>
              <button class="chat-auth-close" onclick="ChatAuth.closePanel()" aria-label="Kapat">
                <svg viewBox="0 0 24 24">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <form class="chat-auth-form" id="chatAuthForgotForm">
              <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem; margin-bottom: 0.5rem">
                E-posta adresinizi girin, ÅŸifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± gÃ¶ndereceÄŸiz.
              </p>
              <div class="chat-auth-field">
                <label for="forgotEmail">E-posta</label>
                <input
                  type="email"
                  id="forgotEmail"
                  name="email"
                  required
                  autocomplete="email"
                  placeholder="ornek@email.com"
                />
              </div>
              <button type="submit" class="chat-auth-btn">SÄ±fÄ±rlama BaÄŸlantÄ±sÄ± GÃ¶nder</button>
              <div class="chat-auth-links" style="justify-content: center">
                <a
                  href="#"
                  onclick="
                    ChatAuth.openPanel('main');
                    return false;
                  "
                  >GiriÅŸ Yap'a DÃ¶n</a
                >
              </div>
            </form>
          </div>

          <!-- ÅžÄ°FRE SIFIRLAMA PANELÄ° -->
          <div class="chat-auth-panel" id="chatAuthResetPanel">
            <div class="chat-auth-header">
              <div class="chat-auth-header-spacer"></div>
              <h2>Yeni Åžifre Belirle</h2>
              <button class="chat-auth-close" onclick="ChatAuth.closePanel()" aria-label="Kapat">
                <svg viewBox="0 0 24 24">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <form class="chat-auth-form" id="chatAuthResetForm">
              <div class="chat-auth-field">
                <label for="resetPassword">Yeni Åžifre</label>
                <input
                  type="password"
                  id="resetPassword"
                  name="password"
                  required
                  minlength="8"
                  autocomplete="new-password"
                  placeholder="En az 8 karakter"
                />
                <div class="password-strength" id="resetPasswordStrength">
                  <div class="password-strength-bar"></div>
                </div>
              </div>
              <div class="chat-auth-field">
                <label for="resetPasswordConfirm">Åžifre Tekrar</label>
                <input
                  type="password"
                  id="resetPasswordConfirm"
                  name="confirmPassword"
                  required
                  autocomplete="new-password"
                  placeholder="Åžifreyi tekrar girin"
                />
              </div>
              <input type="hidden" id="resetToken" name="token" value="" />
              <button type="submit" class="chat-auth-btn">Åžifreyi GÃ¼ncelle</button>
            </form>
          </div>

          <!-- PROFÄ°L PANELÄ° -->
          <div class="chat-auth-panel" id="chatAuthProfilePanel">
            <div class="chat-auth-header">
              <div class="chat-auth-header-spacer"></div>
              <h2>Profil</h2>
              <button class="chat-auth-close" onclick="ChatAuth.closePanel()" aria-label="Kapat">
                <svg viewBox="0 0 24 24">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div class="chat-auth-profile-header">
              <div class="chat-auth-avatar" id="profileAvatar">U</div>
              <div class="chat-auth-profile-name" id="profileName">KullanÄ±cÄ±</div>
              <div class="chat-auth-profile-email" id="profileEmail">user@example.com</div>
            </div>
            <div class="chat-auth-menu">
              <button class="chat-auth-menu-item" onclick="ChatAuth.openPanel('settings')">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
                  ></path>
                </svg>
                Ayarlar
              </button>
              <button
                class="chat-auth-menu-item"
                onclick="
                  ChatAuth.openPanel('settings');
                  setTimeout(function () {
                    switchSettingsTab(
                      'guvenlik',
                      document.querySelector('.settings-tab-btn:last-child')
                    );
                  }, 100);
                "
              >
                <svg viewBox="0 0 24 24">
                  <path
                    d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"
                  ></path>
                </svg>
                GÃ¼venlik
              </button>
              <div
                style="height: 1px; background: rgba(255, 255, 255, 0.08); margin: 0.5rem 0"
              ></div>
              <button class="chat-auth-menu-item danger" onclick="ChatAuth.logout()">
                <svg viewBox="0 0 24 24">
                  <path
                    d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
                  ></path>
                </svg>
                Ã‡Ä±kÄ±ÅŸ Yap
              </button>
            </div>
          </div>

          <!-- AYARLAR PANELÄ° -->
          <div class="chat-auth-panel chat-auth-panel--drawer" id="chatAuthSettingsPanel">
            <div class="chat-auth-header">
              <button
                class="chat-auth-back"
                onclick="ChatAuth.openPanel('profile')"
                aria-label="Geri"
              >
                <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
              </button>
              <h2>Ayarlar</h2>
              <button class="chat-auth-close" onclick="ChatAuth.closePanel()" aria-label="Kapat">
                <svg viewBox="0 0 24 24">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div class="chat-auth-drawer-body">
              <!-- Tab Navigation -->
              <div class="settings-tab-bar">
                <button class="settings-tab-btn active" onclick="switchSettingsTab('profil', this)">
                  Profil
                </button>
                <button class="settings-tab-btn" onclick="switchSettingsTab('gorunum', this)">
                  GÃ¶rÃ¼nÃ¼m
                </button>
                <button class="settings-tab-btn" onclick="switchSettingsTab('ai', this)">AI</button>
                <button class="settings-tab-btn" onclick="switchSettingsTab('gizlilik', this)">
                  Gizlilik & Veri
                </button>
                <button class="settings-tab-btn" onclick="switchSettingsTab('guvenlik', this)">
                  GÃ¼venlik
                </button>
              </div>

              <!-- TAB: Profil -->
              <div class="settings-tab-content active" id="settingsTabProfil">
                <div class="chat-auth-settings">
                  <div class="chat-auth-section-title">
                    <svg viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                      />
                    </svg>
                    Profil
                  </div>
                  <div class="chat-auth-profile-edit">
                    <div class="chat-auth-avatar-edit">
                      <div class="chat-auth-avatar-large" id="settingsAvatar">U</div>
                      <div class="chat-auth-avatar-actions">
                        <button onclick="ChatAuth.uploadAvatar()">FotoÄŸraf YÃ¼kle</button>
                        <button onclick="ChatAuth.removeAvatar()">KaldÄ±r</button>
                      </div>
                    </div>
                    <div class="chat-auth-field" style="margin-bottom: 0">
                      <label for="settingDisplayName">GÃ¶rÃ¼nen Ad</label>
                      <input
                        type="text"
                        id="settingDisplayName"
                        placeholder="GÃ¶rÃ¼nen adÄ±nÄ±z"
                        onchange="ChatAuth.updateSetting('displayName', this.value)"
                      />
                    </div>
                  </div>

                  <!-- E-posta (read-only) -->
                  <div class="chat-auth-field" style="margin-top: 16px">
                    <label style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.5)"
                      >E-posta</label
                    >
                    <input
                      type="email"
                      id="settingEmail"
                      disabled
                      readonly
                      style="
                        opacity: 0.6;
                        cursor: not-allowed;
                        background: rgba(255, 255, 255, 0.03);
                        border: 1px solid rgba(255, 255, 255, 0.08);
                        border-radius: 8px;
                        color: #fff;
                        padding: 10px 12px;
                        font-size: 13px;
                        width: 100%;
                        box-sizing: border-box;
                      "
                      placeholder="E-posta adresiniz"
                    />
                  </div>

                  <!-- Bio / Durum -->
                  <div class="chat-auth-field" style="margin-top: 12px">
                    <label style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.5)"
                      >Bio / Durum</label
                    >
                    <textarea
                      id="settingBio"
                      class="settings-bio-textarea"
                      placeholder="Kisa bir tanitim yazisi..."
                      maxlength="160"
                      rows="2"
                      oninput="
                        var c = document.getElementById('settingBioCount');
                        if (c) c.textContent = this.value.length;
                      "
                      onchange="ChatAuth.updateCustomSetting('bio', this.value)"
                    ></textarea>
                    <div
                      style="font-size: 0.7rem; color: rgba(255, 255, 255, 0.35); margin-top: 4px"
                    >
                      <span id="settingBioCount">0</span>/160 karakter
                    </div>
                  </div>

                  <!-- Hesap OluÅŸturulma -->
                  <div class="chat-auth-field" style="margin-top: 12px">
                    <label style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.5)"
                      >Hesap OluÅŸturulma</label
                    >
                    <input
                      type="text"
                      id="settingCreatedAt"
                      disabled
                      readonly
                      style="
                        opacity: 0.6;
                        cursor: not-allowed;
                        background: rgba(255, 255, 255, 0.03);
                        border: 1px solid rgba(255, 255, 255, 0.08);
                        border-radius: 8px;
                        color: #fff;
                        padding: 10px 12px;
                        font-size: 13px;
                        width: 100%;
                        box-sizing: border-box;
                      "
                      placeholder="Bilgi yukleniyor..."
                    />
                  </div>
                </div>
              </div>
              <!-- /settingsTabProfil -->

              <!-- TAB: Gorunum -->
              <div class="settings-tab-content" id="settingsTabGorunum">
                <div class="chat-auth-settings">
                  <div class="chat-auth-section-title">
                    <svg viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
                      />
                    </svg>
                    GÃ¶rÃ¼nÃ¼m
                  </div>
                  <div class="chat-auth-settings" style="padding-top: 0">
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Tema</div>
                        <div class="chat-auth-setting-desc">ArayÃ¼z gÃ¶rÃ¼nÃ¼mÃ¼</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingTheme"
                        onchange="
                          ChatAuth.updateSetting('theme', this.value);
                          setTheme(this.value);
                        "
                      >
                        <option value="dark">Koyu</option>
                        <option value="light">Acik</option>
                        <option value="system">Sistem</option>
                      </select>
                    </div>
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Dil</div>
                        <div class="chat-auth-setting-desc">ArayÃ¼z dili</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingLanguage"
                        onchange="ChatAuth.updateSetting('language', this.value)"
                      >
                        <option value="tr">Turkce</option>
                        <option value="en">English</option>
                      </select>
                    </div>

                    <!-- YazÄ± Boyutu -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">YazÄ± Boyutu</div>
                        <div class="chat-auth-setting-desc">Mesaj metni boyutu</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingFontSize"
                        onchange="ChatAuth.updateCustomSetting('fontSize', this.value)"
                      >
                        <option value="small">KÃ¼Ã§Ã¼k</option>
                        <option value="medium" selected>Orta</option>
                        <option value="large">BÃ¼yÃ¼k</option>
                      </select>
                    </div>

                    <!-- Mesaj YoÄŸunluÄŸu -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Mesaj YoÄŸunluÄŸu</div>
                        <div class="chat-auth-setting-desc">Mesajlar arasÄ± boÅŸluk</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingDensity"
                        onchange="ChatAuth.updateCustomSetting('messageDensity', this.value)"
                      >
                        <option value="compact">SÄ±kÄ±ÅŸtÄ±rmalÄ±</option>
                        <option value="comfortable" selected>Rahat</option>
                        <option value="spacious">GeniÅŸ</option>
                      </select>
                    </div>

                    <!-- Sohbet GeniÅŸliÄŸi -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Sohbet GeniÅŸliÄŸi</div>
                        <div class="chat-auth-setting-desc">Mesaj alanÄ± geniÅŸliÄŸi</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingChatWidth"
                        onchange="ChatAuth.updateCustomSetting('chatWidth', this.value)"
                      >
                        <option value="narrow">Dar</option>
                        <option value="medium" selected>Orta</option>
                        <option value="wide">GeniÅŸ</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /settingsTabGorunum -->

              <!-- TAB: AI -->
              <div class="settings-tab-content" id="settingsTabAI">
                <div class="chat-auth-settings">
                  <div class="chat-auth-section-title">
                    <svg viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                      />
                    </svg>
                    AI Tercihleri
                  </div>
                  <div class="chat-auth-settings" style="padding-top: 0">
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Tercih Edilen Model</div>
                        <div class="chat-auth-setting-desc">VarsayÄ±lan AI modeli</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingModel"
                        onchange="ChatAuth.updateSetting('preferredModel', this.value)"
                      >
                        <option value="premium">Premium</option>
                        <option value="standard">Standart</option>
                        <option value="fast">Hizli</option>
                      </select>
                    </div>
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">GeÃ§miÅŸi Otomatik Kaydet</div>
                        <div class="chat-auth-setting-desc">Sohbetleri otomatik kaydet</div>
                      </div>
                      <div
                        class="chat-auth-toggle active"
                        id="settingAutoSave"
                        onclick="ChatAuth.toggleSetting('autoSaveHistory', this)"
                      ></div>
                    </div>

                    <!-- YanÄ±t UzunluÄŸu -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">YanÄ±t UzunluÄŸu</div>
                        <div class="chat-auth-setting-desc">AI yanÄ±tlarÄ±nÄ±n uzunluÄŸu</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingResponseLength"
                        onchange="ChatAuth.updateCustomSetting('responseLength', this.value)"
                      >
                        <option value="short">KÄ±sa</option>
                        <option value="medium" selected>Orta</option>
                        <option value="long">Uzun</option>
                      </select>
                    </div>

                    <!-- KonuÅŸma HafÄ±zasÄ± -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">KonuÅŸma HafÄ±zasÄ±</div>
                        <div class="chat-auth-setting-desc">AI Ã¶nceki mesajlarÄ± hatÄ±rlasÄ±n</div>
                      </div>
                      <div
                        class="chat-auth-toggle active"
                        id="settingConversationMemory"
                        onclick="ChatAuth.toggleCustomSetting('conversationMemory', this)"
                      ></div>
                    </div>

                    <!-- AI YanÄ±t Dili -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">AI YanÄ±t Dili</div>
                        <div class="chat-auth-setting-desc">AI hangi dilde yanÄ±tlasÄ±n</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingAiLanguage"
                        onchange="ChatAuth.updateCustomSetting('aiLanguage', this.value)"
                      >
                        <option value="tr" selected>TÃ¼rkÃ§e</option>
                        <option value="en">English</option>
                        <option value="auto">Otomatik</option>
                      </select>
                    </div>

                    <!-- Kod TemasÄ± -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Kod TemasÄ±</div>
                        <div class="chat-auth-setting-desc">Kod bloklarÄ± iÃ§in renk ÅŸemasÄ±</div>
                      </div>
                      <select
                        class="chat-auth-select"
                        id="settingCodeTheme"
                        onchange="ChatAuth.updateCustomSetting('codeTheme', this.value)"
                      >
                        <option value="github-dark" selected>GitHub Dark</option>
                        <option value="monokai">Monokai</option>
                        <option value="dracula">Dracula</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /settingsTabAI -->

              <!-- TAB: Gizlilik & Veri -->
              <div class="settings-tab-content" id="settingsTabGizlilik">
                <div class="chat-auth-settings">
                  <!-- Notifications Section -->
                  <div class="chat-auth-section-title">
                    <svg viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                      />
                    </svg>
                    Bildirimler
                  </div>
                  <div class="chat-auth-settings" style="padding-top: 0">
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Push Bildirimleri</div>
                        <div class="chat-auth-setting-desc">TarayÄ±cÄ± bildirimleri al</div>
                      </div>
                      <div
                        class="chat-auth-toggle"
                        id="settingNotifications"
                        onclick="ChatAuth.toggleSetting('notificationsEnabled', this)"
                      ></div>
                    </div>
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">E-posta Bildirimleri</div>
                        <div class="chat-auth-setting-desc">
                          Ã–nemli gÃ¼ncellemeler iÃ§in e-posta al
                        </div>
                      </div>
                      <div
                        class="chat-auth-toggle"
                        id="settingEmailNotifications"
                        onclick="ChatAuth.toggleSetting('emailNotifications', this)"
                      ></div>
                    </div>
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Sesler</div>
                        <div class="chat-auth-setting-desc">ArayÃ¼z seslerini etkinleÅŸtir</div>
                      </div>
                      <div
                        class="chat-auth-toggle"
                        id="settingSounds"
                        onclick="ChatAuth.toggleSetting('soundEnabled', this)"
                      ></div>
                    </div>
                  </div>

                  <!-- Privacy Section -->
                  <div class="chat-auth-section-title">
                    <svg viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                      />
                    </svg>
                    Gizlilik
                  </div>
                  <div class="chat-auth-settings" style="padding-top: 0">
                    <div class="chat-auth-privacy-row">
                      <div class="chat-auth-privacy-info">
                        <div class="chat-auth-privacy-label">Sohbet GeÃ§miÅŸini Kullan</div>
                        <div class="chat-auth-privacy-desc">
                          AI'nÄ±n Ã¶nceki sohbetlerden Ã¶ÄŸrenmesine izin ver
                        </div>
                      </div>
                      <div
                        class="chat-auth-toggle active"
                        id="settingUseHistory"
                        onclick="ChatAuth.toggleSetting('useHistory', this)"
                      ></div>
                    </div>
                    <div class="chat-auth-privacy-row">
                      <div class="chat-auth-privacy-info">
                        <div class="chat-auth-privacy-label">Analitik</div>
                        <div class="chat-auth-privacy-desc">Anonim kullanÄ±m verilerini paylaÅŸ</div>
                      </div>
                      <div
                        class="chat-auth-toggle"
                        id="settingAnalytics"
                        onclick="ChatAuth.toggleSetting('analytics', this)"
                      ></div>
                    </div>
                  </div>

                  <!-- Chat History Management -->
                  <div class="chat-auth-section-title">
                    <svg viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
                      />
                    </svg>
                    Sohbet GeÃ§miÅŸi
                  </div>
                  <div class="chat-auth-settings" style="padding-top: 0">
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Sohbetleri DÄ±ÅŸa Aktar</div>
                        <div class="chat-auth-setting-desc">
                          TÃ¼m sohbet geÃ§miÅŸini JSON olarak indir
                        </div>
                      </div>
                      <button class="chat-auth-export-btn" onclick="ChatAuth.exportChatHistory()">
                        <svg
                          viewBox="0 0 24 24"
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />
                        </svg>
                        Indir
                      </button>
                    </div>
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">TÃ¼m Sohbetleri Sil</div>
                        <div class="chat-auth-setting-desc">
                          TÃ¼m sohbet geÃ§miÅŸini kalÄ±cÄ± olarak sil
                        </div>
                      </div>
                      <button class="chat-auth-danger-btn-sm" onclick="ChatAuth.deleteAllChats()">
                        <svg
                          viewBox="0 0 24 24"
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                          />
                        </svg>
                        Sil
                      </button>
                    </div>
                  </div>

                  <!-- Veri YÃ¶netimi Section -->
                  <div class="chat-auth-section-title" style="margin-top: 16px">
                    <svg
                      viewBox="0 0 24 24"
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Veri YÃ¶netimi
                  </div>
                  <div class="chat-auth-settings" style="padding-top: 0">
                    <!-- Export All Data (KVKK/GDPR) -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">TÃ¼m Verilerimi Ä°ndir</div>
                        <div class="chat-auth-setting-desc">
                          HesabÄ±nÄ±za ait tÃ¼m verileri indirin (KVKK)
                        </div>
                      </div>
                      <button class="chat-auth-export-btn" onclick="ChatAuth.exportAllData()">
                        <svg
                          viewBox="0 0 24 24"
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />
                        </svg>
                        Ä°ndir
                      </button>
                    </div>

                    <!-- Clear Search History -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">Arama GeÃ§miÅŸini Temizle</div>
                        <div class="chat-auth-setting-desc">Web arama geÃ§miÅŸinizi silin</div>
                      </div>
                      <button
                        class="chat-auth-danger-btn-sm"
                        onclick="ChatAuth.clearSearchHistory()"
                      >
                        Temizle
                      </button>
                    </div>

                    <!-- Account Deactivation -->
                    <div class="chat-auth-setting-row">
                      <div>
                        <div class="chat-auth-setting-label">HesabÄ± Dondur</div>
                        <div class="chat-auth-setting-desc">GeÃ§ici olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±n</div>
                      </div>
                      <button
                        class="chat-auth-warning-btn-sm"
                        onclick="ChatAuth.deactivateAccount()"
                      >
                        Dondur
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <!-- /settingsTabGizlilik -->

              <!-- TAB: GÃ¼venlik -->
              <div class="settings-tab-content" id="settingsTabGuvenlik">
                <!-- Security Status -->
                <div class="chat-auth-security-status warning" id="securityStatusSettings">
                  <div class="chat-auth-security-icon">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                      />
                    </svg>
                  </div>
                  <div class="chat-auth-security-info">
                    <div class="chat-auth-security-title">GÃ¼venlik Durumu: Ä°yi</div>
                    <div class="chat-auth-security-desc">
                      2FA aktif deÄŸil - HesabÄ±nÄ±zÄ± korumak iÃ§in etkinleÅŸtirin
                    </div>
                  </div>
                </div>

                <!-- 2FA Section -->
                <div class="chat-auth-section-title">
                  <svg viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
                    />
                  </svg>
                  Ä°ki FaktÃ¶rlÃ¼ DoÄŸrulama
                </div>
                <div class="chat-auth-2fa-card">
                  <div class="chat-auth-2fa-header">
                    <div class="chat-auth-2fa-title">2FA ile Ekstra Koruma</div>
                    <div class="chat-auth-2fa-status" id="2faStatusSettings">Pasif</div>
                  </div>
                  <div class="chat-auth-2fa-desc">
                    Ä°ki faktÃ¶rlÃ¼ doÄŸrulama, hesabÄ±nÄ±za ekstra bir gÃ¼venlik katmanÄ± ekler.
                  </div>
                  <button
                    class="chat-auth-2fa-btn"
                    id="2faBtnSettings"
                    onclick="ChatAuth.setup2FA()"
                  >
                    2FA'yÄ± EtkinleÅŸtir
                  </button>
                </div>

                <!-- Google Account Link -->
                <div class="chat-auth-section-title">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                    />
                  </svg>
                  BaÄŸlÄ± Hesaplar
                </div>
                <div class="chat-auth-settings" style="padding-top: 0">
                  <div class="chat-auth-setting-row" id="googleLinkRowSettings">
                    <div style="display: flex; align-items: center; gap: 10px">
                      <svg width="18" height="18" viewBox="0 0 24 24">
                        <path
                          d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"
                          fill="#4285F4"
                        />
                        <path
                          d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                          fill="#34A853"
                        />
                        <path
                          d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                          fill="#FBBC05"
                        />
                        <path
                          d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                          fill="#EA4335"
                        />
                      </svg>
                      <div>
                        <div class="chat-auth-setting-label">Google Hesabi</div>
                        <div class="chat-auth-setting-desc" id="googleLinkStatusSettings">
                          BaÄŸlÄ± deÄŸil
                        </div>
                      </div>
                    </div>
                    <button
                      class="chat-auth-export-btn"
                      id="googleLinkBtnSettings"
                      onclick="ChatAuth.linkGoogle()"
                      style="font-size: 0.75rem"
                    >
                      Bagla
                    </button>
                  </div>
                </div>

                <!-- Password Change -->
                <div class="chat-auth-section-title">
                  <svg viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"
                    />
                  </svg>
                  Åžifre
                </div>
                <form
                  class="chat-auth-form"
                  id="chatAuthChangePasswordFormSettings"
                  style="padding: 0 1.25rem"
                  onsubmit="
                    event.preventDefault();
                    ChatAuth.changePassword();
                  "
                >
                  <div class="chat-auth-field">
                    <label for="currentPasswordSettings">Mevcut Åžifre</label>
                    <input
                      type="password"
                      id="currentPasswordSettings"
                      name="currentPassword"
                      required
                      autocomplete="current-password"
                      placeholder="Mevcut ÅŸifreniz"
                    />
                  </div>
                  <div class="chat-auth-field">
                    <label for="newPasswordSettings">Yeni Åžifre</label>
                    <input
                      type="password"
                      id="newPasswordSettings"
                      name="newPassword"
                      required
                      minlength="8"
                      autocomplete="new-password"
                      placeholder="En az 8 karakter"
                      oninput="ChatAuth.checkPasswordStrength(this.value)"
                    />
                    <div class="password-strength" id="newPasswordStrengthSettings">
                      <div class="password-strength-bar"></div>
                    </div>
                  </div>
                  <div class="chat-auth-field">
                    <label for="newPasswordConfirmSettings">Yeni Åžifre Tekrar</label>
                    <input
                      type="password"
                      id="newPasswordConfirmSettings"
                      name="newPasswordConfirm"
                      required
                      autocomplete="new-password"
                      placeholder="Yeni ÅŸifreyi tekrar girin"
                    />
                  </div>
                  <button type="submit" class="chat-auth-btn">Sifreyi Guncelle</button>
                </form>

                <!-- Active Sessions -->
                <div class="chat-auth-section-title" style="margin-top: 1rem">
                  <svg viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                    />
                  </svg>
                  Aktif Oturumlar
                </div>
                <div class="chat-auth-sessions" id="activeSessionsSettings">
                  <div class="chat-auth-session current">
                    <div class="chat-auth-session-icon">PC</div>
                    <div class="chat-auth-session-info">
                      <div class="chat-auth-session-device">
                        Bu Cihaz <span class="current-badge">Aktif</span>
                      </div>
                      <div class="chat-auth-session-details">Chrome - Su an aktif</div>
                    </div>
                  </div>
                </div>
                <div style="padding: 0.5rem 1.25rem">
                  <button
                    class="chat-auth-danger-btn"
                    onclick="ChatAuth.logoutAllSessions()"
                    style="font-size: 0.8rem; padding: 10px"
                  >
                    TÃ¼m OturumlarÄ± Kapat
                  </button>
                </div>

                <!-- Login History -->
                <div class="chat-auth-section-title">
                  <svg viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  Son GiriÅŸ Aktivitesi
                </div>
                <div class="chat-auth-settings" style="padding-top: 0">
                  <div class="chat-auth-setting-row" id="lastLoginInfoSettings">
                    <div>
                      <div class="chat-auth-setting-label">Son GiriÅŸ</div>
                      <div class="chat-auth-setting-desc" id="lastLoginTimeSettings">
                        Bilgi yÃ¼kleniyor...
                      </div>
                    </div>
                    <span
                      style="color: rgba(255, 255, 255, 0.5); font-size: 0.8rem"
                      id="lastLoginLocationSettings"
                      >-</span
                    >
                  </div>
                </div>

                <!-- Danger Zone -->
                <div class="chat-auth-danger-zone">
                  <div
                    class="chat-auth-section-title"
                    style="padding: 0 0 0.75rem 0; margin: 0; color: #ef4444"
                  >
                    <svg viewBox="0 0 24 24" style="stroke: #ef4444">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                      />
                    </svg>
                    Tehlikeli BÃ¶lge
                  </div>
                  <button class="chat-auth-danger-btn" onclick="ChatAuth.confirmDeleteAccount()">
                    Hesabimi Kalici Olarak Sil
                  </button>
                  <p
                    style="
                      font-size: 0.7rem;
                      color: rgba(255, 255, 255, 0.4);
                      margin-top: 8px;
                      text-align: center;
                    "
                  >
                    Bu iÅŸlem geri alÄ±namaz. TÃ¼m verileriniz silinecektir.
                  </p>
                </div>
              </div>
              <!-- /settingsTabGuvenlik -->
            </div>
            <!-- /chat-auth-drawer-body -->
          </div>

          <!-- GÃœVENLÄ°K PANELÄ° - ENHANCED -->
          <div class="chat-auth-panel chat-auth-panel--drawer" id="chatAuthSecurityPanel">
            <div class="chat-auth-header">
              <button
                class="chat-auth-back"
                onclick="ChatAuth.openPanel('profile')"
                aria-label="Geri"
              >
                <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"></polyline></svg>
              </button>
              <h2>GÃ¼venlik</h2>
              <button class="chat-auth-close" onclick="ChatAuth.closePanel()" aria-label="Kapat">
                <svg viewBox="0 0 24 24">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div class="chat-auth-drawer-body">
              <!-- Security Status -->
              <div class="chat-auth-security-status warning" id="securityStatus">
                <div class="chat-auth-security-icon">
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                    />
                  </svg>
                </div>
                <div class="chat-auth-security-info">
                  <div class="chat-auth-security-title">GÃ¼venlik Durumu: Ä°yi</div>
                  <div class="chat-auth-security-desc">
                    2FA aktif deÄŸil - HesabÄ±nÄ±zÄ± korumak iÃ§in etkinleÅŸtirin
                  </div>
                </div>
              </div>

              <!-- 2FA Section -->
              <div class="chat-auth-section-title">
                <svg viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
                  />
                </svg>
                Ä°ki FaktÃ¶rlÃ¼ DoÄŸrulama
              </div>
              <div class="chat-auth-2fa-card">
                <div class="chat-auth-2fa-header">
                  <div class="chat-auth-2fa-title">2FA ile Ekstra Koruma</div>
                  <div class="chat-auth-2fa-status" id="2faStatus">Pasif</div>
                </div>
                <div class="chat-auth-2fa-desc">
                  Ä°ki faktÃ¶rlÃ¼ doÄŸrulama, hesabÄ±nÄ±za ekstra bir gÃ¼venlik katmanÄ± ekler. Her giriÅŸte
                  telefonunuzdaki uygulama ile doÄŸrulama yapmanÄ±z gerekir.
                </div>
                <button class="chat-auth-2fa-btn" onclick="ChatAuth.setup2FA()">
                  2FA'yÄ± EtkinleÅŸtir
                </button>
              </div>

              <!-- Google Account Link Section -->
              <div class="chat-auth-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
                  />
                </svg>
                BaÄŸlÄ± Hesaplar
              </div>
              <div class="chat-auth-settings" style="padding-top: 0">
                <div class="chat-auth-setting-row" id="googleLinkRow">
                  <div style="display: flex; align-items: center; gap: 10px">
                    <svg width="18" height="18" viewBox="0 0 24 24">
                      <path
                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"
                        fill="#4285F4"
                      />
                      <path
                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                        fill="#34A853"
                      />
                      <path
                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                        fill="#FBBC05"
                      />
                      <path
                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                        fill="#EA4335"
                      />
                    </svg>
                    <div>
                      <div class="chat-auth-setting-label">Google Hesabi</div>
                      <div class="chat-auth-setting-desc" id="googleLinkStatus">BaÄŸlÄ± deÄŸil</div>
                    </div>
                  </div>
                  <button
                    class="chat-auth-export-btn"
                    id="googleLinkBtn"
                    onclick="ChatAuth.linkGoogle()"
                    style="font-size: 0.75rem"
                  >
                    Bagla
                  </button>
                </div>
              </div>

              <!-- Password Change Section -->
              <div class="chat-auth-section-title">
                <svg viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"
                  />
                </svg>
                Åžifre
              </div>
              <form
                class="chat-auth-form"
                id="chatAuthChangePasswordForm"
                style="padding: 0 1.25rem"
              >
                <div class="chat-auth-field">
                  <label for="currentPassword">Mevcut Åžifre</label>
                  <input
                    type="password"
                    id="currentPassword"
                    name="currentPassword"
                    required
                    autocomplete="current-password"
                    placeholder="Mevcut ÅŸifreniz"
                  />
                </div>
                <div class="chat-auth-field">
                  <label for="newPassword">Yeni Åžifre</label>
                  <input
                    type="password"
                    id="newPassword"
                    name="newPassword"
                    required
                    minlength="8"
                    autocomplete="new-password"
                    placeholder="En az 8 karakter"
                    oninput="ChatAuth.checkPasswordStrength(this.value)"
                  />
                  <div class="password-strength" id="newPasswordStrength">
                    <div class="password-strength-bar"></div>
                  </div>
                  <div
                    class="chat-auth-setting-desc"
                    id="passwordStrengthText"
                    style="margin-top: 4px"
                  >
                    GÃ¼Ã§lÃ¼ ÅŸifre iÃ§in bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harf, rakam ve Ã¶zel karakter kullanÄ±n
                  </div>
                </div>
                <div class="chat-auth-field">
                  <label for="newPasswordConfirm">Yeni Åžifre Tekrar</label>
                  <input
                    type="password"
                    id="newPasswordConfirm"
                    name="newPasswordConfirm"
                    required
                    autocomplete="new-password"
                    placeholder="Yeni ÅŸifreyi tekrar girin"
                  />
                </div>
                <button type="submit" class="chat-auth-btn">Sifreyi Guncelle</button>
              </form>

              <!-- Active Sessions Section -->
              <div class="chat-auth-section-title" style="margin-top: 1rem">
                <svg viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  />
                </svg>
                Aktif Oturumlar
              </div>
              <div class="chat-auth-sessions" id="activeSessions">
                <div class="chat-auth-session current">
                  <div class="chat-auth-session-icon">PC</div>
                  <div class="chat-auth-session-info">
                    <div class="chat-auth-session-device">
                      Bu Cihaz
                      <span class="current-badge">Aktif</span>
                    </div>
                    <div class="chat-auth-session-details">Chrome â€¢ Åžu an aktif</div>
                  </div>
                </div>
                <!-- More sessions will be loaded dynamically -->
              </div>
              <div style="padding: 0.5rem 1.25rem">
                <button
                  class="chat-auth-danger-btn"
                  onclick="ChatAuth.logoutAllSessions()"
                  style="font-size: 0.8rem; padding: 10px"
                >
                  TÃ¼m OturumlarÄ± Kapat
                </button>
              </div>

              <!-- Login History -->
              <div class="chat-auth-section-title">
                <svg viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                Son GiriÅŸ Aktivitesi
              </div>
              <div class="chat-auth-settings" style="padding-top: 0">
                <div class="chat-auth-setting-row" id="lastLoginInfo">
                  <div>
                    <div class="chat-auth-setting-label">Son GiriÅŸ</div>
                    <div class="chat-auth-setting-desc" id="lastLoginTime">Bilgi yÃ¼kleniyor...</div>
                  </div>
                  <span
                    style="color: rgba(255, 255, 255, 0.5); font-size: 0.8rem"
                    id="lastLoginLocation"
                    >-</span
                  >
                </div>
              </div>

              <!-- Danger Zone -->
              <div class="chat-auth-danger-zone">
                <div
                  class="chat-auth-section-title"
                  style="padding: 0 0 0.75rem 0; margin: 0; color: #ef4444"
                >
                  <svg viewBox="0 0 24 24" style="stroke: #ef4444">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                    />
                  </svg>
                  Tehlikeli BÃ¶lge
                </div>
                <button class="chat-auth-danger-btn" onclick="ChatAuth.confirmDeleteAccount()">
                  Hesabimi Kalici Olarak Sil
                </button>
                <p
                  style="
                    font-size: 0.7rem;
                    color: rgba(255, 255, 255, 0.4);
                    margin-top: 8px;
                    text-align: center;
                  "
                >
                  Bu iÅŸlem geri alÄ±namaz. TÃ¼m verileriniz silinecektir.
                </p>
              </div>
            </div>
            <!-- /chat-auth-drawer-body -->
          </div>
        </div>
        <!-- END CHAT AUTH PANEL OVERLAY -->

        <div class="chat-header">
          <div class="header-left" style="display: flex; align-items: center; gap: 10px">
            <!-- Desktop New Chat Button - Only visible on desktop when chat is active -->
            <button class="desktop-new-chat-btn" id="desktopNewChatBtn" title="Yeni Sohbet">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
              </svg>
              <span>Yeni Sohbet</span>
            </button>
          </div>

          <!-- ChatGPT-Style Model Selector Dropdown -->
          <div
            class="header-model-selector"
            id="headerModelSelector"
            onclick="toggleModelDropdown()"
          >
            <span id="headerModelLabel">LyDian AI</span>
            <svg viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z" /></svg>
            <div class="header-model-dropdown" id="headerModelDropdown">
              <button
                class="model-dropdown-option active"
                data-header-mode="general"
                onclick="selectHeaderModel('general', this, event)"
              >
                <div
                  class="model-opt-icon"
                  style="background: rgba(99, 102, 241, 0.15); color: #818cf8"
                >
                  AI
                </div>
                <div class="model-opt-info">
                  <div class="model-opt-name">LyDian AI</div>
                  <div class="model-opt-desc">Genel sohbet ve yardim</div>
                </div>
              </button>
              <button
                class="model-dropdown-option"
                data-header-mode="deep-think"
                onclick="selectHeaderModel('deep-think', this, event)"
              >
                <div
                  class="model-opt-icon"
                  style="background: rgba(168, 85, 247, 0.15); color: #a855f7"
                >
                  DT
                </div>
                <div class="model-opt-info">
                  <div class="model-opt-name">Derin DÃ¼ÅŸÃ¼nce</div>
                  <div class="model-opt-desc">Karmasik analiz ve mantik</div>
                </div>
              </button>
              <button
                class="model-dropdown-option"
                data-header-mode="web-search"
                onclick="selectHeaderModel('web-search', this, event)"
              >
                <div
                  class="model-opt-icon"
                  style="background: rgba(14, 165, 233, 0.15); color: #0ea5e9"
                >
                  WS
                </div>
                <div class="model-opt-info">
                  <div class="model-opt-name">Web Arama</div>
                  <div class="model-opt-desc">Internetten bilgi ara</div>
                </div>
              </button>
              <button
                class="model-dropdown-option"
                data-header-mode="code-write"
                onclick="selectHeaderModel('code-write', this, event)"
              >
                <div
                  class="model-opt-icon"
                  style="background: rgba(16, 163, 127, 0.15); color: #10a37f"
                >
                  KY
                </div>
                <div class="model-opt-info">
                  <div class="model-opt-name">Kod Yaz</div>
                  <div class="model-opt-desc">Kod uret ve onizle</div>
                </div>
              </button>
            </div>
          </div>

          <div class="header-actions">
            <!-- ðŸ“ Visitor City Display -->
            <div id="visitor-city"></div>

            <!-- ðŸ“¥ Download Button - Minimal (Icon only) -->
            <button
              class="header-btn-icon"
              id="downloadBtn"
              title="Sohbeti Ä°ndir"
              aria-label="Sohbeti Ä°ndir"
            >
              <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path
                  d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"
                ></path>
              </svg>
            </button>
            <!-- ðŸ”— Share Button - Minimal (Icon only) -->
            <button
              class="header-btn-icon"
              id="shareBtn"
              title="Sohbeti PaylaÅŸ"
              aria-label="Sohbeti PaylaÅŸ"
            >
              <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path
                  d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"
                ></path>
              </svg>
            </button>

            <!-- â“ Help Dropdown - Desktop Only -->
            <div class="help-dropdown-container" id="helpDropdownContainer">
              <button
                class="header-btn-icon help-trigger"
                id="helpTriggerBtn"
                title="YardÄ±m & BaÄŸlantÄ±lar"
              >
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                  <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"
                  />
                </svg>
              </button>
              <div class="help-dropdown-menu" id="helpDropdownMenu">
                <div class="help-dropdown-header">
                  <span class="help-dropdown-title">BaÄŸlantÄ±lar</span>
                </div>
                <a
                  href="https://www.ailydian.com"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="help-dropdown-item"
                >
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                  </svg>
                  <span>Projeler</span>
                  <span class="help-dropdown-url">ailydian.com</span>
                </a>
                <a
                  href="https://www.ailydian.com/api-reference"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="help-dropdown-item"
                >
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path
                      d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"
                    />
                  </svg>
                  <span>API Docs</span>
                  <span class="help-dropdown-url">api-reference</span>
                </a>
                <a
                  href="https://www.ailydian.com/privacy"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="help-dropdown-item"
                >
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path
                      d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"
                    />
                  </svg>
                  <span>Gizlilik</span>
                  <span class="help-dropdown-url">privacy</span>
                </a>
                <a
                  href="https://www.ailydian.com/status"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="help-dropdown-item"
                >
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path
                      d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM10 17l-3.5-3.5 1.41-1.41L10 14.17l4.59-4.59L16 11l-6 6z"
                    />
                  </svg>
                  <span>Durum</span>
                  <span class="help-dropdown-url">status</span>
                </a>
              </div>
            </div>

            <!-- ðŸ”‘ Mobile Login Trigger - Mobile Only -->
            <button
              class="mobile-login-trigger"
              id="mobileLoginTrigger"
              aria-label="Oturum Ac"
              onclick="ChatAuth.openPanel('main')"
            >
              <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path
                  d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                />
              </svg>
            </button>

            <!-- â“ Mobile Help Trigger - Mobile Only -->
            <button class="mobile-help-trigger" id="mobileHelpTrigger" aria-label="Yardim">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"
                />
              </svg>
            </button>

            <!-- ðŸ‘¤ User Auth Button - Desktop Only -->
            <div class="header-user-auth" id="headerUserAuth">
              <!-- Not logged in state -->
              <button
                class="header-login-btn"
                id="headerLoginBtn"
                onclick="ChatAuth.openPanel('main')"
              >
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                  <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                  />
                </svg>
                <span>GiriÅŸ Yap</span>
              </button>

              <!-- Logged in state (hidden by default) -->
              <div class="header-user-menu" id="headerUserMenu" style="display: none">
                <button class="header-user-btn" id="headerUserBtn">
                  <div class="header-user-avatar" id="headerUserAvatar">U</div>
                  <span class="header-user-name" id="headerUserName">KullanÄ±cÄ±</span>
                  <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                    <path d="M7 10l5 5 5-5z" />
                  </svg>
                </button>
                <div class="header-user-dropdown" id="headerUserDropdown">
                  <button
                    class="header-user-dropdown-item"
                    onclick="ChatAuth.openPanel('settings')"
                  >
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                      <path
                        d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
                      />
                    </svg>
                    Ayarlar
                  </button>
                  <button
                    class="header-user-dropdown-item"
                    onclick="
                      ChatAuth.openPanel('settings');
                      setTimeout(function () {
                        switchSettingsTab(
                          'guvenlik',
                          document.querySelector('.settings-tab-btn:last-child')
                        );
                      }, 100);
                    "
                  >
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                      <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z" />
                    </svg>
                    GÃ¼venlik
                  </button>
                  <div class="header-user-dropdown-divider"></div>
                  <button class="header-user-dropdown-item danger" onclick="ChatAuth.logout()">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                      <path
                        d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
                      />
                    </svg>
                    Ã‡Ä±kÄ±ÅŸ Yap
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ðŸ’­ MESSAGES -->
        <div class="messages-container" id="messagesContainer">
          <div class="empty-state" id="emptyState">
            <!-- Particles background -->
            <div class="particles" id="particles"></div>

            <!-- ðŸ‘¤ USER WELCOME TEXT -->
            <div class="user-welcome-text" id="userWelcomeText">
              <div class="welcome-user-name" id="welcomeUserName">HoÅŸgeldiniz</div>
              <div class="welcome-message">Size NasÄ±l YardÄ±mcÄ± Olabilirim?</div>
            </div>

            <!-- ðŸŒŒ LyDian Orbit Loader -->
            <div class="mini-spinner-container">
              <div class="mini-spinner">
                <svg
                  viewBox="-60 -60 120 120"
                  width="120"
                  height="120"
                  role="img"
                  aria-label="LyDian orbit"
                >
                  <defs>
                    <radialGradient id="g-core" cx="50%" cy="50%" r="50%">
                      <stop offset="0%" stop-color="#7C5CFF" stop-opacity="1"></stop>
                      <stop offset="60%" stop-color="#00E0FF" stop-opacity="0.4"></stop>
                      <stop offset="100%" stop-color="#0B0F19" stop-opacity="0"></stop>
                    </radialGradient>
                    <linearGradient id="g-1" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" stop-color="#7C5CFF"></stop>
                      <stop offset="100%" stop-color="#00E0FF"></stop>
                    </linearGradient>
                    <linearGradient id="g-2" x1="0%" y1="100%" x2="100%" y2="0%">
                      <stop offset="0%" stop-color="#00E0FF"></stop>
                      <stop offset="100%" stop-color="#FF9D00"></stop>
                    </linearGradient>
                    <linearGradient id="g-3" x1="100%" y1="0%" x2="0%" y2="100%">
                      <stop offset="0%" stop-color="#FF9D00"></stop>
                      <stop offset="100%" stop-color="#7C5CFF"></stop>
                    </linearGradient>
                  </defs>

                  <!-- Background aura -->
                  <circle r="48" fill="url(#g-core)" opacity="0.2"></circle>

                  <!-- Orbit 1 - Outer ellipse -->
                  <g class="lydian-orbit-ring-1">
                    <ellipse
                      rx="50"
                      ry="30"
                      fill="none"
                      stroke="url(#g-1)"
                      stroke-opacity="0.7"
                      stroke-width="0.8"
                    ></ellipse>
                    <circle cx="50" cy="0" r="2" fill="#00E0FF"></circle>
                    <circle cx="-50" cy="0" r="2" fill="#00E0FF"></circle>
                  </g>

                  <!-- Orbit 2 - Middle circle -->
                  <g class="lydian-orbit-ring-2">
                    <circle
                      r="38"
                      fill="none"
                      stroke="url(#g-2)"
                      stroke-opacity="0.8"
                      stroke-width="0.8"
                    ></circle>
                    <circle cx="38" cy="0" r="1.5" fill="#FF9D00"></circle>
                    <circle cx="-38" cy="0" r="1.5" fill="#FF9D00"></circle>
                    <circle cx="0" cy="38" r="1.5" fill="#FF9D00"></circle>
                    <circle cx="0" cy="-38" r="1.5" fill="#FF9D00"></circle>
                  </g>

                  <!-- Orbit 3 - Inner circle -->
                  <g class="lydian-orbit-ring-3">
                    <circle
                      r="25"
                      fill="none"
                      stroke="url(#g-3)"
                      stroke-opacity="0.9"
                      stroke-width="1"
                      stroke-dasharray="1.5 5"
                    ></circle>
                  </g>

                  <!-- Lissajous satellites -->
                  <g class="lydian-lissajous">
                    <circle r="2.5" fill="#7C5CFF"></circle>
                  </g>

                  <!-- Core nucleus -->
                  <circle r="12" fill="#111827"></circle>
                  <circle r="12" fill="url(#g-core)" opacity="0.35"></circle>
                  <circle r="0.8" fill="#7C5CFF"></circle>
                </svg>
              </div>
            </div>
          </div>

          <!-- âš¡ PROMINENT LOADING INDICATOR (Shows during AI queries) -->
          <div class="loading-indicator" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <div class="loading-text">
              <span>AI dÃ¼ÅŸÃ¼nÃ¼yor</span>
              <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>

          <!-- âœ¨ FIRE SPARKS CONTAINER -->
          <div id="fireSparks" class="fire-sparks"></div>
        </div>

        <!-- âœï¸ INPUT AREA -->
        <div class="input-container" id="mainInputContainer">
          <!-- âš¡ AI MODE SELECTORS (VISIBLE & PROMINENT) -->
          <div class="input-mode-selectors" role="tablist" aria-label="AI ModlarÄ±">
            <button
              class="mode-btn active"
              data-mode="general"
              title="Genel Sohbet"
              role="tab"
              aria-selected="true"
            >
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path
                  d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                ></path>
              </svg>
              <span>Genel</span>
            </button>
            <button
              class="mode-btn"
              data-mode="deep-think"
              title="Derin DÃ¼ÅŸÃ¼nce"
              data-ai-type="deep-think"
              role="tab"
              aria-selected="false"
            >
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path
                  d="M9 11.75c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zm6 0c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8 0-.29.02-.58.05-.86 2.36-1.05 4.23-2.98 5.21-5.37C11.07 8.33 14.05 10 17.42 10c.78 0 1.53-.09 2.25-.26.21.71.33 1.47.33 2.26 0 4.41-3.59 8-8 8z"
                ></path>
              </svg>
              <span>Derin DÃ¼ÅŸÃ¼nce</span>
            </button>
            <button
              class="mode-btn"
              data-mode="web-search"
              title="Web Arama"
              data-ai-type="web-search"
              role="tab"
              aria-selected="false"
            >
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"
                ></path>
              </svg>
              <span>Web Arama</span>
            </button>
            <button
              class="mode-btn"
              data-mode="code-write"
              title="Kod Yaz"
              data-ai-type="code-write"
              role="tab"
              aria-selected="false"
            >
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path
                  d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"
                ></path>
              </svg>
              <span>Kod Yaz</span>
            </button>
          </div>

          <!-- ðŸ¤– AI MODEL SELECTORS (Advanced, Premium, Ultra) -->
          <div
            class="input-mode-selectors"
            style="
              margin-top: 0.5rem;
              border-top: 1px solid var(--border-light);
              padding-top: 0.5rem;
            "
          >
            <button class="mode-btn" data-model="model-a" title="Advanced Mode">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                ></path>
              </svg>
              <span>Advanced</span>
            </button>
            <button class="mode-btn active" data-model="model-p" title="Premium Mode">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path
                  d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 18.5c-3.87-1.18-6.5-4.85-6.5-8.5V8.3l6.5-3.11 6.5 3.11V12c0 3.65-2.63 7.32-6.5 8.5z"
                ></path>
              </svg>
              <span>Premium</span>
            </button>
            <button class="mode-btn" data-model="model-u" title="Ultra Mode">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path
                  d="M12 2L1 12l11 10 11-10L12 2zm0 2.83L19.17 12 12 19.17 4.83 12 12 4.83z"
                ></path>
              </svg>
              <span>Ultra</span>
            </button>
            <button class="mode-btn" data-model="model-r" title="Research Mode">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path
                  d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"
                ></path>
              </svg>
              <span>Research</span>
            </button>
          </div>

          <!-- ðŸ“Š MOBILE STATS - Above form on mobile -->
          <div class="mobile-input-stats" id="mobileInputStats">
            <span class="stat-item"> <span id="mobileCharCount">0</span> karakter </span>
            <span class="stat-divider">â€¢</span>
            <span class="stat-item token-highlight">
              ~<span id="mobileTokenCount">0</span> token
            </span>
            <span class="stat-item speed-item" id="mobileSpeedDisplay" style="display: none">
              <span class="stat-divider">â€¢</span>
              <span id="mobileSpeedValue">0</span> t/s
            </span>
          </div>

          <!-- ðŸŽ¯ PREMIUM INPUT WRAPPER -->
          <div class="input-wrapper">
            <!-- ðŸ“± Mobile Plus Button (Left side) -->
            <div class="mobile-plus-container">
              <button class="mobile-plus-btn" id="mobilePlusBtn" title="SeÃ§enekler">
                <svg viewBox="0 0 24 24" width="24" height="24">
                  <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
              </button>

              <!-- ðŸ“‹ Mobile Plus Dropdown -->
              <div class="mobile-plus-dropdown" id="mobilePlusDropdown">
                <button class="plus-dropdown-item" id="plusVoiceBtn">
                  <svg viewBox="0 0 24 24" width="20" height="20">
                    <path
                      fill="currentColor"
                      d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"
                    />
                    <path
                      fill="currentColor"
                      d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"
                    />
                  </svg>
                  <span>Sesli GiriÅŸ</span>
                </button>
                <button class="plus-dropdown-item" id="plusFileBtn">
                  <svg viewBox="0 0 24 24" width="20" height="20">
                    <path
                      fill="currentColor"
                      d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"
                    />
                  </svg>
                  <span>Dosya YÃ¼kle</span>
                </button>
                <div
                  style="height: 1px; background: rgba(255, 255, 255, 0.08); margin: 4px 8px"
                ></div>
                <button
                  class="plus-dropdown-item active-mode"
                  id="plusGeneralBtn"
                  data-plus-mode="general"
                >
                  <svg viewBox="0 0 24 24" width="20" height="20">
                    <path
                      fill="currentColor"
                      d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"
                    />
                  </svg>
                  <span>Sohbet</span>
                </button>
                <button
                  class="plus-dropdown-item"
                  id="plusDeepThinkBtn"
                  data-plus-mode="deep-think"
                >
                  <svg viewBox="0 0 24 24" width="20" height="20">
                    <path
                      fill="currentColor"
                      d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                    />
                  </svg>
                  <span>Derin DÃ¼ÅŸÃ¼nce</span>
                </button>
                <button
                  class="plus-dropdown-item"
                  id="plusWebSearchBtn"
                  data-plus-mode="web-search"
                >
                  <svg viewBox="0 0 24 24" width="20" height="20">
                    <path
                      fill="currentColor"
                      d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                    />
                  </svg>
                  <span>Web Arama</span>
                </button>
                <button class="plus-dropdown-item" id="plusCodeBtn" data-plus-mode="code-write">
                  <svg viewBox="0 0 24 24" width="20" height="20">
                    <path
                      fill="currentColor"
                      d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"
                    />
                  </svg>
                  <span>Kod Yaz</span>
                </button>
              </div>
            </div>

            <textarea
              id="messageInput"
              placeholder="LyDian'a bir ÅŸey sorun..."
              rows="1"
              autocomplete="off"
              autocorrect="on"
              autocapitalize="sentences"
              spellcheck="true"
            ></textarea>

            <!-- ðŸŽ¬ Input Actions - Right side -->
            <div class="input-actions">
              <!-- ðŸ“ File Upload Button -->
              <button class="file-upload-btn" id="fileUploadBtn" title="Dosya YÃ¼kle">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path
                    fill="currentColor"
                    d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"
                  />
                </svg>
              </button>

              <!-- ðŸ’» Code Write Button (Desktop) -->
              <button class="code-write-btn" id="desktopCodeBtn" title="Kod Yaz">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path
                    fill="currentColor"
                    d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"
                  />
                </svg>
              </button>

              <!-- ðŸŽ¤ Voice Chat Button -->
              <button class="voice-chat-btn" id="voiceChatBtn" title="Sesli Sohbet">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path
                    fill="currentColor"
                    d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"
                  />
                  <path
                    fill="currentColor"
                    d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"
                  />
                </svg>
              </button>

              <!-- ðŸš€ Send Button -->
              <button id="sendBtn" disabled>
                <svg viewBox="0 0 24 24">
                  <path
                    d="M3.4 20.4l17.45-7.48c.81-.35.81-1.49 0-1.84L3.4 3.6c-.66-.29-1.39.2-1.39.91L2 9.12c0 .5.37.93.87.99L17 12 2.87 13.88c-.5.07-.87.5-.87 1l.01 4.61c0 .71.73 1.2 1.39.91z"
                  ></path>
                </svg>
              </button>
            </div>

            <!-- Hidden file input -->
            <input
              type="file"
              id="mainFileInput"
              accept="image/*,.pdf,.doc,.docx,.txt,.md,.csv"
              style="display: none"
            />
          </div>

          <!-- Recall status moved to global footer -->
        </div>
      </div>
    </div>

    <!-- ðŸ“Š GLOBAL FIXED FOOTER - Always visible at bottom -->
    <div class="global-footer-disclaimer" id="globalFooterDisclaimer">
      <div class="global-footer-content">
        <span class="footer-stat-item">
          <svg
            viewBox="0 0 24 24"
            width="14"
            height="14"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
          </svg>
          <span id="globalCharCount">0</span> karakter
        </span>
        <span class="footer-divider">|</span>
        <span class="footer-stat-item token-highlight">
          <svg
            viewBox="0 0 24 24"
            width="14"
            height="14"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10" />
            <path d="M12 6v6l4 2" />
          </svg>
          ~<span id="globalTokenCount">0</span> token
        </span>
        <span class="footer-divider">|</span>
        <span class="footer-disclaimer-text">
          <svg
            viewBox="0 0 24 24"
            width="14"
            height="14"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
          LyDian hata yapabilir. Ã–nemli bilgileri doÄŸrulayÄ±nÄ±z.
        </span>
        <span class="footer-divider">|</span>
        <div class="recall-status-indicator" data-status="hybrid" id="recallStatus">
          <div class="recall-status-dot"></div>
          <span class="recall-status-text">Hibrit</span>
        </div>
      </div>
    </div>

    <!-- ðŸŽ¨ THEME MODAL -->
    <div class="modal-overlay" id="themeModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Tema SeÃ§in</h2>
          <button class="modal-close" id="closeThemeModalBtn">
            <svg viewBox="0 0 24 24">
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
              ></path>
            </svg>
          </button>
        </div>
        <div class="theme-options">
          <!-- Dark Theme -->
          <div class="theme-option active" data-theme="dark">
            <div class="theme-preview">
              <div class="theme-preview-color" style="background: #0a0b0d"></div>
              <div class="theme-preview-color" style="background: #171717"></div>
              <div class="theme-preview-color" style="background: #ffffff"></div>
            </div>
            <div class="theme-name">Koyu</div>
          </div>
          <!-- Light Theme -->
          <div class="theme-option" data-theme="light">
            <div class="theme-preview">
              <div class="theme-preview-color" style="background: #ffffff"></div>
              <div class="theme-preview-color" style="background: #f5f5f7"></div>
              <div class="theme-preview-color" style="background: #0a0b0d"></div>
            </div>
            <div class="theme-name">Acik</div>
          </div>
          <!-- System Theme -->
          <div class="theme-option" data-theme="system">
            <div class="theme-preview">
              <div
                class="theme-preview-color"
                style="background: linear-gradient(135deg, #0a0b0d 50%, #ffffff 50%)"
              ></div>
              <div
                class="theme-preview-color"
                style="background: linear-gradient(135deg, #171717 50%, #f5f5f7 50%)"
              ></div>
              <div class="theme-preview-color" style="background: #4f46e5"></div>
            </div>
            <div class="theme-name">Sistem</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸŽ¬ IMAGE MODAL -->
    <div class="modal-overlay" id="imageModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">GÃ¶rsel OluÅŸtur</h2>
          <button class="modal-close" id="closeImageModalBtn">
            <svg viewBox="0 0 24 24">
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
              ></path>
            </svg>
          </button>
        </div>
        <div style="padding: 1rem 0">
          <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1rem">
            LyDian AI ile gÃ¶rsel oluÅŸtur
          </p>
          <textarea
            id="imagePromptInput"
            placeholder="GÃ¶rsel aÃ§Ä±klamasÄ±..."
            style="
              width: 100%;
              min-height: 100px;
              padding: 1rem;
              background: rgba(255, 255, 255, 0.05);
              border: 1px solid rgba(255, 255, 255, 0.15);
              border-radius: 12px;
              color: #ffffff;
              font-family: inherit;
              resize: vertical;
            "
          ></textarea>
          <button id="generateImageBtn">OluÅŸtur</button>
        </div>
      </div>
    </div>

    <!-- ðŸŽ¬ VIDEO MODAL -->
    <div class="modal-overlay" id="videoModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Video OluÅŸtur</h2>
          <button class="modal-close" id="closeVideoModalBtn">
            <svg viewBox="0 0 24 24">
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
              ></path>
            </svg>
          </button>
        </div>
        <div style="padding: 1rem 0">
          <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 1rem">
            LyDian AI ile video oluÅŸtur
          </p>
          <textarea
            id="videoPromptInput"
            placeholder="Video aÃ§Ä±klamasÄ±..."
            style="
              width: 100%;
              min-height: 100px;
              padding: 1rem;
              background: rgba(255, 255, 255, 0.05);
              border: 1px solid rgba(255, 255, 255, 0.15);
              border-radius: 12px;
              color: #ffffff;
              font-family: inherit;
              resize: vertical;
            "
          ></textarea>
          <div style="margin-top: 1rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem">
            <div>
              <label
                style="
                  display: block;
                  margin-bottom: 0.5rem;
                  color: rgba(255, 255, 255, 0.7);
                  font-size: 0.9rem;
                "
                >SÃ¼re (saniye)</label
              >
              <input
                type="number"
                id="videoDuration"
                value="5"
                min="3"
                max="30"
                style="
                  width: 100%;
                  padding: 0.75rem;
                  background: rgba(255, 255, 255, 0.05);
                  border: 1px solid rgba(255, 255, 255, 0.15);
                  border-radius: 8px;
                  color: #ffffff;
                  font-family: inherit;
                "
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  margin-bottom: 0.5rem;
                  color: rgba(255, 255, 255, 0.7);
                  font-size: 0.9rem;
                "
                >Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k</label
              >
              <select
                id="videoResolution"
                style="
                  width: 100%;
                  padding: 0.75rem;
                  background: rgba(255, 255, 255, 0.05);
                  border: 1px solid rgba(255, 255, 255, 0.15);
                  border-radius: 8px;
                  color: #ffffff;
                  font-family: inherit;
                "
              >
                <option value="720p">720p</option>
                <option value="1080p" selected="">1080p</option>
                <option value="4k">4K</option>
              </select>
            </div>
          </div>
          <button id="generateVideoBtn">Video OluÅŸtur</button>
          <div
            id="videoGenerationStatus"
            style="
              margin-top: 1rem;
              padding: 1rem;
              background: rgba(255, 255, 255, 0.08);
              border: 1px solid rgba(255, 255, 255, 0.3);
              border-radius: 12px;
              display: none;
            "
          >
            <p id="videoStatusText" style="color: #ffffff"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸš€ JAVASCRIPT -->
    <script>
      // ========== STATE ==========
      const state = {
        messages: [],
        currentChatId: null,
        isTyping: false,
        selectedModel: 'enterprise-ai', // Default: Premium AI
        selectedAiType: (function () {
          try {
            return sessionStorage.getItem('lydian_ai_type') || 'general';
          } catch (e) {
            return 'general';
          }
        })(), // ðŸŽ¯ Track specialized AI mode (persisted in sessionStorage)
      };

      // ========== ELEMENTS ==========
      const elements = {
        sidebar: document.getElementById('sidebar'),
        sidebarToggle: document.getElementById('sidebarToggle'),
        sidebarOpenBtn: document.getElementById('sidebarOpenBtn'),
        newChatBtn: document.getElementById('newChatBtn'),
        chatHistory: document.getElementById('chatHistory'),
        messagesContainer: document.getElementById('messagesContainer'),
        messageInput: document.getElementById('messageInput'),
        sendBtn: document.getElementById('sendBtn'),
        charCount: document.getElementById('charCount'),
        tokenCount: document.getElementById('tokenCount'),
        tokenCountHeader: document.getElementById('tokenCountHeader'),
        // Desktop stats elements
        desktopCharCount: document.getElementById('desktopCharCount'),
        desktopTokenCount: document.getElementById('desktopTokenCount'),
        // Mobile stats elements
        mobileCharCount: document.getElementById('mobileCharCount'),
        mobileTokenCount: document.getElementById('mobileTokenCount'),
        emptyState: document.getElementById('emptyState'),
        themeBtn: document.getElementById('themeBtn'),
        themeModal: document.getElementById('themeModal'),
        closeThemeModalBtn: document.getElementById('closeThemeModalBtn'),
        imageBtn: document.getElementById('imageBtn'),
        imageModal: document.getElementById('imageModal'),
        closeImageModalBtn: document.getElementById('closeImageModalBtn'),
        videoBtn: document.getElementById('videoBtn'),
        videoModal: document.getElementById('videoModal'),
        closeVideoModalBtn: document.getElementById('closeVideoModalBtn'),
        downloadBtn: document.getElementById('downloadBtn'),
        deepThinkBtn: document.getElementById('deepThinkBtn'),
        webSearchBtn: document.getElementById('webSearchBtn'),
        shareBtn: document.getElementById('shareBtn'),
        speedDisplay: document.getElementById('speedDisplay'),
        speedValue: document.getElementById('speedValue'),
        responseTokens: document.getElementById('responseTokens'),
        responseTokenValue: document.getElementById('responseTokenValue'),
        plusBtn: document.getElementById('plusBtn'),
        plusDropdown: document.getElementById('plusDropdown'),
        // ðŸŒŸ Neon AI Mode Icons
        neonDeepThinkBtn: document.getElementById('neonDeepThinkBtn'),
        neonWebSearchBtn: document.getElementById('neonWebSearchBtn'),
        neonImageBtn: document.getElementById('neonImageBtn'),
        neonVideoBtn: document.getElementById('neonVideoBtn'),
        neonMicBtn: document.getElementById('neonMicBtn'),
        neonCodeBtn: document.getElementById('neonCodeBtn'),
      };

      // ========== EVENT LISTENERS ==========

      // Sidebar toggle
      if (elements.sidebarToggle && elements.sidebar) {
        elements.sidebarToggle.addEventListener('click', () => {
          // DEBUG: console.log('ðŸ”˜ Sidebar toggle clicked');
          elements.sidebar.classList.toggle('collapsed');
        });
        // DEBUG: console.log('âœ… Sidebar toggle listener added');
      } else {
        console.error('âŒ Sidebar toggle elements not found:', {
          sidebarToggle: !!elements.sidebarToggle,
          sidebar: !!elements.sidebar,
        });
      }

      if (elements.sidebarOpenBtn && elements.sidebar) {
        elements.sidebarOpenBtn.addEventListener('click', () => {
          // DEBUG: console.log('ðŸ“‚ Sidebar open clicked');
          elements.sidebar.classList.remove('collapsed');
        });
        // DEBUG: console.log('âœ… Sidebar open listener added');
      }

      // New chat
      if (elements.newChatBtn) {
        elements.newChatBtn.addEventListener('click', () => {
          // DEBUG: console.log('ðŸ†• New chat button clicked');
          startNewChat();
        });
        // DEBUG: console.log('âœ… New chat listener added');
      } else {
        console.error('âŒ New chat button not found');
      }

      // Desktop new chat button
      const desktopNewChatBtn = document.getElementById('desktopNewChatBtn');
      if (desktopNewChatBtn) {
        desktopNewChatBtn.addEventListener('click', () => {
          startNewChat();
        });
      }

      // Help dropdown toggle
      const helpTriggerBtn = document.getElementById('helpTriggerBtn');
      const helpDropdownContainer = document.getElementById('helpDropdownContainer');
      if (helpTriggerBtn && helpDropdownContainer) {
        helpTriggerBtn.addEventListener('click', e => {
          e.stopPropagation();
          helpDropdownContainer.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', e => {
          if (!helpDropdownContainer.contains(e.target)) {
            helpDropdownContainer.classList.remove('active');
          }
        });

        // Close dropdown when pressing Escape
        document.addEventListener('keydown', e => {
          if (e.key === 'Escape') {
            helpDropdownContainer.classList.remove('active');
          }
        });
      }

      // â“ Mobile Help Bottom Sheet
      const mobileHelpTrigger = document.getElementById('mobileHelpTrigger');
      const mobileHelpOverlay = document.getElementById('mobileHelpOverlay');
      const mobileHelpSheet = document.getElementById('mobileHelpSheet');

      function openMobileHelp() {
        if (mobileHelpOverlay) mobileHelpOverlay.classList.add('open');
        if (mobileHelpSheet) mobileHelpSheet.classList.add('open');
        document.body.style.overflow = 'hidden';
      }

      function closeMobileHelp() {
        if (mobileHelpOverlay) mobileHelpOverlay.classList.remove('open');
        if (mobileHelpSheet) mobileHelpSheet.classList.remove('open');
        document.body.style.overflow = '';
      }

      if (mobileHelpTrigger) {
        mobileHelpTrigger.addEventListener('click', e => {
          e.stopPropagation();
          openMobileHelp();
        });
      }

      if (mobileHelpOverlay) {
        mobileHelpOverlay.addEventListener('click', closeMobileHelp);
      }

      // Swipe down to close bottom sheet
      if (mobileHelpSheet) {
        let sheetStartY = 0;
        let sheetDragging = false;

        mobileHelpSheet.addEventListener(
          'touchstart',
          e => {
            sheetStartY = e.touches[0].clientY;
            sheetDragging = true;
          },
          { passive: true }
        );

        mobileHelpSheet.addEventListener(
          'touchmove',
          e => {
            if (!sheetDragging) return;
            const deltaY = e.touches[0].clientY - sheetStartY;
            if (deltaY > 80) {
              closeMobileHelp();
              sheetDragging = false;
            }
          },
          { passive: true }
        );

        mobileHelpSheet.addEventListener(
          'touchend',
          () => {
            sheetDragging = false;
          },
          { passive: true }
        );
      }

      // ðŸ‘¤ Header User Menu Dropdown Toggle
      const headerUserBtn = document.getElementById('headerUserBtn');
      const headerUserMenuEl = document.getElementById('headerUserMenu');
      if (headerUserBtn && headerUserMenuEl) {
        headerUserBtn.addEventListener('click', e => {
          e.stopPropagation();
          headerUserMenuEl.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', e => {
          if (!headerUserMenuEl.contains(e.target)) {
            headerUserMenuEl.classList.remove('active');
          }
        });

        // Close dropdown when pressing Escape
        document.addEventListener('keydown', e => {
          if (e.key === 'Escape') {
            headerUserMenuEl.classList.remove('active');
          }
        });
      }

      // Message input - with null checks
      if (elements.messageInput) {
        elements.messageInput.addEventListener('input', e => {
          // Auto-resize
          e.target.style.height = 'auto';
          e.target.style.height = e.target.scrollHeight + 'px';

          // Update counters
          const text = e.target.value;
          const charCount = text.length;
          const tokenCount = Math.ceil(charCount / 4); // Rough estimate

          if (elements.charCount) elements.charCount.textContent = charCount;
          if (elements.tokenCount) elements.tokenCount.textContent = tokenCount;
          if (elements.tokenCountHeader) elements.tokenCountHeader.textContent = tokenCount;

          // Update desktop & mobile stats
          if (elements.desktopCharCount) elements.desktopCharCount.textContent = charCount;
          if (elements.desktopTokenCount) elements.desktopTokenCount.textContent = tokenCount;
          if (elements.mobileCharCount) elements.mobileCharCount.textContent = charCount;
          if (elements.mobileTokenCount) elements.mobileTokenCount.textContent = tokenCount;

          // Update global footer stats
          const globalCharCount = document.getElementById('globalCharCount');
          const globalTokenCount = document.getElementById('globalTokenCount');
          if (globalCharCount) globalCharCount.textContent = charCount;
          if (globalTokenCount) globalTokenCount.textContent = tokenCount;

          // Enable/disable send button
          if (elements.sendBtn) elements.sendBtn.disabled = text.trim().length === 0;
        });

        elements.messageInput.addEventListener('keydown', e => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
          }
        });
      } else {
        console.error('[CHAT] Message input element not found!');
      }

      // Send button - with null check
      if (elements.sendBtn) {
        elements.sendBtn.addEventListener('click', sendMessage);
      } else {
        console.error('[CHAT] Send button element not found!');
      }

      // Theme modal (LEGACY - Theme system removed, keeping for safety)
      if (elements.themeBtn) {
        elements.themeBtn.addEventListener('click', () => {
          if (elements.themeModal) {
            elements.themeModal.classList.add('active');
            updateActiveThemeOption();
          }
        });
      }

      if (elements.closeThemeModalBtn) {
        elements.closeThemeModalBtn.addEventListener('click', () => {
          if (elements.themeModal) elements.themeModal.classList.remove('active');
        });
      }

      if (elements.themeModal) {
        elements.themeModal.addEventListener('click', e => {
          if (e.target === elements.themeModal) {
            elements.themeModal.classList.remove('active');
          }
        });
      }

      // Theme options - Click handler (always register, regardless of themeBtn existence)
      document.querySelectorAll('.theme-option').forEach(option => {
        option.addEventListener('click', () => {
          const themeName = option.dataset.theme;
          setTheme(themeName);
          if (elements.themeModal) {
            setTimeout(() => {
              elements.themeModal.classList.remove('active');
            }, 600);
          }
        });
      });

      // Image modal (LEGACY - Buttons removed from header, keeping modals for safety)
      if (elements.imageBtn && elements.imageModal && elements.closeImageModalBtn) {
        elements.imageBtn.addEventListener('click', () => {
          elements.imageModal.classList.add('active');
        });

        elements.closeImageModalBtn.addEventListener('click', () => {
          elements.imageModal.classList.remove('active');
        });

        const generateImageBtn = document.getElementById('generateImageBtn');
        if (generateImageBtn) {
          generateImageBtn.addEventListener('click', async () => {
            const imagePromptInput = document.getElementById('imagePromptInput');
            const prompt = imagePromptInput?.value.trim();
            if (!prompt) {
              alert('LÃ¼tfen gÃ¶rsel aÃ§Ä±klamasÄ± girin!');
              return;
            }

            elements.imageModal.classList.remove('active');
            addMessage(
              'assistant',
              `ðŸŽ¨ **GÃ¶rsel OluÅŸturuluyor...**\n\n**Prompt:** ${prompt}\n\n*LyDian AI ile gÃ¶rsel oluÅŸturuluyor...*`
            );
          });
        }
      }

      // Video modal (LEGACY - Buttons removed from header, keeping modals for safety)
      if (elements.videoBtn && elements.videoModal && elements.closeVideoModalBtn) {
        elements.videoBtn.addEventListener('click', () => {
          elements.videoModal.classList.add('active');
        });

        elements.closeVideoModalBtn.addEventListener('click', () => {
          elements.videoModal.classList.remove('active');
        });

        const generateVideoBtn = document.getElementById('generateVideoBtn');
        if (generateVideoBtn) {
          generateVideoBtn.addEventListener('click', async () => {
            const videoPromptInput = document.getElementById('videoPromptInput');
            const prompt = videoPromptInput?.value.trim();
            if (!prompt) {
              alert('LÃ¼tfen video aÃ§Ä±klamasÄ± girin!');
              return;
            }

            const videoDuration = document.getElementById('videoDuration');
            const videoResolution = document.getElementById('videoResolution');
            const duration = videoDuration?.value;
            const resolution = videoResolution?.value;

            elements.videoModal.classList.remove('active');
            addMessage(
              'assistant',
              `ðŸŽ¬ **Video OluÅŸturuluyor...**\n\n**Prompt:** ${prompt}\n**SÃ¼re:** ${duration}s\n**Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k:** ${resolution}\n\n*LyDian AI ile video oluÅŸturuluyor...*`
            );
          });
        }
      }

      // Download
      if (elements.downloadBtn) {
        elements.downloadBtn.addEventListener('click', () => {
          const format = prompt(
            'Ä°ndirme formatÄ± seÃ§in:\n1. JSON\n2. TXT\n3. MD (Markdown)\n4. CSV\n\nNumara girin (1-4):',
            '1'
          );

          if (!format) return;

          const formatMap = {
            1: 'json',
            2: 'txt',
            3: 'md',
            4: 'csv',
          };

          const selectedFormat = formatMap[format] || 'json';
          downloadConversation(selectedFormat);
        });
      }

      // ðŸ§  Deep Think Button (ERNIE multi-language)
      if (elements.deepThinkBtn) {
        elements.deepThinkBtn.addEventListener('click', () => {
          state.selectedAiType = 'reasoning'; // Uses LyDian AI Reasoning Engine
        });
      }

      // ðŸŒ Web Search Button (LyDian Acceleration)
      if (elements.webSearchBtn) {
        elements.webSearchBtn.addEventListener('click', () => {
          state.selectedAiType = 'web-search';
        });
      }

      // ðŸŒŸ NEON AI MODE ICON HANDLERS (Premium Inline Icons)
      // Helper function to toggle active neon icon with animation
      function toggleNeonIcon(activeIcon) {
        // Remove active class from all neon icons
        const allNeonIcons = [
          elements.neonDeepThinkBtn,
          elements.neonWebSearchBtn,
          elements.neonImageBtn,
          elements.neonVideoBtn,
          elements.neonMicBtn,
          elements.neonCodeBtn,
        ].filter(Boolean);

        allNeonIcons.forEach(icon => icon.classList.remove('active'));

        // Add active class to clicked icon with animation
        if (activeIcon) {
          activeIcon.classList.add('active');

          // Trigger click animation (scale bounce)
          activeIcon.style.animation = 'none';
          setTimeout(() => {
            activeIcon.style.animation = '';
          }, 10);

          // Create ripple effect
          createRippleEffect(activeIcon);
        }
      }

      // Create ripple effect on icon click
      function createRippleEffect(element) {
        const ripple = document.createElement('span');
        const rect = element.getBoundingClientRect();

        ripple.style.cssText = `
                position: absolute;
                width: ${rect.width}px;
                height: ${rect.height}px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.25);
                transform: scale(0);
                animation: rippleAnimation 0.6s ease-out;
                pointer-events: none;
                left: 0;
                top: 0;
            `;

        element.style.position = 'relative';
        element.appendChild(ripple);

        setTimeout(() => ripple.remove(), 600);
      }

      // ðŸŽ¯ MOBILE PLUS BUTTON - Toggle dropdown menu
      const mobilePlusBtn = document.getElementById('mobilePlusBtn');
      const mobilePlusDropdown = document.getElementById('mobilePlusDropdown');
      const plusVoiceBtn = document.getElementById('plusVoiceBtn');
      const plusFileBtn = document.getElementById('plusFileBtn');

      if (mobilePlusBtn && mobilePlusDropdown) {
        // Toggle dropdown on click
        mobilePlusBtn.addEventListener('click', e => {
          e.stopPropagation();
          mobilePlusBtn.classList.toggle('active');
          mobilePlusDropdown.classList.toggle('show');
        });

        // Close menu when clicking outside
        document.addEventListener('click', e => {
          if (!mobilePlusBtn.contains(e.target) && !mobilePlusDropdown.contains(e.target)) {
            mobilePlusBtn.classList.remove('active');
            mobilePlusDropdown.classList.remove('show');
          }
        });

        // Voice button - trigger voice chat
        if (plusVoiceBtn) {
          plusVoiceBtn.addEventListener('click', () => {
            mobilePlusBtn.classList.remove('active');
            mobilePlusDropdown.classList.remove('show');
            // Trigger voice chat
            const voiceChatBtn = document.getElementById('voiceChatBtn');
            if (voiceChatBtn) {
              voiceChatBtn.click();
            }
          });
        }

        // File button - trigger file upload
        if (plusFileBtn) {
          plusFileBtn.addEventListener('click', () => {
            mobilePlusBtn.classList.remove('active');
            mobilePlusDropdown.classList.remove('show');
            // Trigger file upload
            const mainFileInput = document.getElementById('mainFileInput');
            if (mainFileInput) {
              mainFileInput.click();
            }
          });
        }

        // Mobile mode buttons (Sohbet, Derin DÃ¼ÅŸÃ¼nce, Web Arama, Kod Yaz)
        document
          .querySelectorAll('#mobilePlusDropdown [data-plus-mode]')
          .forEach(function (modeBtn) {
            modeBtn.addEventListener('click', function () {
              var selectedMode = this.getAttribute('data-plus-mode');
              mobilePlusBtn.classList.remove('active');
              mobilePlusDropdown.classList.remove('show');
              state.selectedAiType = selectedMode;
              try {
                sessionStorage.setItem('lydian_ai_type', selectedMode);
              } catch (e) {}
              // Update plus dropdown active state
              document
                .querySelectorAll('#mobilePlusDropdown [data-plus-mode]')
                .forEach(function (b) {
                  b.classList.remove('active-mode');
                });
              modeBtn.classList.add('active-mode');
              // Sync hidden mode buttons
              document.querySelectorAll('[data-mode]').forEach(function (b) {
                b.classList.remove('active');
              });
              var hiddenBtn = document.querySelector('[data-mode="' + selectedMode + '"]');
              if (hiddenBtn) hiddenBtn.classList.add('active');
              // Sync desktop code button
              var deskCodeBtn = document.getElementById('desktopCodeBtn');
              if (deskCodeBtn) {
                if (selectedMode === 'code-write') deskCodeBtn.classList.add('active');
                else deskCodeBtn.classList.remove('active');
              }
              // Update placeholder
              if (elements.messageInput) {
                if (selectedMode === 'code-write') {
                  elements.messageInput.placeholder = 'Kod isteginizi yazin...';
                } else {
                  elements.messageInput.placeholder = "LyDian'a bir ÅŸey sorun...";
                }
                elements.messageInput.focus();
              }
              // Save to server
              if (
                typeof ChatAuth !== 'undefined' &&
                ChatAuth.state &&
                ChatAuth.state.isAuthenticated &&
                ChatAuth.updateCustomSetting
              ) {
                ChatAuth.updateCustomSetting('lastAiType', selectedMode);
              }
            });
          });
      }

      // ðŸ’» DESKTOP CODE WRITE BUTTON - Toggle code-write mode
      const desktopCodeBtn = document.getElementById('desktopCodeBtn');
      if (desktopCodeBtn) {
        desktopCodeBtn.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();
          const isActive = state.selectedAiType === 'code-write';
          if (isActive) {
            // Deactivate: go back to general
            state.selectedAiType = 'general';
            try {
              sessionStorage.setItem('lydian_ai_type', 'general');
            } catch (e) {}
            desktopCodeBtn.classList.remove('active');
            document.querySelectorAll('[data-mode]').forEach(function (b) {
              b.classList.remove('active');
            });
            var generalBtn = document.querySelector('[data-mode="general"]');
            if (generalBtn) generalBtn.classList.add('active');
            if (elements.messageInput) {
              elements.messageInput.placeholder = "LyDian'a bir ÅŸey sorun...";
            }
          } else {
            // Activate code-write
            state.selectedAiType = 'code-write';
            try {
              sessionStorage.setItem('lydian_ai_type', 'code-write');
            } catch (e) {}
            desktopCodeBtn.classList.add('active');
            document.querySelectorAll('[data-mode]').forEach(function (b) {
              b.classList.remove('active');
            });
            var codeBtn = document.querySelector('[data-mode="code-write"]');
            if (codeBtn) codeBtn.classList.add('active');
            if (elements.messageInput) {
              elements.messageInput.placeholder = 'Kod isteginizi yazin...';
              elements.messageInput.focus();
            }
          }
        });
      }

      // ðŸ“ DESKTOP FILE UPLOAD BUTTON - Trigger file input
      const fileUploadBtn = document.getElementById('fileUploadBtn');
      const mainFileInputDesktop = document.getElementById('mainFileInput');

      if (fileUploadBtn && mainFileInputDesktop) {
        fileUploadBtn.addEventListener('click', e => {
          e.preventDefault();
          e.stopPropagation();
          mainFileInputDesktop.click();
        });

        // Handle file selection
        mainFileInputDesktop.addEventListener('change', e => {
          const file = e.target.files[0];
          if (file) {
            console.log('[FileUpload] File selected:', file.name, file.type, file.size);
            handleFileUpload(file);
          }
        });
      }

      // ðŸŽ›ï¸ MOBILE SIDEBAR - ChatGPT Style (Slide from LEFT)
      const mobileHamburgerBtn = document.getElementById('mobileHamburgerBtn');
      const mobileToggleBtn = document.getElementById('mobileToggleBtn');
      const mobileSidebar = document.getElementById('mobileSidebar');
      const mobileSidebarOverlay = document.getElementById('mobileSidebarOverlay');
      const mobileSidebarClose = document.getElementById('mobileSidebarClose');
      const mobileNewChatBtn = document.getElementById('mobileNewChatBtn');
      const mobileChatHistory = document.getElementById('mobileChatHistory');
      const headerActions = document.querySelector('.header-actions');
      const menuDownload = document.getElementById('menuDownload');
      const menuShare = document.getElementById('menuShare');

      // Mobile logo click - ChatGPT style: auth check first
      if (mobileToggleBtn) {
        mobileToggleBtn.addEventListener('click', () => {
          if (window.ChatAuth && ChatAuth.state && ChatAuth.state.isAuthenticated) {
            startNewChat();
          } else if (window.ChatAuth) {
            ChatAuth.openPanel('main');
          }
        });
      }

      // Open mobile sidebar
      function openMobileSidebar() {
        if (mobileSidebar) {
          mobileSidebar.classList.add('open');
          if (mobileSidebarOverlay) {
            mobileSidebarOverlay.classList.add('show');
          }
          document.body.style.overflow = 'hidden'; // Prevent background scroll
          // Load chat history when opening
          loadMobileChatHistory();
        }
      }

      // Close mobile sidebar
      function closeMobileSidebar() {
        if (mobileSidebar) {
          mobileSidebar.classList.remove('open');
          if (mobileSidebarOverlay) {
            mobileSidebarOverlay.classList.remove('show');
          }
          document.body.style.overflow = ''; // Restore scroll
          if (headerActions) {
            headerActions.classList.remove('hide-on-sidebar-open');
          }
        }
      }

      // Load chat history from localStorage (reads both lydian_chat_history + chat_* keys)
      function loadMobileChatHistory() {
        if (!mobileChatHistory) return;

        // Gather from lydian_chat_history array
        let allChats = [];
        try {
          const savedChats = JSON.parse(localStorage.getItem('lydian_chat_history') || '[]');
          savedChats.forEach(chat => {
            allChats.push({
              id: chat.id || Date.now().toString(),
              title: chat.title || chat.preview || 'Sohbet',
              time: chat.savedAt || chat.timestamp || new Date().toISOString(),
              source: 'history',
              messages: chat.messages,
            });
          });
        } catch (e) {}

        // Also gather from chat_* keys
        Object.keys(localStorage)
          .filter(k => k.startsWith('chat_'))
          .forEach(key => {
            try {
              const data = JSON.parse(localStorage.getItem(key));
              if (data && data.messages && Array.isArray(data.messages)) {
                if (!allChats.find(c => c.id === data.id)) {
                  allChats.push({
                    id: data.id || key,
                    title: data.title || data.preview || 'Sohbet',
                    time: data.savedAt || data.timestamp || new Date().toISOString(),
                    source: 'storage',
                    messages: data.messages,
                  });
                }
              }
            } catch (e) {}
          });

        // Sort by time (newest first) and limit to 20
        allChats.sort((a, b) => new Date(b.time) - new Date(a.time));
        const recentChats = allChats.slice(0, 20);

        if (recentChats.length === 0) {
          mobileChatHistory.innerHTML = `
            <div style="padding: 1rem; text-align: center; color: rgba(255,255,255,0.5); font-size: 0.875rem;">
              HenÃ¼z kayÄ±tlÄ± sohbet yok
            </div>
          `;
          return;
        }

        // Group by date (ChatGPT-style)
        let mobileHtml = '';
        let mobileLastGroup = '';
        recentChats.forEach((chat, idx) => {
          const group = typeof getDateGroupLabel === 'function' ? getDateGroupLabel(chat.time) : '';
          if (group && group !== mobileLastGroup) {
            mobileHtml += `<div class="chat-date-group-header">${group}</div>`;
            mobileLastGroup = group;
          }
          const safeTitle = (chat.title || chat.preview || 'Sohbet ' + (idx + 1))
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
          const chatId = chat.id || idx;
          mobileHtml += `
          <div class="mobile-chat-item" data-chat-id="${chatId}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
            </svg>
            <span class="mobile-chat-item-title">${safeTitle}</span>
            <button class="mobile-chat-item-delete" data-delete-id="${chatId}" title="Sil">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>`;
        });
        mobileChatHistory.innerHTML = mobileHtml;

        // Add click handlers to chat items (title area)
        mobileChatHistory.querySelectorAll('.mobile-chat-item').forEach(item => {
          item.addEventListener('click', e => {
            if (e.target.closest('.mobile-chat-item-delete')) return;
            const chatId = item.dataset.chatId;
            loadChatFromHistory(chatId);
            closeMobileSidebar();
          });
        });

        // Add delete handlers
        mobileChatHistory.querySelectorAll('.mobile-chat-item-delete').forEach(btn => {
          btn.addEventListener('click', e => {
            e.stopPropagation();
            const chatId = btn.dataset.deleteId;
            if (!confirm('Bu sohbeti silmek istediginize emin misiniz?')) return;

            // Remove from lydian_chat_history
            try {
              const saved = JSON.parse(localStorage.getItem('lydian_chat_history') || '[]');
              const filtered = saved.filter(c => (c.id || '') !== chatId);
              localStorage.setItem('lydian_chat_history', JSON.stringify(filtered));
            } catch (ex) {}

            // Remove chat_* key
            localStorage.removeItem('chat_' + chatId);
            localStorage.removeItem(chatId);

            // Animate removal
            const item = btn.closest('.mobile-chat-item');
            if (item) {
              item.style.transition = 'opacity 0.2s, transform 0.2s';
              item.style.opacity = '0';
              item.style.transform = 'translateX(-20px)';
              setTimeout(() => {
                item.remove();
                if (mobileChatHistory.querySelectorAll('.mobile-chat-item').length === 0) {
                  loadMobileChatHistory();
                }
              }, 200);
            }
          });
        });
      }

      // Mobile chat search filter
      const mobileChatSearchInput = document.getElementById('mobileChatSearch');
      if (mobileChatSearchInput) {
        mobileChatSearchInput.addEventListener('input', e => {
          const filter = e.target.value.toLowerCase().trim();
          const items = mobileChatHistory.querySelectorAll('.mobile-chat-item');
          items.forEach(item => {
            const title = item.querySelector('.mobile-chat-item-title');
            if (!filter || (title && title.textContent.toLowerCase().includes(filter))) {
              item.style.display = '';
            } else {
              item.style.display = 'none';
            }
          });
        });
      }

      // Load a specific chat from history (checks both lydian_chat_history + chat_* keys)
      function loadChatFromHistory(chatId) {
        let chat = null;

        // First check lydian_chat_history array
        const savedChats = JSON.parse(localStorage.getItem('lydian_chat_history') || '[]');
        chat = savedChats.find(c => (c.id || savedChats.indexOf(c)) == chatId);

        // Also check chat_* keys in localStorage
        if (!chat) {
          try {
            const data = JSON.parse(
              localStorage.getItem(chatId) || localStorage.getItem('chat_' + chatId) || 'null'
            );
            if (data && data.messages) chat = data;
          } catch (e) {}
        }

        if (chat && chat.messages) {
          state.messages = chat.messages;
          state.currentChatId = chatId;
          renderMessages();

          // Desktop: Activate chat layout when loading chat with messages
          if (
            window.innerWidth > 768 &&
            document.body.classList.contains('desktop-centered') &&
            chat.messages.length > 0
          ) {
            document.body.classList.remove('chat-initial');
            document.body.classList.add('chat-active');
          }
        }
      }

      // Save current chat to history
      function saveCurrentChatToHistory() {
        if (state.messages.length === 0) return;

        const savedChats = JSON.parse(localStorage.getItem('lydian_chat_history') || '[]');
        const firstUserMsg = state.messages.find(m => m.role === 'user');
        const preview = firstUserMsg ? firstUserMsg.content.substring(0, 50) : 'Yeni Sohbet';

        const chatData = {
          id: Date.now().toString(),
          title: preview + (preview.length >= 50 ? '...' : ''),
          preview: preview,
          messages: state.messages,
          savedAt: new Date().toISOString(),
        };

        savedChats.push(chatData);

        // Keep only last 50 chats
        if (savedChats.length > 50) {
          savedChats.shift();
        }

        localStorage.setItem('lydian_chat_history', JSON.stringify(savedChats));
      }

      // Hamburger button opens sidebar
      if (mobileHamburgerBtn) {
        mobileHamburgerBtn.addEventListener('click', e => {
          e.preventDefault();
          e.stopPropagation();
          openMobileSidebar();
        });
      }

      // Overlay click closes sidebar
      if (mobileSidebarOverlay) {
        mobileSidebarOverlay.addEventListener('click', closeMobileSidebar);
      }

      // Close button closes sidebar
      if (mobileSidebarClose) {
        mobileSidebarClose.addEventListener('click', closeMobileSidebar);
      }

      // New Chat button - Start fresh conversation
      if (mobileNewChatBtn) {
        mobileNewChatBtn.addEventListener('click', () => {
          // Save current chat if has messages
          if (state.messages.length > 0) {
            saveCurrentChatToHistory();
          }

          // Clear current conversation
          state.messages = [];
          state.conversationHistory = [];
          renderMessages();

          // Show empty state
          const emptyState = document.getElementById('emptyState');
          if (emptyState) {
            emptyState.style.display = 'flex';
          }

          closeMobileSidebar();
        });
      }

      // Mobile dropdown functionality
      const mobileDropdownBtn = document.getElementById('mobileDropdownBtn');
      const mobileDropdownMenu = document.getElementById('mobileDropdownMenu');

      if (mobileDropdownBtn && mobileDropdownMenu) {
        mobileDropdownBtn.addEventListener('click', e => {
          e.preventDefault();
          e.stopPropagation();
          mobileDropdownMenu.classList.toggle('show');
          mobileDropdownBtn.classList.toggle('open');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', e => {
          if (!e.target.closest('.mobile-logo-container')) {
            mobileDropdownMenu.classList.remove('show');
            mobileDropdownBtn.classList.remove('open');
          }
        });
      }

      // ðŸ“² SWIPE GESTURE - Open sidebar by swiping from left edge
      let touchStartX = 0;
      let touchStartY = 0;
      let isSwiping = false;

      document.addEventListener(
        'touchstart',
        e => {
          touchStartX = e.touches[0].clientX;
          touchStartY = e.touches[0].clientY;
          // Only track swipe if starting from left edge (within 30px)
          isSwiping = touchStartX < 30 && !mobileSidebar?.classList.contains('open');
        },
        { passive: true }
      );

      document.addEventListener(
        'touchmove',
        e => {
          if (!isSwiping) return;

          const touchX = e.touches[0].clientX;
          const touchY = e.touches[0].clientY;
          const diffX = touchX - touchStartX;
          const diffY = Math.abs(touchY - touchStartY);

          // If horizontal swipe is greater than vertical, open sidebar
          if (diffX > 50 && diffX > diffY) {
            openMobileSidebar();
            isSwiping = false;
          }
        },
        { passive: true }
      );

      document.addEventListener(
        'touchend',
        () => {
          isSwiping = false;
        },
        { passive: true }
      );

      // Header download/share buttons - Direct actions on mobile
      const originalDownloadBtn = document.getElementById('downloadBtn');
      const originalShareBtn = document.getElementById('shareBtn');

      // Menu actions - actually perform download/share
      if (menuDownload) {
        menuDownload.addEventListener('click', () => {
          closeMobileSidebar();
          setTimeout(() => downloadConversation(), 300);
        });
      }

      if (menuShare) {
        menuShare.addEventListener('click', () => {
          closeMobileSidebar();
          setTimeout(() => shareConversation(), 300);
        });
      }

      // ðŸ§  Neon Deep Thinking Icon
      if (elements.neonDeepThinkBtn) {
        elements.neonDeepThinkBtn.addEventListener('click', () => {
          state.selectedAiType = 'reasoning';
          toggleNeonIcon(elements.neonDeepThinkBtn);
        });
      }

      // ðŸŒ Neon Web Search Icon
      if (elements.neonWebSearchBtn) {
        elements.neonWebSearchBtn.addEventListener('click', () => {
          state.selectedAiType = 'web-search';
          toggleNeonIcon(elements.neonWebSearchBtn);
        });
      }

      // ðŸ–¼ï¸ Neon Image Generation Icon (LyDian AI)
      if (elements.neonImageBtn) {
        elements.neonImageBtn.addEventListener('click', () => {
          state.selectedAiType = 'image';
          toggleNeonIcon(elements.neonImageBtn);
          // No toast - only tooltip shows "Aktif"
        });
      }

      // ðŸŽ¥ Video Generation Icon (LyDian AI)
      if (elements.neonVideoBtn) {
        elements.neonVideoBtn.addEventListener('click', () => {
          state.selectedAiType = 'video';
          toggleNeonIcon(elements.neonVideoBtn);
          // No toast - only tooltip shows "Aktif"
        });
      }

      // ðŸŽ¤ Voice Output Mode (LyDian AI TTS)
      if (elements.neonMicBtn) {
        elements.neonMicBtn.addEventListener('click', () => {
          state.selectedAiType = 'voice';
          toggleNeonIcon(elements.neonMicBtn);
        });
      }

      // ðŸ’» Code Mode Icon
      if (elements.neonCodeBtn) {
        elements.neonCodeBtn.addEventListener('click', () => {
          state.selectedAiType = 'code';
          state.selectedModel = 'code-model';
          toggleNeonIcon(elements.neonCodeBtn);
          // No toast message on click
        });
      }

      // ðŸŽ¯ AI MODE SELECTOR BUTTONS (General, Deep Think, Web Search, Code Write)
      document.querySelectorAll('[data-mode]').forEach(btn => {
        btn.addEventListener('click', () => {
          // Remove active from all mode buttons
          document.querySelectorAll('[data-mode]').forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-selected', 'false');
          });
          btn.classList.add('active');
          btn.setAttribute('aria-selected', 'true');
          const mode = btn.getAttribute('data-mode');
          const aiType = btn.getAttribute('data-ai-type') || mode;
          state.selectedAiType = aiType;
          try {
            sessionStorage.setItem('lydian_ai_type', aiType);
          } catch (e) {}
          if (
            typeof ChatAuth !== 'undefined' &&
            ChatAuth.state &&
            ChatAuth.state.isAuthenticated &&
            ChatAuth.updateCustomSetting
          ) {
            ChatAuth.updateCustomSetting('lastAiType', aiType);
          }

          // Update placeholder based on mode
          if (elements.messageInput) {
            if (aiType === 'code-write') {
              elements.messageInput.placeholder = 'Kod isteginizi yazin...';
            } else {
              elements.messageInput.placeholder = "LyDian'a bir sey sorun...";
            }
          }

          // Sync desktop code button active state
          var deskCodeBtn = document.getElementById('desktopCodeBtn');
          if (deskCodeBtn) {
            if (aiType === 'code-write') {
              deskCodeBtn.classList.add('active');
            } else {
              deskCodeBtn.classList.remove('active');
            }
          }

          // Sync header model dropdown
          var headerLabels = {
            general: 'LyDian AI',
            'deep-think': 'Derin DÃ¼ÅŸÃ¼nce',
            'web-search': 'Web Arama',
            'code-write': 'Kod Yaz',
          };
          var headerLabel = document.getElementById('headerModelLabel');
          if (headerLabel) headerLabel.textContent = headerLabels[mode] || 'LyDian AI';
          document.querySelectorAll('.model-dropdown-option').forEach(function (opt) {
            opt.classList.toggle('active', opt.getAttribute('data-header-mode') === mode);
          });

          // No toast on mode switch - silent transition
        });
      });

      // ðŸ¤– MODEL SELECTOR BUTTONS (Advanced, Premium, Ultra, RAG)
      document.querySelectorAll('[data-model]').forEach(btn => {
        btn.addEventListener('click', () => {
          // Remove active from all model buttons
          document.querySelectorAll('[data-model]').forEach(b => b.classList.remove('active'));
          // Add active to clicked button
          btn.classList.add('active');
          // Update state
          state.selectedModel = btn.getAttribute('data-model');
        });
      });

      // ðŸ”— Share Button with Modal
      if (elements.shareBtn) {
        elements.shareBtn.addEventListener('click', () => {
          shareConversation();
        });
      }

      // Plus button dropdown toggle
      if (elements.plusBtn && elements.plusDropdown) {
        elements.plusBtn.addEventListener('click', e => {
          e.stopPropagation();
          elements.plusDropdown.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', e => {
          if (!elements.plusBtn.contains(e.target) && !elements.plusDropdown.contains(e.target)) {
            elements.plusDropdown.classList.remove('show');
          }
        });

        // Plus dropdown items
        const plusDropdownItems = document.querySelectorAll('.plus-dropdown-item');
        plusDropdownItems.forEach(item => {
          item.addEventListener('click', () => {
            const aiType = item.getAttribute('data-ai-type');
            state.selectedAiType = aiType;
            try {
              sessionStorage.setItem('lydian_ai_type', aiType);
            } catch (e) {}
            elements.plusDropdown.classList.remove('show');
          });
        });
      }

      // ========== WEB SEARCH INTEGRATION ==========

      function detectSearchIntent(message) {
        const searchKeywords = [
          /\b(ara|arat|arama yap|internette ara|google|web'de|web arama)\b/i,
          /\b(gÃ¼ncel|son dakika|bugÃ¼n|dÃ¼n|bu hafta|bu ay|haberler)\b/i,
          /\b(hava durumu|dÃ¶viz|kur|borsa|bist|dolar|euro|altÄ±n|bitcoin)\b/i,
          /\b(maÃ§ sonucu|puan durumu|transfer|ÅŸampiyonlar ligi|sÃ¼per lig)\b/i,
          /\b(search|look up|find|google it)\b/i,
        ];
        return searchKeywords.some(pattern => pattern.test(message));
      }

      async function performWebSearch(query) {
        try {
          const cleanQuery = query
            .replace(/\b(ara|arat|arama yap|internette ara|google|web'de bul)\b/gi, '')
            .trim();
          const searchQuery = cleanQuery || query;
          const res = await fetch(
            '/api/web-search?q=' + encodeURIComponent(searchQuery) + '&num=5&language=tr'
          );
          if (!res.ok) return null;
          const data = await res.json();
          if (data.success && data.results && data.results.length > 0) {
            return data.results;
          }
          return null;
        } catch (e) {
          console.warn('[CHAT] Web search failed:', e.message);
          return null;
        }
      }

      function formatSearchContext(results) {
        if (!results || results.length === 0) return '';
        let context =
          '\n\n[WEB ARAMA SONUÃ‡LARI - Bu bilgileri kullanarak gÃ¼ncel ve doÄŸru yanÄ±t ver]:\n';
        results.forEach((r, i) => {
          context += `${i + 1}. ${r.title}\n   ${r.snippet}\n   Kaynak: ${r.displayLink}\n`;
        });
        return context;
      }

      // ========== AI RECALL CLIENT ==========

      // Initialize AI Recall Client for general chat
      let recallClient = null;
      try {
        if (typeof RecallClient === 'undefined') {
          throw new Error('RecallClient class not loaded');
        }
        recallClient = new RecallClient({
          domain: 'general',
          mode: 'hybrid',
          onModeChange: status => {
            updateChatConnectionStatus(status);
          },
          onStatusChange: status => {
            console.log('[AI_CHAT] Status:', status);
          },
        });
        console.log('[AI_CHAT] RecallClient initialized successfully');
      } catch (initError) {
        console.error('[AI_CHAT] Failed to initialize RecallClient:', initError);
      }

      function updateChatConnectionStatus(status) {
        const indicator = document.querySelector('.recall-status-indicator');
        if (indicator) {
          indicator.setAttribute('data-status', status.effectiveMode || status.mode);
          const textEl = indicator.querySelector('.recall-status-text');
          if (textEl) {
            const labels = {
              online: 'Cevrimici',
              offline: 'Cevrimdisi',
              hybrid: 'Hibrit',
            };
            textEl.textContent = labels[status.effectiveMode || status.mode] || status.mode;
          }
        }
      }

      // ========== FUNCTIONS ==========

      async function sendMessage() {
        // Null check for messageInput
        if (!elements.messageInput) {
          console.error('[CHAT] Cannot send message - input element not found');
          return;
        }

        const message = elements.messageInput.value.trim();
        const hasPendingFile = state.pendingFile && state.pendingFile.name;

        // Must have either message or file
        if ((!message && !hasPendingFile) || state.isTyping) return;

        // ðŸ”’ Guest query limit check (10 per day) - check only, increment after success
        if (typeof ChatAuth !== 'undefined' && !ChatAuth.state?.isAuthenticated) {
          var currentQueryCount = getGuestQueryCount();
          if (currentQueryCount >= 10) {
            showQueryLimitModal();
            return;
          }
          // Show warning at 7th query (will become 8th after success)
          if (currentQueryCount === 7) {
            showToast(
              "GÃ¼nlÃ¼k 10 sorgu hakkÄ±nÄ±zÄ±n 8'ini kullandÄ±nÄ±z. SÄ±nÄ±rsÄ±z kullanÄ±m iÃ§in kayÄ±t olun!",
              'warning'
            );
          }
        }

        // Set typing state to prevent duplicate sends
        state.isTyping = true;

        // Desktop: Activate chat layout (move input to bottom)
        if (window.innerWidth > 768 && document.body.classList.contains('desktop-centered')) {
          document.body.classList.remove('chat-initial');
          document.body.classList.add('chat-active');
        }

        // Capture pending file before clearing
        const currentFile = hasPendingFile ? { ...state.pendingFile } : null;

        // Add user message with file attachment if present
        if (currentFile) {
          addMessageWithFile('user', message || `ðŸ“Ž ${currentFile.name}`, currentFile);
        } else {
          addMessage('user', message);
        }

        // Trigger fire sparks animation
        triggerFireSparks();

        // Clear input and file
        elements.messageInput.value = '';
        elements.messageInput.style.height = 'auto';
        if (elements.sendBtn) elements.sendBtn.disabled = true;
        clearFilePreview();

        // Mobile: Close keyboard
        if (window.innerWidth <= 768) {
          elements.messageInput.blur();
        }

        // Reset stats
        if (elements.charCount) elements.charCount.textContent = '0';
        if (elements.tokenCount) elements.tokenCount.textContent = '0';
        if (elements.tokenCountHeader) elements.tokenCountHeader.textContent = '0';
        if (elements.desktopCharCount) elements.desktopCharCount.textContent = '0';
        if (elements.desktopTokenCount) elements.desktopTokenCount.textContent = '0';
        if (elements.mobileCharCount) elements.mobileCharCount.textContent = '0';
        if (elements.mobileTokenCount) elements.mobileTokenCount.textContent = '0';
        // Reset global footer stats
        const globalCharCount = document.getElementById('globalCharCount');
        const globalTokenCount = document.getElementById('globalTokenCount');
        if (globalCharCount) globalCharCount.textContent = '0';
        if (globalTokenCount) globalTokenCount.textContent = '0';

        // Hide empty state
        if (elements.emptyState) {
          elements.emptyState.style.display = 'none';
        }

        // Show typing indicator
        showTypingIndicator();

        // Track start time for speed calculation
        const startTime = Date.now();

        try {
          let result;

          // If there's a file, analyze it
          if (currentFile) {
            result = await analyzeFileWithAI(currentFile, message);
          } else {
            // Check for URL analysis request
            const urlCheck = isUrlAnalysisRequest(message);

            if (urlCheck.isUrlRequest && urlCheck.urls.length > 0) {
              // URL detected - analyze it
              console.log('[CHAT] URL analysis request detected:', urlCheck.urls[0]);
              result = await analyzeUrlWithAI(urlCheck.urls[0], urlCheck.question);
            } else if (state.selectedAiType === 'code-write') {
              // CODE WRITE MODE - SSE Streaming with LyDian Code AI
              console.log('[CHAT] Code write mode - streaming from code-generate API');
              try {
                var codeController = new AbortController();
                var codeTimeout = setTimeout(function () {
                  codeController.abort();
                }, 120000);

                var codeRes = await fetch('/api/code-generate', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  credentials: 'include',
                  signal: codeController.signal,
                  body: JSON.stringify({
                    message: message,
                    stream: true,
                    history: state.messages.slice(-6).map(function (m) {
                      return { role: m.role, content: m.content };
                    }),
                  }),
                });
                clearTimeout(codeTimeout);

                if (!codeRes.ok) {
                  console.error('[CHAT] Code API HTTP error:', codeRes.status);
                  result = {
                    success: false,
                    error: 'Kod motoru geÃ§ici olarak kullanÄ±lamÄ±yor (HTTP ' + codeRes.status + ')',
                  };
                } else {
                  // SSE Streaming: keep typing indicator until first chunk, then show progressive text

                  // Create temporary streaming message bubble (hidden initially)
                  var streamMsgEl = document.createElement('div');
                  streamMsgEl.className = 'message assistant';
                  streamMsgEl.style.display = 'none';
                  streamMsgEl.innerHTML =
                    '<div class="message-avatar"><svg viewBox="0 0 24 24" width="16" height="16" fill="#fff"><path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61z"/></svg></div>' +
                    '<div class="message-content"><div class="message-text"><pre class="code-stream-pre" style="white-space:pre-wrap;word-break:break-word;font-family:\'Fira Code\',\'Cascadia Code\',monospace;font-size:13px;line-height:1.6;color:#d4d4d4;margin:0;padding:0;background:transparent;"></pre></div></div>';
                  elements.messagesContainer.appendChild(streamMsgEl);

                  var streamPreEl = streamMsgEl.querySelector('.code-stream-pre');
                  var reader = codeRes.body.getReader();
                  var decoder = new TextDecoder();
                  var sseBuffer = '';
                  var rawText = '';
                  var finalContent = '';
                  var firstChunkReceived = false;

                  try {
                    while (true) {
                      var chunk = await reader.read();
                      if (chunk.done) break;
                      sseBuffer += decoder.decode(chunk.value, { stream: true });
                      var sseLines = sseBuffer.split('\n');
                      sseBuffer = sseLines.pop() || '';

                      for (var si = 0; si < sseLines.length; si++) {
                        var sseLine = sseLines[si].trim();
                        if (!sseLine || !sseLine.startsWith('data:')) continue;
                        var sseData = sseLine.slice(5).trim();
                        if (sseData === '[DONE]') continue;

                        try {
                          var sseParsed = JSON.parse(sseData);
                          if (sseParsed.error) {
                            result = { success: false, error: sseParsed.error };
                            break;
                          }
                          if (sseParsed.content) {
                            // On first chunk: hide typing indicator, show streaming bubble
                            if (!firstChunkReceived) {
                              firstChunkReceived = true;
                              hideTypingIndicator();
                              streamMsgEl.style.display = '';
                            }
                            rawText += sseParsed.content;
                            streamPreEl.textContent = rawText;
                            streamMsgEl.scrollIntoView({ behavior: 'smooth', block: 'end' });
                          }
                          if (sseParsed.done && sseParsed.full) {
                            finalContent = sseParsed.full;
                          }
                        } catch (parseErr) {
                          // skip malformed SSE chunks
                        }
                      }
                    }
                  } catch (streamErr) {
                    console.error('[CHAT] Code stream read error:', streamErr.message);
                  }

                  // Ensure typing indicator is hidden even if no chunks arrived
                  if (!firstChunkReceived) {
                    hideTypingIndicator();
                  }

                  // Remove temporary streaming bubble
                  streamMsgEl.remove();

                  // Use final sanitized content, or raw text as fallback
                  var responseText = finalContent || rawText;
                  if (responseText) {
                    result = { success: true, response: responseText };
                  } else if (!result) {
                    result = { success: false, error: 'Kod motoru yanÄ±t veremedi' };
                  }
                }
              } catch (codeErr) {
                console.error('[CHAT] Code write fetch error:', codeErr);
                if (codeErr.name === 'AbortError') {
                  result = {
                    success: false,
                    error: 'Kod motoru Ã§ok uzun sÃ¼rdÃ¼. LÃ¼tfen daha kÄ±sa bir istek deneyin.',
                  };
                } else {
                  result = {
                    success: false,
                    error: 'Kod motoruna baÄŸlanÄ±lamadÄ±. LÃ¼tfen tekrar deneyin.',
                  };
                }
              }
            } else {
              // Check if RecallClient is available
              if (!recallClient) {
                throw new Error('AI client not initialized');
              }

              // Check for web search intent (auto-detect or explicit Web Arama mode)
              let searchContext = '';
              const isWebSearchMode = state.selectedAiType === 'web-search';
              if (isWebSearchMode || detectSearchIntent(message)) {
                console.log(
                  '[CHAT] Web search triggered:',
                  isWebSearchMode ? 'explicit mode' : 'keyword detection'
                );
                const searchResults = await performWebSearch(message);
                if (searchResults) {
                  searchContext = formatSearchContext(searchResults);
                  console.log('[CHAT] Web search returned', searchResults.length, 'results');
                }
              }

              // Use RecallClient for AI responses (with search context if available)
              const enhancedMessage = searchContext ? message + searchContext : message;
              // Build conversation history if useHistory is enabled
              const useHistorySetting =
                typeof ChatAuth !== 'undefined' && ChatAuth.state?.settings?.useHistory !== false;
              const chatHistory = useHistorySetting
                ? state.messages.slice(-10).map(m => ({
                    role: m.role,
                    content: m.content,
                  }))
                : [];

              // Configure parameters based on AI mode
              const isDeepThink =
                state.selectedAiType === 'deep-think' || state.selectedAiType === 'reasoning';
              const chatOptions = {
                domain: state.selectedAiType || 'general',
                language: 'tr-TR',
                preferOffline: false,
                conversationHistory: chatHistory,
              };
              if (isDeepThink) {
                chatOptions.temperature = 0.3;
                chatOptions.maxTokens = 8000;
              }

              // REAL SSE STREAMING for regular chat
              try {
                console.log('[CHAT] SSE streaming mode - calling chatStream()');
                var chatStreamRes = await recallClient.chatStream(enhancedMessage, chatOptions);

                // Create temporary streaming message bubble
                var chatStreamEl = document.createElement('div');
                chatStreamEl.className = 'message assistant';
                chatStreamEl.style.display = 'none';
                chatStreamEl.innerHTML =
                  '<div class="message-avatar"><svg viewBox="0 0 24 24" width="16" height="16" fill="#fff"><path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61z"/></svg></div>' +
                  '<div class="message-content"><div class="message-text"></div></div>';
                elements.messagesContainer.appendChild(chatStreamEl);

                var chatStreamTextEl = chatStreamEl.querySelector('.message-text');
                var chatReader = chatStreamRes.body.getReader();
                var chatDecoder = new TextDecoder();
                var chatSseBuffer = '';
                var chatRawText = '';
                var chatFinalContent = '';
                var chatFirstChunk = false;
                var chatFormatCounter = 0;

                try {
                  while (true) {
                    var chatChunk = await chatReader.read();
                    if (chatChunk.done) break;
                    chatSseBuffer += chatDecoder.decode(chatChunk.value, { stream: true });
                    var chatSseLines = chatSseBuffer.split('\n');
                    chatSseBuffer = chatSseLines.pop() || '';

                    for (var ci = 0; ci < chatSseLines.length; ci++) {
                      var chatSseLine = chatSseLines[ci].trim();
                      if (!chatSseLine || !chatSseLine.startsWith('data:')) continue;
                      var chatSseData = chatSseLine.slice(5).trim();
                      if (chatSseData === '[DONE]') continue;

                      try {
                        var chatSseParsed = JSON.parse(chatSseData);
                        if (chatSseParsed.error) {
                          result = { success: false, error: chatSseParsed.error };
                          break;
                        }
                        if (chatSseParsed.content) {
                          // On first chunk: hide typing indicator, show streaming bubble
                          if (!chatFirstChunk) {
                            chatFirstChunk = true;
                            hideTypingIndicator();
                            chatStreamEl.style.display = '';
                          }
                          chatRawText += chatSseParsed.content;
                          // Format with markdown periodically (every 3 chunks) for performance
                          chatFormatCounter++;
                          if (chatFormatCounter % 3 === 0 || chatSseParsed.content.includes('\n')) {
                            chatStreamTextEl.innerHTML = formatMessage(chatRawText);
                          } else {
                            chatStreamTextEl.innerHTML = formatMessage(chatRawText);
                          }
                          chatStreamEl.scrollIntoView({ behavior: 'smooth', block: 'end' });
                        }
                        if (chatSseParsed.done && chatSseParsed.full) {
                          chatFinalContent = chatSseParsed.full;
                        }
                      } catch (chatParseErr) {
                        // skip malformed SSE chunks
                      }
                    }
                  }
                } catch (chatStreamErr) {
                  console.error('[CHAT] Stream read error:', chatStreamErr.message);
                }

                // Ensure typing indicator is hidden even if no chunks arrived
                if (!chatFirstChunk) {
                  hideTypingIndicator();
                }

                // Remove temporary streaming bubble
                chatStreamEl.remove();

                // Use final sanitized content, or raw text as fallback
                var chatResponseText = chatFinalContent || chatRawText;
                if (chatResponseText) {
                  result = { success: true, response: chatResponseText };
                } else if (!result) {
                  result = { success: false, error: 'AI yanÄ±t veremedi' };
                }
              } catch (chatStreamFetchErr) {
                console.warn(
                  '[CHAT] SSE stream failed, falling back to non-streaming:',
                  chatStreamFetchErr.message
                );
                // Fallback to non-streaming mode
                result = await recallClient.chat(enhancedMessage, chatOptions);
              }
            }
          }

          hideTypingIndicator();

          if (result.success || result.response || result.analysis) {
            const responseText = result.response || result.analysis;
            // Pass confidence if available from API
            addMessage('assistant', responseText, result.confidence || null);

            // Auto-open preview for code-write mode
            if (state.selectedAiType === 'code-write') {
              if (window.innerWidth > 768) {
                // Desktop: side panel
                setTimeout(function () {
                  var lastPreviewBtn = document.querySelector(
                    '.message.assistant:last-child .code-preview-btn'
                  );
                  if (lastPreviewBtn) {
                    lastPreviewBtn.click();
                  } else {
                    setTimeout(function () {
                      var retryBtn = document.querySelector(
                        '.message.assistant:last-child .code-preview-btn'
                      );
                      if (retryBtn) retryBtn.click();
                    }, 200);
                  }
                }, 100);
              } else {
                // Mobile: overlay
                setTimeout(function () {
                  var lastPreviewBtn = document.querySelector(
                    '.message.assistant:last-child .code-preview-btn'
                  );
                  if (lastPreviewBtn) lastPreviewBtn.click();
                }, 150);
              }
            }

            // ðŸ”’ Increment guest query count AFTER successful response
            if (typeof ChatAuth !== 'undefined' && !ChatAuth.state?.isAuthenticated) {
              incrementGuestQuery();
            }

            // Save chat after getting response
            saveCurrentChat();

            // Analytics: track message exchange
            if (typeof ChatAuth !== 'undefined') {
              ChatAuth._trackEvent('chat_message', { domain: state.selectedAiType || 'general' });
            }

            // Calculate response time
            const totalTime = Date.now() - startTime;
            const tokensPerSecond = (
              (responseText?.length || 100) /
              4 /
              (totalTime / 1000)
            ).toFixed(1);

            // Display speed
            if (elements.speedDisplay) {
              elements.speedDisplay.style.display = 'inline';
              elements.speedValue.textContent = tokensPerSecond;
            }
          } else {
            addMessage(
              'assistant',
              `**YanÄ±t AlÄ±namadÄ±**\n\n${result.error || 'LÃ¼tfen tekrar deneyin.'}`
            );
          }
          // Reset typing state on success
          state.isTyping = false;
          if (elements.sendBtn) elements.sendBtn.disabled = false;
        } catch (error) {
          console.error('[CHAT] Error:', error);
          hideTypingIndicator();
          addMessage(
            'assistant',
            `**BaÄŸlantÄ± HatasÄ±**\n\nAI sistemi ile iletiÅŸim kurulamadÄ±. LÃ¼tfen tekrar deneyin.`
          );
          // Reset typing state on error
          state.isTyping = false;
          if (elements.sendBtn) elements.sendBtn.disabled = false;
        }
      }

      // Analyze file with AI (ChatGPT-style)
      async function analyzeFileWithAI(file, userQuestion) {
        try {
          // For non-images, we need to read the file as base64
          let base64Data = file.data;

          // If data is a data URL, extract the base64 part
          if (base64Data && base64Data.startsWith('data:')) {
            base64Data = base64Data.split(',')[1];
          }

          // If no base64 data (for documents), read from the file input
          if (!base64Data) {
            const fileInput = document.getElementById('mainFileInput');
            if (fileInput && fileInput.files && fileInput.files[0]) {
              base64Data = await readFileAsBase64(fileInput.files[0]);
            }
          }

          if (!base64Data) {
            throw new Error('Dosya verisi okunamadÄ±');
          }

          const response = await fetch('/api/files/analyze', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              file: base64Data,
              mimeType: file.type,
              fileName: file.name,
              question: userQuestion || '',
            }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Dosya analizi baÅŸarÄ±sÄ±z');
          }

          return await response.json();
        } catch (error) {
          console.error('[FILE_ANALYZE_ERR]', error);
          return { success: false, error: 'Bir hata olustu. Lutfen tekrar deneyin.' };
        }
      }

      // Read file as base64
      function readFileAsBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => {
            const result = reader.result;
            // Extract base64 from data URL
            const base64 = result.split(',')[1];
            resolve(base64);
          };
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      // ============================================================
      // URL DETECTION AND ANALYSIS (LyDian-style URL Analysis)
      // ============================================================

      /**
       * Detect URLs in a message
       */
      function detectUrls(text) {
        const urlRegex = /(https?:\/\/[^\s<>"{}|\\^`[\]]+)/gi;
        const matches = text.match(urlRegex);
        return matches || [];
      }

      /**
       * Check if message is primarily a URL analysis request
       */
      function isUrlAnalysisRequest(text) {
        const urls = detectUrls(text);
        if (urls.length === 0) return { isUrlRequest: false };

        // Keywords that indicate URL analysis intent (Turkish + English)
        const analysisKeywords = [
          'analiz',
          'incele',
          'Ã¶zetle',
          'aÃ§Ä±kla',
          'ne anlatÄ±yor',
          'ne diyor',
          'iÃ§eriÄŸi',
          'hakkÄ±nda',
          'oku',
          'bak',
          'kontrol',
          'analyze',
          'summarize',
          'explain',
          'what',
          'check',
          'read',
          'content',
        ];

        const lowerText = text.toLowerCase();
        const hasAnalysisKeyword = analysisKeywords.some(kw => lowerText.includes(kw));

        // If message contains URL and analysis keyword, or is mostly just a URL
        const textWithoutUrl = text.replace(/(https?:\/\/[^\s]+)/gi, '').trim();
        const isJustUrl = textWithoutUrl.length < 20;

        return {
          isUrlRequest: urls.length > 0 && (hasAnalysisKeyword || isJustUrl),
          urls: urls,
          question: textWithoutUrl || null,
        };
      }

      /**
       * Analyze URL content with AI
       */
      async function analyzeUrlWithAI(url, question) {
        try {
          const response = await fetch('/api/analyze-url', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              url: url,
              question: question || '',
            }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'URL analizi baÅŸarÄ±sÄ±z');
          }

          const result = await response.json();

          if (result.success) {
            // Format response with URL info
            const formattedResponse = `ðŸ”— **URL Analizi**\nðŸ“Œ **BaÅŸlÄ±k:** ${result.title}\nðŸŒ **Kaynak:** ${result.url}\n\n---\n\n${result.analysis}`;
            return {
              success: true,
              response: formattedResponse,
              url: result.url,
              title: result.title,
            };
          } else {
            return { success: false, error: result.error };
          }
        } catch (error) {
          console.error('[URL_ANALYZE_ERR]', error);
          return { success: false, error: 'Bir hata olustu. Lutfen tekrar deneyin.' };
        }
      }

      // Add message with file attachment (ChatGPT style)
      function addMessageWithFile(role, content, file) {
        const message = { role, content, timestamp: Date.now(), file };
        state.messages.push(message);

        if (elements.emptyState && elements.emptyState.style.display !== 'none') {
          elements.emptyState.style.display = 'none';
        }

        const messageEl = document.createElement('div');
        messageEl.className = `message ${role}`;

        // User avatar from localStorage or initial
        var fileAvatarContent = '';
        var fileSavedAvatar = localStorage.getItem('lydian_avatar');
        if (role === 'user' && fileSavedAvatar) {
          fileAvatarContent = '';
        } else if (role === 'user') {
          var fuName = (typeof ChatAuth !== 'undefined' && ChatAuth.state?.user?.displayName) || '';
          fileAvatarContent = fuName.charAt(0).toUpperCase() || 'U';
        } else {
          fileAvatarContent =
            '<svg viewBox="0 0 24 24" width="16" height="16" fill="#fff"><path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61z"/></svg>';
        }

        const timeStr = new Date(message.timestamp).toLocaleTimeString('tr-TR', {
          hour: '2-digit',
          minute: '2-digit',
        });
        const dateStr = new Date(message.timestamp).toLocaleDateString('tr-TR', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
        });

        // Build file preview HTML
        let filePreviewHtml = '';
        const isImage = file.type && file.type.startsWith('image/');

        if (isImage && file.data) {
          filePreviewHtml = `
            <div class="message-file-preview">
              <img src="${file.data}" alt="${file.name}" class="message-image-preview" onclick="openImageModal(this.src)" />
            </div>
          `;
        } else {
          const fileIcon = getFileIcon(file.type);
          filePreviewHtml = `
            <div class="message-file-preview message-file-doc">
              ${fileIcon}
              <span class="file-name">${file.name}</span>
              <span class="file-size">${formatFileSize(file.size)}</span>
            </div>
          `;
        }

        messageEl.innerHTML = `
          <div class="message-avatar">${fileAvatarContent}</div>
          <div class="message-content">
            ${filePreviewHtml}
            ${content ? `<div class="message-text">${formatMessage(content)}</div>` : ''}
            <div class="message-timestamp">${timeStr} â€¢ ${dateStr}</div>
          </div>
        `;

        elements.messagesContainer.appendChild(messageEl);

        // Set user avatar background-image
        if (role === 'user' && fileSavedAvatar) {
          var fAvEl = messageEl.querySelector('.message-avatar');
          if (fAvEl) {
            fAvEl.style.backgroundImage = 'url(' + fileSavedAvatar + ')';
            fAvEl.style.backgroundSize = 'cover';
            fAvEl.style.backgroundPosition = 'center';
          }
        }

        messageEl.scrollIntoView({ behavior: 'smooth', block: 'end' });

        // Apply syntax highlighting
        if (typeof hljs !== 'undefined') {
          messageEl.querySelectorAll('.code-block-content code:not(.hljs)').forEach(function (el) {
            hljs.highlightElement(el);
          });
        }
      }

      // Get file icon based on type
      function getFileIcon(mimeType) {
        if (mimeType?.includes('pdf')) {
          return '<svg viewBox="0 0 24 24" width="32" height="32" fill="#e53935"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/></svg>';
        } else if (mimeType?.includes('word') || mimeType?.includes('document')) {
          return '<svg viewBox="0 0 24 24" width="32" height="32" fill="#1976d2"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/><path d="M8 12h8v2H8zm0 3h8v2H8z"/></svg>';
        } else {
          return '<svg viewBox="0 0 24 24" width="32" height="32" fill="#ffffff"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>';
        }
      }

      // Format file size
      function formatFileSize(bytes) {
        if (!bytes) return '';
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
      }

      // Open image in modal
      function openImageModal(src) {
        const modal = document.createElement('div');
        modal.className = 'image-modal-overlay';
        modal.innerHTML = `
          <div class="image-modal-content">
            <img src="${src}" alt="Preview" />
            <button class="image-modal-close" onclick="this.parentElement.parentElement.remove()">
              <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"/>
              </svg>
            </button>
          </div>
        `;
        modal.onclick = e => {
          if (e.target === modal) modal.remove();
        };
        document.body.appendChild(modal);
      }

      function addMessage(role, content, confidence = null) {
        const message = { role, content, timestamp: Date.now(), confidence };
        state.messages.push(message);

        // AI response: trigger sound and push notification
        if (role === 'assistant' && typeof ChatAuth !== 'undefined' && ChatAuth.state?.settings) {
          if (ChatAuth.state.settings.soundEnabled) {
            ChatAuth._playNotificationSound();
          }
          ChatAuth._sendPushNotification('AiLydian', content);
        }

        // Ä°lk mesaj gÃ¶nderildiÄŸinde empty state'i gizle
        if (elements.emptyState && elements.emptyState.style.display !== 'none') {
          elements.emptyState.style.display = 'none';
        }

        const messageEl = document.createElement('div');
        messageEl.className = `message ${role}`;

        // Premium icons: User gets person icon or uploaded avatar, AI gets LyDian sparkle
        let avatarContent = '';
        if (role === 'user') {
          const savedAvatar = localStorage.getItem('lydian_avatar');
          if (savedAvatar) {
            avatarContent = ''; // Will use background-image
          } else {
            avatarContent =
              '<svg viewBox="0 0 24 24" width="16" height="16" fill="#fff"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>';
          }
        } else {
          avatarContent =
            '<svg viewBox="0 0 24 24" width="16" height="16" fill="#fff"><path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61z"/></svg>';
        }

        const timeStr = new Date(message.timestamp).toLocaleTimeString('tr-TR', {
          hour: '2-digit',
          minute: '2-digit',
        });
        const dateStr = new Date(message.timestamp).toLocaleDateString('tr-TR', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
        });

        // Build confidence badge HTML if available
        let confidenceBadgeHtml = '';
        if (role === 'assistant' && confidence) {
          const levelClass =
            confidence.level === 'high' ? 'high' : confidence.level === 'medium' ? 'medium' : 'low';
          const researchTip = confidence.suggestResearch
            ? '<span class="research-tip">AraÅŸtÄ±rma Ã¶nerilir</span>'
            : '';
          confidenceBadgeHtml = `
            <div class="response-confidence">
              <span class="confidence-badge confidence-${levelClass}">
                <svg viewBox="0 0 24 24" width="14" height="14">
                  <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                %${confidence.percentage} DoÄŸruluk
              </span>
              ${researchTip}
            </div>
          `;
        }

        // Generate suggestion chips HTML for assistant messages
        let suggestionsHtml = '';
        if (role === 'assistant') {
          const suggestions = generateSuggestions(content, state.messages);
          if (suggestions.length > 0) {
            suggestionsHtml = `
              <div class="suggestion-chips-container">
                ${suggestions
                  .map(
                    s => `
                  <button class="suggestion-chip" data-suggestion="${escapeHtml(s.text)}">
                    <span>${escapeHtml(s.text)}</span>
                  </button>
                `
                  )
                  .join('')}
              </div>
            `;
          }
        }

        // Build actions HTML
        var actionsHtml =
          role === 'assistant'
            ? '<div class="message-actions">' +
              '<button class="message-action-btn copy-btn-small" onclick="copyMessage(this)" title="Kopyala"><svg viewBox="0 0 24 24" width="14" height="14"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button>' +
              '<button class="message-action-btn" onclick="regenerateMessage(this)" title="Yeniden OluÅŸtur"><svg viewBox="0 0 24 24" width="14" height="14"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg></button>' +
              '<span class="feedback-separator"></span>' +
              '<button class="feedback-btn" onclick="feedbackMessage(this, \'up\')" title="Iyi yanit"><svg viewBox="0 0 24 24" width="14" height="14"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg></button>' +
              '<button class="feedback-btn" onclick="feedbackMessage(this, \'down\')" title="Kotu yanit"><svg viewBox="0 0 24 24" width="14" height="14"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"/></svg></button>' +
              '</div>' +
              suggestionsHtml
            : '<div class="message-actions user-actions">' +
              '<button class="message-action-btn copy-btn-small" onclick="copyMessage(this)" title="Kopyala"><svg viewBox="0 0 24 24" width="14" height="14"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button>' +
              '</div>';

        messageEl.innerHTML =
          '<div class="message-avatar">' +
          avatarContent +
          '</div>' +
          '<div class="message-content">' +
          '<div class="message-text">' +
          (role === 'assistant' ? '' : formatMessage(content)) +
          '</div>' +
          confidenceBadgeHtml +
          '<div class="message-timestamp">' +
          timeStr +
          ' &bull; ' +
          dateStr +
          '</div>' +
          actionsHtml +
          '</div>';

        elements.messagesContainer.appendChild(messageEl);

        // Set user avatar background-image if available
        if (role === 'user') {
          var savedAv = localStorage.getItem('lydian_avatar');
          if (savedAv) {
            var avEl = messageEl.querySelector('.message-avatar');
            if (avEl) {
              avEl.style.backgroundImage = 'url(' + savedAv + ')';
              avEl.style.backgroundSize = 'cover';
              avEl.style.backgroundPosition = 'center';
              avEl.textContent = '';
            }
          }
        }

        // Typewriter effect for assistant messages
        if (role === 'assistant' && content.length > 20) {
          var textEl = messageEl.querySelector('.message-text');
          var words = content.split(/(\s+)/);
          var twIdx = 0;
          var twAccum = '';
          var twFormatAt = 0;

          function twTick() {
            if (twIdx >= words.length) {
              // Final render with full formatting
              textEl.innerHTML = formatMessage(content);
              if (typeof hljs !== 'undefined') {
                messageEl
                  .querySelectorAll('.code-block-content code:not(.hljs)')
                  .forEach(function (el) {
                    hljs.highlightElement(el);
                  });
              }
              // Bind suggestion chips
              messageEl.querySelectorAll('.suggestion-chip').forEach(function (chip) {
                chip.addEventListener('click', function () {
                  var st = chip.dataset.suggestion;
                  if (st && elements.messageInput) {
                    elements.messageInput.value = st;
                    elements.messageInput.focus();
                    elements.messageInput.dispatchEvent(new Event('input'));
                  }
                });
              });
              return;
            }
            // Add 3-5 words per frame
            var batch = 3 + Math.floor(Math.random() * 3);
            for (var i = 0; i < batch && twIdx < words.length; i++) {
              twAccum += words[twIdx++];
            }
            // Format every ~15 words for smooth markdown rendering
            if (twIdx >= words.length || twIdx - twFormatAt >= 15) {
              textEl.innerHTML = formatMessage(twAccum) + '<span class="tw-cursor"></span>';
              twFormatAt = twIdx;
            }
            messageEl.scrollIntoView({ behavior: 'smooth', block: 'end' });
            setTimeout(twTick, 25);
          }
          requestAnimationFrame(twTick);
        } else {
          // Short messages or user messages: render immediately
          if (role === 'assistant') {
            messageEl.querySelector('.message-text').innerHTML = formatMessage(content);
          }
          messageEl.scrollIntoView({ behavior: 'smooth', block: 'end' });

          if (typeof hljs !== 'undefined') {
            messageEl
              .querySelectorAll('.code-block-content code:not(.hljs)')
              .forEach(function (el) {
                hljs.highlightElement(el);
              });
          }
          if (role === 'assistant') {
            messageEl.querySelectorAll('.suggestion-chip').forEach(function (chip) {
              chip.addEventListener('click', function () {
                var st = chip.dataset.suggestion;
                if (st && elements.messageInput) {
                  elements.messageInput.value = st;
                  elements.messageInput.focus();
                  elements.messageInput.dispatchEvent(new Event('input'));
                }
              });
            });
          }
        }
      }

      function showTypingIndicator() {
        state.isTyping = true;
        var typingLabel = 'DÃ¼ÅŸÃ¼nÃ¼yor';
        const indicator = document.createElement('div');
        indicator.className = 'message assistant';
        indicator.id = 'typingIndicator';
        indicator.innerHTML = `
                <div class="message-avatar">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="#fff"><path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61z"/></svg>
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <span class="typing-text">
                            ${typingLabel}<span class="typing-dots"><span></span><span></span><span></span></span>
                        </span>
                    </div>
                </div>
            `;
        elements.messagesContainer.appendChild(indicator);
        indicator.scrollIntoView({ behavior: 'smooth' });
      }

      function hideTypingIndicator() {
        state.isTyping = false;
        const indicator = document.getElementById('typingIndicator');
        if (indicator) {
          indicator.remove();
        }
      }

      function triggerFireSparks() {
        const container = document.getElementById('fireSparks');
        if (!container) return;

        // Create 25 sparks
        const sparkCount = 25;
        const colors = ['#10A37F', '#FF6B4A', '#FFFFFF']; // Teal, orange, white for dark theme

        for (let i = 0; i < sparkCount; i++) {
          const spark = document.createElement('div');
          spark.className = 'spark';

          // Random properties
          const startX = Math.random() * 100; // Random horizontal position (0-100%)
          const drift = (Math.random() - 0.5) * 100; // Random drift (-50px to +50px)
          const duration = 1.5 + Math.random() * 1; // Duration between 1.5s - 2.5s
          const delay = Math.random() * 0.3; // Stagger start times
          const size = 4 + Math.random() * 2; // Size between 4px - 6px
          const color = colors[Math.floor(Math.random() * colors.length)];

          // Apply styles
          spark.style.left = `${startX}%`;
          spark.style.width = `${size}px`;
          spark.style.height = `${size}px`;
          spark.style.background = color;
          spark.style.boxShadow = `0 0 4px ${color}`;
          spark.style.animationDuration = `${duration}s`;
          spark.style.animationDelay = `${delay}s`;
          spark.style.setProperty('--drift', `${drift}px`);

          container.appendChild(spark);

          // Remove spark after animation completes
          setTimeout(
            () => {
              spark.remove();
            },
            (duration + delay) * 1000
          );
        }
      }

      function formatMessage(text) {
        // Code-write mode fallback: if no triple backticks found but has HTML-like content, wrap it
        if (state.selectedAiType === 'code-write' && text.indexOf('```') === -1) {
          var codeMatch = text.match(
            /(<(!DOCTYPE|html|head|body|div|span|script|style|link|meta|form|input|button|table|section|header|footer|nav|main|article|aside|canvas|svg)\b[\s\S]{50,})/i
          );
          if (codeMatch) {
            var idx = text.indexOf(codeMatch[0]);
            var before = text.substring(0, idx).trim();
            var code = codeMatch[0].trim();
            text = (before ? before + '\n\n' : '') + '```html\n' + code + '\n```';
          }
        }

        // Phase 1: Extract code blocks (``` ... ```) and protect from inline formatting
        const codeBlocks = [];
        let processed = text.replace(/```(\w*)\n?([\s\S]*?)```/g, function (match, lang, code) {
          const id = '__CODE_BLOCK_' + codeBlocks.length + '__';
          codeBlocks.push({ lang: lang || 'text', code: code.trim() });
          return id;
        });

        // Phase 2: Inline formatting (bold, italic, inline code, images, links)
        processed = processed
          .split('\n')
          .map(function (line) {
            return '<p>' + escapeHtml(line) + '</p>';
          })
          .join('')
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/`(.*?)`/g, '<code>$1</code>')
          .replace(/!\[(.*?)\]\((https?:\/\/[^\)]+)\)/g, function (match, alt, url) {
            return (
              '<div style="position: relative; display: inline-block; margin: 10px 0;">' +
              '<img src="' +
              url +
              '" alt="' +
              alt +
              '" style="max-width: 100%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">' +
              '<a href="' +
              url +
              '" download target="_blank" style="position: absolute; bottom: 12px; right: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: 500; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4); transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;">' +
              '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>' +
              'Indir</a></div>'
            );
          })
          .replace(
            /\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g,
            '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'
          );

        // Phase 3: Re-inject code blocks with rich UI (header, copy, preview)
        codeBlocks.forEach(function (block, i) {
          var langLower = block.lang.toLowerCase();
          var codeLower = block.code.toLowerCase();
          var isPreviewable =
            ['html', 'htm', 'svg'].indexOf(langLower) !== -1 ||
            codeLower.indexOf('<html') !== -1 ||
            codeLower.indexOf('<!doctype') !== -1 ||
            (block.code.indexOf('<') !== -1 &&
              block.code.indexOf('</') !== -1 &&
              ['css', 'javascript', 'js'].indexOf(langLower) === -1) ||
            (state.selectedAiType === 'code-write' &&
              block.code.indexOf('<') !== -1 &&
              block.code.indexOf('>') !== -1);
          var previewBtn = isPreviewable
            ? '<button class="code-preview-btn" onclick="openCodePreview(this)" title="Canli Onizleme">' +
              '<svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>' +
              ' GÃ¶r</button>'
            : '';

          var codeHtml =
            '<div class="code-block-container" data-language="' +
            block.lang +
            '">' +
            '<div class="code-block-header">' +
            '<span class="code-lang-badge">' +
            block.lang +
            '</span>' +
            '<div class="code-block-actions">' +
            previewBtn +
            '<button class="code-copy-btn" onclick="copyCodeBlock(this)" title="Kopyala">' +
            '<svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>' +
            ' Kopyala</button>' +
            '</div>' +
            '</div>' +
            '<pre class="code-block-content"><code class="language-' +
            block.lang +
            '">' +
            escapeHtml(block.code) +
            '</code></pre>' +
            '</div>';

          processed = processed.replace('__CODE_BLOCK_' + i + '__', codeHtml);
        });

        return processed;
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // â•â•â• HEADER MODEL DROPDOWN â•â•â•
      function toggleModelDropdown() {
        var dropdown = document.getElementById('headerModelDropdown');
        var selector = document.getElementById('headerModelSelector');
        if (!dropdown) return;
        var isOpen = dropdown.classList.contains('show');
        dropdown.classList.toggle('show');
        if (selector) selector.classList.toggle('open');
      }

      function selectHeaderModel(mode, btnEl, event) {
        if (event) {
          event.stopPropagation();
        }
        // Update dropdown UI
        document.querySelectorAll('.model-dropdown-option').forEach(function (el) {
          el.classList.remove('active');
        });
        if (btnEl) btnEl.classList.add('active');

        // Update header label
        var labels = {
          general: 'LyDian AI',
          'deep-think': 'Derin DÃ¼ÅŸÃ¼nce',
          'web-search': 'Web Arama',
          'code-write': 'Kod Yaz',
        };
        var label = document.getElementById('headerModelLabel');
        if (label) label.textContent = labels[mode] || 'LyDian AI';

        // Close dropdown
        var dropdown = document.getElementById('headerModelDropdown');
        var selector = document.getElementById('headerModelSelector');
        if (dropdown) dropdown.classList.remove('show');
        if (selector) selector.classList.remove('open');

        // Sync with inline mode buttons
        var inlineBtn = document.querySelector('[data-mode="' + mode + '"]');
        if (inlineBtn) {
          document.querySelectorAll('.mode-btn').forEach(function (el) {
            el.classList.remove('active');
          });
          inlineBtn.classList.add('active');
          inlineBtn.click();
        }
      }

      // Close dropdown on outside click
      document.addEventListener('click', function (e) {
        var selector = document.getElementById('headerModelSelector');
        var dropdown = document.getElementById('headerModelDropdown');
        if (selector && dropdown && !selector.contains(e.target)) {
          dropdown.classList.remove('show');
          selector.classList.remove('open');
        }
      });

      // â•â•â• SETTINGS TAB NAVIGATION â•â•â•
      function switchSettingsTab(tabName, btnEl) {
        // Hide all tab contents
        document.querySelectorAll('.settings-tab-content').forEach(function (el) {
          el.classList.remove('active');
        });
        // Deactivate all tab buttons
        document.querySelectorAll('.settings-tab-btn').forEach(function (el) {
          el.classList.remove('active');
        });
        // Show selected tab
        var tabMap = {
          profil: 'settingsTabProfil',
          gorunum: 'settingsTabGorunum',
          ai: 'settingsTabAI',
          gizlilik: 'settingsTabGizlilik',
          guvenlik: 'settingsTabGuvenlik',
        };
        var targetId = tabMap[tabName];
        if (targetId) {
          var target = document.getElementById(targetId);
          if (target) target.classList.add('active');
        }
        // Activate button
        if (btnEl) btnEl.classList.add('active');

        // Load security data when GÃ¼venlik tab opens
        if (
          tabName === 'guvenlik' &&
          typeof ChatAuth !== 'undefined' &&
          ChatAuth.state &&
          ChatAuth.state.isAuthenticated
        ) {
          try {
            if (ChatAuth.loadActiveSessions) ChatAuth.loadActiveSessions();
            if (ChatAuth.updateSecurityStatus) ChatAuth.updateSecurityStatus();
            if (ChatAuth.loadLastLoginInfo) ChatAuth.loadLastLoginInfo();
            if (ChatAuth._update2FAUIState)
              ChatAuth._update2FAUIState(
                ChatAuth.state.user && ChatAuth.state.user.twoFactorEnabled === true
              );
          } catch (e) {}
        }
      }

      // â•â•â• CODE PREVIEW & COPY FUNCTIONS â•â•â•

      function openCodePreview(btn) {
        var container = btn.closest('.code-block-container');
        var code = container.querySelector('code').textContent;

        // Build full HTML document for preview
        var htmlContent = code;
        if (code.indexOf('<html') === -1 && code.indexOf('<!DOCTYPE') === -1) {
          htmlContent =
            '<!DOCTYPE html>\n<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">\n<style>*{box-sizing:border-box}body{font-family:system-ui,-apple-system,sans-serif;margin:20px;}</style></head>\n<body>' +
            code +
            '</body></html>';
        }

        // DESKTOP: Side Panel (manus.com style)
        if (window.innerWidth > 768) {
          var panel = document.getElementById('codeSidePanel');
          var iframe = document.getElementById('sidePanelIframe');
          var sourceEl = document.getElementById('sidePanelSource');
          if (!panel || !iframe) return;

          // Set content
          iframe.srcdoc = htmlContent;
          sourceEl.textContent = code;

          // Reset tabs to Preview
          var tabs = panel.querySelectorAll('.code-preview-tab[data-view]');
          tabs.forEach(function (t) {
            t.classList.remove('active');
          });
          var previewTab = panel.querySelector('.code-preview-tab[data-view="preview"]');
          if (previewTab) previewTab.classList.add('active');
          iframe.style.display = 'block';
          sourceEl.style.display = 'none';

          // Open panel
          panel.classList.add('open');
          document.body.classList.add('side-panel-open');

          // Setup event listeners (only once)
          if (!panel._listenersAttached) {
            panel._listenersAttached = true;

            // Tab switching
            tabs.forEach(function (tab) {
              tab.addEventListener('click', function () {
                tabs.forEach(function (t) {
                  t.classList.remove('active');
                });
                tab.classList.add('active');
                if (tab.dataset.view === 'preview') {
                  iframe.style.display = 'block';
                  sourceEl.style.display = 'none';
                } else {
                  iframe.style.display = 'none';
                  sourceEl.style.display = 'block';
                }
              });
            });

            // Refresh
            document.getElementById('sidePanelRefresh').addEventListener('click', function () {
              var currentSrcdoc = iframe.srcdoc;
              iframe.srcdoc = '';
              setTimeout(function () {
                iframe.srcdoc = currentSrcdoc;
              }, 50);
            });

            // Close
            document.getElementById('sidePanelClose').addEventListener('click', function () {
              closeSidePanel();
            });
          }

          // ESC to close
          var escHandler = function (e) {
            if (e.key === 'Escape') {
              closeSidePanel();
              document.removeEventListener('keydown', escHandler);
            }
          };
          document.addEventListener('keydown', escHandler);
        } else {
          // MOBILE: Full-screen overlay (existing behavior)
          var overlay = document.createElement('div');
          overlay.className = 'code-preview-overlay';
          overlay.innerHTML =
            '<div class="code-preview-container">' +
            '<div class="code-preview-header">' +
            '<div class="code-preview-tabs">' +
            '<div class="code-preview-tab active" data-view="preview">GÃ¶r</div>' +
            '<div class="code-preview-tab" data-view="code">Kod</div>' +
            '</div>' +
            '<div style="display:flex;gap:8px;align-items:center;">' +
            '<button class="code-preview-tab" id="previewRefreshBtn">Yenile</button>' +
            '<button class="code-preview-close-btn" id="previewCloseBtn">\u2715</button>' +
            '</div>' +
            '</div>' +
            '<iframe class="code-preview-iframe" sandbox="allow-scripts allow-modals"></iframe>' +
            '<pre class="code-preview-source" style="display:none;flex:1;overflow:auto;padding:20px;margin:0;background:#1e1e1e;color:#d4d4d4;font-size:13px;line-height:1.6;"></pre>' +
            '</div>';

          document.body.appendChild(overlay);

          var mobileIframe = overlay.querySelector('iframe');
          mobileIframe.srcdoc = htmlContent;

          var mobileSource = overlay.querySelector('.code-preview-source');
          mobileSource.textContent = code;

          var mobileTabs = overlay.querySelectorAll('.code-preview-tab[data-view]');
          mobileTabs.forEach(function (tab) {
            tab.addEventListener('click', function () {
              mobileTabs.forEach(function (t) {
                t.classList.remove('active');
              });
              tab.classList.add('active');
              if (tab.dataset.view === 'preview') {
                mobileIframe.style.display = 'block';
                mobileSource.style.display = 'none';
              } else {
                mobileIframe.style.display = 'none';
                mobileSource.style.display = 'block';
              }
            });
          });

          overlay.querySelector('#previewRefreshBtn').addEventListener('click', function () {
            mobileIframe.srcdoc = htmlContent;
          });
          overlay.querySelector('#previewCloseBtn').addEventListener('click', function () {
            overlay.remove();
          });
          overlay.addEventListener('click', function (e) {
            if (e.target === overlay) overlay.remove();
          });
          var mobileEsc = function (e) {
            if (e.key === 'Escape') {
              overlay.remove();
              document.removeEventListener('keydown', mobileEsc);
            }
          };
          document.addEventListener('keydown', mobileEsc);
        }
      }

      function closeSidePanel() {
        var panel = document.getElementById('codeSidePanel');
        if (panel) panel.classList.remove('open');
        document.body.classList.remove('side-panel-open');
      }

      function copyCodeBlock(btn) {
        var code = btn.closest('.code-block-container').querySelector('code').textContent;
        navigator.clipboard
          .writeText(code)
          .then(function () {
            var original = btn.innerHTML;
            btn.innerHTML =
              '<svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Kopyalandi';
            setTimeout(function () {
              btn.innerHTML = original;
            }, 2000);
          })
          .catch(function () {
            // Fallback for older browsers
            var textarea = document.createElement('textarea');
            textarea.value = code;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            var original = btn.innerHTML;
            btn.innerHTML =
              '<svg viewBox="0 0 24 24" width="14" height="14"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Kopyalandi';
            setTimeout(function () {
              btn.innerHTML = original;
            }, 2000);
          });
      }

      /**
       * Generate contextual suggestions based on conversation
       * ChatGPT-style follow-up suggestions
       */
      function generateSuggestions(aiResponse, messages) {
        const suggestions = [];
        const lastUserMessage =
          messages
            .filter(m => m.role === 'user')
            .pop()
            ?.content?.toLowerCase() || '';
        const responseLower = aiResponse.toLowerCase();

        // Konu bazlÄ± Ã¶neriler - Ä°KONLARLA
        const topicSuggestions = {
          // Programlama ve Teknoloji
          kod: [
            { text: 'Bu kodu optimize edebilir misin?', icon: '' },
            { text: 'Hata ayÄ±klama iÃ§in Ã¶nerilerin var mÄ±?', icon: 'ðŸ”§' },
            { text: 'Alternatif bir yaklaÅŸÄ±m gÃ¶sterir misin?', icon: 'ðŸ”„' },
          ],
          python: [
            { text: 'Bu kodu daha Pythonic yapabilir misin?', icon: 'ðŸ' },
            { text: 'Unit test ornekleri ekler misin?', icon: '' },
            { text: 'Performans iyileÅŸtirmeleri Ã¶ner', icon: 'ðŸš€' },
          ],
          javascript: [
            { text: 'Modern ES6+ syntax ile yaz', icon: 'âœ¨' },
            { text: 'TypeScript versiyonunu gÃ¶ster', icon: 'ðŸ“˜' },
            { text: 'Error handling ekle', icon: 'ðŸ›¡ï¸' },
          ],

          // Genel Bilgi
          tarih: [
            { text: 'Bu dÃ¶nemin Ã¶nemli olaylarÄ± neler?', icon: 'ðŸ“œ' },
            { text: 'Daha detaylÄ± anlatÄ±r mÄ±sÄ±n?', icon: 'ðŸ”' },
            { text: 'GÃ¼nÃ¼mÃ¼ze etkileri neler?', icon: 'ðŸŒ' },
          ],

          // SaÄŸlÄ±k
          saÄŸlÄ±k: [
            { text: 'Belirtiler ne anlama geliyor?', icon: 'ðŸ©º' },
            { text: 'Hangi uzmanÄ± gÃ¶rmeliyim?', icon: 'ðŸ‘¨â€âš•ï¸' },
            { text: 'Ã–nleme yÃ¶ntemleri neler?', icon: 'ðŸ’ª' },
          ],

          // Finans
          finans: [
            { text: 'YatÄ±rÄ±m stratejileri Ã¶ner', icon: 'ðŸ“ˆ' },
            { text: 'Risk analizi yapabilir misin?', icon: 'âš–ï¸' },
            { text: 'Alternatif seÃ§enekler neler?', icon: 'ðŸ’¡' },
          ],

          // EÄŸitim
          Ã¶ÄŸren: [
            { text: 'Pratik Ã¶rnekler verebilir misin?', icon: 'ðŸ“' },
            { text: 'Kaynak Ã¶nerilerin var mÄ±?', icon: 'ðŸ“š' },
            { text: 'AdÄ±m adÄ±m anlat', icon: 'ðŸŽ¯' },
          ],

          // Yemek ve Tarif
          tarif: [
            { text: 'Malzeme listesi verir misin?', icon: 'ðŸ¥—' },
            { text: 'PiÅŸirme sÃ¼resi ne kadar?', icon: 'â±ï¸' },
            { text: 'Vegan alternatifi var mÄ±?', icon: 'ðŸŒ±' },
          ],

          // Seyahat
          seyahat: [
            { text: 'En iyi zaman ne zaman?', icon: 'ðŸ“…' },
            { text: 'BÃ¼tÃ§e Ã¶nerisi verir misin?', icon: 'ðŸ’°' },
            { text: 'GÃ¶rÃ¼lmesi gereken yerler neler?', icon: 'ðŸ“' },
          ],
        };

        // Genel Ã¶neriler (fallback) - Ä°KONLARLA
        const generalSuggestions = [
          { text: 'Daha detaylÄ± aÃ§Ä±klar mÄ±sÄ±n?', icon: 'ðŸ”' },
          { text: 'BaÅŸka Ã¶rnekler verebilir misin?', icon: 'ðŸ’¡' },
          { text: 'Bu konuda nelere dikkat etmeliyim?', icon: '' },
          { text: 'Ã–zet geÃ§ebilir misin?', icon: 'ðŸ“‹' },
        ];

        // YanÄ±t iÃ§eriÄŸine gÃ¶re Ã¶neriler
        if (
          responseLower.includes('kod') ||
          responseLower.includes('function') ||
          responseLower.includes('class')
        ) {
          suggestions.push(...(topicSuggestions.kod || []));
        }
        if (responseLower.includes('python') || lastUserMessage.includes('python')) {
          suggestions.push(...(topicSuggestions.python || []));
        }
        if (
          responseLower.includes('javascript') ||
          responseLower.includes('js') ||
          lastUserMessage.includes('javascript')
        ) {
          suggestions.push(...(topicSuggestions.javascript || []));
        }
        if (
          responseLower.includes('tarih') ||
          responseLower.includes('yÃ¼zyÄ±l') ||
          responseLower.includes('dÃ¶nem')
        ) {
          suggestions.push(...(topicSuggestions.tarih || []));
        }
        if (
          responseLower.includes('saÄŸlÄ±k') ||
          responseLower.includes('hastalÄ±k') ||
          responseLower.includes('tedavi')
        ) {
          suggestions.push(...(topicSuggestions.saÄŸlÄ±k || []));
        }
        if (
          responseLower.includes('yatÄ±rÄ±m') ||
          responseLower.includes('finans') ||
          responseLower.includes('para')
        ) {
          suggestions.push(...(topicSuggestions.finans || []));
        }
        if (
          responseLower.includes('tarif') ||
          responseLower.includes('yemek') ||
          responseLower.includes('piÅŸir')
        ) {
          suggestions.push(...(topicSuggestions.tarif || []));
        }
        if (
          responseLower.includes('seyahat') ||
          responseLower.includes('gezi') ||
          responseLower.includes('tur')
        ) {
          suggestions.push(...(topicSuggestions.seyahat || []));
        }

        // EÄŸer konu bazlÄ± Ã¶neri bulunamadÄ±ysa genel Ã¶neriler
        if (suggestions.length === 0) {
          suggestions.push(...generalSuggestions);
        }

        // Benzersiz ve max 3 Ã¶neri dÃ¶ndÃ¼r
        const uniqueSuggestions = [...new Map(suggestions.map(s => [s.text, s])).values()];
        return uniqueSuggestions.slice(0, 3);
      }

      function startNewChat() {
        // Save current chat before clearing (prevents history loss)
        if (state.messages.length > 0 && state.currentChatId) {
          saveCurrentChat();
          saveCurrentChatToHistory();
        }
        state.messages = [];
        state.currentChatId = null;

        // Desktop: Reset to initial centered state
        if (window.innerWidth > 768 && document.body.classList.contains('desktop-centered')) {
          document.body.classList.remove('chat-active');
          document.body.classList.add('chat-initial');
        }

        elements.messagesContainer.innerHTML = `
                <div class="empty-state" id="emptyState">
                    <div class="particles" id="particles"></div>
                    <div class="user-welcome-text" id="userWelcomeText">
                        <div class="welcome-user-name" id="welcomeUserName">${getTimeGreeting()}</div>
                        <div class="welcome-message">Size NasÄ±l YardÄ±mcÄ± Olabilirim?</div>
                    </div>
                    <div class="mini-spinner-container">
                        <div class="mini-spinner">
                            <svg viewBox="-60 -60 120 120" width="120" height="120" role="img" aria-label="LyDian orbit">
                                <defs>
                                    <radialGradient id="g-core-2" cx="50%" cy="50%" r="50%">
                                        <stop offset="0%" stop-color="#7C5CFF" stop-opacity="1" />
                                        <stop offset="60%" stop-color="#00E0FF" stop-opacity="0.4" />
                                        <stop offset="100%" stop-color="#0B0F19" stop-opacity="0" />
                                    </radialGradient>
                                    <linearGradient id="g-1-2" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" stop-color="#7C5CFF" />
                                        <stop offset="100%" stop-color="#00E0FF" />
                                    </linearGradient>
                                    <linearGradient id="g-2-2" x1="0%" y1="100%" x2="100%" y2="0%">
                                        <stop offset="0%" stop-color="#00E0FF" />
                                        <stop offset="100%" stop-color="#FF9D00" />
                                    </linearGradient>
                                    <linearGradient id="g-3-2" x1="100%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#FF9D00" />
                                        <stop offset="100%" stop-color="#7C5CFF" />
                                    </linearGradient>
                                </defs>
                                <circle r="48" fill="url(#g-core-2)" opacity="0.2" />
                                <g class="lydian-orbit-ring-1">
                                    <ellipse rx="50" ry="30" fill="none" stroke="url(#g-1-2)" stroke-opacity="0.7" stroke-width="0.8" />
                                    <circle cx="50" cy="0" r="2" fill="#00E0FF" />
                                    <circle cx="-50" cy="0" r="2" fill="#00E0FF" />
                                </g>
                                <g class="lydian-orbit-ring-2">
                                    <circle r="38" fill="none" stroke="url(#g-2-2)" stroke-opacity="0.8" stroke-width="0.8" />
                                    <circle cx="38" cy="0" r="1.5" fill="#FF9D00" />
                                    <circle cx="-38" cy="0" r="1.5" fill="#FF9D00" />
                                    <circle cx="0" cy="38" r="1.5" fill="#FF9D00" />
                                    <circle cx="0" cy="-38" r="1.5" fill="#FF9D00" />
                                </g>
                                <g class="lydian-orbit-ring-3">
                                    <circle r="25" fill="none" stroke="url(#g-3-2)" stroke-opacity="0.9" stroke-width="1" stroke-dasharray="1.5 5" />
                                </g>
                                <g class="lydian-lissajous">
                                    <circle r="2.5" fill="#7C5CFF" />
                                </g>
                                <circle r="12" fill="#111827" />
                                <circle r="12" fill="url(#g-core-2)" opacity="0.35" />
                                <circle r="0.8" fill="#7C5CFF" />
                            </svg>
                        </div>
                    </div>
                </div>
            `;
        elements.emptyState = document.getElementById('emptyState');
        initParticles();
      }

      // ðŸ“¥ Download conversation in multiple formats
      function downloadConversation(format) {
        if (state.messages.length === 0) {
          showToast('Indirilecek mesaj yok!');
          return;
        }

        let content = '';
        let mimeType = '';
        let filename = `chat-${Date.now()}`;

        switch (format) {
          case 'json':
            content = JSON.stringify(state.messages, null, 2);
            mimeType = 'application/json';
            filename += '.json';
            break;
          case 'txt':
            content = state.messages
              .map(m => `[${m.role.toUpperCase()}]: ${m.content}`)
              .join('\n\n');
            mimeType = 'text/plain';
            filename += '.txt';
            break;
          case 'md':
            content = '# LYDIAN Chat Export\n\n';
            content += state.messages
              .map(m => {
                const prefix = m.role === 'user' ? '### ðŸ‘¤ User' : '### ðŸ¤– Assistant';
                return `${prefix}\n\n${m.content}\n\n---\n`;
              })
              .join('\n');
            mimeType = 'text/markdown';
            filename += '.md';
            break;
          case 'csv':
            content = 'Role,Content,Timestamp\n';
            content += state.messages
              .map(m => {
                const escapedContent = (m.content || '').replace(/"/g, '""');
                return `"${m.role}","${escapedContent}","${new Date().toISOString()}"`;
              })
              .join('\n');
            mimeType = 'text/csv';
            filename += '.csv';
            break;
        }

        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        showToast(`Sohbet ${format.toUpperCase()} olarak indirildi!`);
      }

      // ðŸ”— Share conversation - Secure encrypted share
      async function shareConversation() {
        if (state.messages.length === 0) {
          showToast('PaylaÅŸÄ±lacak mesaj yok', 'warning');
          return;
        }

        try {
          // Show loading
          showToast('PaylaÅŸÄ±m linki oluÅŸturuluyor...', 'info');

          // Get title from first user message
          const title = getTitle();

          // Call secure share API
          const response = await fetch('/api/share/create', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              messages: state.messages,
              title,
              expiresIn: '24h',
              whatsAppOnly: true,
            }),
          });

          const result = await response.json();

          if (result.success) {
            showShareModal(result.shareUrl, result.expiresAt);
          } else {
            showToast(result.error || 'PaylaÅŸÄ±m baÅŸarÄ±sÄ±z', 'error');
          }
        } catch (error) {
          console.error('[SHARE_ERR]', error);
          showToast('PaylaÅŸÄ±m baÅŸarÄ±sÄ±z. LÃ¼tfen tekrar deneyin.', 'error');
        }
      }

      // ðŸ“¤ Show share modal
      function showShareModal(shareUrl, expiresAt) {
        // Remove existing modal if any
        const existingModal = document.getElementById('shareModalOverlay');
        if (existingModal) existingModal.remove();

        const expiresDate = new Date(expiresAt).toLocaleString('tr-TR');
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent('LyDian AI Sohbet: ' + shareUrl)}`;

        const modal = document.createElement('div');
        modal.id = 'shareModalOverlay';
        modal.className = 'share-modal-overlay';
        modal.innerHTML = `
          <div class="share-modal">
            <div class="share-modal-header">
              <h3>Sohbeti PaylaÅŸ</h3>
              <button class="share-modal-close" onclick="this.closest('.share-modal-overlay').remove()">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
            <div class="share-modal-content">
              <div class="share-warning">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"/>
                  <path d="M7 11V7a5 5 0 0110 0v4" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Bu link sadece WhatsApp Ã¼zerinden aÃ§Ä±labilir ve 24 saat geÃ§erlidir.</span>
              </div>
              <div class="share-url-box">
                <input type="text" value="${shareUrl}" readonly id="shareUrlInput" />
                <button class="copy-btn" onclick="copyShareUrl()">
                  <svg viewBox="0 0 24 24" width="18" height="18">
                    <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                  </svg>
                  Kopyala
                </button>
              </div>
              <a href="${whatsappUrl}" class="whatsapp-share-btn" target="_blank" rel="noopener">
                <svg viewBox="0 0 24 24" width="24" height="24">
                  <path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                </svg>
                WhatsApp ile PaylaÅŸ
              </a>
              <div class="share-expiry">
                <svg viewBox="0 0 24 24" width="16" height="16">
                  <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                  <path d="M12 6v6l4 2" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
                Link sÃ¼resi: ${expiresDate}
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);

        // Close on overlay click
        modal.addEventListener('click', e => {
          if (e.target === modal) modal.remove();
        });
      }

      // Copy share URL to clipboard
      function copyShareUrl() {
        const input = document.getElementById('shareUrlInput');
        if (input) {
          navigator.clipboard
            .writeText(input.value)
            .then(() => showToast('Link kopyalandÄ±!', 'success'))
            .catch(() => showToast('Kopyalama baÅŸarÄ±sÄ±z', 'error'));
        }
      }

      function copyToClipboard(text) {
        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              showToast('Sohbet panoya kopyalandÄ±!');
            })
            .catch(() => {
              showToast('Panoya kopyalanamadi!');
            });
        } else {
          // Fallback for older browsers
          const textarea = document.createElement('textarea');
          textarea.value = text;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          showToast('Sohbet panoya kopyalandÄ±!');
        }
      }

      function getTitle() {
        const firstMessage = state.messages.find(m => m.role === 'user');
        if (firstMessage) {
          return (
            firstMessage.content.substring(0, 40) + (firstMessage.content.length > 40 ? '...' : '')
          );
        }
        return 'Yeni Sohbet';
      }

      /**
       * Premium Theme System with Dark/Light/System support
       * @param {string} themeName - Theme name (dark, light, system)
       * @param {boolean} silent - If true, don't show notification (used on page load)
       */
      function setTheme(themeName, silent = false) {
        // Store the user's preference
        localStorage.setItem('lydian_theme', themeName);

        // Remove existing theme attribute
        document.body.removeAttribute('data-theme');

        if (themeName === 'system') {
          // System theme - detect user preference
          document.body.setAttribute('data-theme', 'system');
        } else if (themeName === 'light') {
          document.body.setAttribute('data-theme', 'light');
        } else if (themeName !== 'dark') {
          // Legacy themes (ocean, forest, etc.) - fallback to dark
          document.body.setAttribute('data-theme', themeName);
        }
        // 'dark' is the default, no attribute needed

        updateActiveThemeOption();

        // Swap highlight.js theme for light/dark
        var hljsDark = document.getElementById('hljs-dark-theme');
        var hljsLight = document.getElementById('hljs-light-theme');
        if (hljsDark && hljsLight) {
          var isLight =
            themeName === 'light' ||
            (themeName === 'system' && window.matchMedia('(prefers-color-scheme: light)').matches);
          hljsDark.disabled = isLight;
          hljsLight.disabled = !isLight;
        }
      }

      function getThemeName(theme) {
        const names = { dark: 'Koyu', light: 'Acik', system: 'Sistem' };
        return names[theme] || theme.charAt(0).toUpperCase() + theme.slice(1);
      }

      function updateActiveThemeOption() {
        const currentTheme = localStorage.getItem('lydian_theme') || 'dark';
        document.querySelectorAll('.theme-option').forEach(option => {
          if (option.dataset.theme === currentTheme) {
            option.classList.add('active');
          } else {
            option.classList.remove('active');
          }
        });
      }

      // Listen for system theme changes
      if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
          const currentTheme = localStorage.getItem('lydian_theme');
          if (currentTheme === 'system') {
            // Re-apply system theme to trigger CSS update
            document.body.removeAttribute('data-theme');
            document.body.setAttribute('data-theme', 'system');
          }
        });
      }

      // ðŸ“ Handle file upload
      function handleFileUpload(file) {
        // Max file size: 10MB
        const maxSize = 10 * 1024 * 1024;
        if (file.size > maxSize) {
          showToast("Dosya boyutu 10MB'dan buyuk olamaz");
          return;
        }

        // Check file type
        const isImage = file.type.startsWith('image/');
        const allowedTypes = [
          'image/',
          'application/pdf',
          'text/',
          'application/msword',
          'application/vnd.openxmlformats',
        ];
        const isAllowed = allowedTypes.some(
          type => file.type.startsWith(type) || file.type.includes(type)
        );

        if (!isAllowed) {
          showToast('Bu dosya turu desteklenmiyor');
          return;
        }

        // Show toast for feedback
        showToast(`Dosya yukleniyor: ${file.name}`);

        // For images, show preview in input area
        if (isImage) {
          const reader = new FileReader();
          reader.onload = function (e) {
            // Store the image data for sending with the message
            state.pendingFile = {
              name: file.name,
              type: file.type,
              size: file.size,
              data: e.target.result,
            };

            // Show preview badge
            showFilePreview(file.name, e.target.result, true);
          };
          reader.readAsDataURL(file);
        } else {
          // For documents, store reference
          state.pendingFile = {
            name: file.name,
            type: file.type,
            size: file.size,
          };

          // Show file badge
          showFilePreview(file.name, null, false);
        }
      }

      // Show file preview badge near input - ChatGPT style
      function showFilePreview(fileName, imageData, isImage) {
        // Remove existing preview
        const existing = document.getElementById('filePreviewBadge');
        if (existing) existing.remove();

        const badge = document.createElement('div');
        badge.id = 'filePreviewBadge';
        badge.style.cssText = `
          display: inline-flex;
          align-items: center;
          gap: 10px;
          padding: ${isImage ? '6px 10px 6px 6px' : '10px 14px'};
          background: rgba(32, 33, 36, 0.95);
          border: 1px solid rgba(255, 255, 255, 0.12);
          border-radius: ${isImage ? '12px' : '10px'};
          margin-bottom: 10px;
          max-width: 280px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          animation: slideInUp 0.2s ease-out;
        `;

        const preview =
          isImage && imageData
            ? `<img src="${imageData}" style="width: 56px; height: 56px; object-fit: cover; border-radius: 8px; flex-shrink: 0;" />`
            : `<div style="width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                 <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="#ffffff" stroke-width="2">
                   <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                   <polyline points="14 2 14 8 20 8"/>
                 </svg>
               </div>`;

        // Get file extension
        const ext = fileName.split('.').pop().toUpperCase();
        const fileTypeLabel = isImage ? 'GÃ¶rsel' : ext;

        badge.innerHTML = `
          ${preview}
          <div style="flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 2px;">
            <span style="color: #fff; font-size: 0.85rem; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
              ${fileName}
            </span>
            <span style="color: rgba(255,255,255,0.5); font-size: 0.75rem;">${fileTypeLabel}</span>
          </div>
          <button onclick="clearFilePreview()" style="background: rgba(255,255,255,0.08); border: none; color: rgba(255,255,255,0.6); cursor: pointer; padding: 6px; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0;" onmouseover="this.style.background='rgba(239,68,68,0.2)'; this.style.color='#ef4444';" onmouseout="this.style.background='rgba(255,255,255,0.08)'; this.style.color='rgba(255,255,255,0.6)';">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        `;

        // Insert before input wrapper
        const inputWrapper = document.querySelector('.input-wrapper');
        if (inputWrapper && inputWrapper.parentNode) {
          inputWrapper.parentNode.insertBefore(badge, inputWrapper);
        }
      }

      // Clear file preview
      function clearFilePreview() {
        const badge = document.getElementById('filePreviewBadge');
        if (badge) badge.remove();
        state.pendingFile = null;
        // Clear file input
        const fileInput = document.getElementById('mainFileInput');
        if (fileInput) fileInput.value = '';
      }

      /**
       * Premium Toast Notification System
       * @param {string} message - Toast message
       * @param {string} type - 'success' | 'error' | 'info' | 'welcome'
       * @param {Object} options - Additional options
       */
      function showToast(message, type = 'info', options = {}) {
        // Remove any existing toast
        const existingToast = document.querySelector('.toast-notification');
        if (existingToast) existingToast.remove();

        const toast = document.createElement('div');
        toast.className = `toast-notification ${type}`;

        const iconSvg =
          type === 'success'
            ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>'
            : type === 'error'
              ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>'
              : type === 'welcome'
                ? ''
                : '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>';

        toast.innerHTML = `
          <div class="toast-avatar">
            ${options.avatar || iconSvg}
          </div>
          <div class="toast-content">
            <div class="toast-title">${message}</div>
            ${options.subtitle ? `<div class="toast-subtitle">${options.subtitle}</div>` : ''}
          </div>
          <button class="toast-close" onclick="this.parentElement.remove()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
          <div class="toast-progress"></div>
        `;

        document.body.appendChild(toast);

        // Trigger animation
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            toast.classList.add('show');
          });
        });

        // Auto remove
        const duration = options.duration || 3000;
        setTimeout(() => {
          toast.classList.remove('show');
          toast.classList.add('hide');
          setTimeout(() => toast.remove(), 400);
        }, duration);

        return toast;
      }

      /**
       * Premium Welcome Toast for Login
       * Shows personalized greeting with avatar and last login info
       */
      function showWelcomeToast(user) {
        const initial = user.displayName?.charAt(0)?.toUpperCase() || 'U';
        const lastLogin = localStorage.getItem('lydian_last_login');
        const isReturning = !!lastLogin;

        // Save current login time
        localStorage.setItem('lydian_last_login', new Date().toISOString());

        let subtitle = '';
        if (isReturning && lastLogin) {
          const lastDate = new Date(lastLogin);
          const now = new Date();
          const diffMs = now - lastDate;
          const diffMins = Math.floor(diffMs / 60000);
          const diffHours = Math.floor(diffMs / 3600000);
          const diffDays = Math.floor(diffMs / 86400000);

          if (diffMins < 60) {
            subtitle = `Son giriÅŸ: ${diffMins} dakika Ã¶nce`;
          } else if (diffHours < 24) {
            subtitle = `Son giriÅŸ: ${diffHours} saat Ã¶nce`;
          } else if (diffDays < 7) {
            subtitle = `Son giriÅŸ: ${diffDays} gÃ¼n Ã¶nce`;
          } else {
            subtitle = `Son giriÅŸ: ${lastDate.toLocaleDateString('tr-TR')}`;
          }
        } else {
          subtitle = "AILYDIAN'a hoÅŸ geldiniz!";
        }

        const greeting = isReturning
          ? `Tekrar hoÅŸgeldin, ${user.displayName}!`
          : `HoÅŸgeldin, ${user.displayName}!`;

        showToast(greeting, 'welcome', {
          avatar: initial,
          subtitle: subtitle,
          duration: 4000,
        });
      }

      function initParticles() {
        const particlesContainer = document.getElementById('particles');
        if (!particlesContainer) return;

        particlesContainer.innerHTML = '';
        for (let i = 0; i < 30; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 10 + 's';
          particle.style.animationDuration = 10 + Math.random() * 5 + 's';
          particlesContainer.appendChild(particle);
        }
      }

      // Copy message
      window.copyMessage = async function (button) {
        const messageContent = button.closest('.message-content').querySelector('.message-text');
        const text = messageContent.innerText;

        try {
          await navigator.clipboard.writeText(text);
          const originalText = button.innerHTML;
          button.innerHTML = `
                    <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                    KopyalandÄ±!
                `;
          button.style.color = '#10A37F';

          setTimeout(() => {
            button.innerHTML = originalText;
            button.style.color = '';
          }, 2000);
        } catch (error) {
          console.error('Kopyalama hatasÄ±:', error);
          alert('Kopyalama baÅŸarÄ±sÄ±z oldu!');
        }
      };

      // Feedback message (thumbs up/down)
      window.feedbackMessage = function (button, type) {
        const actionsDiv = button.closest('.message-actions');
        if (!actionsDiv) return;

        const allFeedbackBtns = actionsDiv.querySelectorAll('.feedback-btn');
        const isAlreadyActive = button.classList.contains('active-' + type);

        // Remove all active states first
        allFeedbackBtns.forEach(btn => {
          btn.classList.remove('active-up', 'active-down');
        });

        // Toggle: if same button clicked again, just remove (already done above)
        if (isAlreadyActive) {
          removeFeedback(actionsDiv);
          return;
        }

        // Set active state
        button.classList.add('active-' + type);

        // Get message text for identification
        const messageEl = button.closest('.message');
        const messageText = messageEl ? messageEl.querySelector('.message-text') : null;
        const msgContent = messageText ? messageText.innerText.substring(0, 200) : '';
        const msgId = messageEl
          ? messageEl.dataset.msgId || hashString(msgContent)
          : Date.now().toString();

        // Store in localStorage
        storeFeedback(msgId, type, msgContent);

        // Send to server if authenticated
        syncFeedbackToServer(msgId, type, msgContent);

        showToast(
          type === 'up' ? 'Geri bildirim kaydedildi' : 'Geri bildirim kaydedildi',
          'success'
        );
      };

      function hashString(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          const char = str.charCodeAt(i);
          hash = (hash << 5) - hash + char;
          hash |= 0;
        }
        return 'fb_' + Math.abs(hash).toString(36);
      }

      function storeFeedback(msgId, type, content) {
        try {
          const feedbackData = JSON.parse(localStorage.getItem('lydian_feedback') || '{}');
          feedbackData[msgId] = {
            type: type,
            content: content,
            timestamp: Date.now(),
            conversationId: state.currentConversationId || null,
          };
          // Keep max 200 feedback entries
          const keys = Object.keys(feedbackData);
          if (keys.length > 200) {
            const sorted = keys.sort(
              (a, b) => feedbackData[a].timestamp - feedbackData[b].timestamp
            );
            sorted.slice(0, keys.length - 200).forEach(k => delete feedbackData[k]);
          }
          localStorage.setItem('lydian_feedback', JSON.stringify(feedbackData));
        } catch (e) {
          console.warn('[FEEDBACK] Storage error:', e);
        }
      }

      function removeFeedback(actionsDiv) {
        const messageEl = actionsDiv.closest('.message');
        const messageText = messageEl ? messageEl.querySelector('.message-text') : null;
        const msgContent = messageText ? messageText.innerText.substring(0, 200) : '';
        const msgId = messageEl ? messageEl.dataset.msgId || hashString(msgContent) : null;
        if (!msgId) return;
        try {
          const feedbackData = JSON.parse(localStorage.getItem('lydian_feedback') || '{}');
          delete feedbackData[msgId];
          localStorage.setItem('lydian_feedback', JSON.stringify(feedbackData));
        } catch (e) {
          console.warn('[FEEDBACK] Remove error:', e);
        }
      }

      async function syncFeedbackToServer(msgId, type, content) {
        if (typeof ChatAuth === 'undefined' || !ChatAuth.state?.isAuthenticated) return;
        try {
          await fetch('/api/chat-auth/feedback', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({
              messageId: msgId,
              feedback: type,
              content: content,
              conversationId: state.currentConversationId || null,
            }),
          });
        } catch (e) {
          console.warn('[FEEDBACK] Server sync failed:', e.message);
        }
      }

      // Regenerate message
      window.regenerateMessage = async function (button) {
        if (state.isTyping) {
          alert('LÃ¼tfen mevcut yanÄ±t tamamlanana kadar bekleyin.');
          return;
        }

        const messageElements = Array.from(elements.messagesContainer.querySelectorAll('.message'));
        const currentMessageEl = button.closest('.message');
        const currentIndex = messageElements.indexOf(currentMessageEl);

        let lastUserMessage = null;
        for (let i = currentIndex - 1; i >= 0; i--) {
          if (messageElements[i].classList.contains('user')) {
            const messageText = messageElements[i].querySelector('.message-text');
            lastUserMessage = messageText.innerText;
            break;
          }
        }

        if (!lastUserMessage) {
          alert('Yeniden oluÅŸturulacak mesaj bulunamadÄ±!');
          return;
        }

        currentMessageEl.remove();
        const messageIndex = state.messages.findIndex(
          (msg, idx) => msg.role === 'assistant' && idx === currentIndex
        );
        if (messageIndex !== -1) {
          state.messages.splice(messageIndex, 1);
        }

        showTypingIndicator();

        try {
          // Clean history: remove timestamp property for API compatibility
          const cleanHistory = state.messages.slice(-10).map(msg => ({
            role: msg.role,
            content: msg.content,
          }));

          const response = await fetch('/api/chat', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept-Language': 'tr-TR',
              'Content-Language': 'tr',
            },
            body: JSON.stringify({
              model: 'LYDIAN_QUANTUM', // LyDian primary engine
              message: lastUserMessage,
              temperature: 0.9,
              max_tokens: 8000, // Maximum detail
              history: cleanHistory,
              language: 'tr',
              locale: 'tr-TR',
            }),
          });

          if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
          }

          const data = await response.json();
          hideTypingIndicator();

          if (data.success && data.response) {
            addMessage('assistant', data.response);
            // DEBUG: console.log('ðŸ”„ Message regenerated successfully');
          } else {
            throw new Error('Invalid response from API');
          }
        } catch (error) {
          console.error('âŒ Regeneration Error:', error);
          hideTypingIndicator();
          addMessage(
            'assistant',
            `**Yeniden OluÅŸturma HatasÄ±**\n\nMesaj yeniden oluÅŸturulamadÄ±.\n\n*Bir hata olustu. Lutfen tekrar deneyin.*`
          );
        }
      };

      // User menu dropdown toggle
      const userMenuBtn = document.getElementById('userMenuBtn');
      const userDropdown = document.getElementById('userDropdown');

      /* DEBUG: console.log('ðŸ” User menu elements:', {
        userMenuBtn: !!userMenuBtn,
        userDropdown: !!userDropdown,
      }); */

      if (userMenuBtn && userDropdown) {
        userMenuBtn.addEventListener('click', e => {
          e.stopPropagation();
          // DEBUG: console.log('ðŸ‘¤ User menu clicked');
          userDropdown.classList.toggle('active');
          userMenuBtn.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', e => {
          if (!userMenuBtn.contains(e.target) && !userDropdown.contains(e.target)) {
            userDropdown.classList.remove('active');
            userMenuBtn.classList.remove('active');
          }
        });
        // DEBUG: console.log('âœ… User menu listener added');
      } else {
        console.error('âŒ User menu elements not found');
      }

      // Sidebar search functionality
      const sidebarSearch = document.getElementById('sidebarSearch');
      if (sidebarSearch) {
        sidebarSearch.addEventListener('input', e => {
          const searchTerm = e.target.value.toLowerCase().trim();
          const chatItems = elements.chatHistory.querySelectorAll('.chat-item');

          chatItems.forEach(item => {
            const title = item.querySelector('.chat-item-title')?.textContent.toLowerCase() || '';
            const preview =
              item.querySelector('.chat-item-preview')?.textContent.toLowerCase() || '';

            if (title.includes(searchTerm) || preview.includes(searchTerm)) {
              item.style.display = '';
            } else {
              item.style.display = 'none';
            }
          });
        });
      }

      // ========== USER NAME DISPLAY ==========

      function loadUserName() {
        try {
          // Get user data from localStorage (set during login)
          const userDataStr = localStorage.getItem('lydian_user');
          if (userDataStr) {
            const userData = JSON.parse(userDataStr);
            const userName = userData.name || userData.username || 'Misafir';
            updateWelcomeText(userName);
          } else {
            // Default fallback
            updateWelcomeText('HoÅŸgeldiniz');
          }
        } catch (e) {
          console.warn('Could not load user name:', e);
          updateWelcomeText('HoÅŸgeldiniz');
        }
      }

      function getTimeGreeting() {
        const hour = new Date().getHours();
        if (hour >= 5 && hour < 12) return 'GunaydÄ±n';
        if (hour >= 12 && hour < 18) return 'Ä°yi GÃ¼nler';
        if (hour >= 18 && hour < 22) return 'Ä°yi AkÅŸamlar';
        return 'Ä°yi Geceler';
      }

      function updateWelcomeText(userName) {
        const welcomeUserName = document.getElementById('welcomeUserName');
        if (welcomeUserName) {
          const greeting = getTimeGreeting();
          if (userName && userName !== 'HoÅŸgeldiniz' && userName !== 'Misafir') {
            welcomeUserName.textContent = greeting + ', ' + userName;
          } else {
            welcomeUserName.textContent = greeting;
          }
        }
      }

      // ðŸ”’ GUEST QUERY LIMIT SYSTEM
      function getGuestQueryCount() {
        try {
          const data = JSON.parse(localStorage.getItem('lydian_guest_queries') || '{}');
          const today = new Date().toISOString().split('T')[0];
          if (data.date !== today) return 0;
          return data.count || 0;
        } catch {
          return 0;
        }
      }

      function incrementGuestQuery() {
        const today = new Date().toISOString().split('T')[0];
        let data = {};
        try {
          data = JSON.parse(localStorage.getItem('lydian_guest_queries') || '{}');
        } catch {}
        if (data.date !== today) {
          data = { date: today, count: 0 };
        }
        data.count = (data.count || 0) + 1;
        localStorage.setItem('lydian_guest_queries', JSON.stringify(data));
        return data.count;
      }

      function showQueryLimitModal() {
        // Remove existing if any
        const existing = document.getElementById('queryLimitModal');
        if (existing) existing.remove();

        const modal = document.createElement('div');
        modal.id = 'queryLimitModal';
        modal.style.cssText =
          'position:fixed;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:center;z-index:100000;padding:1rem;animation:fadeIn 0.3s ease';
        modal.innerHTML = `
          <div style="background:linear-gradient(145deg,rgba(32,33,36,0.98),rgba(24,25,28,0.98));border:1px solid rgba(255,255,255,0.1);border-radius:24px;padding:2rem;max-width:420px;width:100%;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,0.5);transform:scale(1);animation:scaleIn 0.3s ease">
            <div style="width:80px;height:80px;margin:0 auto 1.5rem;background:linear-gradient(135deg,rgba(124,92,255,0.2),rgba(0,224,255,0.2));border-radius:50%;display:flex;align-items:center;justify-content:center">
              <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="#7C5CFF" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                <path d="M12 8v4M12 16h.01"/>
              </svg>
            </div>
            <h3 style="font-size:1.4rem;font-weight:700;color:#fff;margin-bottom:0.75rem">GÃ¼nlÃ¼k Limit Doldu</h3>
            <p style="color:rgba(255,255,255,0.7);font-size:0.95rem;line-height:1.6;margin-bottom:1.5rem">
              Misafir olarak gÃ¼nlÃ¼k <strong style="color:#7C5CFF">10 sorgu</strong> hakkÄ±nÄ±z bulunmaktadÄ±r.
              SÄ±nÄ±rsÄ±z kullanÄ±m iÃ§in Ã¼cretsiz hesap oluÅŸturun!
            </p>
            <div style="display:flex;gap:0.75rem">
              <button onclick="this.closest('#queryLimitModal').remove()" style="flex:1;padding:0.875rem;border-radius:12px;background:rgba(255,255,255,0.1);color:rgba(255,255,255,0.8);border:1px solid rgba(255,255,255,0.15);font-size:1rem;font-weight:600;cursor:pointer">Kapat</button>
              <button onclick="this.closest('#queryLimitModal').remove();ChatAuth.openPanel('main')" style="flex:1;padding:0.875rem;border-radius:12px;background:linear-gradient(135deg,#7C5CFF,#00E0FF);color:#fff;border:none;font-size:1rem;font-weight:600;cursor:pointer;box-shadow:0 4px 15px rgba(124,92,255,0.4)">Ãœcretsiz KayÄ±t Ol</button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        modal.addEventListener('click', e => {
          if (e.target === modal) modal.remove();
        });
      }

      // ========== INITIALIZATION ==========

      window.addEventListener('DOMContentLoaded', () => {
        // Mobilde sidebar kapalÄ± baÅŸlasÄ±n
        if (window.innerWidth <= 768) {
          elements.sidebar.classList.add('collapsed');
        }

        // Restore AI mode from sessionStorage
        if (state.selectedAiType && state.selectedAiType !== 'general') {
          var savedType = state.selectedAiType;
          // Update desktop code button
          var deskCodeRestore = document.getElementById('desktopCodeBtn');
          if (deskCodeRestore && savedType === 'code-write') {
            deskCodeRestore.classList.add('active');
          }
          // Update placeholder
          if (elements.messageInput && savedType === 'code-write') {
            elements.messageInput.placeholder = 'Kod isteginizi yazin...';
          }
          // Update mode selector buttons
          document.querySelectorAll('[data-mode]').forEach(function (b) {
            b.classList.remove('active');
          });
          var savedModeBtn = document.querySelector('[data-mode="' + savedType + '"]');
          if (savedModeBtn) savedModeBtn.classList.add('active');
        }

        // Desktop centered layout initialization
        if (window.innerWidth > 768) {
          document.body.classList.add('desktop-centered', 'chat-initial');
          // Enable transitions after layout settles to prevent FOUC
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              document.body.classList.add('transitions-ready');
              // Remove early FOUC suppressor now that layout is stable
              document.documentElement.classList.remove('desktop-early');
            });
          });
          // Click on logo - ChatGPT style: auth check first
          const desktopLogo = document.getElementById('desktopLogo');
          if (desktopLogo) {
            desktopLogo.addEventListener('click', () => {
              if (window.ChatAuth && ChatAuth.state && ChatAuth.state.isAuthenticated) {
                startNewChat();
              } else if (window.ChatAuth) {
                ChatAuth.openPanel('main');
              }
            });
          }
        }

        // Listen for window resize to add/remove desktop mode
        window.addEventListener('resize', () => {
          if (window.innerWidth > 768) {
            document.body.classList.add('desktop-centered');
            // If no messages, show initial state
            if (!state.messages || state.messages.length === 0) {
              document.body.classList.add('chat-initial');
              document.body.classList.remove('chat-active');
            }
          } else {
            document.body.classList.remove('desktop-centered', 'chat-initial', 'chat-active');
          }
        });

        // Mobile keyboard handler - SIMPLE & SAFE approach
        if (window.innerWidth <= 768) {
          const messageInput = document.getElementById('messageInput');
          const messagesContainer = document.getElementById('messagesContainer');

          if (messageInput) {
            // On focus: just scroll messages to bottom after keyboard opens
            messageInput.addEventListener('focus', () => {
              setTimeout(() => {
                if (messagesContainer) {
                  messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
                // Ensure input is visible - simple native scroll
                messageInput.scrollIntoView({ block: 'nearest' });
              }, 350);
            });
          }
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('lydian_theme') || 'dark';
        setTheme(savedTheme, true); // Silent mode on page load

        // Initialize particles
        initParticles();

        // Load and display user name from login
        loadUserName();

        // Load chat history (only valid chat objects with id, title, messages)
        const chatKeys = Object.keys(localStorage).filter(key => key.startsWith('chat_'));
        chatKeys.forEach(key => {
          try {
            const chatData = JSON.parse(localStorage.getItem(key));
            // Validate it's a proper chat object (not shared or other data)
            if (chatData && chatData.id && chatData.messages && Array.isArray(chatData.messages)) {
              addChatToHistory(chatData);
            }
          } catch (e) {
            console.warn('Invalid chat data for key:', key);
          }
        });

        // DEBUG: console.log('ðŸš€ LyDian Quantum Chat initialized');
      });

      function addChatToHistory(chatData) {
        const chatItem = document.createElement('div');
        chatItem.className = 'chat-item';
        chatItem.dataset.chatId = chatData.id;

        // Truncate title to 30 chars for cleaner look
        const displayTitle =
          chatData.title.length > 30 ? chatData.title.substring(0, 30) + '...' : chatData.title;

        chatItem.innerHTML = `
                <div class="chat-item-content">
                    <svg class="chat-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <div class="chat-item-title">${displayTitle}</div>
                </div>
                <button class="chat-item-delete" onclick="deleteChatFromHistory('${chatData.id}', event)" title="Sohbeti sil">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            `;

        // Click handler for chat item (not delete button)
        chatItem.addEventListener('click', e => {
          if (!e.target.closest('.chat-item-delete')) {
            loadChat(chatData.id);
          }
        });

        elements.chatHistory.insertBefore(chatItem, elements.chatHistory.firstChild);
      }

      // Save current chat to localStorage and server (if authenticated)
      async function saveCurrentChat() {
        if (state.messages.length === 0) return;

        // Create or update chat ID
        const isNewChat = !state.currentChatId;
        if (!state.currentChatId) {
          state.currentChatId = `chat_${Date.now()}`;
        }

        // Get first user message as title (max 50 chars)
        const firstUserMessage = state.messages.find(msg => msg.role === 'user');
        const title = firstUserMessage
          ? firstUserMessage.content.substring(0, 50) +
            (firstUserMessage.content.length > 50 ? '...' : '')
          : 'Yeni Sohbet';

        const chatData = {
          id: state.currentChatId,
          title: title,
          timestamp: Date.now(),
          messages: state.messages,
        };

        // Save to localStorage
        localStorage.setItem(state.currentChatId, JSON.stringify(chatData));

        // Check if already in chat history UI
        const existingItem = document.querySelector(`[data-chat-id="${state.currentChatId}"]`);
        if (!existingItem) {
          // Add to chat history UI only if it's a new chat
          addChatToHistory(chatData);
        }

        // Refresh desktop history drawer if it exists
        if (typeof loadDesktopHistory === 'function') {
          try {
            loadDesktopHistory();
          } catch (e) {}
        }

        // Sync to server if user is authenticated
        if (typeof ChatAuth !== 'undefined' && ChatAuth.state && ChatAuth.state.isAuthenticated) {
          try {
            await syncChatToServer(chatData, isNewChat);
          } catch (err) {
            console.warn('Server sync failed:', err.message);
          }
        }
      }

      // Sync chat to server
      async function syncChatToServer(chatData, isNewChat) {
        if (typeof ChatAuth === 'undefined' || !ChatAuth.state?.isAuthenticated) return;

        // Check if we have a server conversation ID mapped
        let serverConvId = localStorage.getItem(`server_conv_${chatData.id}`);

        // Create new conversation on server if needed
        if (!serverConvId) {
          const createRes = await fetch('/api/chat-auth/history', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({
              title: chatData.title,
              model: 'premium',
            }),
          });

          const createData = await createRes.json();
          if (createData.success && createData.conversationId) {
            serverConvId = createData.conversationId;
            localStorage.setItem(`server_conv_${chatData.id}`, serverConvId);
          } else {
            console.warn('Failed to create server conversation');
            return;
          }
        }

        // Sync messages to server
        const lastSyncIndex = parseInt(localStorage.getItem(`sync_index_${chatData.id}`) || '0');
        const newMessages = chatData.messages.slice(lastSyncIndex);

        if (newMessages.length > 0) {
          const msgRes = await fetch('/api/chat-auth/messages', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({
              conversationId: serverConvId,
              messages: newMessages.map(m => ({
                role: m.role,
                content: m.content,
                model: 'premium',
              })),
            }),
          });

          if (msgRes.ok) {
            localStorage.setItem(`sync_index_${chatData.id}`, String(chatData.messages.length));
          }
        }

        // Update title if changed
        if (!isNewChat) {
          await fetch('/api/chat-auth/history', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({
              id: serverConvId,
              title: chatData.title,
            }),
          });
        }
      }

      // Delete chat from history
      window.deleteChatFromHistory = async function (chatId, event) {
        event.stopPropagation();

        if (confirm('Bu sohbeti silmek istediginizden emin misiniz?')) {
          // Remove from DOM
          const chatItem = document.querySelector(`[data-chat-id="${chatId}"]`);
          if (chatItem) {
            chatItem.style.animation = 'slideOutLeft 0.3s ease';
            setTimeout(() => {
              chatItem.remove();
            }, 300);
          }

          // Delete from server if it's a server chat
          if (chatId.startsWith('server_')) {
            const serverId = chatId.replace('server_', '');
            try {
              await fetch(`/api/chat-auth/history?id=${serverId}`, {
                method: 'DELETE',
                credentials: 'include',
              });
            } catch (err) {
              console.warn('Server delete failed:', err);
            }
          } else {
            // Check if local chat is synced to server
            const serverConvId = localStorage.getItem(`server_conv_${chatId}`);
            if (
              serverConvId &&
              typeof ChatAuth !== 'undefined' &&
              ChatAuth.state?.isAuthenticated
            ) {
              try {
                await fetch(`/api/chat-auth/history?id=${serverConvId}`, {
                  method: 'DELETE',
                  credentials: 'include',
                });
              } catch (err) {
                console.warn('Server delete failed:', err);
              }
            }
            // Remove server mapping
            localStorage.removeItem(`server_conv_${chatId}`);
            localStorage.removeItem(`sync_index_${chatId}`);
          }

          // Remove chat data from localStorage
          localStorage.removeItem(chatId);

          // Also remove from chatHistory array (if exists)
          const savedChats = JSON.parse(localStorage.getItem('chatHistory') || '[]');
          const updatedChats = savedChats.filter(chat => chat.id !== chatId);
          localStorage.setItem('chatHistory', JSON.stringify(updatedChats));
        }
      };

      async function loadChat(chatId) {
        // Check if it's a server chat
        if (chatId.startsWith('server_')) {
          const serverId = chatId.replace('server_', '');
          await loadServerChat(serverId, chatId);
          return;
        }

        // Load from localStorage
        const chatData = JSON.parse(localStorage.getItem(chatId));
        if (chatData) {
          state.messages = chatData.messages;
          state.currentChatId = chatId;
          renderMessages();

          // Hide empty state
          if (elements.emptyState) {
            elements.emptyState.style.display = 'none';
          }

          // Desktop: Activate chat layout when loading chat with messages
          if (
            window.innerWidth > 768 &&
            document.body.classList.contains('desktop-centered') &&
            chatData.messages.length > 0
          ) {
            document.body.classList.remove('chat-initial');
            document.body.classList.add('chat-active');
          }
        }
      }

      // Load chat from server
      async function loadServerChat(serverId, localId) {
        try {
          const res = await fetch(`/api/chat-auth/history?id=${serverId}`, {
            credentials: 'include',
          });
          const data = await res.json();

          if (data.success && data.messages) {
            // Convert server messages to local format
            state.messages = data.messages.map(m => ({
              role: m.role,
              content: m.content,
              timestamp: new Date(m.createdAt).getTime(),
            }));
            state.currentChatId = localId;

            // Cache locally
            const chatData = {
              id: localId,
              serverId: serverId,
              title: data.conversation?.title || 'Sohbet',
              timestamp: Date.now(),
              messages: state.messages,
              isServerChat: true,
            };
            localStorage.setItem(localId, JSON.stringify(chatData));
            localStorage.setItem(`server_conv_${localId}`, serverId);
            localStorage.setItem(`sync_index_${localId}`, String(state.messages.length));

            renderMessages();

            // Hide empty state
            if (elements.emptyState) {
              elements.emptyState.style.display = 'none';
            }

            // Desktop: Activate chat layout when loading chat with messages
            if (
              window.innerWidth > 768 &&
              document.body.classList.contains('desktop-centered') &&
              state.messages.length > 0
            ) {
              document.body.classList.remove('chat-initial');
              document.body.classList.add('chat-active');
            }
          }
        } catch (err) {
          console.error('Failed to load server chat:', err);
          showToast('Sohbet yuklenemedi', 'error');
        }
      }

      function renderMessages() {
        elements.messagesContainer.innerHTML = '';
        state.messages.forEach(msg => {
          addMessage(msg.role, msg.content);
        });
      }

      // ============================================================
      // âœ… UNLIMITED GUEST ACCESS - TIMER DISABLED
      // User requested: Remove 5-minute limit, make chat unlimited
      // ============================================================
      (async function initGuestTimer() {
        // DEBUG: console.log('âœ… Guest chat timer DISABLED - unlimited access enabled');

        // Clear any existing timer data from localStorage
        localStorage.removeItem('guestChatStartTime');

        // No timer functionality - unlimited access for all users
        // This allows both logged-in and guest users to use chat without restrictions
        return;
      })();
    </script>

    <!-- Translation System -->
    <!-- <script src="/js/translation.js"></script> DISABLED -->

    <!-- ðŸ” Chat Auth System -->
    <script>
      // ============================================================
      // ðŸ” CHAT AUTH MANAGER - Independent Authentication System
      // ============================================================

      const ChatAuth = {
        state: {
          isAuthenticated: false,
          user: null,
          settings: null,
          activePanel: null,
          authEmail: null,
          authMode: null,
          phoneCountdown: 0,
        },

        elements: {
          overlay: null,
          panels: {},
        },

        // Initialize
        init() {
          this.elements.overlay = document.getElementById('chatAuthOverlay');
          this.elements.panels = {
            main: document.getElementById('chatAuthMainPanel'),
            phone: document.getElementById('chatAuthPhonePanel'),
            forgot: document.getElementById('chatAuthForgotPanel'),
            reset: document.getElementById('chatAuthResetPanel'),
            profile: document.getElementById('chatAuthProfilePanel'),
            settings: document.getElementById('chatAuthSettingsPanel'),
            security: document.getElementById('chatAuthSecurityPanel'),
          };

          this.bindEvents();
          this.checkSession();
          this.checkResetToken();
          this.checkOAuthError();
        },

        // Bind all form events
        bindEvents() {
          // Auth email - Enter key
          document.getElementById('authEmailInput')?.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
              e.preventDefault();
              this.handleEmailContinue();
            }
          });
          // Login password - Enter key
          document.getElementById('authLoginPassword')?.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
              e.preventDefault();
              this.handleLoginSubmit();
            }
          });
          // Register password strength
          document.getElementById('authRegisterPassword')?.addEventListener('input', e => {
            this.updatePasswordStrength(e.target.value, 'authRegisterStrength');
          });
          // Register confirm - Enter key
          document.getElementById('authRegisterPasswordConfirm')?.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
              e.preventDefault();
              this.handleRegisterSubmit();
            }
          });
          // OTP auto-advance
          document.querySelectorAll('.auth-otp-digit').forEach((input, index, inputs) => {
            input.addEventListener('input', e => {
              if (e.target.value && index < inputs.length - 1) inputs[index + 1].focus();
            });
            input.addEventListener('keydown', e => {
              if (e.key === 'Backspace' && !e.target.value && index > 0) inputs[index - 1].focus();
            });
          });

          // Forgot password form
          document.getElementById('chatAuthForgotForm')?.addEventListener('submit', e => {
            e.preventDefault();
            this.handleForgotPassword(new FormData(e.target));
          });

          // Reset password form
          document.getElementById('chatAuthResetForm')?.addEventListener('submit', e => {
            e.preventDefault();
            this.handleResetPassword(new FormData(e.target));
          });

          // Change password form
          document.getElementById('chatAuthChangePasswordForm')?.addEventListener('submit', e => {
            e.preventDefault();
            this.handleChangePassword(new FormData(e.target));
          });

          // Password strength indicators
          document.getElementById('registerPassword')?.addEventListener('input', e => {
            this.updatePasswordStrength(
              e.target.value,
              'registerPasswordStrength',
              'registerPasswordStrengthText'
            );
          });
          document.getElementById('resetPassword')?.addEventListener('input', e => {
            this.updatePasswordStrength(e.target.value, 'resetPasswordStrength');
          });
          document.getElementById('newPassword')?.addEventListener('input', e => {
            this.updatePasswordStrength(e.target.value, 'newPasswordStrength');
          });

          // Overlay click to close
          this.elements.overlay?.addEventListener('click', e => {
            if (e.target === this.elements.overlay) {
              this.closePanel();
            }
          });

          // ESC key to close
          document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && this.state.activePanel) {
              this.closePanel();
            }
          });

          // User menu clicks (desktop sidebar and mobile sidebar)
          document.getElementById('userMenuBtn')?.addEventListener('click', () => {
            if (this.state.isAuthenticated) {
              this.openPanel('profile');
            } else {
              this.openPanel('main');
            }
          });

          document.getElementById('mobileUserProfile')?.addEventListener('click', () => {
            if (this.state.isAuthenticated) {
              this.openPanel('profile');
            } else {
              this.openPanel('main');
            }
            // Close mobile sidebar
            document.getElementById('mobileSidebar')?.classList.remove('open');
            document.getElementById('mobileSidebarOverlay')?.classList.remove('active');
          });
        },

        // Check for reset token in URL
        checkResetToken() {
          const urlParams = new URLSearchParams(window.location.search);
          const resetToken = urlParams.get('reset');
          if (resetToken) {
            document.getElementById('resetToken').value = resetToken;
            this.openPanel('reset');
            // Clean URL
            window.history.replaceState({}, document.title, window.location.pathname);
          }
        },

        // Check for OAuth errors in URL (Google redirect)
        checkOAuthError() {
          const urlParams = new URLSearchParams(window.location.search);
          const error = urlParams.get('error');
          if (error) {
            const errorMessages = {
              google_denied: 'Google giriÅŸi iptal edildi',
              google_no_code: 'Google doÄŸrulama kodu alÄ±namadÄ±',
              google_state_invalid: 'GÃ¼venlik doÄŸrulamasÄ± baÅŸarÄ±sÄ±z. Tekrar deneyin.',
              google_token_failed: 'Google giriÅŸ iÅŸlemi baÅŸarÄ±sÄ±z oldu',
              google_userinfo_failed: 'Google kullanÄ±cÄ± bilgisi alÄ±namadÄ±',
              google_no_email: 'Google hesabÄ±nÄ±zda e-posta bulunamadÄ±',
              google_not_configured: 'Google giriÅŸi ÅŸimdilik kullanÄ±m dÄ±ÅŸÄ±',
              google_failed: 'Google giriÅŸinde bir hata oluÅŸtu',
              rate_limit: 'Ã‡ok fazla deneme. LÃ¼tfen bekleyin.',
            };
            const msg = errorMessages[error] || 'GiriÅŸ sÄ±rasÄ±nda bir hata oluÅŸtu';
            this.showToast(msg, 'error');
            window.history.replaceState({}, document.title, window.location.pathname);
          }
        },

        // Open auth panel
        openPanel(panelName) {
          if (panelName === 'login' || panelName === 'register') panelName = 'main';
          this.closeAllPanels();
          this.elements.overlay?.classList.add('active');
          const panel = this.elements.panels[panelName];
          if (panel) {
            // Drawer panel detection (settings/security)
            const isDrawer = panel.classList.contains('chat-auth-panel--drawer');
            if (isDrawer) {
              this.elements.overlay.classList.add('chat-auth-overlay--drawer');
            } else {
              this.elements.overlay.classList.remove('chat-auth-overlay--drawer');
            }

            panel.classList.add('active');
            this.state.activePanel = panelName;
            if (panelName === 'main') this.resetAuthSteps();

            // Panel-specific initialization
            if (panelName === 'settings') {
              this.updateSettingsAvatar();
              this.loadUserSettings();
            } else if (panelName === 'security') {
              this.loadActiveSessions();
              this.loadLastLoginInfo();
              this.updateSecurityStatus();
              this.updateGoogleLinkStatus();
              this._update2FAUIState(this.state.user?.twoFactorEnabled === true);
            }

            // Focus first input
            setTimeout(() => {
              panel.querySelector('input:not([type="hidden"])')?.focus();
            }, 100);
          }
        },

        // Load last login info
        loadLastLoginInfo() {
          const lastLogin = localStorage.getItem('lydian_last_login');
          const lastLoginTime = document.getElementById('lastLoginTime');
          const lastLoginLocation = document.getElementById('lastLoginLocation');

          if (lastLogin && lastLoginTime) {
            const date = new Date(lastLogin);
            lastLoginTime.textContent = date.toLocaleString('tr-TR', {
              day: 'numeric',
              month: 'long',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit',
            });
          }
          if (lastLoginLocation) {
            lastLoginLocation.textContent = 'TÃ¼rkiye'; // Would be from IP geolocation
          }
        },

        // Close panel (with slide-out animation for drawer panels)
        closePanel() {
          const activePanel = this.state.activePanel;
          const panel = activePanel ? this.elements.panels[activePanel] : null;

          if (panel && panel.classList.contains('chat-auth-panel--drawer')) {
            // Drawer panel: animate slide-out
            panel.classList.add('closing');
            panel.classList.remove('active');
            setTimeout(() => {
              panel.classList.remove('closing');
              this.elements.overlay?.classList.remove('active');
              this.elements.overlay?.classList.remove('chat-auth-overlay--drawer');
              this.closeAllPanels();
              this.state.activePanel = null;
            }, 350);
          } else {
            // Standard panel: instant close
            this.elements.overlay?.classList.remove('active');
            this.elements.overlay?.classList.remove('chat-auth-overlay--drawer');
            this.closeAllPanels();
            this.state.activePanel = null;
          }
        },

        // Close all panels
        closeAllPanels() {
          Object.values(this.elements.panels).forEach(p => {
            p?.classList.remove('active');
            p?.classList.remove('closing');
          });
        },

        // Reset auth steps to initial state
        resetAuthSteps() {
          document.querySelectorAll('#chatAuthMainPanel .auth-step').forEach(s => {
            s.classList.remove('active');
            s.style.animation = '';
          });
          document.getElementById('authStep1')?.classList.add('active');
          const ids = [
            'authEmailInput',
            'authLoginPassword',
            'authRegisterName',
            'authRegisterPassword',
            'authRegisterPasswordConfirm',
          ];
          ids.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = '';
          });
          document
            .querySelectorAll('.auth-error-msg')
            .forEach(el => el.classList.remove('visible'));
          this.state.authEmail = null;
          this.state.authMode = null;
        },

        // Switch steps with animation
        switchStep(fromId, toId) {
          const from = document.getElementById(fromId);
          const to = document.getElementById(toId);
          if (!from || !to) return;
          from.style.animation = 'authStepOut 0.2s ease forwards';
          setTimeout(() => {
            from.classList.remove('active');
            from.style.animation = '';
            to.classList.add('active');
          }, 200);
        },

        // Go back to step 1
        goBackToStep1() {
          const active = document.querySelector('#chatAuthMainPanel .auth-step.active');
          if (active) this.switchStep(active.id, 'authStep1');
          setTimeout(() => document.getElementById('authEmailInput')?.focus(), 350);
          this.state.authMode = null;
        },

        // Show error in specific element
        showAuthError(elementId, message) {
          const el = document.getElementById(elementId);
          if (el) {
            el.textContent = message;
            el.classList.add('visible');
            setTimeout(() => el.classList.remove('visible'), 5000);
          }
        },

        // Handle email continue (Step 1 -> Step 2)
        async handleEmailContinue() {
          const emailInput = document.getElementById('authEmailInput');
          const email = emailInput?.value?.trim();
          if (!email) {
            this.showAuthError('authStep1Error', 'LÃ¼tfen e-posta adresinizi girin');
            return;
          }
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(email)) {
            this.showAuthError('authStep1Error', 'GeÃ§erli bir e-posta adresi girin');
            return;
          }

          const btn = document.getElementById('authContinueBtn');
          btn.classList.add('loading');
          btn.disabled = true;

          try {
            const res = await fetch('/api/chat-auth/check-email', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email }),
            });
            const data = await res.json();
            this.state.authEmail = email;

            if (data.exists) {
              this.state.authMode = 'login';
              document.getElementById('authLoginEmailDisplay').textContent = email;
              this.switchStep('authStep1', 'authStep2Login');
              setTimeout(() => document.getElementById('authLoginPassword')?.focus(), 350);
            } else {
              this.state.authMode = 'register';
              document.getElementById('authRegisterEmailDisplay').textContent = email;
              this.switchStep('authStep1', 'authStep2Register');
              setTimeout(() => document.getElementById('authRegisterName')?.focus(), 350);
            }
          } catch (err) {
            this.showAuthError('authStep1Error', 'BaÄŸlantÄ± hatasÄ±. Tekrar deneyin.');
          } finally {
            btn.classList.remove('loading');
            btn.disabled = false;
          }
        },

        // Handle login submit (Step 2a)
        async handleLoginSubmit() {
          const password = document.getElementById('authLoginPassword')?.value;
          if (!password) {
            this.showAuthError('authStep2LoginError', 'Åžifre gerekli');
            return;
          }

          const btn = document.getElementById('authLoginBtn');
          btn.classList.add('loading');
          btn.disabled = true;

          try {
            const loginPayload = { email: this.state.authEmail, password };

            // If we have a pending 2FA code, include it
            const totpInput = document.getElementById('authLogin2FACode');
            if (totpInput && totpInput.value) {
              loginPayload.totpCode = totpInput.value.trim();
            }

            const res = await fetch('/api/chat-auth/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify(loginPayload),
            });
            const data = await res.json();

            if (data.success) {
              this.onLoginSuccess(data.user);
            } else if (data.requires2FA) {
              // Show 2FA input step
              this._show2FALoginStep();
            } else {
              // Check if this is a 2FA code error
              const errorTarget = document.getElementById('authLogin2FACode')
                ? 'authStep2FAError'
                : 'authStep2LoginError';
              this.showAuthError(errorTarget, data.error || 'GiriÅŸ baÅŸarÄ±sÄ±z');
            }
          } catch (err) {
            this.showAuthError('authStep2LoginError', 'BaÄŸlantÄ± hatasÄ±');
          } finally {
            btn.classList.remove('loading');
            btn.disabled = false;
          }
        },

        // Show 2FA verification step during login
        _show2FALoginStep() {
          // Find the login form container and add 2FA input after password
          const loginForm = document.getElementById('authStep2Login');
          if (!loginForm) return;

          // Check if already showing
          if (document.getElementById('auth2FASection')) return;

          // Hide the password section temporarily and show 2FA section
          const section = document.createElement('div');
          section.id = 'auth2FASection';
          section.innerHTML = `
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.08);">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 0.75rem;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                <span style="color: rgba(255,255,255,0.7); font-size: 0.85rem;">Authenticator kodunuzu girin</span>
              </div>
              <div class="chat-auth-field">
                <input type="text" id="authLogin2FACode" placeholder="6 haneli kod" maxlength="6" pattern="[0-9]*" inputmode="numeric" autocomplete="one-time-code" style="text-align: center; letter-spacing: 4px; font-size: 1.2rem;">
              </div>
              <div class="auth-error" id="authStep2FAError" style="display:none;"></div>
            </div>
          `;

          // Insert before the submit button
          const btnContainer =
            loginForm.querySelector('.chat-auth-btn')?.parentElement || loginForm;
          btnContainer.parentElement.insertBefore(section, btnContainer);

          // Focus the 2FA input
          setTimeout(() => document.getElementById('authLogin2FACode')?.focus(), 100);

          // Add Enter key handler
          document.getElementById('authLogin2FACode')?.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
              e.preventDefault();
              this.handleLoginSubmit();
            }
          });
        },

        // Handle register submit (Step 2b)
        async handleRegisterSubmit() {
          const displayName = document.getElementById('authRegisterName')?.value?.trim();
          const password = document.getElementById('authRegisterPassword')?.value;
          const confirmPassword = document.getElementById('authRegisterPasswordConfirm')?.value;

          if (!displayName || !password || !confirmPassword) {
            this.showAuthError('authStep2RegisterError', 'TÃ¼m alanlar gerekli');
            return;
          }
          if (password !== confirmPassword) {
            this.showAuthError('authStep2RegisterError', 'Åžifreler eÅŸleÅŸmiyor');
            return;
          }
          if (password.length < 8) {
            this.showAuthError('authStep2RegisterError', 'Åžifre en az 8 karakter olmalÄ±');
            return;
          }

          const btn = document.getElementById('authRegisterBtn');
          btn.classList.add('loading');
          btn.disabled = true;

          try {
            const res = await fetch('/api/chat-auth/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email: this.state.authEmail, password, displayName }),
            });
            const data = await res.json();

            if (data.success) {
              this.showToast('KayÄ±t baÅŸarÄ±lÄ±!', 'success');
              const loginRes = await fetch('/api/chat-auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ email: this.state.authEmail, password }),
              });
              const loginData = await loginRes.json();
              if (loginData.success) {
                this.onLoginSuccess(loginData.user);
              } else {
                this.closePanel();
                this.showToast('KayÄ±t baÅŸarÄ±lÄ±! LÃ¼tfen giriÅŸ yapÄ±n.', 'info');
              }
            } else {
              this.showAuthError('authStep2RegisterError', data.error || 'KayÄ±t baÅŸarÄ±sÄ±z');
            }
          } catch (err) {
            this.showAuthError('authStep2RegisterError', 'BaÄŸlantÄ± hatasÄ±');
          } finally {
            btn.classList.remove('loading');
            btn.disabled = false;
          }
        },

        // Toggle password visibility
        togglePasswordVisibility(inputId, toggleBtn) {
          const input = document.getElementById(inputId);
          if (!input) return;
          const isPassword = input.type === 'password';
          input.type = isPassword ? 'text' : 'password';
          toggleBtn.innerHTML = isPassword
            ? '<svg viewBox="0 0 24 24"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>'
            : '<svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>';
        },

        // Open phone login
        openPhoneLogin() {
          this.openPanel('phone');
        },

        // Send phone OTP
        async sendPhoneOTP() {
          const phoneNumber = document
            .getElementById('phoneNumberInput')
            ?.value?.replace(/\D/g, '');
          const countryCode = document.getElementById('phoneCountryCode')?.value || '+90';
          if (!phoneNumber || phoneNumber.length < 10) {
            this.showAuthError('phoneStep1Error', 'Gecerli bir telefon numarasi girin');
            return;
          }
          try {
            const btn = document.querySelector('#phoneStep1 .auth-btn-primary');
            if (btn) {
              btn.disabled = true;
              btn.textContent = 'Gonderiliyor...';
            }
            const res = await fetch('/api/chat-auth/phone-send-otp', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify({ phoneNumber, countryCode }),
            });
            const data = await res.json();
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'Kod gÃ¶nder';
            }
            if (!data.success) {
              this.showAuthError('phoneStep1Error', data.error || 'Kod gÃ¶nderilemedi');
              return;
            }
            // Store full phone number for verification
            this._phoneFullNumber = data.phoneNumber;
            // Switch to step 2
            document.getElementById('phoneStep1')?.classList.remove('active');
            document.getElementById('phoneStep2')?.classList.add('active');
            // Focus first OTP digit
            document.querySelector('#phoneStep2 .auth-otp-digit')?.focus();
            // Start resend countdown
            this._startResendCountdown();
            this.showToast('DoÄŸrulama kodu gÃ¶nderildi', 'success');
          } catch (err) {
            console.error('[PHONE_OTP] Send error:', err);
            this.showAuthError('phoneStep1Error', 'Bir hata oluÅŸtu. Tekrar deneyin.');
            const btn = document.querySelector('#phoneStep1 .auth-btn-primary');
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'Kod gÃ¶nder';
            }
          }
        },

        // Resend countdown timer
        _startResendCountdown() {
          const btn = document.getElementById('phoneResendBtn');
          if (!btn) return;
          btn.disabled = true;
          let seconds = 60;
          btn.textContent = `Kodu tekrar gÃ¶nder (${seconds}s)`;
          if (this._resendTimer) clearInterval(this._resendTimer);
          this._resendTimer = setInterval(() => {
            seconds--;
            if (seconds <= 0) {
              clearInterval(this._resendTimer);
              btn.disabled = false;
              btn.textContent = 'Kodu tekrar gÃ¶nder';
            } else {
              btn.textContent = `Kodu tekrar gÃ¶nder (${seconds}s)`;
            }
          }, 1000);
        },

        // Resend phone OTP
        resendPhoneOTP() {
          // Reset to step 1 inputs but re-send
          this.sendPhoneOTP();
        },

        // Verify phone OTP
        async verifyPhoneOTP() {
          // Collect 6-digit code from OTP inputs
          const digits = document.querySelectorAll('#phoneStep2 .auth-otp-digit');
          const code = Array.from(digits)
            .map(d => d.value)
            .join('');
          if (code.length !== 6 || !/^\d{6}$/.test(code)) {
            this.showAuthError('phoneStep2Error', '6 haneli doÄŸrulama kodunu girin');
            return;
          }
          if (!this._phoneFullNumber) {
            this.showAuthError('phoneStep2Error', 'Telefon numarasÄ± bulunamadÄ±. Geri dÃ¶nÃ¼n.');
            return;
          }
          try {
            const btn = document.querySelector('#phoneStep2 .auth-btn-primary');
            if (btn) {
              btn.disabled = true;
              btn.textContent = 'DogrulanÄ±yor...';
            }
            const res = await fetch('/api/chat-auth/phone-verify-otp', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify({ phoneNumber: this._phoneFullNumber, code }),
            });
            const data = await res.json();
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'Dogrula';
            }
            if (!data.success) {
              this.showAuthError('phoneStep2Error', data.error || 'DoÄŸrulama baÅŸarÄ±sÄ±z');
              return;
            }
            // Success - close panel and refresh session
            this.showToast(data.message || 'GiriÅŸ baÅŸarÄ±lÄ±!', 'success');
            this.closePanel();
            await this.checkSession();
          } catch (err) {
            console.error('[PHONE_OTP] Verify error:', err);
            this.showAuthError('phoneStep2Error', 'Bir hata oluÅŸtu. Tekrar deneyin.');
            const btn = document.querySelector('#phoneStep2 .auth-btn-primary');
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'Dogrula';
            }
          }
        },

        // Password strength calculation
        updatePasswordStrength(password, barId, textId = null) {
          const bar = document.querySelector(`#${barId} .password-strength-bar`);
          const text = textId ? document.getElementById(textId) : null;
          if (!bar) return;

          let score = 0;
          let strength = 'weak';
          let strengthText = 'ZayÄ±f';

          if (password.length >= 8) score++;
          if (password.length >= 12) score++;
          if (/[A-Z]/.test(password)) score++;
          if (/[a-z]/.test(password)) score++;
          if (/[0-9]/.test(password)) score++;
          if (/[^A-Za-z0-9]/.test(password)) score++;

          if (score >= 5) {
            strength = 'strong';
            strengthText = 'GÃ¼Ã§lÃ¼';
          } else if (score >= 3) {
            strength = 'medium';
            strengthText = 'Orta';
          }

          bar.className = 'password-strength-bar ' + strength;
          if (text) text.textContent = password.length > 0 ? strengthText : '';
        },

        // Show toast notification
        showToast(message, type = 'info') {
          // Use existing showToast if available, otherwise create simple one
          if (typeof window.showToast === 'function') {
            window.showToast(message, type);
          } else {
            const toast = document.createElement('div');
            toast.style.cssText = `
              position: fixed;
              bottom: 20px;
              left: 50%;
              transform: translateX(-50%);
              padding: 12px 24px;
              background: ${type === 'error' ? '#ef4444' : type === 'success' ? 'rgba(255, 255, 255, 0.9)' : '#6e84ff'};
              color: white;
              border-radius: 8px;
              font-size: 14px;
              z-index: 10010;
              box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
          }
        },

        // Set button loading state
        setButtonLoading(btn, loading, text) {
          if (loading) {
            btn.disabled = true;
            btn.dataset.originalText = btn.textContent;
            btn.classList.add('loading');
          } else {
            btn.disabled = false;
            btn.textContent = text || btn.dataset.originalText || 'GÃ¶nder';
            btn.classList.remove('loading');
          }
        },

        // Handle Forgot Password
        async handleForgotPassword(formData) {
          const email = formData.get('email');
          const btn = document.querySelector('#chatAuthForgotForm .chat-auth-btn');

          this.setButtonLoading(btn, true);

          try {
            const res = await fetch('/api/chat-auth/forgot-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email }),
            });

            const data = await res.json();
            this.showToast(data.message || 'Ä°stek gÃ¶nderildi', 'success');
            document.getElementById('chatAuthForgotForm').reset();
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
          } finally {
            this.setButtonLoading(btn, false, 'SÄ±fÄ±rlama BaÄŸlantÄ±sÄ± GÃ¶nder');
          }
        },

        // Handle Reset Password
        async handleResetPassword(formData) {
          const token = formData.get('token');
          const password = formData.get('password');
          const confirmPassword = formData.get('confirmPassword');

          if (password !== confirmPassword) {
            this.showToast('Åžifreler eÅŸleÅŸmiyor', 'error');
            return;
          }

          const btn = document.querySelector('#chatAuthResetForm .chat-auth-btn');
          this.setButtonLoading(btn, true);

          try {
            const res = await fetch('/api/chat-auth/reset-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ token, password }),
            });

            const data = await res.json();

            if (data.success) {
              this.showToast('Åžifre gÃ¼ncellendi! GiriÅŸ yapabilirsiniz.', 'success');
              document.getElementById('chatAuthResetForm').reset();
              this.openPanel('main');
            } else {
              this.showToast(data.error || 'Åžifre sÄ±fÄ±rlama baÅŸarÄ±sÄ±z', 'error');
            }
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
          } finally {
            this.setButtonLoading(btn, false, 'Åžifreyi GÃ¼ncelle');
          }
        },

        // Handle Change Password
        async handleChangePassword(formData) {
          const currentPassword = formData.get('currentPassword');
          const newPassword = formData.get('newPassword');
          const newPasswordConfirm = formData.get('newPasswordConfirm');

          if (newPassword !== newPasswordConfirm) {
            this.showToast('Yeni ÅŸifreler eÅŸleÅŸmiyor', 'error');
            return;
          }

          const btn = document.querySelector('#chatAuthChangePasswordForm .chat-auth-btn');
          this.setButtonLoading(btn, true);

          try {
            const res = await fetch('/api/chat-auth/change-password', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify({ currentPassword, newPassword }),
            });

            const data = await res.json();

            if (data.success) {
              this.showToast('Åžifre gÃ¼ncellendi', 'success');
              document.getElementById('chatAuthChangePasswordForm').reset();
            } else {
              this.showToast(data.error || 'Åžifre deÄŸiÅŸtirme baÅŸarÄ±sÄ±z', 'error');
            }
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
          } finally {
            this.setButtonLoading(btn, false, 'Åžifreyi GÃ¼ncelle');
          }
        },

        // Login success handler
        onLoginSuccess(user) {
          this.state.isAuthenticated = true;
          this.state.user = user;
          localStorage.setItem('lydian_chat_user', JSON.stringify(user));
          this.updateUI();
          this.closePanel();
          this.loadUserSettings();
          this.loadUserChatHistory();
        },

        // Check existing session with automatic token refresh
        async checkSession() {
          try {
            let res = await fetch('/api/chat-auth/me', { credentials: 'include' });
            let data = await res.json();

            // If token expired, try to refresh
            if (!data.success && (data.expired || res.status === 401)) {
              const refreshRes = await fetch('/api/chat-auth/refresh', {
                method: 'POST',
                credentials: 'include',
              });
              const refreshData = await refreshRes.json();

              if (refreshData.success) {
                // Retry getting user info with new token
                res = await fetch('/api/chat-auth/me', { credentials: 'include' });
                data = await res.json();
              }
            }

            if (data.success && data.user) {
              this.state.isAuthenticated = true;
              this.state.user = data.user;
              this.state.settings = data.settings;
              localStorage.setItem('lydian_chat_user', JSON.stringify(data.user));
              this.updateUI();
              this.applySettings(data.settings);
              // Load user's chat history from server
              this.loadUserChatHistory();
            }
          } catch (err) {
            // No session, continue as guest
            console.warn('Session check failed:', err);
          }
        },

        // Update UI with user info
        updateUI() {
          const user = this.state.user;
          if (!user) return;

          const initial = user.displayName?.charAt(0)?.toUpperCase() || 'U';

          // Desktop sidebar
          const userName = document.querySelector('.user-name');
          const userEmail = document.querySelector('.user-email');
          if (userName) userName.textContent = user.displayName;
          if (userEmail) userEmail.textContent = user.email;

          // Mobile sidebar
          const mobileUserName = document.querySelector('.mobile-sidebar-user-name');
          const mobileUserAvatar = document.querySelector('.mobile-sidebar-user-avatar');
          if (mobileUserName) mobileUserName.textContent = user.displayName;
          if (mobileUserAvatar) mobileUserAvatar.textContent = initial;

          // Profile panel
          const profileAvatar = document.getElementById('profileAvatar');
          const profileName = document.getElementById('profileName');
          const profileEmail = document.getElementById('profileEmail');
          if (profileAvatar) profileAvatar.textContent = initial;
          if (profileName) profileName.textContent = user.displayName;
          if (profileEmail) profileEmail.textContent = user.email;

          // Welcome text with time-based personalized greeting
          const welcomeName = document.getElementById('welcomeUserName');
          if (welcomeName) {
            const hour = new Date().getHours();
            let greeting;
            if (hour >= 5 && hour < 12) {
              greeting = 'GÃ¼naydÄ±n';
            } else if (hour >= 12 && hour < 18) {
              greeting = 'Ä°yi gÃ¼nler';
            } else if (hour >= 18 && hour < 22) {
              greeting = 'Ä°yi akÅŸamlar';
            } else {
              greeting = 'Ä°yi geceler';
            }
            welcomeName.textContent = `${greeting}, ${user.displayName}`;
            welcomeName.style.display = 'block';
          }

          // ðŸ‘¤ Header User Auth (Desktop) - Show logged in state
          const headerLoginBtn = document.getElementById('headerLoginBtn');
          const headerUserMenu = document.getElementById('headerUserMenu');
          const headerUserAvatar = document.getElementById('headerUserAvatar');
          const headerUserName = document.getElementById('headerUserName');

          if (headerLoginBtn) headerLoginBtn.style.display = 'none';
          if (headerUserMenu) headerUserMenu.style.display = 'flex';
          if (headerUserAvatar) headerUserAvatar.textContent = initial;
          if (headerUserName) headerUserName.textContent = user.displayName;

          // ðŸ”‘ Mobile Login Trigger - Hide when logged in
          const mobileLoginTrigger = document.getElementById('mobileLoginTrigger');
          if (mobileLoginTrigger) mobileLoginTrigger.style.display = 'none';

          // ðŸ–¼ï¸ Restore avatar: prefer localStorage, fallback to server avatar
          var savedAvatar = localStorage.getItem('lydian_avatar');
          if (!savedAvatar && this.state.user?.avatarUrl) {
            // Server has avatar but localStorage doesn't (different device)
            savedAvatar = this.state.user.avatarUrl;
            localStorage.setItem('lydian_avatar', savedAvatar);
          }
          if (savedAvatar) {
            this.updateAllAvatars(savedAvatar);
          }
        },

        // Load and apply settings
        applySettings(settings) {
          if (!settings) return;
          this.state.settings = settings;

          // Theme
          const themeSelect = document.getElementById('settingTheme');
          if (themeSelect) themeSelect.value = settings.theme || 'dark';

          // Language
          const langSelect = document.getElementById('settingLanguage');
          if (langSelect) langSelect.value = settings.language || 'tr';

          // Model
          const modelSelect = document.getElementById('settingModel');
          if (modelSelect) modelSelect.value = settings.preferredModel || 'premium';

          // Toggles
          const autoSave = document.getElementById('settingAutoSave');
          if (autoSave) autoSave.classList.toggle('active', settings.autoSaveHistory !== false);

          const notifications = document.getElementById('settingNotifications');
          if (notifications)
            notifications.classList.toggle('active', settings.notificationsEnabled);

          const sounds = document.getElementById('settingSounds');
          if (sounds) sounds.classList.toggle('active', settings.soundEnabled);

          const emailNotifications = document.getElementById('settingEmailNotifications');
          if (emailNotifications)
            emailNotifications.classList.toggle('active', settings.emailNotifications);

          const useHistory = document.getElementById('settingUseHistory');
          if (useHistory) useHistory.classList.toggle('active', settings.useHistory !== false);

          const analytics = document.getElementById('settingAnalytics');
          if (analytics) analytics.classList.toggle('active', settings.analytics);

          // Sync display name
          const displayNameInput = document.getElementById('settingDisplayName');
          if (displayNameInput && this.state.user) {
            displayNameInput.value = this.state.user.displayName || '';
          }

          // Apply custom settings
          var custom = settings.customSettings || {};

          // Font size
          var fontSizeEl = document.getElementById('settingFontSize');
          if (fontSizeEl) fontSizeEl.value = custom.fontSize || 'medium';
          this.applyCustomSetting('fontSize', custom.fontSize || 'medium');

          // Density
          var densityEl = document.getElementById('settingDensity');
          if (densityEl) densityEl.value = custom.messageDensity || 'comfortable';
          this.applyCustomSetting('messageDensity', custom.messageDensity || 'comfortable');

          // Chat width
          var chatWidthEl = document.getElementById('settingChatWidth');
          if (chatWidthEl) chatWidthEl.value = custom.chatWidth || 'medium';
          this.applyCustomSetting('chatWidth', custom.chatWidth || 'medium');

          // Response length
          var respLenEl = document.getElementById('settingResponseLength');
          if (respLenEl) respLenEl.value = custom.responseLength || 'medium';

          // Conversation memory
          var convMemEl = document.getElementById('settingConversationMemory');
          if (convMemEl) {
            if (custom.conversationMemory === false) {
              convMemEl.classList.remove('active');
            } else {
              convMemEl.classList.add('active');
            }
          }

          // AI language
          var aiLangEl = document.getElementById('settingAiLanguage');
          if (aiLangEl) aiLangEl.value = custom.aiLanguage || 'tr';

          // Code theme
          var codeThemeEl = document.getElementById('settingCodeTheme');
          if (codeThemeEl) codeThemeEl.value = custom.codeTheme || 'github-dark';

          // Bio
          var bioEl = document.getElementById('settingBio');
          if (bioEl) {
            bioEl.value = custom.bio || '';
            var bioCount = document.getElementById('settingBioCount');
            if (bioCount) bioCount.textContent = (custom.bio || '').length;
          }

          // Email (from user object)
          var emailEl = document.getElementById('settingEmail');
          if (emailEl && this.state.user) emailEl.value = this.state.user.email || '';

          // Created at
          var createdEl = document.getElementById('settingCreatedAt');
          if (createdEl && this.state.user && this.state.user.createdAt) {
            var d = new Date(this.state.user.createdAt);
            createdEl.value = d.toLocaleDateString('tr-TR', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            });
          }

          // Restore AI mode from server
          if (custom.lastAiType && custom.lastAiType !== 'general') {
            state.selectedAiType = custom.lastAiType;
            try {
              sessionStorage.setItem('lydian_ai_type', custom.lastAiType);
            } catch (e) {}
            var savedModeBtn = document.querySelector('[data-mode="' + custom.lastAiType + '"]');
            if (savedModeBtn) {
              document.querySelectorAll('[data-mode]').forEach(function (b) {
                b.classList.remove('active');
              });
              savedModeBtn.classList.add('active');
            }
            // Update header dropdown label
            var headerLabel = document.getElementById('headerModelLabel');
            if (headerLabel) {
              var labelMap = {
                general: 'LyDian AI',
                'deep-think': 'Derin DÃ¼ÅŸÃ¼nce',
                'web-search': 'Web Arama',
                'code-write': 'Kod Yaz',
              };
              headerLabel.textContent = labelMap[custom.lastAiType] || 'LyDian AI';
            }
          }
        },

        // Load user settings from API
        async loadUserSettings() {
          try {
            const res = await fetch('/api/chat-auth/settings', { credentials: 'include' });
            const data = await res.json();
            if (data.success) {
              this.applySettings(data.settings);
            }
          } catch (err) {}
        },

        // Update a setting
        async updateSetting(key, value) {
          try {
            // displayName goes to profile endpoint, not settings
            if (key === 'displayName') {
              const res = await fetch('/api/chat-auth/profile', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({ displayName: value }),
              });
              const data = await res.json();
              if (data.success && this.state.user) {
                this.state.user.displayName = value;
                localStorage.setItem('lydian_chat_user', JSON.stringify(this.state.user));
                this.updateAllAvatars(localStorage.getItem('lydian_avatar'));
              } else {
                this.showToast(data.error || 'GÃ¼ncelleme baÅŸarÄ±sÄ±z', 'error');
              }
              return;
            }
            const body = {};
            body[key] = value;
            const res = await fetch('/api/chat-auth/settings', {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify(body),
            });
            const data = await res.json();
            if (data.success) {
              // Sync local state
              if (this.state.settings) {
                this.state.settings[key] = value;
              }
              // Track setting change if analytics enabled
              this._trackEvent('setting_changed', { key, value });
            }
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
          }
        },

        // Toggle setting with real functionality
        async toggleSetting(key, element) {
          const isActive = element.classList.toggle('active');

          // Push Notifications: request browser permission
          if (key === 'notificationsEnabled' && isActive) {
            if (!('Notification' in window)) {
              element.classList.remove('active');
              this.showToast('TarayÄ±cÄ±nÄ±z bildirimleri desteklemiyor', 'error');
              return;
            }
            const permission = await Notification.requestPermission();
            if (permission !== 'granted') {
              element.classList.remove('active');
              this.showToast('Bildirim izni reddedildi', 'error');
              return;
            }
          }

          // Sound toggle: play test sound
          if (key === 'soundEnabled' && isActive) {
            this._playNotificationSound();
          }

          this.updateSetting(key, isActive);
        },

        // Notification sound via Web Audio API
        _playNotificationSound() {
          try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(880, ctx.currentTime);
            osc.frequency.setValueAtTime(1047, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.15, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.3);
          } catch (e) {}
        },

        // Custom Settings Management
        async updateCustomSetting(key, value) {
          var current =
            this.state.settings && this.state.settings.customSettings
              ? Object.assign({}, this.state.settings.customSettings)
              : {};
          current[key] = value;

          // Apply immediately
          this.applyCustomSetting(key, value);

          // Save to server
          try {
            await fetch('/api/chat-auth/settings', {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify({ customSettings: current }),
            });
            if (this.state.settings) {
              this.state.settings.customSettings = current;
            }
          } catch (e) {
            console.warn('[SETTINGS] Custom setting save failed:', e.message);
          }
        },

        applyCustomSetting(key, value) {
          switch (key) {
            case 'fontSize':
              var sizes = { small: '13px', medium: '15px', large: '17px' };
              document.documentElement.style.setProperty(
                '--chat-font-size',
                sizes[value] || '15px'
              );
              break;
            case 'messageDensity':
              document.body.setAttribute('data-density', value || 'comfortable');
              break;
            case 'chatWidth':
              document.body.setAttribute('data-chat-width', value || 'medium');
              break;
          }
        },

        async toggleCustomSetting(key, element) {
          var isActive = element.classList.toggle('active');
          await this.updateCustomSetting(key, isActive);
        },

        async exportAllData() {
          try {
            var settingsRes = await fetch('/api/chat-auth/settings', { credentials: 'include' });
            var historyRes = await fetch('/api/chat-auth/history', { credentials: 'include' });
            var settingsData = await settingsRes.json();
            var historyData = await historyRes.json();

            var exportData = {
              exportDate: new Date().toISOString(),
              platform: 'AILYDIAN',
              user: this.state.user,
              settings: settingsData.settings || {},
              conversations: historyData.conversations || [],
              localData: {},
            };

            for (var i = 0; i < localStorage.length; i++) {
              var lsKey = localStorage.key(i);
              if (lsKey && (lsKey.startsWith('lydian_') || lsKey.startsWith('chat_'))) {
                exportData.localData[lsKey] = localStorage.getItem(lsKey);
              }
            }

            var blob = new Blob([JSON.stringify(exportData, null, 2)], {
              type: 'application/json',
            });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'ailydian-veri-export-' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          } catch (e) {
            this.showToast('Veri indirme baÅŸarÄ±sÄ±z', 'error');
          }
        },

        async clearSearchHistory() {
          if (!confirm('Arama geÃ§miÅŸiniz silinecek. Devam etmek istiyor musunuz?')) return;
          localStorage.removeItem('lydian_search_history');
          sessionStorage.removeItem('lydian_search_cache');
          this.showToast('Arama geÃ§miÅŸi temizlendi', 'success');
        },

        async deactivateAccount() {
          if (
            !confirm(
              'HesabÄ±nÄ±z geÃ§ici olarak dondurulacak. Tekrar giriÅŸ yaptÄ±ÄŸÄ±nÄ±zda aktif olacaktÄ±r. Devam?'
            )
          )
            return;
          try {
            await this.logout();
          } catch (e) {
            this.showToast('Ä°ÅŸlem baÅŸarÄ±sÄ±z', 'error');
          }
        },

        // Send browser push notification
        _sendPushNotification(title, body) {
          if (!this.state.settings?.notificationsEnabled) return;
          if (!('Notification' in window) || Notification.permission !== 'granted') return;
          if (document.hasFocus()) return; // Don't notify if tab is focused
          try {
            new Notification(title, {
              body: body.substring(0, 100),
              icon: '/favicon.ico',
              tag: 'ailydian-chat',
            });
          } catch (e) {}
        },

        // Minimal analytics tracking (anonymous, respects user toggle)
        _trackEvent(event, data = {}) {
          if (!this.state.settings?.analytics) return;
          try {
            const entry = {
              event,
              timestamp: new Date().toISOString(),
              sessionId: sessionStorage.getItem('ailydian_session') || this._initSession(),
              ...data,
            };
            // Store locally (anonymous)
            const events = JSON.parse(localStorage.getItem('ailydian_analytics') || '[]');
            events.push(entry);
            // Keep only last 100 events
            if (events.length > 100) events.splice(0, events.length - 100);
            localStorage.setItem('ailydian_analytics', JSON.stringify(events));
          } catch (e) {}
        },

        _initSession() {
          const id = 'sess_' + Math.random().toString(36).substring(2, 10);
          sessionStorage.setItem('ailydian_session', id);
          return id;
        },

        // Load user chat history from server
        async loadUserChatHistory() {
          if (!this.state.user) return;

          try {
            const res = await fetch('/api/chat-auth/history', { credentials: 'include' });
            const data = await res.json();

            if (data.success && data.conversations) {
              // Store server conversations
              localStorage.setItem('lydian_chat_history', JSON.stringify(data.conversations));

              // Clear existing chat history UI to avoid duplicates
              const chatHistoryEl = document.getElementById('chatHistory');
              if (chatHistoryEl) {
                chatHistoryEl.innerHTML = '';
              }

              // Add server conversations to UI
              data.conversations.forEach(conv => {
                const chatData = {
                  id: `server_${conv.id}`,
                  serverId: conv.id,
                  title: conv.title || 'Yeni Sohbet',
                  timestamp: new Date(conv.updatedAt || conv.createdAt).getTime(),
                  messageCount: conv.messageCount || 0,
                  isServerChat: true,
                };

                // Add to UI
                if (typeof addChatToHistory === 'function') {
                  addChatToHistory(chatData);
                }
              });

              // Also load local chats that haven't been synced
              const localChatKeys = Object.keys(localStorage).filter(
                key => key.startsWith('chat_') && !localStorage.getItem(`server_conv_${key}`)
              );

              localChatKeys.forEach(key => {
                try {
                  const chatData = JSON.parse(localStorage.getItem(key));
                  if (
                    chatData &&
                    chatData.id &&
                    chatData.messages &&
                    Array.isArray(chatData.messages)
                  ) {
                    addChatToHistory(chatData);
                  }
                } catch (e) {
                  console.warn('Invalid local chat data:', key);
                }
              });
            }
          } catch (err) {
            console.warn('Chat history load failed:', err);
          }
        },

        // Logout
        async logout() {
          try {
            await fetch('/api/chat-auth/logout', { method: 'POST', credentials: 'include' });
          } catch (err) {}

          this.state.isAuthenticated = false;
          this.state.user = null;
          this.state.settings = null;
          localStorage.removeItem('lydian_chat_user');
          localStorage.removeItem('lydian_chat_history');

          // Reset UI
          const userName = document.querySelector('.user-name');
          const userEmail = document.querySelector('.user-email');
          if (userName) userName.textContent = 'KullanÄ±cÄ±';
          if (userEmail) userEmail.textContent = 'GiriÅŸ yapÄ±n';

          const mobileUserName = document.querySelector('.mobile-sidebar-user-name');
          const mobileUserAvatar = document.querySelector('.mobile-sidebar-user-avatar');
          if (mobileUserName) mobileUserName.textContent = 'KullanÄ±cÄ±';
          if (mobileUserAvatar) mobileUserAvatar.textContent = 'U';

          const welcomeName = document.getElementById('welcomeUserName');
          if (welcomeName) welcomeName.textContent = 'HoÅŸgeldiniz';

          // ðŸ‘¤ Header User Auth (Desktop) - Reset to logged out state
          const headerLoginBtn = document.getElementById('headerLoginBtn');
          const headerUserMenu = document.getElementById('headerUserMenu');

          if (headerLoginBtn) headerLoginBtn.style.display = 'flex';
          if (headerUserMenu) {
            headerUserMenu.style.display = 'none';
            headerUserMenu.classList.remove('active');
          }

          // ðŸ”‘ Mobile Login Trigger - Show when logged out
          const mobileLoginTrigger = document.getElementById('mobileLoginTrigger');
          if (mobileLoginTrigger) mobileLoginTrigger.style.display = '';

          this.closePanel();
        },

        // Link Google account
        linkGoogle() {
          window.location.href = '/api/chat-auth/google-auth';
        },

        // Update Google link status in security panel
        updateGoogleLinkStatus() {
          const statusEl = document.getElementById('googleLinkStatus');
          const btnEl = document.getElementById('googleLinkBtn');
          if (!statusEl || !btnEl) return;
          if (this.state.user?.authProvider === 'google' || this.state.user?.googleLinked) {
            statusEl.textContent = this.state.user.email || 'Bagli';
            btnEl.textContent = 'Bagli';
            btnEl.disabled = true;
            btnEl.style.opacity = '0.5';
          }
        },

        // ============================================================
        // ENHANCED SECURITY FEATURES
        // ============================================================

        // Check password strength
        checkPasswordStrength(password) {
          const strengthBar = document.querySelector('#newPasswordStrength .password-strength-bar');
          const strengthText = document.getElementById('passwordStrengthText');
          if (!strengthBar || !strengthText) return;

          let strength = 0;
          let feedback = [];

          // Length check
          if (password.length >= 8) strength += 1;
          if (password.length >= 12) strength += 1;
          else feedback.push('12+ karakter Ã¶nerilir');

          // Uppercase
          if (/[A-Z]/.test(password)) strength += 1;
          else feedback.push('bÃ¼yÃ¼k harf');

          // Lowercase
          if (/[a-z]/.test(password)) strength += 1;
          else feedback.push('kÃ¼Ã§Ã¼k harf');

          // Numbers
          if (/[0-9]/.test(password)) strength += 1;
          else feedback.push('rakam');

          // Special chars
          if (/[^A-Za-z0-9]/.test(password)) strength += 1;
          else feedback.push('Ã¶zel karakter');

          const percentage = (strength / 6) * 100;
          strengthBar.style.width = percentage + '%';

          if (strength <= 2) {
            strengthBar.style.background = '#ef4444';
            strengthText.textContent = 'ZayÄ±f - Eksik: ' + feedback.join(', ');
            strengthText.style.color = '#ef4444';
          } else if (strength <= 4) {
            strengthBar.style.background = '#f59e0b';
            strengthText.textContent = 'Orta - Ã–nerilen: ' + feedback.join(', ');
            strengthText.style.color = '#f59e0b';
          } else {
            strengthBar.style.background = '#22c55e';
            strengthText.textContent = 'Guclu sifre';
            strengthText.style.color = '#22c55e';
          }
        },

        // 2FA Setup - Real implementation
        async setup2FA() {
          // If 2FA is already enabled, show disable modal instead
          if (this.state.user?.twoFactorEnabled) {
            this._show2FADisableModal();
            return;
          }

          // Create loading modal
          const modal = document.createElement('div');
          modal.className = 'chat-auth-overlay';
          modal.id = 'twoFASetupModal';
          modal.style.cssText = 'display: flex; z-index: 10020;';
          modal.innerHTML = `
            <div class="chat-auth-panel" style="display: block; max-width: 420px; width: 90%;">
              <div class="chat-auth-header">
                <div class="chat-auth-header-spacer"></div>
                <h2>2FA Kurulumu</h2>
                <button class="chat-auth-close" onclick="document.getElementById('twoFASetupModal').remove()" aria-label="Kapat">
                  <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
              </div>
              <div style="padding: 1.5rem; text-align: center;">
                <div style="color: rgba(255,255,255,0.6); padding: 2rem 0;">Kurulum hazÄ±rlanÄ±yor...</div>
              </div>
            </div>
          `;
          document.body.appendChild(modal);
          modal.addEventListener('click', e => {
            if (e.target === modal) modal.remove();
          });

          try {
            const res = await fetch('/api/chat-auth/2fa-setup', {
              method: 'POST',
              credentials: 'include',
            });
            const data = await res.json();

            if (!data.success) {
              this.showToast(data.error || '2FA kurulumu baÅŸarÄ±sÄ±z', 'error');
              modal.remove();
              return;
            }

            // Format manual key with dashes for readability
            const formattedKey = data.manualKey.match(/.{1,4}/g)?.join('-') || data.manualKey;

            // Update modal with real QR code
            const panelContent = modal.querySelector('.chat-auth-panel');
            panelContent.innerHTML = `
              <div class="chat-auth-header">
                <div class="chat-auth-header-spacer"></div>
                <h2>2FA Kurulumu</h2>
                <button class="chat-auth-close" onclick="document.getElementById('twoFASetupModal').remove()" aria-label="Kapat">
                  <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
              </div>
              <div style="padding: 1.5rem;">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                  <div style="width: 200px; height: 200px; background: #ffffff; border-radius: 12px; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                    <img src="${data.qrCode}" alt="2FA QR Code" style="width: 100%; height: 100%; object-fit: contain;">
                  </div>
                  <p style="color: rgba(255,255,255,0.7); font-size: 0.85rem; line-height: 1.5;">
                    Google Authenticator veya benzeri bir uygulama ile QR kodu tarayÄ±n.
                  </p>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                  <div style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-bottom: 0.5rem;">Manuel GiriÅŸ Kodu:</div>
                  <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: #ffffff; letter-spacing: 1px; text-align: center; word-break: break-all; user-select: all; cursor: pointer;" title="Kopyalamak iÃ§in tÄ±klayÄ±n" onclick="navigator.clipboard.writeText('${data.manualKey}'); ChatAuth.showToast('Kod kopyalandÄ±', 'success');">
                    ${formattedKey}
                  </div>
                </div>
                <div class="chat-auth-field">
                  <label>DoÄŸrulama Kodu</label>
                  <input type="text" id="twoFAVerifyCode" placeholder="6 haneli kod girin" maxlength="6" pattern="[0-9]*" inputmode="numeric" autocomplete="one-time-code" style="text-align: center; letter-spacing: 4px; font-size: 1.2rem;">
                </div>
                <button class="chat-auth-btn" id="twoFAVerifyBtn" style="margin-top: 1rem;" onclick="ChatAuth.verify2FACode()">
                  DoÄŸrula ve EtkinleÅŸtir
                </button>
              </div>
            `;
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
            modal.remove();
          }
        },

        // Verify 2FA code - Real implementation
        async verify2FACode() {
          const code = document.getElementById('twoFAVerifyCode')?.value?.trim();
          if (!code || code.length !== 6) {
            this.showToast('6 haneli doÄŸrulama kodunu girin', 'error');
            return;
          }

          const btn = document.getElementById('twoFAVerifyBtn');
          if (btn) {
            btn.disabled = true;
            btn.textContent = 'DoÄŸrulanÄ±yor...';
          }

          try {
            const res = await fetch('/api/chat-auth/2fa-verify', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify({ code }),
            });
            const data = await res.json();

            if (data.success) {
              this.showToast('2FA baÅŸarÄ±yla etkinleÅŸtirildi', 'success');
              document.getElementById('twoFASetupModal')?.remove();
              // Update local state
              if (this.state.user) this.state.user.twoFactorEnabled = true;
              this._update2FAUIState(true);
              this.updateSecurityStatus();
            } else {
              this.showToast(data.error || 'DoÄŸrulama baÅŸarÄ±sÄ±z', 'error');
              if (btn) {
                btn.disabled = false;
                btn.textContent = 'DoÄŸrula ve EtkinleÅŸtir';
              }
            }
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'DoÄŸrula ve EtkinleÅŸtir';
            }
          }
        },

        // Show 2FA disable modal
        _show2FADisableModal() {
          const modal = document.createElement('div');
          modal.className = 'chat-auth-overlay';
          modal.id = 'twoFADisableModal';
          modal.style.cssText = 'display: flex; z-index: 10020;';
          modal.innerHTML = `
            <div class="chat-auth-panel" style="display: block; max-width: 400px; width: 90%;">
              <div class="chat-auth-header">
                <div class="chat-auth-header-spacer"></div>
                <h2>2FA Devre DÄ±ÅŸÄ± BÄ±rak</h2>
                <button class="chat-auth-close" onclick="document.getElementById('twoFADisableModal').remove()" aria-label="Kapat">
                  <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
              </div>
              <div style="padding: 1.5rem;">
                <p style="color: rgba(255,255,255,0.7); font-size: 0.85rem; line-height: 1.5; margin-bottom: 1.5rem;">
                  2FA'yÄ± devre dÄ±ÅŸÄ± bÄ±rakmak iÃ§in authenticator uygulamanÄ±zdan mevcut doÄŸrulama kodunu girin.
                </p>
                <div class="chat-auth-field">
                  <label>DoÄŸrulama Kodu</label>
                  <input type="text" id="twoFADisableCode" placeholder="6 haneli kod" maxlength="6" pattern="[0-9]*" inputmode="numeric" style="text-align: center; letter-spacing: 4px; font-size: 1.2rem;">
                </div>
                <button class="chat-auth-btn" id="twoFADisableBtn" style="margin-top: 1rem; background: rgba(239,68,68,0.2); border-color: rgba(239,68,68,0.3);" onclick="ChatAuth._confirm2FADisable()">
                  Devre DÄ±ÅŸÄ± BÄ±rak
                </button>
              </div>
            </div>
          `;
          document.body.appendChild(modal);
          modal.addEventListener('click', e => {
            if (e.target === modal) modal.remove();
          });
        },

        async _confirm2FADisable() {
          const code = document.getElementById('twoFADisableCode')?.value?.trim();
          if (!code || code.length !== 6) {
            this.showToast('6 haneli doÄŸrulama kodunu girin', 'error');
            return;
          }

          const btn = document.getElementById('twoFADisableBtn');
          if (btn) {
            btn.disabled = true;
            btn.textContent = 'Ä°ÅŸleniyor...';
          }

          try {
            const res = await fetch('/api/chat-auth/2fa-disable', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify({ code }),
            });
            const data = await res.json();

            if (data.success) {
              this.showToast('2FA baÅŸarÄ±yla devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±', 'success');
              document.getElementById('twoFADisableModal')?.remove();
              if (this.state.user) this.state.user.twoFactorEnabled = false;
              this._update2FAUIState(false);
              this.updateSecurityStatus();
            } else {
              this.showToast(data.error || 'Ä°ÅŸlem baÅŸarÄ±sÄ±z', 'error');
              if (btn) {
                btn.disabled = false;
                btn.textContent = 'Devre DÄ±ÅŸÄ± BÄ±rak';
              }
            }
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
            if (btn) {
              btn.disabled = false;
              btn.textContent = 'Devre DÄ±ÅŸÄ± BÄ±rak';
            }
          }
        },

        // Update 2FA UI elements in security panel
        _update2FAUIState(enabled) {
          const statusEl = document.getElementById('2faStatus');
          const btnEl = document.querySelector('.chat-auth-2fa-btn');
          if (statusEl) {
            statusEl.textContent = enabled ? 'Aktif' : 'Pasif';
            statusEl.style.color = enabled ? '#22c55e' : '';
          }
          if (btnEl) {
            btnEl.textContent = enabled ? '2FA Devre DÄ±ÅŸÄ± BÄ±rak' : "2FA'yÄ± EtkinleÅŸtir";
            btnEl.style.background = enabled ? 'rgba(239,68,68,0.15)' : '';
          }
        },

        // Logout all sessions
        async logoutAllSessions() {
          if (!confirm('TÃ¼m cihazlardan Ã§Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) return;

          try {
            const res = await fetch('/api/chat-auth/logout-all', {
              method: 'POST',
              credentials: 'include',
            });
            const data = await res.json();

            if (data.success) {
              this.showToast('TÃ¼m oturumlar sonlandÄ±rÄ±ldÄ±', 'success');
              this.logout();
            } else {
              this.showToast(data.error || 'Ä°ÅŸlem baÅŸarÄ±sÄ±z', 'error');
            }
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
          }
        },

        // Load active sessions
        async loadActiveSessions() {
          try {
            const res = await fetch('/api/chat-auth/sessions', { credentials: 'include' });
            const data = await res.json();

            if (data.success && data.sessions) {
              const container = document.getElementById('activeSessions');
              if (!container) return;

              container.innerHTML = data.sessions
                .map(
                  (session, i) => `
                <div class="chat-auth-session ${session.current ? 'current' : ''}">
                  <div class="chat-auth-session-icon">${session.device === 'mobile' ? 'M' : 'PC'}</div>
                  <div class="chat-auth-session-info">
                    <div class="chat-auth-session-device">
                      ${session.browser || 'Unknown Browser'}
                      ${session.current ? '<span class="current-badge">Aktif</span>' : ''}
                    </div>
                    <div class="chat-auth-session-details">${session.location || '-'} â€¢ ${session.lastActive || '-'}</div>
                  </div>
                  ${!session.current ? `<button class="chat-auth-session-logout" onclick="ChatAuth.logoutSession('${session.id}')">Ã‡Ä±kÄ±ÅŸ</button>` : ''}
                </div>
              `
                )
                .join('');
            }
          } catch (err) {
            console.warn('Sessions load failed:', err);
          }
        },

        // Logout specific session
        async logoutSession(sessionId) {
          try {
            const res = await fetch(`/api/chat-auth/sessions/${sessionId}`, {
              method: 'DELETE',
              credentials: 'include',
            });
            const data = await res.json();

            if (data.success) {
              this.showToast('Oturum sonlandÄ±rÄ±ldÄ±', 'success');
              this.loadActiveSessions();
            }
          } catch (err) {
            this.showToast('Ä°ÅŸlem baÅŸarÄ±sÄ±z', 'error');
          }
        },

        // Confirm delete account
        async confirmDeleteAccount() {
          const confirmed = confirm(
            'DIKKAT: Hesabinizi silmek uzeresiniz!\n\n' +
              'Bu iÅŸlem geri alÄ±namaz ve ÅŸunlarÄ± silecektir:\n' +
              'â€¢ TÃ¼m sohbet geÃ§miÅŸiniz\n' +
              'â€¢ TÃ¼m ayarlarÄ±nÄ±z\n' +
              'â€¢ Hesap bilgileriniz\n\n' +
              'Devam etmek istiyor musunuz?'
          );

          if (!confirmed) return;

          const finalConfirm = prompt('Onaylamak iÃ§in "HESABIMI SIL" yazÄ±n:');
          if (finalConfirm !== 'HESABIMI SIL') {
            this.showToast('Ä°ÅŸlem iptal edildi', 'info');
            return;
          }

          try {
            const res = await fetch('/api/chat-auth/account', {
              method: 'DELETE',
              credentials: 'include',
            });
            const data = await res.json();

            if (data.success) {
              this.showToast('HesabÄ±nÄ±z silindi', 'success');
              this.logout();
            } else {
              this.showToast(data.error || 'Silme iÅŸlemi baÅŸarÄ±sÄ±z', 'error');
            }
          } catch (err) {
            this.showToast('BaÄŸlantÄ± hatasÄ±', 'error');
          }
        },

        // Upload avatar
        uploadAvatar() {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = 'image/*';
          input.onchange = async e => {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 2 * 1024 * 1024) {
              this.showToast("Dosya boyutu 2MB'dan kÃ¼Ã§Ã¼k olmalÄ±", 'error');
              return;
            }

            try {
              const reader = new FileReader();
              reader.onload = event => {
                const base64 = event.target.result;

                // Create resized image
                const img = new Image();
                img.onload = () => {
                  const canvas = document.createElement('canvas');
                  const size = 128;
                  canvas.width = size;
                  canvas.height = size;
                  const ctx = canvas.getContext('2d');

                  // Crop to square (center)
                  const minDim = Math.min(img.width, img.height);
                  const sx = (img.width - minDim) / 2;
                  const sy = (img.height - minDim) / 2;
                  ctx.drawImage(img, sx, sy, minDim, minDim, 0, 0, size, size);

                  const resizedBase64 = canvas.toDataURL('image/jpeg', 0.8);
                  localStorage.setItem('lydian_avatar', resizedBase64);

                  // Update all avatar displays
                  this.updateAllAvatars(resizedBase64);

                  // Sync avatar to server for cross-device support
                  fetch('/api/chat-auth/profile', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ avatarUrl: resizedBase64 }),
                  }).catch(function () {});
                };
                img.src = base64;
              };
              reader.readAsDataURL(file);
            } catch (err) {
              this.showToast('FotoÄŸraf yÃ¼klenirken hata oluÅŸtu', 'error');
            }
          };
          input.click();
        },

        // Remove avatar
        removeAvatar() {
          localStorage.removeItem('lydian_avatar');
          this.updateAllAvatars(null);
          // Sync removal to server
          fetch('/api/chat-auth/profile', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ avatarUrl: '' }),
          }).catch(function () {});
        },

        // Update all avatar elements across the UI
        updateAllAvatars(base64) {
          const initial = this.state.user?.displayName?.charAt(0)?.toUpperCase() || 'U';
          const avatarElements = document.querySelectorAll(
            '.chat-auth-avatar, .chat-auth-avatar-large, #profileAvatar, #settingsAvatar, #headerUserAvatar, .user-avatar-img'
          );

          avatarElements.forEach(el => {
            if (base64) {
              el.style.backgroundImage = `url(${base64})`;
              el.style.backgroundSize = 'cover';
              el.style.backgroundPosition = 'center';
              el.textContent = '';
            } else {
              el.style.backgroundImage = '';
              el.textContent = initial;
            }
          });

          // Also update header user avatar if exists
          const headerAvatar = document.querySelector('.mobile-sidebar-user-avatar');
          if (headerAvatar) {
            if (base64) {
              headerAvatar.style.backgroundImage = `url(${base64})`;
              headerAvatar.style.backgroundSize = 'cover';
              headerAvatar.textContent = '';
            } else {
              headerAvatar.style.backgroundImage = '';
              headerAvatar.textContent = initial;
            }
          }
        },

        // Social login
        socialLogin(provider) {
          if (provider === 'google') {
            window.location.href = '/api/chat-auth/google-auth';
            return;
          }
          const providerName = provider === 'apple' ? 'Apple' : provider;
          this.showToast(`${providerName} ile giriÅŸ yakÄ±nda aktif olacak`, 'info');
        },

        // Update settings avatar display
        updateSettingsAvatar() {
          const avatar = document.getElementById('settingsAvatar');
          const displayNameInput = document.getElementById('settingDisplayName');
          if (this.state.user) {
            if (avatar)
              avatar.textContent = this.state.user.displayName?.charAt(0)?.toUpperCase() || 'U';
            if (displayNameInput) displayNameInput.value = this.state.user.displayName || '';
          }
          // Load saved avatar
          const savedAvatar = localStorage.getItem('lydian_avatar');
          if (savedAvatar) {
            this.updateAllAvatars(savedAvatar);
          }
        },

        // Export chat history as JSON
        async exportChatHistory() {
          try {
            this.showToast('Sohbet geÃ§miÅŸi hazÄ±rlanÄ±yor...', 'info');
            const res = await fetch('/api/chat-auth/history', { credentials: 'include' });
            const data = await res.json();

            if (data.success && data.conversations && data.conversations.length > 0) {
              // Fetch messages for each conversation
              const fullConversations = [];
              for (const conv of data.conversations) {
                try {
                  const msgRes = await fetch(`/api/chat-auth/history?id=${conv.id}`, {
                    credentials: 'include',
                  });
                  const msgData = await msgRes.json();
                  fullConversations.push({
                    id: conv.id,
                    title: conv.title,
                    model: conv.model,
                    messageCount: conv.messageCount,
                    createdAt: conv.createdAt,
                    updatedAt: conv.updatedAt,
                    messages: msgData.success ? msgData.messages || [] : [],
                  });
                } catch (e) {
                  fullConversations.push({ ...conv, messages: [] });
                }
              }

              const exportData = {
                exportDate: new Date().toISOString(),
                exportVersion: '2.0',
                user: this.state.user?.email,
                totalConversations: fullConversations.length,
                totalMessages: fullConversations.reduce(
                  (sum, c) => sum + (c.messages?.length || 0),
                  0
                ),
                conversations: fullConversations,
              };

              const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                type: 'application/json',
              });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `ailydian-chat-export-${new Date().toISOString().split('T')[0]}.json`;
              a.click();
              URL.revokeObjectURL(url);
            } else {
              this.showToast('DÄ±ÅŸa aktarÄ±lacak sohbet bulunamadÄ±', 'info');
            }
          } catch (err) {
            this.showToast('DÄ±ÅŸa aktarma baÅŸarÄ±sÄ±z', 'error');
          }
        },

        // Delete all chat history
        async deleteAllChats() {
          if (
            !confirm(
              'TÃ¼m sohbet geÃ§miÅŸinizi silmek istediÄŸinize emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz.'
            )
          )
            return;

          try {
            const res = await fetch('/api/chat-auth/history', { credentials: 'include' });
            const data = await res.json();

            if (data.success && data.conversations) {
              for (const conv of data.conversations) {
                await fetch(`/api/chat-auth/history?id=${conv.id}`, {
                  method: 'DELETE',
                  credentials: 'include',
                });
              }
            }

            // Clear local storage chats
            Object.keys(localStorage)
              .filter(k => k.startsWith('chat_'))
              .forEach(k => localStorage.removeItem(k));
            localStorage.removeItem('lydian_chat_history');

            // Clear sidebar
            const chatHistory = document.getElementById('chatHistory');
            if (chatHistory) chatHistory.innerHTML = '';

            this.showToast('Tum sohbetler silindi', 'success');
          } catch (err) {
            this.showToast('Silme iÅŸlemi baÅŸarÄ±sÄ±z', 'error');
          }
        },

        // Update security status dynamically
        updateSecurityStatus() {
          const statusEl = document.getElementById('securityStatus');
          const titleEl = statusEl?.querySelector('.chat-auth-security-title');
          const descEl = statusEl?.querySelector('.chat-auth-security-desc');
          const iconEl = statusEl?.querySelector('.chat-auth-security-icon svg');

          if (!statusEl) return;

          const has2FA = this.state.user?.twoFactorEnabled === true;
          const hasStrongPassword = true; // Assume true if logged in

          if (has2FA && hasStrongPassword) {
            statusEl.className = 'chat-auth-security-status good';
            if (titleEl) titleEl.textContent = 'GÃ¼venlik Durumu: MÃ¼kemmel';
            if (descEl) descEl.textContent = 'HesabÄ±nÄ±z tam koruma altÄ±nda';
            if (iconEl)
              iconEl.innerHTML =
                '<path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>';
          } else if (hasStrongPassword) {
            statusEl.className = 'chat-auth-security-status warning';
            if (titleEl) titleEl.textContent = 'GÃ¼venlik Durumu: Ä°yi';
            if (descEl)
              descEl.textContent = '2FA aktif deÄŸil - HesabÄ±nÄ±zÄ± korumak iÃ§in etkinleÅŸtirin';
          } else {
            statusEl.className = 'chat-auth-security-status danger';
            if (titleEl) titleEl.textContent = 'GÃ¼venlik Durumu: DÃ¼ÅŸÃ¼k';
            if (descEl) descEl.textContent = 'Åžifrenizi gÃ¼Ã§lendirin ve 2FA etkinleÅŸtirin';
          }
        },
      };

      // Initialize on DOM ready
      document.addEventListener('DOMContentLoaded', () => ChatAuth.init());
    </script>

    <!-- Desktop Chat History Drawer HTML -->
    <div class="desktop-history-drawer-backdrop" id="desktopHistoryBackdrop"></div>
    <div class="desktop-history-drawer" id="desktopHistoryDrawer">
      <div class="desktop-history-header">
        <div class="desktop-drawer-logo">
          <svg
            class="logo-icon"
            viewBox="0 0 512 512"
            width="32"
            height="32"
            fill="none"
            stroke="currentColor"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <circle cx="256" cy="256" r="230" stroke-width="6" />
            <circle cx="256" cy="256" r="210" stroke-width="4" />
            <g stroke-width="5">
              <path d="M 256 80 Q 245 100, 250 120" stroke-linecap="round" />
              <path d="M 230 110 Q 210 105, 195 120 Q 188 135, 200 150 Q 215 160, 232 148 Z" />
              <path d="M 275 105 Q 295 100, 310 115 Q 317 130, 305 145 Q 290 155, 273 143 Z" />
              <path d="M 253 95 Q 265 90, 275 100 Q 280 110, 272 120 Q 263 125, 255 118 Z" />
              <circle cx="256" cy="160" r="24" />
              <circle cx="220" cy="200" r="23" />
              <circle cx="256" cy="205" r="23" />
              <circle cx="292" cy="200" r="23" />
              <circle cx="190" cy="245" r="22" />
              <circle cx="230" cy="250" r="22" />
              <circle cx="282" cy="250" r="22" />
              <circle cx="322" cy="245" r="22" />
              <circle cx="218" cy="295" r="21" />
              <circle cx="256" cy="300" r="21" />
              <circle cx="294" cy="295" r="21" />
              <circle cx="235" cy="340" r="20" />
              <circle cx="277" cy="340" r="20" />
              <circle cx="256" cy="380" r="19" />
            </g>
          </svg>
          <span class="logo-text">LyDian</span>
        </div>
        <button class="desktop-history-close" id="desktopHistoryClose">
          <svg
            viewBox="0 0 24 24"
            width="20"
            height="20"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="3" width="18" height="18" rx="2.5"></rect>
            <path d="M9 3v18"></path>
            <line x1="13" y1="8" x2="18" y2="8"></line>
            <line x1="13" y1="12" x2="16" y2="12"></line>
          </svg>
        </button>
      </div>
      <button class="desktop-history-new-chat" id="desktopHistoryNewChat">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
        </svg>
        Yeni Sohbet
      </button>
      <div class="desktop-history-search">
        <input type="text" id="desktopHistorySearch" placeholder="Sohbetlerde ara..." />
      </div>
      <div class="desktop-history-list" id="desktopHistoryList">
        <div class="desktop-history-empty" id="desktopHistoryEmpty">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          <p>HenÃ¼z kayÄ±tlÄ± sohbet yok</p>
        </div>
      </div>
    </div>

    <script>
      // ============================================================
      // Desktop Chat History Drawer
      // ============================================================
      (function () {
        const toggle = document.getElementById('desktopHistoryToggle');
        const drawer = document.getElementById('desktopHistoryDrawer');
        const backdrop = document.getElementById('desktopHistoryBackdrop');
        const closeBtn = document.getElementById('desktopHistoryClose');
        const searchInput = document.getElementById('desktopHistorySearch');
        const historyList = document.getElementById('desktopHistoryList');
        const emptyState = document.getElementById('desktopHistoryEmpty');
        const newChatBtn = document.getElementById('desktopHistoryNewChat');

        if (!toggle || !drawer) return;

        function openDrawer() {
          drawer.classList.add('open');
          backdrop.classList.add('open');
          loadDesktopHistory();
        }

        function closeDrawer() {
          drawer.classList.remove('open');
          backdrop.classList.remove('open');
        }

        toggle.addEventListener('click', openDrawer);
        backdrop.addEventListener('click', closeDrawer);
        closeBtn.addEventListener('click', closeDrawer);

        if (newChatBtn) {
          newChatBtn.addEventListener('click', function () {
            closeDrawer();
            if (typeof startNewChat === 'function') {
              startNewChat();
            } else if (document.getElementById('desktopNewChatBtn')) {
              document.getElementById('desktopNewChatBtn').click();
            }
          });
        }

        function gatherChats() {
          var chats = [];

          // From lydian_chat_history
          try {
            var savedChats = JSON.parse(localStorage.getItem('lydian_chat_history') || '[]');
            savedChats.forEach(function (chat) {
              chats.push({
                id: chat.id || Date.now().toString(),
                title: chat.title || chat.preview || 'Sohbet',
                time: chat.savedAt || chat.timestamp || new Date().toISOString(),
                source: 'history',
              });
            });
          } catch (e) {}

          // From chat_* keys
          Object.keys(localStorage)
            .filter(function (k) {
              return k.startsWith('chat_');
            })
            .forEach(function (key) {
              try {
                var data = JSON.parse(localStorage.getItem(key));
                if (data && data.messages && Array.isArray(data.messages)) {
                  if (
                    !chats.find(function (c) {
                      return c.id === data.id;
                    })
                  ) {
                    chats.push({
                      id: data.id || key,
                      title: data.title || data.preview || 'Sohbet',
                      time: data.savedAt || data.timestamp || new Date().toISOString(),
                      source: 'storage',
                    });
                  }
                }
              } catch (e) {}
            });

          // Sort by time (newest first)
          chats.sort(function (a, b) {
            return new Date(b.time) - new Date(a.time);
          });
          return chats;
        }

        function loadDesktopHistory() {
          var chats = gatherChats();
          renderHistory(chats);
        }

        // Date group helper: returns group label for a date
        function getDateGroupLabel(dateStr) {
          try {
            var date = new Date(dateStr);
            var now = new Date();
            var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            var yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            var weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            var monthAgo = new Date(today);
            monthAgo.setDate(monthAgo.getDate() - 30);

            if (date >= today) return 'BugÃ¼n';
            if (date >= yesterday) return 'DÃ¼n';
            if (date >= weekAgo) return 'Son 7 GÃ¼n';
            if (date >= monthAgo) return 'Son 30 GÃ¼n';
            return 'Daha Eski';
          } catch (e) {
            return 'Daha Eski';
          }
        }

        function renderHistory(chats, filter) {
          if (!historyList) return;

          var filtered = filter
            ? chats.filter(function (c) {
                return c.title.toLowerCase().includes(filter.toLowerCase());
              })
            : chats;

          if (filtered.length === 0) {
            historyList.innerHTML =
              '<div class="desktop-history-empty">' +
              '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">' +
              '<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>' +
              '</svg>' +
              '<p>' +
              (filter ? 'SonuÃ§ bulunamadÄ±' : 'HenÃ¼z kayÄ±tlÄ± sohbet yok') +
              '</p>' +
              '</div>';
            return;
          }

          // Group by date
          var html = '';
          var lastGroup = '';
          filtered.forEach(function (chat) {
            var group = getDateGroupLabel(chat.time);
            if (group !== lastGroup) {
              html += '<div class="chat-date-group-header">' + group + '</div>';
              lastGroup = group;
            }
            var timeStr = formatRelativeTime(chat.time);
            html +=
              '<div class="desktop-history-item" data-chat-id="' +
              chat.id +
              '" style="display: flex; align-items: center; justify-content: space-between;">' +
              '<div style="flex: 1; min-width: 0; cursor: pointer;" data-load-chat="' +
              chat.id +
              '">' +
              '<div class="desktop-history-item-title">' +
              escapeHtml(chat.title) +
              '</div>' +
              '<div class="desktop-history-item-time">' +
              timeStr +
              '</div>' +
              '</div>' +
              '<button class="desktop-history-item-delete" data-delete-chat="' +
              chat.id +
              '" title="Sil">' +
              '<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">' +
              '<polyline points="3 6 5 6 21 6"></polyline>' +
              '<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>' +
              '</svg>' +
              '</button>' +
              '</div>';
          });
          historyList.innerHTML = html;

          // Attach click handlers
          historyList.querySelectorAll('[data-load-chat]').forEach(function (el) {
            el.addEventListener('click', function () {
              var chatId = this.getAttribute('data-load-chat');
              closeDrawer();
              if (typeof loadChatFromHistory === 'function') {
                loadChatFromHistory(chatId);
              }
            });
          });

          historyList.querySelectorAll('[data-delete-chat]').forEach(function (el) {
            el.addEventListener('click', function (e) {
              e.stopPropagation();
              var chatId = this.getAttribute('data-delete-chat');
              deleteDesktopHistoryItem(chatId, this);
            });
          });
        }

        function formatRelativeTime(dateStr) {
          try {
            var date = new Date(dateStr);
            var now = new Date();
            var diff = now - date;
            var mins = Math.floor(diff / 60000);
            var hours = Math.floor(diff / 3600000);
            var days = Math.floor(diff / 86400000);

            if (mins < 1) return 'Az once';
            if (mins < 60) return mins + ' dk once';
            if (hours < 24) return hours + ' saat once';
            if (days < 7) return days + ' gun once';
            return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' });
          } catch (e) {
            return '';
          }
        }

        function escapeHtml(str) {
          var div = document.createElement('div');
          div.textContent = str;
          return div.innerHTML;
        }

        // Search functionality
        if (searchInput) {
          searchInput.addEventListener('input', function (e) {
            var chats = gatherChats();
            renderHistory(chats, e.target.value);
          });
        }

        // Delete function
        window.deleteDesktopHistoryItem = function (chatId, btnEl) {
          if (!confirm('Bu sohbeti silmek istediginize emin misiniz?')) return;

          // Remove from lydian_chat_history
          try {
            var saved = JSON.parse(localStorage.getItem('lydian_chat_history') || '[]');
            var filtered = saved.filter(function (c) {
              return (c.id || '') !== chatId;
            });
            localStorage.setItem('lydian_chat_history', JSON.stringify(filtered));
          } catch (e) {}

          // Remove chat_* key
          localStorage.removeItem('chat_' + chatId);
          localStorage.removeItem(chatId);

          // Remove from UI with animation
          var item = btnEl.closest('.desktop-history-item');
          if (item) {
            item.style.transition = 'opacity 0.2s, transform 0.2s';
            item.style.opacity = '0';
            item.style.transform = 'translateX(-20px)';
            setTimeout(function () {
              item.remove();
              if (historyList.querySelectorAll('.desktop-history-item').length === 0) {
                loadDesktopHistory();
              }
            }, 200);
          }

          if (typeof showToast === 'function') {
            showToast('Sohbet silindi', 'success');
          }
        };

        // Keyboard shortcut: Escape to close
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape' && drawer.classList.contains('open')) {
            closeDrawer();
          }
        });

        // Expose globally so saveCurrentChat() can refresh the drawer
        window.loadDesktopHistory = loadDesktopHistory;
      })();
    </script>

    <script src="/js/mobile-menu-handler.js"></script>
    <!-- Visitor Location & VPN Detection -->
    <script src="/js/visitor-info.js"></script>
    <!-- Voice Chat Module -->
    <script src="/js/voice-chat.js"></script>
    <script src="/js/location-permission.js"></script>
    <!-- File Analyzer Module -->
    <script src="/js/file-analyzer.js"></script>

    <!-- Auto Permission Prompts on Page Load -->
    <script>
      // Permissions are requested on-demand when user clicks voice/location buttons
      // No auto-prompts on page load (better UX - no modal stacking)
    </script>
    <!-- Code Side Panel (Manus-style) -->
    <div id="codeSidePanel" class="code-side-panel">
      <div class="side-panel-header">
        <div class="code-preview-tabs">
          <div class="code-preview-tab active" data-view="preview">GÃ¶r</div>
          <div class="code-preview-tab" data-view="code">Kod</div>
        </div>
        <div style="display: flex; gap: 8px; align-items: center">
          <button class="code-preview-tab" id="sidePanelRefresh">Yenile</button>
          <button class="code-preview-close-btn" id="sidePanelClose">&times;</button>
        </div>
      </div>
      <iframe
        id="sidePanelIframe"
        class="side-panel-iframe"
        sandbox="allow-scripts allow-modals"
      ></iframe>
      <pre id="sidePanelSource" class="side-panel-source"></pre>
    </div>
  </body>
</html>
